sap.ui.define(["sap/ui/core/Core","sap/gantt/library","sap/ui/base/ManagedObjectObserver","sap/ui/core/Item","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/FlexBox","sap/m/FlexDirection","sap/m/Button","sap/m/ButtonType","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/m/ViewSettingsDialog","sap/m/ViewSettingsCustomTab","sap/m/PlacementType","sap/m/CheckBox","sap/m/Slider","sap/m/Popover","../control/AssociateContainer"],function(C,l,M,a,O,b,T,F,c,B,d,S,e,f,V,g,P,h,j,k,A){"use strict";var G=l.simple.GanttChartWithTableDisplayType;var n=O.extend("sap.gantt.simple.ContainerToolbar",{metadata:{properties:{showBirdEyeButton:{type:"boolean",defaultValue:false},showDisplayTypeButton:{type:"boolean",defaultValue:false},showLegendButton:{type:"boolean",defaultValue:false},showSettingButton:{type:"boolean",defaultValue:true},showTimeZoomControl:{type:"boolean",defaultValue:true},zoomControlType:{type:"sap.gantt.config.ZoomControlType",defaultValue:l.config.ZoomControlType.SliderWithButtons},stepCountOfSlider:{type:"int",defaultValue:10},infoOfSelectItems:{type:"object[]",defaultValue:[]},zoomLevel:{type:"int",defaultValue:0}},aggregations:{settingItems:{type:"sap.gantt.config.SettingItem",multiple:true},legendContainer:{type:"sap.ui.core.Control",multiple:false,visibility:"public"}},events:{zoomStopChange:{parameters:{index:{type:"int"},selectedItem:{type:"sap.ui.core.Item"}}},birdEyeButtonPress:{},displayTypeChange:{parameters:{displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType"}}}}}});n.prototype.init=function(){O.prototype.init.apply(this,arguments);this.mSettingsConfig={};this._oRb=C.getLibraryResourceBundle("sap.gantt");this.oObserver=new M(this.observePropertiesChanges.bind(this));this.oObserver.observe(this,{properties:["showBirdEyeButton","showLegendButton","showTimeZoomControl","showSettingButton","zoomControlType","infoOfSelectItems","showDisplayTypeButton"]});this.bShallUpdateContent=true;this.bZoomControlTypeChanged=false;this._bSuppressZoomStopChange=false;this.oToolbarSpacer=new T();};n.prototype.observePropertiesChanges=function(o){this.bShallUpdateContent=true;this.bZoomControlTypeChanged=o.name==="zoomControlType";};n.prototype.exit=function(){this.oObserver.disconnect();};n.prototype.applySettings=function(s,i){s=s||{};if(!s.settingItems){s.settingItems=l.config.DEFAULT_TOOLBAR_SETTING_ITEMS.map(function(o){return o.clone();});}O.prototype.applySettings.apply(this,arguments);this._createControlsOnly();return this;};n.prototype.onBeforeRendering=function(){if(this.bShallUpdateContent===true){this.updateToolbarContents();this.bShallUpdateContent=false;this.bZoomControlTypeChanged=false;}};n.prototype.updateToolbarContents=function(){var N=function(o){return this.getContent().indexOf(o)===-1;}.bind(this);if(N(this.oToolbarSpacer)){this._addToolbarContent(this.oToolbarSpacer);}var i=this.getContent().indexOf(this.oToolbarSpacer)+1;var I=function(s,o){if(s&&N(o)){this.insertContent(o,i);i++;}else if(!s&&!N(o)){this.removeContent(o);}else if(s&&!N(o)){i++;}}.bind(this);I(this.getShowBirdEyeButton(),this._genBirdEyeButton());if(this.bZoomControlTypeChanged){var p=[this._oZoomOutButton,this._oZoomSlider,this._oSelect,this._oZoomInButton];p.forEach(function(o){if(!N(o)){this.removeContent(o);}}.bind(this));}var t=this._genTimeZoomGroupControls();if(t){t.forEach(function(o){I(this.getShowTimeZoomControl(),o);}.bind(this));}I(this.getShowLegendButton(),this._genLegend());I(this.getShowSettingButton(),this._genSettings());I(this.getShowDisplayTypeButton(),this._genDisplayTypeButton());};n.prototype._addToolbarContent=function(v){if(jQuery.isArray(v)){for(var m=0;m<v.length;m++){this.addContent(v[m]);}}else if(v){this.addContent(v);}};n.prototype._createControlsOnly=function(){this._genBirdEyeButton();this._genTimeZoomGroupControls();this._genLegend();this._genSettings();this._genDisplayTypeButton();};n.prototype._genDisplayTypeButton=function(){if(this._oDisplayTypeSegmentedButton){return this._oDisplayTypeSegmentedButton;}this._oDisplayTypeSegmentedButton=new S({selectedKey:G.Both,selectionChange:function(E){this.fireDisplayTypeChange({displayType:E.getParameter("item").getKey()});}.bind(this),items:[new e({tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_BOTH"),icon:"sap-icon://Chart-Tree-Map",key:G.Both}),new e({tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_CHART"),icon:"sap-icon://along-stacked-chart",key:G.Chart}),new e({tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_TABLE"),icon:"sap-icon://table-view",key:G.Table})]});};n.prototype._genBirdEyeButton=function(){if(this._oBirdEyeButton==null){var i=function(r){var s=r.getText("TXT_BRIDEYE"),t=r.getText("TXT_BRIDEYE_RANGE_VISIBLE_ROWS"),m=r.getText("TLTP_BRIDEYE_ON_VISIBLE_ROWS");return s+"("+t+"): "+m;};this._oBirdEyeButton=new B({icon:"sap-icon://show",type:d.Transparent,tooltip:i(this._oRb),press:function(E){this.fireBirdEyeButtonPress();}.bind(this)});}return this._oBirdEyeButton;};n.prototype._getSelectItems=function(){var s=[],I=this.getInfoOfSelectItems();if(I.length>0){if(I[0]instanceof a){s=I;}else{for(var i=0;i<I.length;i++){var o=new a({key:I[i].key,text:I[i].text});s.push(o);}}}return s;};n.prototype._genTimeZoomGroupControls=function(){var Z=l.config.ZoomControlType;var z=this.getZoomControlType();var L=new b({priority:sap.m.OverflowToolbarPriority.NeverOverflow});var u=function(m){jQuery.sap.clearDelayedCall(this._iLiveChangeTimer);this._iLiveChangeTimer=-1;this.setZoomLevel(m,true);};this.fireEvent("_zoomControlTypeChange",{zoomControlType:z});if(z===Z.None){return[];}if(z===Z.Select){if(this._oSelect){return[this._oSelect];}var s=this._getSelectItems();this._oSelect=new f({items:s,selectedItem:s[this.getZoomLevel()],layoutData:L,change:function(E){var o=E.getSource();var m=o.getSelectedItem();var p=o.indexOfItem(m);this._iLiveChangeTimer=jQuery.sap.delayedCall(200,this,u,[p,m]);}.bind(this)});return[this._oSelect];}else{if(this._oZoomSlider){this._oZoomSlider.setMax(this.getStepCountOfSlider()-1);if(z===Z.SliderOnly){return[this._oZoomSlider];}else if(z===Z.ButtonsOnly){return[this._oZoomOutButton,this._oZoomInButton];}else{return[this._oZoomOutButton,this._oZoomSlider,this._oZoomInButton];}}this._oZoomSlider=new j({width:"200px",layoutData:L,max:this.getStepCountOfSlider()-1,value:this.getZoomLevel(),min:0,step:1,liveChange:function(E){var m=parseInt(E.getParameter("value"),10);jQuery.sap.clearDelayedCall(this._iLiveChangeTimer);this._iLiveChangeTimer=jQuery.sap.delayedCall(200,this,u,[m]);}.bind(this)});var i=function(m){return function(E){this._iLiveChangeTimer=jQuery.sap.delayedCall(200,this,function(){var o=parseInt(m?this._oZoomSlider.stepUp(1).getValue():this._oZoomSlider.stepDown(1).getValue(),10);u.call(this,o);});};};this._oZoomInButton=new B({icon:"sap-icon://zoom-in",type:d.Transparent,tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_IN"),layoutData:L.clone(),press:i(true).bind(this)});this._oZoomOutButton=new B({icon:"sap-icon://zoom-out",type:d.Transparent,tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_OUT"),layoutData:L.clone(),press:i(false).bind(this)});return[this._oZoomOutButton,this._oZoomSlider,this._oZoomInButton];}};n.prototype._genSettings=function(){if(this._oSettingsButton){return this._oSettingsButton;}var i=this.getSettingItems().map(function(s){return new h({name:s.getKey(),text:s.getDisplayText(),tooltip:s.getTooltip(),selected:s.getChecked()}).addStyleClass("sapUiSettingBoxItem");});this._oSettingsBox=new F({direction:c.Column,items:i}).addStyleClass("sapUiSettingBox");this._oSettingsDialog=new V({title:this._oRb.getText("SETTINGS_DIALOG_TITLE"),customTabs:[new g({content:this._oSettingsBox})],confirm:function(){this._fireSettingItemChangedEvent();}.bind(this),cancel:function(){this.updateSettingItems(this.mSettingsConfig);}.bind(this)});this._oSettingsButton=new B({icon:"sap-icon://action-settings",type:d.Transparent,tooltip:this._oRb.getText("TLTP_CHANGE_SETTINGS"),layoutData:new b({priority:sap.m.OverflowToolbarPriority.High}),press:function(E){this._oSettingsDialog.open();}.bind(this)});return this._oSettingsButton;};n.prototype._genLegend=function(){if(this._oLegendButton){return this._oLegendButton;}if(!this._oLegendPop){this._oLegendPop=new k({placement:P.Bottom,showArrow:false,showHeader:false});}this._oLegendButton=new B({icon:"sap-icon://legend",type:d.Transparent,tooltip:this._oRb.getText("TLTP_SHOW_LEGEND"),layoutData:new b({priority:sap.m.OverflowToolbarPriority.High,closeOverflowOnInteraction:false}),press:function(E){var L=this._oLegendPop;if(L.isOpen()){L.close();}else{L.openBy(this._oLegendButton);}}.bind(this)});return this._oLegendButton;};n.prototype.updateZoomLevel=function(z){this._bSuppressZoomStopChange=true;this.setZoomLevel(z);};n.prototype.setZoomLevel=function(z,i){if(!isNaN(z)){var m=this.getZoomLevel();if(m!==z){this.setProperty("zoomLevel",z,i);if(this._oZoomSlider){this._oZoomSlider.setValue(z);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:z});}}if(this._oSelect){this._oSelect.setSelectedItem(this._oSelect.getItems()[z]);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:z,selectedItem:this._oSelect.getSelectedItem()});}}if(this._oZoomOutButton&&this._oZoomInButton){var o=this._oZoomSlider.getMax(),p=this._oZoomSlider.getMin();if(z===o){this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true);}else if(z===p){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(false);}else{this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true);}}}}this._bSuppressZoomStopChange=false;return this;};n.prototype.setLegendContainer=function(L){this.setAggregation("legendContainer",L);if(!this._oLegendPop){this._oLegendPop=new k({placement:P.Bottom,showArrow:false,showHeader:false});}if(L){this._oLegendPop.removeAllContent();this._oLegendPop.addContent(new A({content:L}));}};n.prototype._fireSettingItemChangedEvent=function(){var s=this._oSettingsBox.getItems();var m=[];for(var i=0;i<s.length;i++){var o=s[i].getName(),p=o.substr(4),q=this.mSettingsConfig[p],N=s[i].getSelected();if(q!==N){m.push({name:o,value:N});}}if(m.length>0){this.fireEvent("_settingsChange",m);}};n.prototype.updateSettingsConfig=function(m){Object.keys(m).forEach(function(p){this.mSettingsConfig[p]=m[p];}.bind(this));this.updateSettingItems(m);};n.prototype.updateSettingItems=function(m){var s=this._oSettingsBox.getItems();Object.keys(m).forEach(function(p){var o=s.filter(function(i){return i.getName().endsWith(p);})[0];if(o){o.setSelected(m[p]);}});};n.prototype.getAllToolbarItems=function(){return this.getContent();};n.prototype.setInfoOfSelectItems=function(i,s){this.setProperty("infoOfSelectItems",i,s);var t=this;if(this._oSelect){var m=this._getSelectItems();this._oSelect.removeAllItems();m.forEach(function(o){t._oSelect.addItem(o);});}};return n;},true);
