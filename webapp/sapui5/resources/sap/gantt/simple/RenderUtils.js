/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["./BaseText","./AggregationUtils","./GanttUtils"],function(B,A,G){"use strict";var R={RENDER_EXTEND_FACTOR:0.382,getGanttRenderWidth:function(g){var v=jQuery.sap.byId(g.getId()+"-gantt").width();return v*(1+2*R.RENDER_EXTEND_FACTOR);},renderAttributes:function(r,e,a){var p=a.map(function(b){var P=b.split("-").reduce(function(c,n){return c+n.charAt(0).toUpperCase()+n.slice(1);},"get");return{name:b,value:e[P]()};});p.forEach(function(o){if(o.value||o.value===0){r.writeAttribute(o.name,o.value);}});},renderTooltip:function(r,e){if(e.getTooltip()){r.write("<title>");r.write(e.getTooltip());r.write("</title>");}},updateShapeSelections:function(g,s,d){if(g._getResizeExtension==null){return;}var r=g._getResizeExtension();var c=g.getId();var D=G.getShapesWithUid(c,d);D.forEach(function(E){if(E){E.setProperty("selected",false,true);}});r.clearAllOutline(c);var e=G.getShapesWithUid(c,s);e.forEach(function(E){if(E){E.setProperty("selected",true,true);r.toggleOutline(E);g.getSelection().updateTime(E.getShapeUid(),{time:E.getTime(),endTime:E.getEndTime()});}});},renderElementTitle:function(r,e){if(e.getShowTitle==null||!e.getShowTitle()){return;}var t=e.getTitle();if(t){var h=0,E=0;if(e.getWidth){E=e.getWidth();}if(e.getHeadWidth){h=e.getHeadWidth();E-=h;}if(e.getTailWidth){E-=e.getTailWidth();}var l=2+h,d=12;var T={x:e.getX()+l,y:e.getRowYCenter()+d/2,text:t,fill:"#000",showEllipsis:true,truncateWidth:E};var o=new B(T).addStyleClass("sapGanttTextNoPointerEvents");o.setProperty("childElement",true,true);o.renderElement(r,o);}},renderInlineShapes:function(r,o,g){var t=o.getId()+"-top";var s=o.getId()+"-row";r.write("<g");r.writeElementData(o);r.addClass(t);r.writeClasses();r.write(">");r.write("<g");r.writeAttribute(G.ROW_ID_DATASET_KEY,o.getRowId()||"");r.addClass(s);r.writeClasses();r.write(">");this.renderMainRowAllShapes(r,o,g);r.write("</g>");r.write("</g>");},renderMainRowAllShapes:function(r,o,g){var a=g.getSyncedControl().getRowStates();var p=this.calcRowDomPosition(o,a),m=p.rowYCenter,i=p.rowHeight;var b=A.getNonLazyAggregations(o);var s=Object.keys(b).filter(function(n){return n!=="calendars"&&n!=="relationships";}).map(function(n){return o.getAggregation(n)||[];}.bind(o));var c=o.getRowUid(),S=g.oSelection,e=g._oExpandModel,d=g.getAxisTime(),h=e.isRowExpanded(c);s.forEach(function(f,I){f.forEach(function(j){if(g.isShapeVisible(j)){R.renderMainRowShape(r,j,{expandModel:e,selectionModel:S,axisTime:d,rowSetting:o,rowUid:c,rowExpanded:h,mainRowYCenter:m,rowHeight:i});}});});},renderMainRowShape:function(r,s,o){this.setSpecialProperties(s,o);s.renderElement(r,s,null);if(o.rowExpanded){this.renderExpandShapesIfNecessary(r,s,o);}},setSpecialProperties:function(s,o){var e=o.expandModel,r=o.rowUid,S=o.rowSetting.getShapeUid(s);s._iBaseRowHeight=o.rowHeight;s.mAxisTime=o.axisTime;s.setProperty("shapeUid",S,true);s.setProperty("selected",o.selectionModel.existed(S),true);s.setProperty("rowYCenter",e.getRowYCenterByUid(r,o.mainRowYCenter,s.getScheme(),0),true);},isValidD:function(d){return!!d&&d.indexOf("NaN")===-1&&d.indexOf("undefined")===-1&&d.indexOf("null")===-1;},renderExpandShapesIfNecessary:function(r,m,o){var f=function(s){if(!s||s.length===0){return;}var e=s;if(jQuery.isArray(s)===false){e=[s];}e.forEach(function(S,i){S.setProperty("rowYCenter",o.expandModel.getRowYCenterByUid(o.rowUid,null,S.getScheme(),i),true);S._iBaseRowHeight=o.expandModel.getExpandShapeHeightByUid(o.rowUid,S.getScheme(),o.iRowHeight);S.setProperty("shapeUid",o.rowSetting.getShapeUid(S),true);S.renderElement(r,S);});};var a=A.getLazyAggregations(m);Object.keys(a).forEach(function(n){var s=m.getAggregation(n);f(s);});},calcRowDomPosition:function(r,a){var o=r._getRow(),t=o.getParent(),i=t.indexOfRow(o);var b=a[i].height;var c=0;for(var I=0;I<=i;I++){c+=a[I].height;}c-=b/2;return{rowYCenter:c,rowHeight:b};}};return R;},true);
