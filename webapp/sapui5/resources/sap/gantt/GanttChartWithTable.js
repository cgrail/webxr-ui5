/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/Device","./GanttChartBase","sap/ui/table/Column","sap/ui/table/TreeTable","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./GanttChart","./control/Cell","./control/Toolbar","./control/AssociateContainer","./drawer/SelectionPanel","./eventHandler/MouseWheelHandler","sap/ui/thirdparty/d3"],function(D,G,C,T,S,a,b,c,d,A,e,M){"use strict";var f=G.extend("sap.gantt.GanttChartWithTable",{metadata:{designtime:"sap/gantt/designtime/GanttChartWithTable.designtime",properties:{cellCallback:{type:"object"},fixedColumnCount:{type:"int"}},aggregations:{customToolbarItems:{type:"sap.ui.core.Control",multiple:true,visibility:"public",singularName:"customToolbarItem",bindable:"bindable"},columns:{type:"sap.ui.table.Column",multiple:true,visibility:"public",singularName:"column"},_selectionPanel:{type:"sap.ui.table.TreeTable",multiple:false,visibility:"hidden"},_chart:{type:"sap.gantt.GanttChart",multiple:false,visibility:"hidden"}}}});f.prototype.init=function(){G.prototype.init.apply(this,arguments);jQuery.sap.measure.start("GanttChartWithTable Init","GanttPerf:GanttChartWithTable Init function");this._oGanttChart=new b();this.setAggregation("_chart",this._oGanttChart);this._oGanttChartCnt=new A({enableRootDiv:true,content:this._oGanttChart});this._oTC=this._oGanttChart._oTT;var t=this;this._oTT=new T({visibleRowCountMode:"Auto",minAutoRowCount:1});jQuery.extend(this.mDefaultTableProperties,{fixedColumnCount:0,showColumnVisibilityMenu:false,selectionBehavior:sap.ui.table.SelectionBehavior.Row});this.setTableProperties(jQuery.extend({},this.mDefaultTableProperties));this._oTT._bVariableRowHeightEnabled=true;this._oTT._collectRowHeights=function(h){var H=T.prototype._collectRowHeights.apply(this,arguments);if(h){return H;}t._aHeights=H;var B=t._aHeights[0];var F=t._getTTFirstRenderingRowIndex();var r=t._aHeights.length;var m=B;var s=t._oGanttChart._getDrawingData([F,F+r-1]);if(s&&s.length>0){m=s[0].rowSpan*B;}for(var i=0;i<r;i++){var o=this.getContextByIndex(F+i);if(o){var g=o.getObject();var u=g?g.uid:undefined;if(u&&t._oGanttChart._oRowStatusMap[u]){t._aHeights[i]=t._oGanttChart._oRowStatusMap[u].visibleRowSpan*B;}else{t._aHeights[i]=m;}}else{t._aHeights[i]=B;}}return t._aHeights;};this._oTT._updateTableContent=function(){sap.ui.table.TreeTable.prototype._updateTableContent.apply(this,arguments);var r=this.getRows(),R=t._getRowHeights();if(!R){return;}var $=this.$().find(".sapUiTableCtrlFixed > tbody > tr.sapUiTableTr");var g=this.$().find(".sapUiTableRowHdr");for(var i=0;i<r.length;i++){var h=r[i].$(),j=$.filter(":eq("+i+")"),k=g.filter(":eq("+i+")"),H=R[i]||0;var B=t._oGanttChart.getBaseRowHeight();var l=H/B>1;h.toggleClass('sapGanttExpandedRow',l);j.toggleClass('sapGanttExpandedRow',l);k.toggleClass('sapGanttExpandedRow',l);}};this._oTT.addEventDelegate({onAfterRendering:this._bindVerticalScrollForTT},this);this._oTT.attachToggleOpenState(function(E){t.fireTreeTableToggleEvent({rowIndex:E.getParameter("rowIndex"),rowContext:E.getParameter("rowContext"),expanded:E.getParameter("expanded")});});this._oTT.attachEvent("_rowsUpdated",this._onTTRowUpdate.bind(this));this.setAggregation("_selectionPanel",this._oTT);this._oToolbar=new d({type:sap.gantt.control.ToolbarType.Local,sourceId:sap.gantt.config.DEFAULT_HIERARCHY_KEY});this._oToolbar.data("holder",this);this._oToolbar.attachSourceChange(this._onToolbarSourceChange,this);this._oToolbar.attachExpandChartChange(this._onToolbarExpandChartChange,this);this._oToolbar.attachExpandTreeChange(this._onToolbarExpandTreeChange,this);this._oToolbar.attachModeChange(this._onToolbarModeChange,this);this._oToolbar.attachBirdEye(this._onToolbarBirdEye,this);this._oTT.addExtension(this._oToolbar);this._oSelectionPanelCnt=new A({enableRootDiv:true,content:this._oTT,layoutData:new a({size:"30%"})});this._oSplitter=new S({width:"100%",height:"100%",orientation:sap.ui.core.Orientation.Horizontal,contentAreas:[this._oSelectionPanelCnt,this._oGanttChartCnt]}).addStyleClass("sapGanttViewSplitterH");this._oSplitter.attachResize(this._onSplitterResize,this);this._oGanttChart.attachHorizontalScroll(this._onChartHSbScroll,this);this._oGanttChart.attachVerticalScroll(this._onChartVSbScroll,this);this._oGanttChart.attachRowSelectionChange(this._onRowSelectionChange,this);this._oGanttChart.attachShapeSelectionChange(this._onShapeSelectionChange,this);this._oGanttChart.attachChartMouseOver(this._onChartMouseOver,this);this._oGanttChart.attachRelationshipSelectionChange(this._onRelationshipSelectionChange,this);this._oGanttChart.attachChartClick(this._onClick,this);this._oGanttChart.attachChartDoubleClick(this._onDoubleClick,this);this._oGanttChart.attachChartRightClick(this._onRightClick,this);this._oGanttChart.attachEvent("_zoomInfoUpdated",this._onZoomInfoUpdated,this);this._oGanttChart.attachEvent("_shapesUpdated",this._onShapesUpdated,this);this._oGanttChart.attachChartDragEnter(this._onChartDragEnter,this);this._oGanttChart.attachChartDragLeave(this._onChartDragLeave,this);this._oGanttChart.attachShapeDragEnd(this._onShapeDragEnd,this);this._oGanttChart.attachEvent("_visibleHorizonUpdate",this._onGanttChartVisibleHorizonUpdate,this);this._oGanttChart.attachEvent("_timePeriodZoomStatusChange",this._onGanttChartTimePeriodZoomStatusChange,this);this._oGanttChart.attachEvent("_timePeriodZoomOperation",this._onGanttChartTimePeriodZoomOperation,this);this._oGanttChart.attachShapeResizeEnd(this._onShapeResizeEnd,this);this._oGanttChart.attachShapeMouseEnter(this._onShapeMouseEnter,this);this._oGanttChart.attachShapeMouseLeave(this._onShapeMouseLeave,this);this._oModesConfigMap={};this._oModesConfigMap[sap.gantt.config.DEFAULT_MODE_KEY]=sap.gantt.config.DEFAULT_MODE;this._oToolbarSchemeConfigMap={};this._oToolbarSchemeConfigMap[sap.gantt.config.DEFAULT_GANTTCHART_TOOLBAR_SCHEME_KEY]=sap.gantt.config.DEFAULT_GANTTCHART_TOOLBAR_SCHEME;this._oToolbarSchemeConfigMap[sap.gantt.config.EMPTY_TOOLBAR_SCHEME_KEY]=sap.gantt.config.EMPTY_TOOLBAR_SCHEME;this._oHierarchyConfigMap={};this._oHierarchyConfigMap[sap.gantt.config.DEFAULT_HIERARCHY_KEY]=sap.gantt.config.DEFAULT_HIERARCHY;this._oSelectionPanelDrawer=new e();this._oGanttChartSchemesConfigMap={};this._oGanttChartSchemesConfigMap[sap.gantt.config.DEFAULT_CHART_SCHEME_KEY]=sap.gantt.config.DEFAULT_CHART_SCHEME;this._oObjectTypesConfigMap={};this._oObjectTypesConfigMap[sap.gantt.config.DEFAULT_OBJECT_TYPE_KEY]=sap.gantt.config.DEFAULT_OBJECT_TYPE;this._oShapesConfigMap={};this._oMouseWheelHandler=new M(this);jQuery.sap.measure.end("GanttChartWithTable Init");};f.prototype.setFixedColumnCount=function(F){this.setTableProperties({fixedColumnCount:F});return this;};f.prototype.getFixedColumnCount=function(){return this.getTableProperties().fixedColumnCount;};f.prototype.setTimeAxis=function(t){this.setProperty("timeAxis",t,true);this._oGanttChart.setTimeAxis(t);return this;};f.prototype.setMode=function(m){this.setProperty("mode",m);this._oGanttChart.setMode(m);this._oToolbar.setMode(m);return this;};f.prototype.setModes=function(m){this.setProperty("modes",m);this._oToolbar.setModes(m);this._oGanttChart.setModes(m);this._oModesConfigMap={};if(m){for(var i=0;i<m.length;i++){this._oModesConfigMap[m[i].getKey()]=m[i];}}return this;};f.prototype.setSelectionMode=function(s){this.setProperty("selectionMode",s);switch(s){case sap.gantt.SelectionMode.Multiple:case sap.gantt.SelectionMode.MultiWithKeyboard:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.MultiToggle,selectionBehavior:sap.ui.table.SelectionBehavior.Row});break;case sap.gantt.SelectionMode.Single:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.Single,selectionBehavior:sap.ui.table.SelectionBehavior.Row});break;case sap.gantt.SelectionMode.None:this.setTableProperties({selectionMode:sap.ui.table.SelectionMode.None,selectionBehavior:sap.ui.table.SelectionBehavior.RowOnly});break;}this._oGanttChart.setSelectionMode(s);return this;};f.prototype.setShapeSelectionMode=function(s){this.setProperty("shapeSelectionMode",s);this._oGanttChart.setShapeSelectionMode(s);return this;};f.prototype.setToolbarSchemes=function(t){this.setProperty("toolbarSchemes",t);this._oToolbar.setToolbarSchemes(t);this._oToolbarSchemeConfigMap={};if(t){for(var i=0;i<t.length;i++){this._oToolbarSchemeConfigMap[t[i].getKey()]=t[i];}}return this;};f.prototype.setHierarchyKey=function(h){this.setProperty("hierarchyKey",h);this._oGanttChart.setProperty("hierarchyKey",h);this._oToolbar.setSourceId(h);this._hierarchyChange();return this;};f.prototype.setHierarchies=function(h){this.setProperty("hierarchies",h);this._oToolbar.setHierarchies(h);this._oGanttChart.setHierarchies(h);this._oHierarchyConfigMap={};if(h){for(var i=0;i<h.length;i++){this._oHierarchyConfigMap[h[i].getKey()]=h[i];}}this._hierarchyChange();return this;};f.prototype.setCalendarDef=function(o){this.setAggregation("calendarDef",o);var p=o.getBindingInfo("defs");if(p){p.templateShareable=true;}this._oGanttChart.setCalendarDef(o.clone());return this;};f.prototype.setAdhocLineLayer=function(l){this.setProperty("adhocLineLayer",l);this._oGanttChart.setAdhocLineLayer(l);return this;};f.prototype.addAdhocLine=function(o){this._oGanttChart.addAdhocLine(o);return this;};f.prototype.insertAdhocLine=function(o,i){this._oGanttChart.insertAdhocLine(o,i);return this;};f.prototype.removeAdhocLine=function(o){return this._oGanttChart.removeAdhocLine(o);};f.prototype.getAdhocLines=function(){return this._oGanttChart.getAdhocLines();};f.prototype.removeAllAdhocLines=function(){return this._oGanttChart.removeAllAdhocLines();};f.prototype.setUseFlatMode=function(F){this._oTT.setUseFlatMode(F);return this;};f.prototype._hierarchyChange=function(o){var h=this.getHierarchyKey();if(h&&this._oHierarchyConfigMap[h]){if(this._oHierarchyConfigMap[h].getColumns()&&this._oHierarchyConfigMap[h].getColumns().length>0){this._buildColumnFromCellCallback();}var m=this.getMode();if(m===sap.gantt.config.DEFAULT_MODE_KEY&&this._oHierarchyConfigMap[this.getHierarchyKey()]){m=this._oHierarchyConfigMap[this.getHierarchyKey()].getActiveModeKey();}this.setMode(m);}};f.prototype._buildColumnFromCellCallback=function(){this._oTT.removeAllColumns();var h,g;h=this._oHierarchyConfigMap[this.getHierarchyKey()];if(h){g=h.getColumns();}if(g){for(var i=0;i<g.length;i++){var o=new C({label:g[i].getTitle(),sortProperty:g[i].getSortAttribute(),filterProperty:g[i].getFilterAttribute(),width:g[i].getWidth(),template:new c({cellCallback:this.getCellCallback(),columnConfig:g[i]}).data("rowTypeName",this.getRowTypeName())});this._oTT.addColumn(o);this._oTT.addAriaLabelledBy(o.getLabel());}}};f.prototype.setObjectTypes=function(o){this.setProperty("objectTypes",o,true);this._oGanttChart.setObjectTypes(o);this._oObjectTypesConfigMap={};if(o){for(var i=0;i<o.length;i++){this._oObjectTypesConfigMap[o[i].getKey()]=o[i];}}return this;};f.prototype.setChartSchemes=function(g){this.setProperty("chartSchemes",g,true);this._oGanttChart.setChartSchemes(g);this._oGanttChartSchemesConfigMap={};if(g){for(var i=0;i<g.length;i++){this._oGanttChartSchemesConfigMap[g[i].getKey()]=g[i];}}return this;};f.prototype.setShapeDataNames=function(s){this.setProperty("shapeDataNames",s);this._oGanttChart.setShapeDataNames(s);return this;};f.prototype.setLocale=function(l){this.setProperty("locale",l,true);this._oGanttChart.setLocale(l);return this;};f.prototype.setShapes=function(s){this.setProperty("shapes",s,true);this._oGanttChart.setShapes(s);this._oShapesConfigMap={};if(s){for(var i=0;i<s.length;i++){this._oShapesConfigMap[s[i].getKey()]=s[i];}}return this;};f.prototype.setSvgDefs=function(s){this.setProperty("svgDefs",s);this._oGanttChart.setSvgDefs(s);return this;};f.prototype.setEnableCursorLine=function(E){this.setProperty("enableCursorLine",E);this._oGanttChart.setEnableCursorLine(E);this._oToolbar.setEnableCursorLine(E);return this;};f.prototype.setEnableNowLine=function(E){this.setProperty("enableNowLine",E);this._oGanttChart.setEnableNowLine(E);this._oToolbar.setEnableNowLine(E);return this;};f.prototype.setEnableVerticalLine=function(E){this.setProperty("enableVerticalLine",E);this._oGanttChart.setEnableVerticalLine(E);this._oToolbar.setEnableVerticalLine(E);return this;};f.prototype.setEnableAdhocLine=function(E){this.setProperty("enableAdhocLine",E);this._oGanttChart.setEnableAdhocLine(E);this._oToolbar.setEnableAdhocLine(E);return this;};f.prototype.setEnableShapeTimeDisplay=function(E){this.setProperty("enableShapeTimeDisplay",E);this._oGanttChart.setEnableShapeTimeDisplay(E);return this;};f.prototype.setTimeZoomRate=function(t){this.setProperty("timeZoomRate",t,true);this._oGanttChart.setTimeZoomRate(t);return this;};f.prototype.setAxisTimeStrategy=function(o){this._oGanttChart.setAxisTimeStrategy(o);return this;};f.prototype.getAxisTimeStrategy=function(){return this._oGanttChart.getAxisTimeStrategy();};f.prototype.addRelationship=function(r){this._oGanttChart.addRelationship(r);};f.prototype.insertRelationship=function(i,r){this._oGanttChart.insertRelationship(i,r);};f.prototype.removeRelationship=function(r){this._oGanttChart.removeRelationship(r);};f.prototype.getRelationships=function(){this._oGanttChart.getRelationships();};f.prototype.destroyRelationships=function(){this._oGanttChart.destroyRelationships();};f.prototype.indexOfRelationship=function(r){this._oGanttChart.indexOfRelationship(r);};f.prototype.removeAllRelationships=function(){this._oGanttChart.removeAllRelationships();};f.prototype.updateRelationships=function(r){this._oGanttChart.updateRelationships(r);};f.prototype.setSelectionPanelSize=function(s,g){this.setProperty("selectionPanelSize",s,g);this._oSelectionPanelCnt.setLayoutData(new a({size:s}));return this;};f.prototype.addColumn=function(o){this._oTT.addColumn(o);};f.prototype.insertColumn=function(o,i){this._oTT.insertColumn(o,i);};f.prototype.removeColumn=function(o){this._oTT.removeColumn(o);};f.prototype.removeAllColumns=function(){this._oTT.removeAllColumns();};f.prototype.getColumns=function(){return this._oTT.getColumns();};f.prototype.setGhostAlignment=function(g){this.setProperty("ghostAlignment",g);this._oGanttChart.setGhostAlignment(g);return this;};f.prototype._bindAggregation=function(n,B){var m,o;if(n=="rows"&&B){m=this.getModel(B.model);o=this.getBindingContext(B.model);if(o&&m){B.path=m.resolve(B.path,o);}this._oTT.bindRows(B);this._oGanttChart.bindRows(B);this._oTC.updateRows=this._updateRows.bind(this);this._oTT._oSelectionPlugin=this._oTC._oSelectionPlugin;}else if(n=="relationships"&&B){m=this.getModel(B.model);o=this.getBindingContext(B.model);if(o&&m){B.path=m.resolve(B.path,o);}this._oGanttChart.bindRelationships(B);}else if(n=="columns"&&B){m=this.getModel(B.model);o=this.getBindingContext(B.model);if(o&&m){B.path=m.resolve(B.path,o);}this._oTT.bindColumns(B);}else{return G.prototype._bindAggregation.apply(this,arguments);}};f.prototype.setTableProperties=function(p){G.prototype.setTableProperties.apply(this,arguments);this._oGanttChart.setTableProperties(p);return this;};f.prototype._updateRows=function(r){if(r!==sap.ui.table.TableUtils.RowsUpdateReason.VerticalScroll&&(this._oTC.getFirstVisibleRow()===this._oTT.getFirstVisibleRow()||r===sap.ui.model.ChangeReason.Filter||r===sap.ui.model.ChangeReason.Sort)){sap.ui.table.Table.prototype.updateRows.apply(this._oTT,arguments);}sap.ui.table.Table.prototype.updateRows.apply(this._oTC,arguments);};f.prototype._detachToolbarEvents=function(){this._oToolbar.detachSourceChange(this._onToolbarSourceChange,this);this._oToolbar.detachExpandChartChange(this._onToolbarExpandChartChange,this);this._oToolbar.detachExpandTreeChange(this._onToolbarExpandTreeChange,this);this._oToolbar.detachBirdEye(this._onToolbarBirdEye,this);};f.prototype._onToolbarBirdEye=function(E){var p=E.getParameters();var B=p.birdEyeRange;this._oGanttChart._doBirdEye(B);};f.prototype.doBirdEyeOnRow=function(r){this._oGanttChart.doBirdEyeOnRow(r);};f.prototype.getVisibleWidth=function(){return this._oGanttChart.getVisibleWidth();};f.prototype.onAfterRendering=function(){this._attachEvents();};f.prototype.onBeforeRendering=function(){if(this._oToolbar.getAllToolbarItems().length===0){this._oTT.removeExtension(this._oToolbar);}else if(this._oTT.getExtension().length==0){this._oTT.addExtension(this._oToolbar);}};f.prototype._attachEvents=function(){var o={onAfterRendering:this._syncGanttTablesDomEvents};this._oTT.removeEventDelegate(o);this._oTT.addEventDelegate(o,this);this._oTC.removeEventDelegate(o);this._oTC.addEventDelegate(o,this);this._appendMaskSvg();var $=this.$().find(this.getDomSelectorById("spm-svg-table"));if(D.browser.firefox){$.unbind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));$.bind("MozMousePixelScroll.sapUiTableMouseWheel",this._onMouseWheel.bind(this));}else{$.unbind("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));$.bind("wheel.sapUiTableMouseWheel",this._onMouseWheel.bind(this));}};f.prototype._onMouseWheel=function(E){this._oMouseWheelHandler.handleEvent(E);};f.prototype._onRowSelectionChange=function(E){var s=this._oTT.getSelectedIndices();this._oToolbar.toggleExpandTreeButton(s.length>0);this.fireRowSelectionChange({originEvent:E.getParameter("originEvent")});this._oTT._updateSelection();};f.prototype._onChartMouseOver=function(E){var p=E.getParameters();this.fireChartMouseOver({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};f.prototype._onShapeSelectionChange=function(E){this.fireShapeSelectionChange({originEvent:E.getParameter("originEvent")});};f.prototype._onRelationshipSelectionChange=function(E){this.fireRelationshipSelectionChange({originEvent:E.getParameter("originEvent")});};f.prototype._onClick=function(E){var p=E.getParameters();this.fireChartClick({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};f.prototype._onDoubleClick=function(E){var p=E.getParameters();this.fireChartDoubleClick({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};f.prototype._onRightClick=function(E){var p=E.getParameters();this.fireChartRightClick({objectInfo:p.objectInfo,leadingRowInfo:p.leadingRowInfo,timestamp:p.timestamp,svgId:p.svgId,svgCoordinate:p.svgCoordinate,effectingMode:p.effectingMode,originEvent:p.originEvent});};f.prototype._onChartDragEnter=function(E){this.fireChartDragEnter({originEvent:E.getParameter("originEvent")});};f.prototype._onChartDragLeave=function(E){this.fireChartDragLeave({originEvent:E.getParameter("originEvent"),draggingSource:E.getParameter("draggingSource"),timePopoverData:E.getParameter("timePopoverData")});};f.prototype._onShapeDragEnd=function(E){var p=E.getParameters();this.fireShapeDragEnd({originEvent:p.originEvent,sourceShapeData:p.sourceShapeData,targetData:p.targetData,sourceSvgId:p.sourceSvgId,targetSvgId:p.targetSvgId});};f.prototype._onShapeResizeEnd=function(E){var p=E.getParameters();this.fireShapeResizeEnd({shapeUid:p.shapeUid,rowObject:p.rowObject,oldTime:p.oldTime,newTime:p.newTime});};f.prototype._onShapeMouseEnter=function(E){var p=E.getParameters();this.fireShapeMouseEnter({shapeData:p.shapeData,pageX:p.pageX,pageY:p.pageY,originEvent:p.originEvent});};f.prototype._onShapeMouseLeave=function(E){var p=E.getParameters();this.fireShapeMouseLeave({shapeData:p.shapeData,originEvent:p.originEvent});};f.prototype._onGanttChartVisibleHorizonUpdate=function(E){this.fireEvent("_visibleHorizonUpdate",E.getParameters());};f.prototype._onGanttChartTimePeriodZoomStatusChange=function(E){this.fireEvent("_timePeriodZoomStatusChange",E.getParameters());};f.prototype._onGanttChartTimePeriodZoomOperation=function(E){this.fireEvent("_timePeriodZoomOperation",E.getParameters());};f.prototype.syncTimePeriodZoomStatus=function(g){this._oGanttChart.syncTimePeriodZoomStatus(g);};f.prototype.syncTimePeriodZoomOperation=function(E,t,o){this._oGanttChart.syncTimePeriodZoomOperation(E,t,o);};f.prototype.syncMouseWheelZoom=function(E){this._oGanttChart.syncMouseWheelZoom(E);};f.prototype._onChartHSbScroll=function(E){this.fireHorizontalScroll(E.getParameters());};f.prototype.syncVisibleHorizon=function(t,v,k){this._oGanttChart.syncVisibleHorizon(t,v,k);};f.prototype._onChartVSbScroll=function(E){var $=jQuery(this.getTTVsbDom());var g=jQuery(this.getTCVsbDom());if(this.sScrollSource===null||this.sScrollSource!=="GanttChartWithTable"){this.sScrollSource="GanttChart";window.requestAnimationFrame(function(){$.scrollTop(g.scrollTop());});}else{this.sScrollSource=null;}this.fireVerticalScroll({scrollSteps:this._oTC.getFirstVisibleRow(),scrollPosition:jQuery(this.getTCVsbDom()).scrollTop()});};f.prototype._drawSvg=function(){this._appendMaskSvg();this._updateMaskSvg();this._updateTableRowHeights();this._drawSelectionPanel();};f.prototype._onZoomInfoUpdated=function(E){var p=E.getParameters();if(p.axisTimeChanged){this.setProperty("timeZoomRate",this._oGanttChart.getAxisTime().getZoomRate(),true);}this.fireEvent("_zoomInfoUpdated",p);};f.prototype._onShapesUpdated=function(E){this.fireEvent("_shapesUpdated",{aSvg:E.getParameter("aSvg")});};f.prototype._bindVerticalScrollForTT=function(){var $=jQuery(this.getTTVsbDom());$.unbind("scroll.sapUiTableVScrollForGanttChartWithTable",this._onSelectionPanelVSbScroll);$.bind("scroll.sapUiTableVScrollForGanttChartWithTable",jQuery.proxy(this._onSelectionPanelVSbScroll,this));};f.prototype._onSelectionPanelVSbScroll=function(){var $=jQuery(this.getTTVsbDom());var g=jQuery(this.getTCVsbDom());if(this.sScrollSource===null||this.sScrollSource!=="GanttChart"){this.sScrollSource="GanttChartWithTable";window.requestAnimationFrame(function(){g.scrollTop($.scrollTop());});}else{this.sScrollSource=null;}this._applyTransform();};f.prototype._applyTransform=function(){this.$().find(this.getDomSelectorById("spm-svg-table")).css("transform","translateY("+(-this._oTT.$().find(".sapUiTableCCnt").scrollTop())+"px)");};f.prototype._onSplitterResize=function(E){var p=E.getParameters();this._oGanttChart._draw();this.fireSplitterResize(p);};f.prototype._onToolbarSourceChange=function(E){var o=this.getHierarchyKey();var g=this.getMode();this.setHierarchyKey(E.getParameter("id"));this.notifySourceChange();this.fireGanttChartSwitchRequested({hierarchyKey:E.getParameter("id"),oldHierarchyKey:o,oldMode:g});};f.prototype._onToolbarExpandChartChange=function(E){var g=E.getParameter("isExpand"),h=E.getParameter("expandedChartSchemes");this.handleExpandChartChange(g,h,null);};f.prototype._onToolbarExpandTreeChange=function(E){var s=E.getParameter("action");if(s){var g=this._oTT.getSelectedIndices();this._oTT[s](g);}};f.prototype._onToolbarModeChange=function(E){var B=this.getBinding("mode");if(B){B.setValue(E.getParameter("mode"));}this.setMode(E.getParameter("mode"));};f.prototype.handleExpandChartChange=function(E,g,s){s=s?s:this._oTT.getSelectedIndices();this._oGanttChart.handleExpandChartChange(E,g,s);};f.prototype.invertRowExpandStatus=function(s,g){if(s&&s.length>0&&g){this._oGanttChart.invertRowExpandStatus(s,g);}};f.prototype._updateTableRowHeights=function(){var t=this._oTT;var h=this._getRowHeights();if(!h){return;}t._updateRowHeights(h,false);};f.prototype._getRowHeights=function(){return this._aHeights;};f.prototype.setBaseRowHeight=function(n){this.setProperty("baseRowHeight",n);this._oTT.setRowHeight(n);return this._oGanttChart.setBaseRowHeight(n);};f.prototype.getBaseRowHeight=function(){return this._oGanttChart.getBaseRowHeight();};f.prototype._onTTRowUpdate=function(){var $=this.$().find(this.getDomSelectorById("spm-svg-table-ctn"));if(this._oGanttChart.isRowExpanded()){var g=this._oTT.$();$.height(g.find(".sapUiTableCCnt").height());$.show();var h=$.find(".sapGanttSPMaskSvg");h.height(g.find(".sapUiTableCtrlCnt").height());this._drawSvg();}else{$.hide();}this._adjustGanttInferredRowHeight();this._oTT._updateTableContent();this._adjustChartHeaderHeight();};f.prototype._adjustChartHeaderHeight=function(){var $=this._oTT.$().find(".sapUiTableExt");var g=this._oTT.$().find(".sapUiTableColHdrCnt");var i=($?$.outerHeight():0)+g.height()+1;if(D.browser.firefox){var h=this._oTT.$().find(".sapUiTableCCnt");i=parseInt(h[0].getBoundingClientRect().top-this._oTT.$()[0].getBoundingClientRect().top,10);}var j=this._oGanttChart.$().find(".sapGanttChartHeader");j.height(i);j.css("min-height",i);var k=this._oGanttChart.$().find(".sapGanttChartHeaderSvg");k.height(i);k.css("min-height",i);};f.prototype._adjustGanttInferredRowHeight=function(){var h=this._getRowHeights();var F=this._getTTFirstRenderingRowIndex();var s=this._oGanttChart._getDrawingData([F,F]);if(h&&h.length>0&&s&&s.length>0){var B=h[0]/s[0].visibleRowSpan;var p=this._oGanttChart._iInferedBaseRowHeight;if(B!==p){this._oGanttChart._setInferedBaseRowHeight(B);if(p===undefined){this._oTC.updateRows();}}}};f.prototype._syncGanttTablesDomEvents=function(E){var s=E.srcControl,t=s.getId()===this._oTT.getId()?this._oTC:this._oTT;s.$().find(".sapUiTableRowHdr, .sapUiTableTr").hover(function(E){var i=jQuery(E.currentTarget).data("sapUiRowindex");t.$().find(".sapUiTableCtrlFixed > tbody > tr.sapUiTableTr").filter(":eq("+i+")").addClass("sapUiTableRowHvr");t.$().find(".sapUiTableCtrlScroll > tbody > tr.sapUiTableTr").filter(":eq("+i+")").addClass("sapUiTableRowHvr");t.$().find(".sapUiTableRowHdr").filter(":eq("+i+")").addClass("sapUiTableRowHvr");},function(E){t.$().find(".sapUiTableCtrlFixed > tbody > tr.sapUiTableTr").removeClass("sapUiTableRowHvr");t.$().find(".sapUiTableCtrlScroll > tbody > tr.sapUiTableTr").removeClass("sapUiTableRowHvr");t.$().find(".sapUiTableRowHdr").removeClass("sapUiTableRowHvr");});};f.prototype._setLargeDataScrolling=function(l){if(this._oTT._setLargeDataScrolling){this._oTT._setLargeDataScrolling(!!l);}if(this._oTC._setLargeDataScrolling){this._oTC._setLargeDataScrolling(!!l);}};f.prototype.getToolbarSchemeKey=function(){return this._oToolbar.getToolbarSchemeKey();};f.prototype.jumpToPosition=function(o){this._oGanttChart.jumpToPosition(o);};f.prototype.selectShapes=function(i,g){return this._oGanttChart.selectShapes(i,g);};f.prototype.deselectShapes=function(i){return this._oGanttChart.deselectShapes(i);};f.prototype.selectRelationships=function(i,g){return this._oGanttChart.selectRelationships(i,g);};f.prototype.deselectRelationships=function(i){return this._oGanttChart.deselectRelationships(i);};f.prototype.selectRows=function(i,g){return this._oGanttChart.selectRows(i,g);};f.prototype.deselectRows=function(i){return this._oGanttChart.deselectRows(i);};f.prototype.selectRowsAndShapes=function(i,I){return this._oGanttChart.selectRowsAndShapes(i,I);};f.prototype.getAllSelections=function(){return this._oGanttChart.getAllSelections();};f.prototype.getSelectedShapes=function(){var s=this._oGanttChart.getSelectedShapes();return s;};f.prototype.getSelectedRows=function(){var s=this._oGanttChart.getSelectedRows();return s;};f.prototype.getSelectedRelationships=function(){var s=this._oGanttChart.getSelectedRelationships();return s;};f.prototype.setDraggingData=function(o){this._oGanttChart.setDraggingData(o);};f.prototype.setTimePopoverData=function(o){this._oGanttChart.setTimePopoverData(o);};f.prototype.getRowByShapeUid=function(s){return this._oGanttChart.getRowByShapeUid(s);};f.prototype._drawSelectionPanel=function(){var t=this._oTT.$().find(".sapUiTableRowHdrScr").width();var v=this._getVisibleRowData();if(v!==undefined){this._oSelectionPanelDrawer.drawSvg(d3.select(this.getDomSelectorById("spm-svg-table")),v,t,this);this.$().find(this.getDomSelectorById("spm-svg-table")).css("transform","translateY("+(-this._oTT.$().find(".sapUiTableCCnt").scrollTop())+"px)");}};f.prototype._getVisibleRowData=function(){var F=this._getTTFirstRenderingRowIndex();var v=this.getVisibleRowCount()+1;var V=this._oGanttChart._getDrawingData([F,F+v-1]);var B=this._oGanttChart.getBaseRowHeight();var p=0;for(var i=0;i<V.length;i++){var s=V[i];s.rowHeight=s.rowSpan*B;s.y=p;p+=s.rowHeight;}return V;};f.prototype._appendMaskSvg=function(){var $=this.$().find(this.getDomSelectorById("spm-svg-table-ctn"));var g=this._oTT.$();if($.length==0&&this._oGanttChart.isRowExpanded()){$=jQuery("<div id='"+this.getId()+"-spm-svg-table-ctn' class='sapGanttChartSPMSvgCtn' >"+"<svg id='"+this.getId()+"-spm-svg-table' class='sapGanttSPMaskSvg'>"+"</svg>"+"</div>");g.parent().append($);}};f.prototype._updateMaskSvg=function(){var $=this.$().find(this.getDomSelectorById("spm-svg-table-ctn"));var g=this._oTT.$();$.height(g.find(".sapUiTableCCnt").height());$.width(jQuery(document).width());$.css("top",this._oGanttChart.$().find(".sapGanttChartHeader").height()+1);$.css("min-width",g.find("table").css("min-width"));var h=$.find(".sapGanttSPMaskSvg");h.width($.width());h.height(g.find(".sapUiTableCtrlCnt").height());};f.prototype.getAxisOrdinal=function(){return this._oGanttChart.getAxisOrdinal();};f.prototype.getAxisTime=function(){return this._oGanttChart.getAxisTime();};f.prototype.expandToLevel=function(l){this._oTT.expandToLevel(l);return this;};f.prototype.expand=function(r){this._oTT.expand(r);return this;};f.prototype.collapse=function(r){this._oTT.collapse(r);return this;};f.prototype.getVisibleRowCount=function(){return this._oTT.getVisibleRowCount();};f.prototype.getLargestHorizonByDataRange=function(B,r,i){return this._oGanttChart.getLargestHorizonByDataRange(B,r,i);};f.prototype.setSelectedIndex=function(r){this._oTT.setSelectedIndex(r);return this;};f.prototype.getSelectedIndex=function(){return this._oTT.getSelectedIndex();};f.prototype.getFirstVisibleRow=function(){return this.getTableProperties().firstVisibleRow;};f.prototype.setFirstVisibleRow=function(r){this.setTableProperties({firstVisibleRow:r});return this;};f.prototype.getRows=function(){return this._oTT.getRows();};f.prototype.exit=function(){this._detachToolbarEvents();this._oSplitter.destroy();};f.prototype.notifySourceChange=function(){this._oTT.setFirstVisibleRow(0);this._oGanttChart.notifySourceChange();};f.prototype.autoResizeColumn=function(g){if(g>=0&&jQuery.isNumeric(g)){this._oTT.autoResizeColumn(g);}else{for(var i=this._oTT.getColumns().length;i>=0;i--){this._oTT.autoResizeColumn(i);}}};f.prototype._autoResizeColumn=function(){if(this._oHierarchyConfigMap[this.getHierarchyKey()].getAutoResizeColumn()){this.autoResizeColumn();}};f.prototype.redraw=function(h){this._oGanttChart.redraw(h);};f.prototype.selectByUid=function(u){this._oGanttChart.selectByUid(u);};f.prototype.getTTHsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.HorizontalScrollBar);};f.prototype.getTTVsbDom=function(){return this._oTT.getDomRef(sap.ui.table.SharedDomRef.VerticalScrollBar);};f.prototype.getTCVsbDom=function(){return this._oGanttChart.getTTVsbDom();};f.prototype._getTTFirstRenderingRowIndex=function(){if(this._oTT.getRows().length>0){return this._oTT.getRows()[0].getIndex();}return this._oTT.getFirstVisibleRow();};["addCustomToolbarItem","insertCustomToolbarItem","removeCustomToolbarItem","indexOfCustomToolbarItem","removeAllCustomToolbarItems","destroyCustomToolbarItems","getCustomToolbarItems"].forEach(function(m){f.prototype[m]=function(){return this._oToolbar[m].apply(this._oToolbar,arguments);};});return f;},true);
