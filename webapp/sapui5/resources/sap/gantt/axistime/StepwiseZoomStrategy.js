/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/base/util/ObjectPath","./AxisTimeStrategyBase","../misc/Format"],function(l,O,A,F){"use strict";var r=sap.ui.getCore().getLibraryResourceBundle("sap.gantt");var T=l.config.TimeUnit;sap.gantt.axistime.StepwiseTimeLineOptions={"FiveMinutes":{text:r.getText("SWZS_FIVE_MINUTES"),innerInterval:{unit:T.minute,span:5,range:32},largeInterval:{unit:T.hour,span:1,pattern:"ha / MMMM dd, yyyy "},smallInterval:{unit:T.minute,span:5,pattern:"mm "}},"FifteenMinutes":{text:r.getText("SWZS_FIFTEEN_MINUTES"),innerInterval:{unit:T.minute,span:15,range:48},largeInterval:{unit:T.hour,span:1,pattern:"ha / MMMM dd, yyyy "},smallInterval:{unit:T.minute,span:15,pattern:"mm "}},"Hour":{text:r.getText("SWZS_HOUR"),innerInterval:{unit:T.hour,span:1,range:48},largeInterval:{unit:T.day,span:1,pattern:"MMMM dd, yyyy "},smallInterval:{unit:T.hour,span:1,pattern:"HH:mm "}},"SixHours":{text:r.getText("SWZS_SIX_HOURS"),innerInterval:{unit:T.hour,span:6,range:64},largeInterval:{unit:T.day,span:1,pattern:"MMMM dd, yyyy "},smallInterval:{unit:T.hour,span:6,pattern:"HH:mm "}},"DayDate":{text:r.getText("SWZS_DATE_1"),innerInterval:{unit:T.day,span:1,range:64},largeInterval:{unit:T.week,span:1,pattern:"MMM yyyy, 'Week' ww  "},smallInterval:{unit:T.day,span:1,pattern:sap.ui.getCore().getConfiguration().getRTL()?"dd EEE ":"EEE dd "}},"Date":{text:r.getText("SWZS_DATE_2"),innerInterval:{unit:T.day,span:1,range:32},largeInterval:{unit:T.week,span:1,pattern:"MMM yyyy, 'Week' ww  "},smallInterval:{unit:T.day,span:1,pattern:"dd "}},"CWWeek":{text:r.getText("SWZS_WEEK_1"),innerInterval:{unit:T.week,span:1,range:56},largeInterval:{unit:T.month,span:1,pattern:"MMM yyyy "},smallInterval:{unit:T.week,span:1,pattern:sap.ui.getCore().getConfiguration().getRTL()?"'CW' ww  ":"'CW' ww  "}},"WeekOfYear":{text:r.getText("SWZS_WEEK_2"),innerInterval:{unit:T.week,span:1,range:32},largeInterval:{unit:T.month,span:1,pattern:"MMM yyyy "},smallInterval:{unit:T.week,span:1,pattern:"ww "}},"Month":{text:r.getText("SWZS_MONTH"),innerInterval:{unit:T.day,span:30,range:48},largeInterval:{unit:T.month,span:3,pattern:"yyyy QQQ "},smallInterval:{unit:T.month,span:1,pattern:"MMM "}},"Quarter":{text:r.getText("SWZS_QUARTER"),innerInterval:{unit:T.day,span:90,range:48},largeInterval:{unit:T.year,span:1,pattern:"yyyy "},smallInterval:{unit:T.month,span:3,pattern:"QQQ "}},"Year":{text:r.getText("SWZS_YEAR"),innerInterval:{unit:T.day,span:360,range:48},largeInterval:{unit:T.year,span:5,pattern:"yyyy "},smallInterval:{unit:T.year,span:1,pattern:"yyyy "}}};var S=sap.gantt.axistime.StepwiseTimeLineOptions;var a=A.extend("sap.gantt.axistime.StepwiseZoomStrategy",{metadata:{library:"sap.gantt"}});a.prototype.init=function(){this._oTotalHorizonBeforeExtension=null;this._sZoomControlType=sap.gantt.config.ZoomControlType.Select;this._aTimeLineOptions=null;this._calculatedTotalHorizon=null;this.bAxisTimeChanged=false;this.iLastZoomLevel=-1;var t=S.DayDate;this.setProperty("timeLineOption",t,true);this.setProperty("timeLineOptions",S,true);this.setProperty("mouseWheelZoomType",sap.gantt.MouseWheelZoomType.Stepwise,true);this.setProperty("finestTimeLineOption",null,true);this.setProperty("coarsestTimeLineOption",null,true);this._aZoomRate=new Array(11);};a.prototype.applySettings=function(){A.prototype.applySettings.apply(this,arguments);this._updateZoomRateArray();this._updateTimeLineOptions();this.setInitialProperties();return this;};a.prototype.setInitialProperties=function(){this.setProperty("zoomLevels",this._getCountOfTimeLineOptions(),true);if(this._getIndexOfTimeLineOption(this.getTimeLineOption())===-1){this.setTimeLineOption(this._aTimeLineOptions[this._getCountOfTimeLineOptions()/2]);}};a.prototype.createAxisTime=function(L){A.prototype.createAxisTime.apply(this,arguments);this.setZoomLevel(this._getIndexOfTimeLineOption(this.getTimeLineOption(),this.getTimeLineOptions()));this._Locale=L;return this;};a.prototype.setVisibleHorizon=function(v){this.setVisibleHorizonWithReason(v,"visibleHorizonUpdated");return this;};a.prototype.setVisibleHorizonWithReason=function(v,R,o){var L=this.getVisibleHorizon();A.prototype.setVisibleHorizon.apply(this,arguments);this.fireRedrawRequest(false,R,L,o);return this;};a.prototype.setTotalHorizon=function(t){A.prototype.setTotalHorizon.apply(this,arguments);this._setCalculatedTotalHorizon(t);if(this.getAxisTime()){this.fireRedrawRequest(true,"totalHorizonUpdated");}return this;};a.prototype._setCalculatedTotalHorizon=function(h){if(h){if(this._calculatedTotalHorizon){this._calculatedTotalHorizon.setStartTime(h.getStartTime(),true);this._calculatedTotalHorizon.setEndTime(h.getEndTime(),true);}else{this._calculatedTotalHorizon=new sap.gantt.config.TimeHorizon({startTime:h.getStartTime(),endTime:h.getEndTime()});}this._updateTimeRangeAndViewRange(h);}return this;};a.prototype._updateTimeRangeAndViewRange=function(h){var o=this.getAxisTime();if(o&&h){o.setTimeRange([F.getTimeStampFormatter().parse(h.getStartTime()),F.getTimeStampFormatter().parse(h.getEndTime())]);var H=F.getTimeStampFormatter().parse(h.getStartTime());var b=F.getTimeStampFormatter().parse(h.getEndTime());var n=b.valueOf()-H.valueOf();var t=this.getTimeLineOption();var c=O.get(t.innerInterval.unit).offset(H,t.innerInterval.span).valueOf()-H.valueOf();o.setViewRange([0,Math.ceil((n*t.innerInterval.range/c)/this._aZoomRate[this.getZoomLevel()])]);}return this;};a.prototype._getCalculatedTotalHorizon=function(){if(!this._calculatedTotalHorizon||!this._calculatedTotalHorizon.getStartTime()||!this._calculatedTotalHorizon.getEndTime()){this._setCalculatedTotalHorizon(this.getAggregation("totalHorizon"));}return this._calculatedTotalHorizon;};a.prototype.getTotalHorizon=function(){return this._getCalculatedTotalHorizon();};a.prototype.setZoomLevels=function(z){return this;};a.prototype.setZoomLevel=function(z){if(z>=0){this.iLastZoomLevel=this.getZoomLevel();this.setProperty("zoomLevel",z,true);this.setProperty("timeLineOption",this._getTimeLineOptionByIndex(z),true);if(this._aZoomRate[z]&&this.getGanttVisibleWidth()){var n=this._updateVisibleHorizon(this.getGanttVisibleWidth());this.setVisibleHorizon(n);}}return this;};a.prototype.setTimeLineOption=function(t){this.setProperty("timeLineOption",t,true);this.setZoomLevel(this._getIndexOfTimeLineOption(t));};a.prototype.setCoarsestTimeLineOption=function(t){return this;};a.prototype.setFinestTimeLineOption=function(t){return this;};a.prototype.setTimeLineOptions=function(t){A.prototype.setTimeLineOptions.apply(this,arguments);this._updateZoomRateArray();this._updateTimeLineOptions();return this;};a.prototype._updateVisibleHorizon=function(n){if(!n){var w=this._getWidthOfTotalHorizon();this._extendTotalHorizon(w);}else{this._extendTotalHorizon(n);}var o=this.getAxisTime();if(o){o.setZoomRate(this._aZoomRate[this.getZoomLevel()]);var v=this.getVisibleHorizon();var m=this.calMiddleDate(F.getTimeStampFormatter().parse(v.getStartTime()),F.getTimeStampFormatter().parse(v.getEndTime()));var N=this.calVisibleHorizonByRate(this._aZoomRate[this.getZoomLevel()],m);A.prototype.setVisibleHorizon.call(this,N);return N;}};a.prototype.updateGanttVisibleWidth=function(n){return this;};a.prototype.isTimePeriodZoomEnabled=function(){return false;};a.prototype.syncContext=function(n){var R={zoomLevel:undefined,axisTimeChanged:false};if(n!==this.getGanttVisibleWidth()){this._updateVisibleHorizon(n);R.axisTimeChanged=true;A.prototype.updateGanttVisibleWidth.apply(this,arguments);}else if(this.iLastZoomLevel===this.getZoomLevel()){R.axisTimeChanged=false;}else{R.axisTimeChanged=true;this.iLastZoomLevel=this.getZoomLevel();}R.zoomLevel=this.getZoomLevel();return R;};a.prototype._updateZoomRateArray=function(){if(this._oZoom){var t=this.getTimeLineOptions();this._aZoomRate=[];if(t){var i;if(this._sZoomControlType!==sap.gantt.config.ZoomControlType.Select){i=this._getCountOfTimeLineOptions();for(var j in t){i--;this._aZoomRate[i]=this._oZoom.base.scale/this.calZoomScale(t[j].innerInterval.unit,t[j].innerInterval.span,t[j].innerInterval.range);}}else{i=0;for(var n in t){this._aZoomRate[i]=this._oZoom.base.scale/this.calZoomScale(t[n].innerInterval.unit,t[n].innerInterval.span,t[n].innerInterval.range);i++;}}}else{this._aZoomRate[0]=1;}}};a.prototype._updateTimeLineOptions=function(){var t=this.getTimeLineOptions();this._aTimeLineOptions=[];if(t){for(var i in t){this._aTimeLineOptions.push(t[i]);}if(this._sZoomControlType!==sap.gantt.config.ZoomControlType.Select){this._aTimeLineOptions=this._aTimeLineOptions.reverse();}}};a.prototype.updateStopInfo=function(s){this.setZoomLevel(s.index);return this;};a.prototype._getIndexOfTimeLineOption=function(t,o){var b=o;if(!b){b=this.getTimeLineOptions();}if(!this._aTimeLineOptions){this._updateTimeLineOptions();}for(var i=0,c=this._aTimeLineOptions.length;i<c;i++){if(this._aTimeLineOptions[i]==t){return i;}}return-1;};a.prototype._getTimeLineOptionByIndex=function(i){if(!this._aTimeLineOptions){this._updateTimeLineOptions();}if(i<this._aTimeLineOptions.length){return this._aTimeLineOptions[i];}else{return null;}};a.prototype._getWidthOfTotalHorizon=function(){var c=this._getCalculatedTotalHorizon();var s=F.getTimeStampFormatter().parse(c.getStartTime());var e=F.getTimeStampFormatter().parse(c.getEndTime());var o=this.getAxisTime();var b=o.timeToView(s);var d=o.timeToView(e);return Math.abs(d-b);};a.prototype._extendTotalHorizon=function(n){var c=this._getCalculatedTotalHorizon();var b=0;if(this._oZoom&&this._oZoom.base&&this._oZoom.base.scale!==undefined){var C=F.abapTimestampToDate(c.getStartTime());var o=F.abapTimestampToDate(c.getEndTime());var d=o.getTime()-C.getTime();var e=this._aZoomRate[this.getZoomLevel()];var f=this._oZoom.base.scale/e;var g=n*f;b=g-d;c=this._calTotalHorizon(b,g);this._setCalculatedTotalHorizon(c);}};a.prototype._calTotalHorizon=function(n,b){var c=this._getCalculatedTotalHorizon();if(n!==0){var d=F.abapTimestampToDate(this.getAggregation("totalHorizon").getStartTime()).getTime();var e=F.abapTimestampToDate(this.getAggregation("totalHorizon").getEndTime()).getTime();var f=(d+e)/2;var g,h;if(n>0){g=f-b/2;h=f+b/2;}else{g=F.abapTimestampToDate(c.getStartTime()).getTime()-n/2;h=F.abapTimestampToDate(c.getEndTime()).getTime()+n/2;if(g>d){g=d;}if(h<e){h=e;}}var N=new Date();N.setTime(g);var o=new Date();o.setTime(h);return new sap.gantt.config.TimeHorizon({startTime:N,endTime:o});}return c;};a.prototype._updateZoomControlType=function(z){if(z){A.prototype._updateZoomControlType.apply(this,arguments);this._sZoomControlType=z;this._updateZoomRateArray();this._updateTimeLineOptions();this.setZoomLevel(this._getIndexOfTimeLineOption(this.getTimeLineOption(),this.getTimeLineOptions()));}};a.prototype._getCountOfTimeLineOptions=function(){if(this._iCountOfTimeLineOptions){return this._iCountOfTimeLineOptions;}var t=this.getTimeLineOptions();var c=0;for(var i in t){if(t.hasOwnProperty(i)){c++;}}this._iCountOfTimeLineOptions=c;return c;};return a;},true);
