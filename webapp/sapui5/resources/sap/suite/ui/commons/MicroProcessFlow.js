sap.ui.define(["sap/ui/thirdparty/jquery",'./library','sap/ui/core/Control','sap/ui/core/Icon','sap/ui/base/ManagedObject','sap/ui/core/delegate/ItemNavigation',"sap/ui/core/ResizeHandler",],function(q,l,C,I,M,a,R){"use strict";var b=l.MicroProcessFlowRenderType;var L=function(i){return i[i.length-1];};var c=C.extend("sap.suite.ui.commons.MicroProcessFlow",{metadata:{library:"sap.suite.ui.commons",properties:{ariaLabel:{type:"string",defaultValue:null},renderType:{type:"sap.suite.ui.commons.MicroProcessFlowRenderType",defaultValue:sap.suite.ui.commons.MicroProcessFlowRenderType.Wrap},width:{type:"sap.ui.core.CSSSize",defaultValue:""}},aggregations:{content:{type:"sap.suite.ui.commons.MicroProcessFlowItem",multiple:true,singularName:"content"}}},renderer:function(r,m){var d=m.getContent(),w=m.getWidth(),e=d.length;if(!m._bThemeApplied){return;}r.write("<div ");r.writeAttributeEscaped("role","listbox");r.writeControlData(m);if(w){r.addStyle("width",w);}r.writeStyles();r.addClass("sapSuiteUiCommonsMicroProcessFlow");r.writeClasses(m);r.write(">");if(m._hasScrolling()){r.write("<div tabindex=\"0\" id=\""+m.getId()+"-leftscroller\" class=\"sapSuiteUiCommonsMicroProcessFlowScroller sapSuiteUiCommonsMicroProcessFlowLeftScroller\">");r.renderControl(m._getLeftScroller());r.write("<span id=\""+m.getId()+"-leftlabel\" class=\"sapSuiteUiCommonsMicroProcessFlowLeftLabel\"></span>");r.write("</div>");}r.write("<div id=\""+m.getId()+"-content\" class=\"sapSuiteUiCommonsMicroProcessFlowContent\">");r.write("<div id=\""+m.getId()+"-scrolling\" class=\"sapSuiteUiCommonsMicroProcessFlowScrolling sapSuiteUiCommonsMicroProcessFlowScrollingTransition\"");if(m.getRenderType()===b.Wrap){r.addStyle("flex-wrap","wrap");r.writeStyles();}r.write(">");d.forEach(function(o,i){o._setAccessibilityData(i+1,e);r.renderControl(o);});r.write("</div>");r.write("</div>");if(m._hasScrolling()){r.write("<div tabindex=\"0\" id=\""+m.getId()+"-rightscroller\" class=\"sapSuiteUiCommonsMicroProcessFlowScroller sapSuiteUiCommonsMicroProcessFlowRightScroller\">");r.write("<span id=\""+m.getId()+"-rightlabel\" class=\"sapSuiteUiCommonsMicroProcessFlowRightLabel\"></span>");r.renderControl(m._getRightScroller());r.write("</div>");}r.write("</div>");}});c.prototype.onExit=function(){if(this._oLeftScroller){this._oLeftScroller.destroy();}if(this._oRightScroller){this._oRightScroller.destroy();}};c.prototype.init=function(){sap.ui.getCore().attachThemeChanged(function(){this._bThemeApplied=true;this.invalidate();},this);this._bThemeApplied=sap.ui.getCore().isThemeApplied();this._iScrollingIndex=0;this._iLastVisibleIndex=0;this._aEdges=[];this._aWidths=[];};c.prototype.onAfterRendering=function(){this._correctSeparatorWidth();this._setupKeyboard();if(this._hasScrolling()){this._setupScrolling();this._collectEdgesAndWidths();this._updateScrollingElements();if(this.getRenderType()===b.ScrollingWithResizer){this._oResizer=R.register(this,q.proxy(this._performResizeChanges,this));}}};c.prototype._performResizeChanges=function(){this._collectEdgesAndWidths();this._updateScrollingElements();};c.prototype._isLastItem=function(i){return i===this.getContent()[this.getContent().length-1];};c.prototype._getMaxHeight=function(i){return Math.max.apply(null,this.$().find(".sapSuiteUiCommonsMicroProcessFlowItemWrapper").map(function(){return q(this).height();}).get());};c.prototype._correctSeparatorWidth=function(){var m=this._getMaxHeight();if(m){this.getContent().forEach(function(i){var s=i.getStepWidth(),S;if(s.indexOf("%")!==-1){S=parseInt(s,10);if(!isNaN(S)){i.$("separator").width(m/S*100);}}},this);}};c.prototype._firePress=function(){if(this._oItemNavigation){var i=this._oItemNavigation.getFocusedIndex(),d=this.getContent()[i];if(d){d._firePress();}}};c.prototype._setupKeyboard=function(){var f=this.getDomRef(),d=this.getContent(),D=[];d.forEach(function(o,i){var $=o._getAccessibleItem();D.push($[0]);});if(!this._oItemNavigation){this._oItemNavigation=new a();this.addDelegate(this._oItemNavigation);}this._oItemNavigation.setRootDomRef(f);this._oItemNavigation.setItemDomRefs(D);this._oItemNavigation.setCycling(false);this._oItemNavigation.attachEvent(a.Events.AfterFocus,function(e){if(this._bKeyBoard===true){this._findEdgeItems(e.getParameter("index"));this._updateScrollingElements();}this._bKeyBoard=false;}.bind(this));};c.prototype._hasScrolling=function(){var r=this.getRenderType();return r===b.Scrolling||r===b.ScrollingWithResizer;};c.prototype._setupScrolling=function(){var $=this.$("leftscroller"),d=this.$("rightscroller");this._iScrollingIndex=0;this._iLastVisibleIndex=0;$.click(this._scroll.bind(this,-1));d.click(this._scroll.bind(this,1));this._iScrollingIndex<=0?$.hide():$.show();};c.prototype._updateScrollingElements=function(d){var e=this.getContent(),$=this.$("leftscroller"),f=this.$("rightscroller");$[this._iScrollingIndex<=0?"hide":"show"]();this._iLastVisibleIndex=this._findLastVisibleItemIndex(d);f[this._iLastVisibleIndex>=e.length-1?"hide":"show"]();this.$("leftlabel").text(this._iScrollingIndex);this.$("rightlabel").text(e.length-1-this._iLastVisibleIndex);};c.prototype._scroll=function(d){var e=this.getContent(),$=this.$("rightscroller"),f=this.$("leftscroller"),g=sap.ui.getCore().getConfiguration().getRTL(),E,t,r;var h=function(){if(d>0){var w=this.$("content").width()-(f.is(":visible")?0:f.width()),n=L(this._aEdges)+L(this._aWidths);if(E+w>n){E-=(E+w-n+$.width());for(var i=0;i<this._aEdges;i++){if(this._aEdges[i]+this._aWidths[i]>E){this._iScrollingIndex=i;break;}}}}}.bind(this);var j=function(){if(!g&&m[0].scrollLeft!=0){this._clearScroll(m);}if(g){r=m.scrollRightRTL();if(r){this._clearScroll(m);}}}.bind(this);var k=this.$("scrolling"),m=k.parent();this._bKeyBoard=false;if(d<0&&this._iScrollingIndex<=0){return;}j();(d<0)?$.show():f.show();this._iScrollingIndex+=d;E=this._aEdges[this._iScrollingIndex];h();t="translateX("+((g?1:-1)*E)+"px)";this.$("scrolling").css("transform",t);if(!k.hasClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition")){setTimeout(function(){k.addClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");},0);}this._updateScrollingElements(d);j();};c.prototype._clearScroll=function($){var i=sap.ui.getCore().getConfiguration().getRTL();if($&&$[0]){i?$.scrollLeftRTL($[0].scrollWidth-$[0].clientWidth):$[0].scrollLeft=0;}};c.prototype._findLastVisibleItemIndex=function(d){var s=this._aEdges[this._iScrollingIndex],w=this.$("content").width(),W=w+this.$("rightscroller").width(),e,n=0,f;for(var i=0;i<this._aEdges.length;i++){e=this._aEdges[i];if(e+this._aWidths[i]-10<s+w){n=i;}else{if(e+this._aWidths[i]<s+W){f=true;}else{f=false;break;}}}return f&&d!==-1?this.getContent().length-1:n;};c.prototype._collectEdgesAndWidths=function(){var s=0,h=0,w=this.$("content").width();this._aEdges=[];this._aWidths=[];this.getContent().forEach(function(o,i){var d=o.$().width();this._aEdges.push(s);this._aWidths.push(d);s+=d;},this);};c.prototype._getLeftScroller=function(){if(!this._oLeftScroller){this._oLeftScroller=new I(this.getId()+"leftscroller",{src:"sap-icon://nav-back"});this._oLeftScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow");}return this._oLeftScroller;};c.prototype._getRightScroller=function(){if(!this._oRightScroller){this._oRightScroller=new I(this.getId()+"rightscroller",{src:"sap-icon://navigation-right-arrow"});this._oRightScroller.addStyleClass("sapSuiteUiCommonsMicroProcessFlowArrow");}return this._oRightScroller;};c.prototype._findEdgeItems=function(d){var $=this.$("scrolling"),e=$.parent(),f=this.$("leftscroller"),g=this.$("rightscroller"),h=this.getContent(),j=Math.abs($.position().left),w,E,F=-1,k=-1;if(j<10||d===0){F=0;this._clearScroll(e);}if(d===h.length-1){k=h.length-1;}w=$.width();for(var i=0;i<this._aEdges.length;i++){E=this._aEdges[i];if(F===-1&&E>=j){F=i;}if(k===-1&&(E+this._aWidths[i]>j+w+5)){k=i-1;break;}}this._iScrollingIndex=F;this._iLastVisibleIndex=k!==-1?k:h.length-2;};c.prototype._processKeyPress=function(){if(this._hasScrolling()){var $=this.$("scrolling");this._bKeyBoard=true;$.removeClass("sapSuiteUiCommonsMicroProcessFlowScrollingTransition");$.css("transform","");}};c.prototype.onsapspace=function(){this._firePress();};c.prototype.onsapenter=function(){this._firePress();};c.prototype.onsapnext=function(e){this._processKeyPress();};c.prototype.onsapprevious=function(){this._processKeyPress();};c.prototype.onsaphome=function(e){this._processKeyPress();};c.prototype.onsapend=function(){this._processKeyPress();};return c;});
