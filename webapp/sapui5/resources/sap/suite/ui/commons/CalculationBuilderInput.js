sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","./CalculationBuilderItem","sap/m/List","sap/m/ListMode","sap/m/StandardListItem","sap/m/Popover","sap/m/PlacementType","sap/m/Button","sap/m/ButtonType","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/m/OverflowToolbar","sap/m/ToolbarSeparator","sap/m/ToolbarSpacer","sap/m/Title","sap/m/OverflowToolbarToggleButton","sap/ui/core/CustomData","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/Device","sap/ui/dom/containsOrEquals"],function(q,l,C,a,L,b,S,P,c,B,d,M,f,g,O,T,h,j,k,m,n,J,D,o){"use strict";var E="&nbsp;&nbsp;";var p="┘┘";var I=l.CalculationBuilderItemType,V=l.CalculationBuilderValidationMode;var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var s=function(e){if(typeof e.which==="undefined"){return true;}else if(typeof e.which==="number"&&e.which>0){return!e.ctrlKey&&!e.metaKey&&!e.altKey&&e.which!==8;}return false;};var G=function(e,R){var N,u="",i=0;if(e instanceof q){e=e[0];}var v=e.nodeType;if(!v){while((N=e[i++])){u+=G(N,R);}}else if(v===1||v===9||v===11){for(e=e.firstChild;e;e=e.nextSibling){u+=G(e,R);}}else if(v===3||v===4){u+=R&&q(e).parent().hasClass("sapCalculationBuilderItemTextEmpty")&&e.nodeValue==="  "?"┘┘":e.nodeValue;}return u;};var t=C.extend("sap.suite.ui.commons.CalculationBuilderInput",{metadata:{library:"sap.suite.ui.commons",events:{change:{parameters:{value:"String",position:"integer",validate:"boolean"}}}},renderer:function(R,i){var e="contenteditable=\"true\"";if(i.getParent().getShowInputToolbar()&&!i._bReadOnly){R.write("<div class=\"sapCalculationBuilderInputToolbarWrapper\">");R.renderControl(i._oInputToolbar);R.write("</div>");}R.write("<div");R.writeControlData(i);R.addClass("sapCalculationBuilderInputWrapper");if(i._bReadOnly){e="";}R.writeClasses(i);R.write(" aria-label=\"\" >");R.write("<div aria-label=\"\" aria-describedby=\""+i.getId()+"-error\" spellcheck=\"false\""+e+" id=\""+i.getId()+"-input\" class=\"sapCalculationBuilderInput\"></div>");R.write("<div id=\""+i.getId()+"-error\" class=\"sapCalculationBuilderInputErrorArea\"></div>");R.write("</div>");}});t.prototype.init=function(){this._setupSuggestionList();this._iCarretPosition=0;this._sSuggestionText="";this._aVariables=[];this._oInputToolbar=new O(this.getId()+"-toolbar").addStyleClass("sapCalculationBuilderInputToolbar");this.addDependent(this._oInputToolbar);};t.prototype.exit=function(){if(this._oPopup){this._oPopup.destroy();}if(this._oInputToolbar){this._oInputToolbar.destroy();}};t.prototype.onAfterRendering=function(){this._setupKeyPress();this._setupEvents();this._setupAriaLabel();};t.prototype.onBeforeRendering=function(){this._aFunctions=this.getParent()._getAllFunctions();this._fillInputToolbar();};t.prototype.getFocusDomRef=function(){return this.getDomRef("input");};t.prototype._setupEvents=function(){var $=this.$("input");$.blur(function(){this._lastRangeSelection=this._getSelectionRange();}.bind(this));$.mouseup(function(e){this._iCarretPosition=this._getCaretPosition();}.bind(this));};t.prototype._validate=function(e){var i=this.getParent();if(i&&i.getValidationMode()===V.FocusOut){this.getParent()._validateInput(G(this.$("input")),e?this._iCarretPosition:0);}};t.prototype._setupKeyPress=function(){var i=this,u=this.getParent(),A=u&&u.getAllowSuggestions()&&D.system.desktop,v="paste input";if(D.browser.msie){v+=" keyup";}this.$("input").on('focus',function(){var $=q(this);$.data('before',G($[0]));}).on(v,function(e){var $=q(this),w=$.data('before'),x=e.key,y=G($[0]);if(i._oPopup.isOpen()&&x==="Enter"){return;}if(w!==y){var z=i._iCarretPosition=i._getCaretPosition();i._storeCurrent();i.fireChange({position:Math.max(0,z),value:G($[0],true)});if(A){i._checkSuggestions(z,y,s(e));if(i._sSuggestionText.length>0){i._filterSuggestionList(i._sSuggestionText);if(i._oSuggestionList.getItems().length===0){i._oPopup.close();}else{i._findCurrentSpan();if(!i._oPopup.isOpen()){var F=sap.ui.getCore().getConfiguration().getRTL(),H=q(i._oCurrentSpan),K=F?-($.width()-H.position().left-H.width()):H.position().left;var N=parseInt(K,10),Q=i.$("input").outerHeight()-(parseInt(q(i._oCurrentSpan).position().top,10)+q(i._oCurrentSpan).height())-10;i._iSuggestionSelectedIndex=-1;i._oPopup.setOffsetX(N);i._oPopup.setOffsetY(-Q);i._oPopup.openBy(i.getDomRef("input"));}}}}}});};t.prototype._createItemSpan=function(K,e){var i=function(){if(!K){return"sapCalculationBuilderItemTextEmpty";}if(e){return"sapCalculationBuilderItemTextError";}if(this._isOperator(K)){return"sapCalculationBuilderItemTextOperator";}return"sapCalculationBuilderItemTextDefault";}.bind(this);var F=K?"text":"html";var N=q('<span />',{title:e?e.title:"","class":i(),"aria-hidden":D.browser.msie})[F](K||E);return N;};t.prototype._findCurrentSpan=function(){var e;if(window.getSelection&&window.getSelection().getRangeAt){e=window.getSelection();this._oCurrentSpan=e.anchorNode.parentNode;if(!q(this._oCurrentSpan).is("span")){this._oCurrentSpan=this.$("input").children().first()[0];}}return this._oCurrentSpan;};t.prototype._setupSuggestionList=function(){var e=new n({path:"grouptitle",descending:false,group:function(i){return i.getProperty("grouptitle");}});var A=function(K){var N=this._createItemSpan(K);q(this._oCurrentSpan).after(N);return N;}.bind(this);var u=function($){var i=$.innerText,v=this._sSuggestionText.toLowerCase(),w=v.length,x=i.toLowerCase(),N="",y=(" "+x).indexOf(" "+v),z;if(y>-1){N+=i.substring(0,y);z=i.substring(y,y+w);N+="<span class=\"sapMInputHighlight\">"+z+"</span>";N+=i.substring(y+w);}else{N=i;}return N;}.bind(this);this._oSuggestionList=new L({mode:b.SingleSelectMaster,showNoData:false,enableBusyIndicator:false,rememberSelections:false,items:{path:"/data",factory:function(i,v){var w=v.getProperty(v.oModel.sPath),x=new S({title:w.title,customData:[new m({key:"key",value:w.key})]});x.addStyleClass("sapCalculationBuilderSuggestionItem");return x;},sorter:e},selectionChange:function(v){var w=v.getParameter("listItem"),x,y,F,K,z;if(w){K=w.getCustomData()[0].getValue();F=this._getFunction(K);q(this._oCurrentSpan).text(F?K+"(":K+"");q(this._oCurrentSpan).removeClass("sapCalculationBuilderItemTextError").addClass("sapCalculationBuilderItemTextDefault");this._iCarretPosition+=(K||"").length+1;if(F){z=this._getFunctionTemplateItems(F);x=z.length;if(x>0){z.forEach(function(K,i){this._oCurrentSpan=A(K)[0];if(!K&&!y){y=this._oCurrentSpan;}if(!y&&K){this._iCarretPosition+=K.length;}if(K&&i!==x-1){this._oCurrentSpan=A(" ");}}.bind(this));}else{y=this._oCurrentSpan=A("")[0];}var H=A(")");if(!y){this._oCurrentSpan=H[0];}}this._storeCurrent();var N=y||this._oCurrentSpan,Q=(N&&N.textContent&&N.textContent.length)||0;this.fireChange({position:this._getCaretPosition(N,F?1:Q),value:G(this.$("input")[0],true)});}this._oPopup.close();}.bind(this)});this._oSuggestionList.addEventDelegate({onAfterRendering:function(){this._oSuggestionList.$().find(".sapMDLILabel, .sapMSLITitleOnly, .sapMDLIValue").each(function(){this.innerHTML=u(this);});}.bind(this)});this._oPopup=new P(this.getId()+"-popup",{autoClose:false,contentWidth:"300px",showArrow:false,showHeader:false,placement:c.Vertical,horizontalScrolling:true,content:this._oSuggestionList,initialFocus:this}).attachAfterClose(function(i){this._clearSuggestion();}.bind(this));};t.prototype._checkSuggestions=function(e,u,v){var w=u[Math.max(e-1,0)];var x=function(w){return this._isOperator(w)||this._isEmptySpace(w);}.bind(this);if(!w||x(w)){this._clearSuggestion();return;}var W=v?w:"",y=v?2:1;e=Math.max(e,0);for(var i=e-y;i>=0;i--){if(x(u[i])){break;}W=u[i]+W;}for(i=e;i<u.length;i++){if(x(u[i])){break;}W=W+u[i];}if(!W){this._clearSuggestion();}this._sSuggestionText=W||"";};t.prototype._clearSuggestion=function(){this._sSuggestionText="";this._oCurrentSpan={};this._oPopup.close();};t.prototype._filterSuggestionList=function(e){var i=[];var A=function(K,v,w,x){var y=(v||K).toLowerCase(),z=e.toLowerCase();if((" "+y).indexOf(" "+z)!==-1){i.push({title:v||K,key:K,type:w,grouptitle:x});}};var u=this.getParent();u.getOperators().forEach(function(v){A(v.getKey(),v.getText(),I.CustomOperator,r.getText("CALCULATION_BUILDER_OPERATORS_TITLE"));});this._aVariables.forEach(function(v){var w=v.getGroup(),x,y=r.getText("CALCULATION_BUILDER_VARIABLES_TITLE");if(w){x=u.getGroups().filter(function(z){return z.getKey()===w;})[0];y=x?x.getTitle():y;}A(v.getKey(),v.getLabel(),I.Variable,y);});this._aFunctions.forEach(function(v){A(v.key,v.title,I.Function,r.getText("CALCULATION_BUILDER_FUNCTIONS_TITLE"));});i.sort(function(v,w){return v.title.toUpperCase()<w.title.toUpperCase()?-1:1;});this._oSuggestionList.setModel(new J({"data":i}));};t.prototype._getCaretPosition=function(u,v){var R,w,x,A=0;var y=function(N){return(u&&N===u)||(!u&&(N===w.anchorNode||N===w.anchorNode.parentNode));};var z=function(N){var F;if(y(N)){return false;}if(N.nodeType===3){A+=N.textContent.length;}else{for(var i=0;i<N.childNodes.length;i++){F=N.childNodes[i];if(y(F)){return false;}A+=F.textContent.length;}}return true;};try{if(window.getSelection&&window.getSelection().getRangeAt){R=window.getSelection().getRangeAt(0);w=window.getSelection();x=this.$("input")[0].childNodes;for(var i=0;i<x.length;i++){if(!z(x[i])){break;}}return(v||R.startOffset)+A;}}catch(e){return this._iCarretPosition;}return 0;};t.prototype._getSelectionRange=function(){var i,u=0,v=this.$("input")[0];if(typeof window.getSelection!=="undefined"){try{var R=window.getSelection().getRangeAt(0),w=R.cloneRange();if(!o(v,R.startContainer)){return this._lastRangeSelection;}w.selectNodeContents(v);w.setEnd(R.startContainer,R.startOffset);i=w.toString().length;u=i+R.toString().length;}catch(e){u=i=this._iCarretPosition||0;}}return{start:i,length:u-i};};t.prototype._setCaretPosition=function(e){var u=window.getSelection(),$=this.$("input"),v,R,w,F,x;var y=function(x){var z=$.children(),A,H,K=0;for(var i=0;i<z.length;i++){A=z[i];H=A.innerText||"";if(K+H.length>x){return{spanIndex:i,position:K+H.length-x};}K+=H.length;}return{spanIndex:Math.max(i-1,0),position:100};};if(typeof e==="number"){e=y(e);}w=e&&e.span;if(e){v=$[0];if(!w){w=v&&v.children&&v.children.length>e.spanIndex?v.childNodes[e.spanIndex]:null;}if(w){R=document.createRange();F=w.firstChild?w.firstChild:w;x=Math.min(F.length,e.position);R.setStart(F,x);R.collapse(true);u.removeAllRanges();u.addRange(R);}}};t.prototype._recreateText=function(e){var u=function(Q){var R;if(Q){if(!this._isEmptySpace(Q)){R=q.grep(e.errors,function(U){return U.index===y;})[0];}if(Q==="┘"){Q="";}H+=this._createItemSpan(Q,R)[0].outerHTML;if(!this._isEmptySpace(Q)){y++;}F++;}}.bind(this);var v=function(){for(;i<x.length;i++){w();if(!this._isEmptySpace(x[i])&&x[i]!=="("){i--;break;}W+=x[i];if(x[i]==="("){break;}}u(W);W="";}.bind(this);var w=function(Q){if(!K&&e.position===i){K={spanIndex:F-(Q||0),position:Q||W.length};}};var H="",x,y=0,A=this.getParent().getAllowStringConstants(),z=false,F=0,K=null,W="",N;x=e.text||G(this.$("input")[0],true);for(var i=0;i<x.length;i++){N=x[i];w();if(N==="\""&&A){z=!z;}if(z){W+=N;continue;}if(N==="┘"||this._isEmptySpace(N)||this._isOperator(N)){if(this._isFunction(W)){v();}else{u(W);u(N);W="";}if(N==="┘"){i++;w(1);}}else{W+=N;}}u(W);this.$("input").html(H);this._showErrorText(true,e.errors);if(e.position>0){this._setCaretPosition(K||{spanIndex:F-1,position:Number.MAX_SAFE_INTEGER});}};t.prototype._setupAriaLabel=function(){var e,i,A;if(D.browser.msie){return;}e=this.getParent();i=e._oExpressionBuilder._aErrors;A=r.getText("CALCULATION_BUILDER_EXPRESSION_TITLE")+": "+e.getExpression();if(i.length>0){A+=". "+r.getText("CALCULATION_BUILDER_ERROR_TITLE")+": ";i.forEach(function(u){A+=u.title+" ";});}this.$().attr("aria-label",A);};t.prototype._showErrorText=function(e,u){var $=this.$("error");u=u||this.getParent().getErrors();if((u&&u.length>0)&&e){var v="",w=5;for(var i=0;i<u.length&&i<w;i++){v+=u[i].title+"\n";}$.show();$.text(v);}else{$.hide();}};t.prototype._stringToItems=function(e){var i=[],u="",v="",w=0,x=false;var y=function(){var F,A="";if(v){F=this._getFunction(v);if(F){if(e[w]!=="("){A=I.Error;for(;w<e.length;w++){if(e[w]==="("){A="";break;}if(!this._isEmptySpace(e[w])){w--;break;}}}}var H=new a({key:v});H._sType=A;i.push(H);}v="";return!!F||!!A;}.bind(this);if(!e){e=G(this.$("input")[0],true);}for(;w<e.length;w++){u=e[w];if(u==="\""&&this.getParent().getAllowStringConstants()){v+="\"";if(x){i.push(new a({key:v}));v="";}x=!x;continue;}if(x){v+=u;continue;}if(u==="┘"){i.push(new a());w++;continue;}if(this._isEmptySpace(u)){if(v){y();}continue;}var N=e[w+1];if(N&&this._isOperator(u+N,false)){u+=N;w++;}var z=this._isOperator(u,false);if(z){if(y()){continue;}i.push(new a({key:u}));}else{v+=u;}}y();return i;};t.prototype._itemsToString=function(e){var u=e.items,v="",w="",x,y,z;var A=function(H){var K="";if(H){K=H.getKey();x=this._isFunction(K);if(x){K+="(";}}return K;}.bind(this);var F=function(H){return H&&H.getKey();};for(var i=0;i<u.length;i++){y=q.grep(e.errors,function(H){return H.index===i;})[0];z=A(u[i]);var N=F(u[i+1]);w+=this._createItemSpan(z,y)[0].outerHTML;if(!x&&z!=="("&&N!==")"&&i!==u.length-1&&N!==","){w+=this._createItemSpan(" ")[0].outerHTML;z+=" ";}v+=z;}this.$("input").html(w);return v;};t.prototype.onfocusin=function(e){if(this._bSetCaretOnFocus){this._setCaretPosition(this._iCarretPosition);}this._bSetCaretOnFocus=false;this._showErrorText(true);};t.prototype.onsapfocusleave=function(e){if(e.relatedControlId&&o(this._oPopup.getDomRef(),sap.ui.getCore().byId(e.relatedControlId).getFocusDomRef())){if(sap.ui.getCore().isMobile()||D.browser.safari){this._bSetCaretOnFocus=true;}this.focus();}else{this._showErrorText(false);this._validate(false);}};t.prototype.onsappageup=function(e){this._suggestionListKeyHandling({event:e,add:true,toEnd:true});if(!this._oPopup.isOpen()){this._iCarretPosition=G(this.$("input")).length-1;}};t.prototype.onsapnext=function(e){if(this._iCarretPosition<G(this.$("input")).length-1){this._iCarretPosition++;}};t.prototype.onsapprev=function(e){if(this._iCarretPosition>0){this._iCarretPosition--;}};t.prototype.onsappagedown=function(e){this._suggestionListKeyHandling({event:e,add:false,toEnd:true});if(!this._oPopup.isOpen()){this._iCarretPosition=0;}};t.prototype.onsapdown=function(e){this._suggestionListKeyHandling({event:e,add:true});};t.prototype.onsapescape=function(e){if(this._oPopup.isOpen()){this._oPopup.close();}};t.prototype.onsapup=function(e){this._suggestionListKeyHandling({event:e,add:false});};t.prototype.onsapenter=function(e){if(this._oPopup.isOpen()){this._oSuggestionList.fireSelectionChange({listItem:this._oSuggestionList.getSelectedItem()});}else{this._validate(true);}e.preventDefault();e.stopPropagation();};t.prototype._suggestionListKeyHandling=function(e){var i=e.event,A=e.add,u=e.toEnd,v,w;if(!this._oPopup.isOpen()||!i){return;}A?this._iSuggestionSelectedIndex++:this._iSuggestionSelectedIndex--;v=this._oSuggestionList.$().find(".sapCalculationBuilderSuggestionItem");w=v.length;if((this._iSuggestionSelectedIndex<0)||(!A&&u)){this._iSuggestionSelectedIndex=w-1;}else if((this._iSuggestionSelectedIndex>=w)||(A&&u)){this._iSuggestionSelectedIndex=0;}this._oSuggestionList.removeSelections(true);sap.ui.getCore().byId(v[this._iSuggestionSelectedIndex].id).setSelected(true).focus();i.preventDefault();i.stopPropagation();};t.prototype._displayError=function(e){this.$("input")[e?"addClass":"removeClass"]("sapCalculationBuilderInputError");};t.prototype._insertItemFromToolbar=function(K){var $=this.$("input"),e,N,R;var i=" "+K+" ",F=this._getFunction(K),u=i.length,v;var w=function(){return{start:$.text().length,length:0};};R=this._getSelectionRange()||w();$.focus();this._lastRangeSelection={};e=G($[0],true);if(e[R.start]==="┘"&&e[R.start-1]==="┘"&&R.length===0){R.start--;R.length+=2;}if(F){i=" "+K+"(";v=this._getFunctionTemplateItems(F);if(v.length>0){v.forEach(function(K){i+=K?K:p;});}else{i+=p;}i+=") ";u=i.indexOf(p)+1;}N=[e.slice(0,R.start),i,e.slice(R.start+R.length)].join('');this.fireChange({value:N,position:R.start+u});this._storeCurrent();};t.prototype._convertEmptyHashes=function(e){return e?e.replace(new RegExp(p,'g'),"  "):"";};t.prototype._fillInputToolbar=function(){var e=function(X,Y){return new B({type:d.Transparent,text:X==="*"?"x":X,press:this._insertItemFromToolbar.bind(this,X)}).addStyleClass("sapCalculationBuilderInputToolbarButtons "+Y);}.bind(this);var i=function(X){if(X){return X.map(function(Y){return new g({key:Y.getKey(),text:Y._getLabel()});}).sort(function(Y,Z){return Y.getText().localeCompare(Z.getText());});}return[];};var u=function(X){return X.map(function(Y){return new g({key:Y.getKey(),text:Y.getText()?Y.getText():Y.getKey()});}).sort(function(Y,Z){return Y.getText().localeCompare(Z.getText());});};var v=function(X){return X.map(function(Y){return new g({key:Y,text:Y});});};var w=function(){var H=this.getParent(),X=H.getAllowComparisonOperators(),Y=H.getAllowLogicalOperators(),Z=H.getOperators(),$=Z.length>0,_,a1,b1,c1=[];if(X){_=v(Object.keys(z));c1.push(new g({text:r.getText("CALCULATION_BUILDER_COMPARISON_TITLE"),items:_}));}if(Y){a1=v(Object.keys(A));c1.push(new g({text:r.getText("CALCULATION_BUILDER_LOGICAL_TITLE"),items:v(Object.keys(A))}));}if($){b1=u(Z);c1.push(new g({text:r.getText("CALCULATION_BUILDER_ADDITIONAL_OPERATOR"),items:b1}));}if(c1.length>1){return c1;}if(X){return _;}if(Y){return a1;}if($){return b1;}return[];}.bind(this);var x=function(X){return new f({text:X,menu:new M({itemSelected:function(Y){this._insertItemFromToolbar(Y.getParameters().item.getKey());}.bind(this)})}).addStyleClass("sapCalculationBuilderInputToolbarFunctionMenu").addStyleClass("sapCalculationBuilderInputToolbarMenuButtons");}.bind(this);var y=l.CalculationBuilderOperatorType,z=l.CalculationBuilderComparisonOperatorType,A=l.CalculationBuilderLogicalOperatorType,F=w(),H=this.getParent(),K=!!H.getTitle()&&(H.getLayoutType()===l.CalculationBuilderLayoutType.TextualOnly),N;this._oInputToolbar.removeAllContent();this._oInputToolbar.addContent(new j({text:H.getTitle(),visible:K}));this._oInputToolbar.addContent(new h());Object.keys(y).forEach(function(X){this._oInputToolbar.addContent(e(y[X],""));}.bind(this));this._oInputToolbar.addContent(new T().addStyleClass("sapUiSmallMarginBeginEnd"));if(F.length>0){this._oInputToolbar.addContent(new f({text:r.getText("CALCULATION_BUILDER_OPERATORS_TITLE"),menu:new M({itemSelected:function(X){this._insertItemFromToolbar(X.getParameters().item.getKey());}.bind(this),items:F})}).addStyleClass("sapCalculationBuilderInputToolbarMenuButtons"));}N=this._aFunctions.map(function(X){return new g({key:X.key,text:X.title});});var Q=x(r.getText("CALCULATION_BUILDER_FUNCTIONS_AND_VARIABLES_TITLE"));if(N.length>0){Q.getMenu().addItem(new g({text:r.getText("CALCULATION_BUILDER_FUNCTIONS_TITLE"),items:[N]}));}var R=H._getGroupMap(),U=H.getGroups(),W=R["##DEFAULT##"];if(W&&W.length>0){Q.getMenu().addItem(new g({text:r.getText("CALCULATION_BUILDER_VARIABLES_TITLE"),items:i(W)}));}U.forEach(function(X){var Y=R[X.getKey()];if(Y&&Y.length>0){Q.getMenu().addItem(new g({text:X._getTitle(),items:i(Y)}));}});this._oInputToolbar.addContent(Q);};t.prototype._isOperator=function(e,A){return this.getParent()&&this.getParent()._isOperator(e,A);};t.prototype._getFunctionTemplateItems=function(F){return this.getParent()._getFunctionTemplateItems(F);};t.prototype._isEmptySpace=function(e){return e===String.fromCharCode(160)||e===" ";};t.prototype._isEmptyItem=function(e){return e===E;};t.prototype._getText=function(){return this.$("input").text();};t.prototype._isFunction=function(K){return!!this._getFunction(K);};t.prototype._getFunction=function(K){var e=this.getParent();return e&&e._isTokenAllowed(K)&&e._getFunctionDefinition(K);};t.prototype._storeCurrent=function(v){var $=this.$("input");$.data('before',$.text());};return t;});
