sap.ui.define(["sap/suite/ui/commons/statusindicator/Shape","sap/suite/ui/commons/statusindicator/ShapeGroup","sap/suite/ui/commons/statusindicator/CustomShape","sap/base/Log"],function(S,a,C,L){"use strict";var A=function(s){this._oStatusIndicator=s;this.aOnDiscreteThresholdChange=[];this.aOnPropertyThresholdChange=[];};A.prototype.addDiscreteThresholdChange=function(c){this.aOnDiscreteThresholdChange.push(c);};A.prototype.addPropertyThresholdChange=function(c){this.aOnPropertyThresholdChange.push(c);};A.prototype.getValue=function(s,i){var p=s.getParent();if(!p instanceof a){L.fatal("Shape should be always direct child of ShapeGroup.");return i;}if(!this._oStatusIndicator._discreteThresholdsEnabled()){return i;}return this._getGroupValue(p,this._getCappedValue(p,i));};A.prototype._getCappedValue=function(g,s){var n=this._getStatusIndicatorValue(g,s);var d=this._oStatusIndicator._getDiscreteThresholdForValue(n);return d?d.getValue():0;};A.prototype.propagateValueChange=function(s,n){if(!this._oStatusIndicator._discreteThresholdsEnabled()){return;}var g=s.getParent();var o=this._getCappedValue(g,s.getDisplayedValue());var N=this._getCappedValue(g,n);if(o!==N){this.aOnDiscreteThresholdChange.forEach(function(O){O(N);});}};A.prototype.getColor=function(s,i){var p=s.getParent();if(p instanceof C){i=p.getDisplayedValue();p=p.getParent();}var b=this._getStatusIndicatorValue(p,i);var n=s._getCssFillColor();if(this._oStatusIndicator._propertyThresholdsEnabled()){var P=this._oStatusIndicator._getPropertyThresholdForValue(b);if(P){n=P._getCssFillColor();}}return n;};A.prototype.propagateColorChange=function(s,i){if(!this._oStatusIndicator._propertyThresholdsEnabled()){return;}var p=s.getParent();var n=this._getPropertyThreshold(p,i);var o=this._getPropertyThreshold(p,s.getDisplayedValue());if(n!==o){this.aOnPropertyThresholdChange.forEach(function(O){O(n._getCssFillColor());});}};A.prototype._getPropertyThreshold=function(g,s){var i=this._getStatusIndicatorValue(g,s);return this._oStatusIndicator._getPropertyThresholdForValue(i);};A.prototype._getStatusIndicatorValue=function(c,s){var t=this;var g=this._oStatusIndicator.getGroups();var i=0;g.some(function(G){var f=G.getWeight()/t._getTotalWeight();if(G!==c){var F=100*f;i+=F;return false;}var b=s*f;i+=b;return true;});return Number(i.toPrecision(3));};A.prototype._getGroupValue=function(c,s){var g=this._oStatusIndicator.getGroups();var t=this._getTotalWeight();var r=0;g.some(function(G){var f=G.getWeight()/t;var n;if(s===0){n=0;}else if(s>=100*f){n=100;}else{n=s/f;}s-=n*f;if(c!==G){return false;}r=n;return true;});return r;};A.prototype._getTotalWeight=function(){return this._oStatusIndicator.getGroups().reduce(function(i,g){return i+g.getWeight();},0);};return A;});
