sap.ui.define(["sap/ui/thirdparty/jquery","sap/suite/ui/commons/library","sap/ui/core/Control","sap/ui/core/theming/Parameters","sap/m/Panel","sap/ui/model/json/JSONModel","sap/m/Dialog","sap/m/Button","sap/m/FlexBox","sap/m/Label","sap/ui/model/Filter","sap/m/SearchField","sap/m/List","sap/m/StandardListItem","sap/m/CheckBox","sap/m/Title","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Text","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/model/FilterOperator","sap/base/security/encodeXML","sap/ui/core/format/NumberFormat","sap/ui/core/Core","sap/ui/core/Configuration","sap/m/ButtonType","./TAccountUtils","./TAccountPanelRenderer"],function(q,l,C,P,a,J,D,B,F,L,b,S,c,d,e,T,f,g,h,j,k,m,n,N,o,p,r,s,t){"use strict";var R=o.getLibraryResourceBundle("sap.suite.ui.commons");var u=l.taccount.TAccountPanelState;var v=a.extend("sap.suite.ui.commons.taccount.TAccountPanel",{metadata:{library:"sap.suite.ui.commons",properties:{title:{type:"string",group:"Misc",defaultValue:null},state:{type:"sap.suite.ui.commons.taccount.TAccountPanelState",group:"Misc",defaultValue:"Default"},showOverlay:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{properties:{type:"sap.suite.ui.commons.taccount.TAccountItemProperty",multiple:true,singularName:"property"},table:{type:"sap.ui.core.Control",multiple:false}},events:{stateChanged:{parameters:{state:"sap.suite.ui.commons.taccount.TAccountPanelState"}},settingsApplied:{parameters:{properties:"object"}}}}});v.prototype.init=function(){this._bDisplayLabels=true;};v.prototype.onBeforeRendering=function(){this._oSum=null;this._prepareProperties();this._createToolbar();};v.prototype.onAfterRendering=function(){var $=this.$();this._switchContent(this.getState()===u.Table);$.attr("aria-label",this._getAriaLabelText());$.addClass("sapSuiteUiCommonsAccountPanel");this._setTotalBalanceTitle();};v.prototype.getSum=function(){var w=0,M="",x=true,y=this.getContent();if(!this._oSum){for(var i=0;i<y.length;i++){var G=y[i];if(G instanceof sap.suite.ui.commons.taccount.TAccountGroup){var z=G._getSum();if((M&&M!==z.measure)||!z.correct){x=false;break;}M=z.measure;w+=z.sum;}}this._oSum={measure:M,sum:w||0,correct:x};}return this._oSum;};v.prototype.switchContent=function(i){var w=i?u.Table:u.Default;this._switchContent(i);this.setProperty("state",w,true);};v.prototype.getSettingsDialog=function(){return this._getPopover();};v.prototype.getToolbar=function(){return this._getToolbar();};v.prototype.openSettings=function(){this._oSelectAllCheckBox&&this._oSelectAllCheckBox.setText(this._getSelectAllText());this._getPopover().open();};v.prototype.setState=function(V){var i=V===u.Table;this._switchContent(i);this.setProperty("state",V,true);return this;};v.prototype._switchContent=function(i){var w=i?u.Table:u.Default;this.$("table")[i?"show":"hide"]();this.$("datacontent")[i?"hide":"show"]();if(this._oDisplaySwitcher){this._oDisplaySwitcher.setSelectedKey(w);}};v.prototype._prepareProperties=function(){this._mProperties={};this.getProperties().forEach(function(i){var K=i.getKey();if(K){this._mProperties[K]=i;}}.bind(this));};v.prototype._setPropertiesVisibility=function(w){var $=this.$();Object.keys(w).forEach(function(K){var x=w[K],I=$.find(".sapSuiteUiCommonsAccountPropertyWrapper[key="+K+"]");I.each(function(i,y){var V=x.getVisible(),z=o.byId(y.id);if(z){z.setProperty("visible",V,true);z.getParent()._refreshAriaLabel();}q(y)[V?"show":"hide"]();});});$.find(".sapSuiteUiCommonsAccountItemLabel")[this._bDisplayLabels?"show":"hide"]();};v.prototype._getPopover=function(){if(!this._oPopover){this._createPopover();}return this._oPopover;};v.prototype._getSelectAllText=function(i){var w=this.getProperties();if(!i&&i!==0){i=w.reduce(function(x,y){return x+(y.getVisible()?1:0);},0);}this._iSelectedCount=i;return R.getText("TACCOUNT_SELECTALL")+" ("+i+"/"+w.length+")";};v.prototype._createPopover=function(){var i=this,w=false;if(!this._oPopover){this._oPopover=new D({contentWidth:"450px",title:R.getText("TACCOUNT_DISPLAYOPTIONS"),afterOpen:function(){if(!w){var M=i._oPopover.$().height();i._oPopover.setProperty("contentHeight",M+"px",true);w=true;}}});}this._oPopover.setEndButton(new B({text:R.getText("TACCOUNT_CANCEL"),press:function(M){i._oPopover.close();}}));this._oPopover.setBeginButton(new B({text:R.getText("TACCOUNT_OK"),type:r.Emphasized,press:function(M){var O=E.getSelectedContexts(true),Q=E.getModel();var V={},U={};O.forEach(function(X){var Y=Q.getProperty(X.sPath);if(Y){var Z=i._mProperties[Y.key];V[Y.key]=1;if(Z&&!Z.getVisible()){Z.setProperty("visible",true,true);U[Y.key]=Z;}}});Object.keys(i._mProperties).forEach(function(X){var Y=i._mProperties[X];if(Y.getVisible()&&!V[X]){Y.setProperty("visible",false,true);U[X]=Y;}});i._bDisplayLabels=x.getSelected();if(i.fireEvent("settingsApplied",{properties:U},true)){i._setPropertiesVisibility(U);}i._oPopover.close();}}));this._oPopover.removeAllContent();var W=new F({width:"100%",renderType:"Bare",direction:"Column"});this._oPopover.addContent(W);var x=new e({selected:this._bDisplayLabels}).addStyleClass("sapUiTinyMarginBegin");var y=new F({renderType:"Bare",alignItems:"Center",items:[x,new L({text:"Show labels"}).addStyleClass("sapUiTinyMarginBegin")]}).addStyleClass("sapUiTinyMarginBottom sapUiTinyMarginTop");W.addItem(y);var z=function(M){var O=[],Q=M.getSource().getValue();if(Q&&Q.length>0){O.push(new b("title",m.Contains,Q));}var U=E.getBinding("items");U.filter(O,"Application");};var A=new S({width:"100%",liveChange:z}).addStyleClass("sapSuiteUiCommonsAccountsPopupSearch");W.addItem(A);var E=new c({width:"100%",mode:"MultiSelect",includeItemInSelection:true,selectionChange:function(M){var O=M.getParameter("listItem").getSelected();i._oSelectAllCheckBox.setText(i._getSelectAllText(i._iSelectedCount+(O?1:-1)));i._oSelectAllCheckBox.setSelected(G.length===i._iSelectedCount);}}).addStyleClass("sapSuiteUiCommonsAccountsPopupList");E.bindAggregation("items",{path:"/items",template:new d({title:"{title}",selected:"{selected}"})});var G=this.getProperties(),H=this._getSelectAllText();this._oSelectAllCheckBox=new e({selected:G.length===i._iSelectedCount,text:H,select:function(M){var O=M.getSource().getSelected();i._oSelectAllCheckBox.setText(i._getSelectAllText(O?G.length:0));E.getItems().forEach(function(Q){Q.setSelected(O);});}}).addStyleClass("sapUiTinyMarginBegin sapUiTinyMarginEnd sapSuiteUiCommonsAccountsPopupSelectAll");var I=new F({renderType:"Bare",alignItems:"Center"}).addStyleClass("sapSuiteUiCommonsAccountsPopupSelectAllWrapper");I.addItem(this._oSelectAllCheckBox);W.addItem(I);W.addItem(E);var K=[];G.forEach(function(M){K.push({title:M._getLabel(),key:M.getKey(),selected:M.getVisible()});});E.setModel(new J({items:K}));return this._oPopover;};v.prototype._getToolbar=function(){if(!this._oToolbar){this._createToolbar();}return this._oToolbar;};v.prototype._createToolbar=function(){var i=this;if(this._oToolbar){return;}this._oToolbar=new f();this._oToolbar.addContent(new T(this.getId()+"-toolbartitle",{text:this.getTitle()}));this._oToolbar.addContent(new g(this.getId()+"-toolbarspacer"));this._oToolbar.addContent(new h(this.getId()+"-toolbarbalancelabel",{wrapping:false,text:R.getText("TACCOUNT_TOTALBALANCE")+":"}).addStyleClass("sapSuiteUiCommonsAccountPanelLabel"));this._oToolbar.addContent(new h(this.getId()+"-toolbarsumtitle",{wrapping:false}).addStyleClass("sapSuiteUiCommonsAccountPanelSum"));this._oDisplaySwitcher=new j(this.getId()+"-toolbarswitcher",{selectionChange:function(E){var I=o.byId(i._oDisplaySwitcher.getSelectedItem());if(I){i.switchContent(I.getKey()===u.Table);i.fireStateChanged({state:I.getKey()});}},items:[new k({key:u.Default,tooltip:R.getText("TACCOUNT_DEFAULT"),icon:"sap-icon://screen-split-two"}),new k({key:u.Table,tooltip:R.getText("TACCOUNT_TABLE"),icon:"sap-icon://table-chart"})]});this._oToolbar.addContent(this._oDisplaySwitcher);this._oToolbar.addContent(new B(this.getId()+"-toolbarsettings",{icon:"sap-icon://action-settings",press:this.openSettings.bind(this)}));this.setHeaderToolbar(this._oToolbar);};v.prototype._getSumText=function(){var i=this.getSum();if(!i.correct){return" - ";}return s.formatCurrency(Math.abs(i.sum),i.measure)+" "+n(i.measure);};v.prototype._setTotalBalanceTitle=function(){var i=this.getSum(),w="";if(!i.correct||i.sum===0){w=R.getText("TACCOUNT_TOTALBALANCE");}else{w=i.sum>0?R.getText("TACCOUNT_TOTALCREDIT"):R.getText("TACCOUNT_TOTALDEBIT");}this.$("toolbarbalancelabel").text(w+":");this.$("toolbarsumtitle").text(this._getSumText());};v.prototype._getAriaLabelText=function(){return"T account panel "+this.getTitle()+" "+this._getSumText();};v.prototype._valueChanged=function(i){var w=this.getSum();if(w.correct){this._oSum.sum+=i;this._setTotalBalanceTitle();}};v.prototype.setShowOverlay=function(V){this.setProperty("showOverlay",V,true);this.$("overlay")[V?"addClass":"removeClass"]("sapSuiteUiCommonsAccountPanelOverlayVisible");};return v;});
