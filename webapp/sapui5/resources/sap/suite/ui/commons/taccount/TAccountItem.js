sap.ui.define(["sap/ui/thirdparty/jquery","sap/suite/ui/commons/library","sap/ui/core/Control","sap/ui/core/theming/Parameters","sap/suite/ui/commons/taccount/TAccountPanel","sap/suite/ui/commons/taccount/TAccountGroup","sap/ui/core/format/NumberFormat","sap/ui/core/Core","sap/ui/core/library","./TAccountUtils"],function(q,l,C,P,T,a,N,b,c,d){"use strict";var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var e=C.extend("sap.suite.ui.commons.taccount.TAccountItem",{metadata:{library:"sap.suite.ui.commons",properties:{value:{type:"float",group:"Misc",defaultValue:0},color:{type:"sap.m.ValueCSSColor",group:"Misc",defaultValue:null},group:{type:"string",group:"Misc",defaultValue:""},ariaLabel:{type:"string",group:"Misc",defaultValue:""}},aggregations:{properties:{type:"sap.suite.ui.commons.taccount.TAccountItemProperty",multiple:true,singularName:"property"}},events:{press:{}}},renderer:function(R,i){var s=i.getColor(),u=i.getParent()&&i.getParent().getMeasureOfUnit(),v=d.formatCurrency(i.getValue(),u),t=v+" "+u;R.write("<div tabindex=\"0\"");R.addClass("sapSuiteUiCommonsAccountItem");R.writeClasses(i);R.writeControlData(i);if(i.getGroup()){R.writeAttributeEscaped("group",i.getGroup());}R.writeAttribute("aria-selected","false");R.writeAttribute("aria-setsize",i._indexSize);R.writeAttribute("aria-posinset",i._index);R.writeAttribute("role","option");R.writeAttributeEscaped("aria-label",i._getAriaLabel(t));R.write(">");R.write("<div class=\"sapSuiteUiCommonsAccountColorBar\"");if(s&&c.CSSColor.isValid(s)){R.write("style=\"background-color:"+s+"\"");}else if(c.CSSColor.isValid(P.get(s))){R.write("style=\"background-color:"+P.get(s)+"\"");}R.write(">");R.write("</div>");R.write("<div id=\""+i.getId()+"-content\" class=\"sapSuiteUiCommonsAccountContent\">");R.write("<div class=\"sapSuiteUiCommonsAccountItemTitleWrapper\">");R.write("<span class=\"sapSuiteUiCommonsAccountItemTitle\">");R.write(t);R.write("</span>");R.write("</div>");R.write("<div class=\"sapSuiteUiCommonsAccountItemProperties\">");i.getProperties().forEach(function(p){R.renderControl(p);});R.write("</div>");R.write("</div>");R.write("</div>");}});e.prototype.onBeforeRendering=function(){this._prepareProperties();};e.prototype.onAfterRendering=function(){this.$().on("click",this._click.bind(this));};e.prototype._refreshAriaLabel=function(v){this.$().attr("aria-label",this._getAriaLabel());};e.prototype._getAriaLabel=function(t){var A=this.getAriaLabel();if(A){return A;}if(!t){var u=this.getParent()&&this.getParent().getMeasureOfUnit(),v=d.formatCurrency(this.getValue(),u),t=v+" "+u;}var s=(this._bIsDebit?r.getText("TACCOUNT_DEBIT"):r.getText("TACCOUNT_CREDIT"))+" "+r.getText("TACCOUNT_ITEM");s+=" "+t+" ";this.getProperties().forEach(function(i){if(i.getVisible()){s+=i.getLabel()+":"+i.getValue()+" ";}});return s;};e.prototype._click=function(){var E=this.fireEvent("press",{},true);if(E){this._highlightItems();}};e.prototype._highlightItems=function(){var $=this.$(),g=this.getGroup(),s=!$.is(".sapSuiteUiCommonsAccountItemSelected, .sapSuiteUiCommonsAccountItemSelectedByGroup"),f=q(".sapSuiteUiCommonsAccountItemSelected");this._setAriaHighlighted(f,false);this._setAriaHighlighted($,s);f.removeClass("sapSuiteUiCommonsAccountItemSelected");s?$.addClass("sapSuiteUiCommonsAccountItemSelected"):$.removeClass("sapSuiteUiCommonsAccountItemSelected");var p=this._findHighlightParent();if(p){var h=q(".sapSuiteUiCommonsAccountItemSelectedByGroup");h.removeClass("sapSuiteUiCommonsAccountItemSelectedByGroup");this._setAriaHighlighted(h,false);if(g&&s){var G=q(".sapSuiteUiCommonsAccountItem[group="+g+"]");G.addClass("sapSuiteUiCommonsAccountItemSelectedByGroup");var t=this;G.each(function(i,j){var E=sap.ui.getCore().byId(j.id);if(E){t._setAriaHighlighted(E.$(),true);var o=E.getParent();if(o){o.$().addClass("sapSuiteUiCommonsAccountItemSelectedByGroup");var k=o.getParent();if(k instanceof a){k.$().addClass("sapSuiteUiCommonsAccountItemSelectedByGroup");}}}});}}};e.prototype.onsapenter=function(){this._highlightItems();};e.prototype.onsapspace=function(){this._highlightItems();};e.prototype._setAriaHighlighted=function($,s){$.attr("aria-selected",s);$.attr("aria-label",s?r.getText("COLORED_ITEM_FROM")+" "+this.getGroup():this._getAriaLabel());};e.prototype._findHighlightParent=function(){var p=this.getParent();p=p&&p.getParent();if(p instanceof a){var o=p.getParent();return o instanceof T||p;}return null;};e.prototype._prepareProperties=function(){this._mProperties={};this.getProperties().forEach(function(p){var k=p.getKey();if(k){this._mProperties[k]=p;}}.bind(this));};e.prototype.setValue=function(v){var o=this.getValue(),D=(this._bIsDebit?-1:1)*(v-o);this.setProperty("value",v);this.getParent()&&this.getParent()._valueChanged(D);};return e;});
