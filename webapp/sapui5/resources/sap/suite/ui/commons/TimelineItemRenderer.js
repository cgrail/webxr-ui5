/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["./library","sap/suite/ui/commons/util/HtmlElement","sap/ui/core/format/DateFormat","sap/ui/core/Icon","sap/base/security/encodeXML","sap/base/security/encodeCSS"],function(l,H,D,I,e,a){"use strict";var T=l.TimelineAlignment;var b={};var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons"),M=24*60*60*1000;b.render=function(R,t){this._getTimelineItemElement(t).getRenderer().render(R);};b._getTimelineItemElement=function(t){if(t._orientation==="V"){return this._getVerticalTimelineItemElement(t);}else{return this._getHorizontalTimelineItemElement(t);}};b._getFormatedDateTime=function(t,A){A=A||{};var R=A.resBundle||r,d=A.dateFormat||D.getDateInstance({style:"short"}),o=A.timeFormat||D.getTimeInstance({style:"short"}),c=t.getDateTimeWithoutStringParse(),f,g,i,C;if(!(c instanceof Date)||(isNaN(c.getTime()))){return c;}f=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());g=new Date();g=Date.UTC(g.getFullYear(),g.getMonth(),g.getDate());i=Math.floor((g-f)/M);switch(i){case 0:C=R.getText("TIMELINE_TODAY");break;case 1:C=R.getText("TIMELINE_YESTERDAY");break;default:C=d.format(c);}return C+" "+R.getText("TIMELINE_AT")+" "+o.format(c);};b._getHorizontalTimelineItemElement=function(t){var i=(t._placementLine==="top"),s=i?"sapSuiteUiCommonsTimelineItemHTop":"sapSuiteUiCommonsTimelineItemHBottom",c=t.getText()==="GroupHeader",g=t._groupID,A,o;if(c){return this._getGroupHeaderElement(t);}var d=new H("li"),f=new H("div"),h=new H("div"),j=new H("div"),k=new H("div"),m=new H("div"),n=new H("div"),p=this._getTimelineItemShell(t);if(g){d.setAttribute("groupid",t._groupID);}if(t._isFirstGroupEvenItem){d.setAttribute("firstgroupevenitem",t._isFirstGroupEvenItem);}d.addControlData(t);d.addClass("sapSuiteUiCommonsTimelineItemLiWrapperV");d.addClass(e(s));f.addClass("sapSuiteUiCommonsTimelineItemWrapperH sapSuiteUiCommonsTimelineItemBaseLength");d.addChild(f);h.addClass("sapSuiteUiCommonsTimelineItemBubbleSpacer");f.addChild(h);j.addClass("sapSuiteUiCommonsTimelineItemBubble");h.addChild(j);k.addClass("sapSuiteUiCommonsTimelineItemOutline");k.setId(t.getId()+"-outline");k.setAttribute("tabindex","0");k.setAttribute("data-sap-ui-fastnavgroup",true);this._addAccessibilityTags(k,t);m.addClass("sapSuiteUiCommonsTimelineItemBox");k.addChild(m);n.addClass("sapSuiteUiCommonsTimelineItemArrow");if(i){j.addChild(k);j.addChild(n);}else{j.addChild(n);j.addChild(k);}if(!t._callParentFn("_isGrouped")&&t._callParentFn("getEnableDoubleSided")&&t._index===1){o=t.getParent();A="margin-left";if(o&&o._bRtlMode){A="margin-right";}d.addStyle(a(A),"100px");}m.addChild(p);if(t._isGroupCollapsed()){d.addStyle("display","none");}return d;};b._getGroupHeaderElement=function(t){var c=new H("li"),d=new H("div"),f=new H("div"),g=new H("div"),h=new H("div"),i=new H("div"),j=new H("span"),k=new H("div"),m=new H("div"),n=new H("div"),o=t._orientation==="V"?f:g,p=new H("div"),q=new H("div"),s=new H("div");var u=t._isGroupCollapsed(),S=t._callParentFn("getShowIcons"),v;if(t._groupID){c.setAttribute("groupid",t._groupID);}if(t._isLastGroup){c.addClass("sapSuiteUiCommonsTimelineLastItem");}c.addControlData(t);c.addClass("sapSuiteUiCommonsTimelineGroupHeader");this._addAccessibilityTags(c,t,true);c.addChild(d);d.addChild(f);d.addClass("sapSuiteUiCommonsTimelineGroupHeaderDirectChild");f.addClass("sapSuiteUiCommonsTimelineGroupHeaderMainWrapper");f.setId(t.getId()+"-outline");f.setAttribute("tabindex","0");f.setAttribute("data-sap-ui-fastnavgroup",true);f.addChild(g);c.addChild(n);c.setAttribute("nodeType","GroupHeader");h.addClass("sapSuiteUiCommonsTimelineGroupHeaderSpanWrapper");if(t._orientation==="V"){c.addClass(t._position===T.Left?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight");}g.addClass("sapSuiteUiCommonsTimelineGroupHeaderWrapper");g.addClass("sapSuiteUiCommonsTimelineGroupHeaderPointer");o.addChild(i);g.addChild(m);g.addChild(h);c.addClass(u?"sapSuiteUiCommonsTimelineGroupCollapsed":"sapSuiteUiCommonsTimelineGroupExpanded");m.addClass("sapSuiteUiCommonsTimelineGroupHeaderIconWrapper");v=t._getCorrectGroupIcon();t._objects.register("groupCollapseIcon",function(){var w=new I(t.getId()+"-groupCollapseIcon",{src:v,decorative:true});w.addStyleClass("sapSuiteUiCommonsTimelineGroupHeaderPointer");w.setParent(t);return w;});m.addChild(t._objects.getGroupCollapseIcon());i.addClass("sapSuiteUiCommonsTimelineItemArrow");n.addClass("sapSuiteUiCommonsTimelineGroupHeaderLineWrapper");k.addClass("sapSuiteUiCommonsTimelineGroupHeaderLine");n.addChild(k);h.addChild(j);j.addClass("sapSuiteUiCommonsTimelineGroupHeaderSpan");j.addChildEscaped(" "+t.getTitle());if(t._orientation==="V"){c.addChild(p);q.addChild(t._getLineIcon());p.addChild(q);q.addClass("sapSuiteUiCommonsTimelineItemBarIconWrapperV");p.addClass("sapSuiteUiCommonsTimelineGroupHeaderBarWrapper");if(!t._isGroupCollapsed()){p.addStyle("display","none");}s.addClass("sapSuiteUiCommonsTimelineItemBarV");if(!S){s.addClass("sapSuiteUiCommonsTimelineItemBarNoIcon");}p.addChild(s);if(t._additionalBarClass){s.addClass(e(t._additionalBarClass));}}return c;};b._getVerticalTimelineItemElement=function(t){var c=new H("li"),d=new H("div"),f=new H("div"),g=new H("div"),h=new H("div"),i=new H("div"),j=new H("div"),k=new H("div"),m=new H("div"),n=new H("div"),o=new H("div"),p;var s=t._callParentFn("getShowIcons"),G=t._groupID,q=t.getText()==="GroupHeader",S=t._getStatusColorClass();if(q){return this._getGroupHeaderElement(t);}if(G){c.setAttribute("groupID",G);}c.addControlData(t);c.addClass("sapSuiteUiCommonsTimelineItem");c.setAttribute("role","presentation");if(t._isLast){c.addClass("sapSuiteUiCommonsTimelineLastItem");}d.addClass(q?"sapSuiteUiCommonsTimelineItemWrapperGrp":"sapSuiteUiCommonsTimelineItemWrapperV");c.addChild(d);d.addClass(t._position===T.Left?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight");d.addChild(h);d.addChild(f);f.addClass("sapSuiteUiCommonsTimelineItemBarWrapperV");g.addClass("sapSuiteUiCommonsTimelineItemBarIconWrapperV");if(S){g.addClass(e(S));}else{g.addClass("sapSuiteUiCommonsTimelineNoStatus");}if(s){f.addChild(g);g.addChild(t._getLineIcon('',G));}else{o.addChild(n);o.addClass("sapSuiteUiCommonsTimelineItemNoIconWrapper");n.addClass("sapSuiteUiCommonsTimelineItemNoIcon");f.addChild(o);if(S){n.addClass(e(S));}i.addClass("sapSuiteUiCommonsTimelineItemBarNoIcon");}i.addClass("sapSuiteUiCommonsTimelineItemBarV");f.addChild(i);if(t._additionalBarClass){i.addClass(e(t._additionalBarClass));}h.addClass("sapSuiteUiCommonsTimelineItemBubble");m.addClass("sapSuiteUiCommonsTimelineItemArrow");h.addChild(m);h.addChild(k);k.addClass("sapSuiteUiCommonsTimelineItemOutline");k.setId(t.getId()+"-outline");k.setAttribute("tabindex","0");k.setAttribute("data-sap-ui-fastnavgroup",true);this._addAccessibilityTags(k,t);j.addClass("sapSuiteUiCommonsTimelineItemBox");k.addChild(j);p=this._getTimelineItemShell(t);j.addChild(p);if(t._isGroupCollapsed()){c.addStyle("display","none");}return c;};b._getTimelineItemShell=function(t){var c=new H("div"),d=new H("div"),f=new H("div"),g=new H("span"),u,U,h=new H("span"),i=new H("div"),j=new H("div"),k=new H("div"),m=new H("span"),n=new H("div"),o=new H("span"),p=new H("div"),q;var E=t.getEmbeddedControl();c.setId(t.getId()+"-shell");c.addClass("sapSuiteUiCommonsTimelineItemShell");c.addChild(t._objects.getInfoBar());c.addChild(d);d.addClass("sapSuiteUiCommonsTimelineItemHeaderWrapper");u=t._getUserPictureControl();if(u){u.addStyleClass("sapSuiteUiCommonsTimelineItemUserPicture");d.addChild(u);}f.setId(t.getId()+"-header");f.addClass("sapSuiteUiCommonsTimelineItemHeader");f.addClass("sapSuiteUiCommonsTimelineItemTextLineClamp");g.setId(t.getId()+"-username");g.addClass("sapSuiteUiCommonsTimelineItemShellUser");f.addChild(g);U=t._getUserNameLinkControl();if(U){g.addChild(U);}else{g.addChildEscaped(t.getUserName());g.addClass("sapUiSelectable");}d.addChild(f);h.addClass("sapSuiteUiCommonsTimelineItemShellHdr");h.addClass("sapUiSelectable");h.addChildEscaped(" "+t.getTitle());f.addChild(h);i.addClass("sapSuiteUiCommonsTimelineItemShellDateTime");i.addClass("sapUiSelectable");i.addChildEscaped(this._getFormatedDateTime(t));f.addChild(i);j.addClass("sapSuiteUiCommonsTimelineItemShellBody");c.addChild(j);if(E!==null){j.addChild(E);}else if(t.getText()){k.addChild(m);k.addClass("sapSuiteUiCommonsTimelineItemTextWrapper");m.setId(t.getId()+"-realtext");m.addClass("sapUiSelectable");j.addChild(k);q=t._checkTextIsExpandable();if(q){o.setId(t.getId()+"-threeDots");o.addClass("sapMFeedListItemTextString");o.addChildEscaped(" ");k.addChild(o);m.addChildEscaped(t._getCollapsedText(),true);o.addChildEscaped("... ");k.setAttribute("expandable",true);}else{m.addChildEscaped(t.getText(),true);n.addStyle("display","none");}j.addChild(n);n.addClass("sapSuiteUiCommonsTimelineItemShowMore");n.addChild(t._getButtonExpandCollapse());}if(t.getParent()&&t.getParent()._aFilterList&&(t._callParentFn("getEnableSocial")||t.getCustomAction().length>0)){p.addClass("sapSuiteUiCommonsTimelineItemShellBottom");p.addChild(t._objects.getSocialBar());c.addChild(p);}return c;};b._addAccessibilityTags=function(c,t,i){var g;c.setAttribute("role","option");if(typeof t._index==="number"){c.setAttribute("aria-posinset",t._index+1);c.setAttribute("aria-setsize",t._callParentFn("_getItemsCount"));}c.setAttribute("aria-live","polite");if(i){c.setAttribute("aria-expanded",!t._isGroupCollapsed());g=r.getText("TIMELINE_ACCESSIBILITY_GROUP_HEADER")+": "+t.getTitle();c.setAttribute("aria-label",g);}};return b;},true);
