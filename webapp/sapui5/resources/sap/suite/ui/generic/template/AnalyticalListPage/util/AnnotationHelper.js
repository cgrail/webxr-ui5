sap.ui.define(["sap/ui/base/Object","sap/base/Log"],function(B,L){"use strict";var a=B.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper");a.getDetailEntitySet=function(c){var o=c.getObject();var m=c.getModel();var M=m.getProperty("/metaModel");return M.createBindingContext(M.getODataEntitySet(o,true));};a.resolveMetaModelPath=function(c){var p=c.getObject();var m=c.getModel();var M=m.getProperty("/metaModel");return M.createBindingContext(p);};a.createWorkingContext=function(c){var p=c.getObject(),s=p.settings,m=c.getModel(),M=m.getProperty("/metaModel"),E=M.getODataEntitySet(p.entitySet),o=M.getODataEntityType(E.entityType),u=s.uniqueHierarchyNodeIDForTreeTable,A="",w={};A=o.$path+"/com.sap.vocabularies.UI.v1.SelectionPresentationVariant"+(s&&s.qualifier?"#"+s.qualifier:"");w.selectionPresentationVariant=M.getObject(A);w.selectionPresentationVariantQualifier=A.split("#")[1]||"";w.selectionPresentationVariantPath=A;if(u&&s.tableType==="TreeTable"&&o&&o.hasOwnProperty('property')&&o.property.length){var I=[],h="",P=o.property;for(var i=0;i<P.length;i++){if(P[i].hasOwnProperty('sap:hierarchy-node-for')){h=P[i]["sap:hierarchy-node-for"];break;}}for(var i=0;i<P.length;i++){var b=P[i].name!==u&&P[i].name!==h;if(!P[i].hasOwnProperty('com.sap.vocabularies.Analytics.v1.Measure')){if(P[i].hasOwnProperty('sap:attribute-for')&&b){if(P[i]['sap:attribute-for']!==u&&P[i]['sap:attribute-for']!==h){I.push(P[i]['name']);}}else if(b){I.push(P[i]['name']);}}}w.ignoredFields=I.toString();}A=a.getAnnotationfromSPV(o,A,w.selectionPresentationVariant,w.selectionPresentationVariantPath,(s?s.qualifier:""),"PresentationVariant");w.presentationVariant=M.getObject(A);w.presentationVariantPath=A;w.presentationVariantQualifier=A.split("#")[1]||"";w.initialExpansionLevel=w.presentationVariant&&w.presentationVariant.InitialExpansionLevel&&w.presentationVariant.InitialExpansionLevel.Int;if(s.qualifier&&!w.presentationVariant){var e=new Error("Error in manifest.json: Not SelectionPresentationVariant or PresentationVariant found for qualifier: "+s.qualifier,"./manifest.json");throw e;}if(w.presentationVariant&&w.presentationVariant.Visualizations){w.presentationVariant.Visualizations.forEach(function(v){var f="/"+v.AnnotationPath.slice(1);if(f.indexOf("com.sap.vocabularies.UI.v1.LineItem")>-1){A=o.$path+f;w.lineItem=M.getObject(A);w.lineItemPath=A;w.lineItemQualifier=A.split("#")[1]||"";w.lineItemCriticality=sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper._resolveLineItemCriticality(w.lineItem,w.lineItemQualifier);}if(!s.chartPresentationQualifier&&(f.indexOf("com.sap.vocabularies.UI.v1.Chart")>-1)){A=o.$path+f;w.chart=M.getObject(A);w.chartPath=A;w.chartQualifier=A.split("#")[1]||"";}});}if(!w.lineItem){A=o.$path+"/com.sap.vocabularies.UI.v1.LineItem";w.lineItem=M.getObject(A);w.lineItemPath=A;w.lineItemQualifier="";w.lineItemCriticality=sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper._resolveLineItemCriticality(w.lineItem,w.lineItemQualifier);}if(s&&s.chartPresentationQualifier){var d=o.$path+"/com.sap.vocabularies.UI.v1.PresentationVariant"+"#"+s.chartPresentationQualifier;var C=M.getObject(d);if(!C){var e=new Error("Error in manifest.json: No PresentationVariant found for qualifier: "+s.chartPresentationQualifier,"./manifest.json");throw e;}if(C&&!C.Visualizations){var e=new Error("Error: No Visualizations found in PresentationVariant for chartPresentationVariantQualifier: "+s.chartPresentationQualifier,"./manifest.json");throw e;}else{C.Visualizations.forEach(function(v){var f="/"+v.AnnotationPath.slice(1);if(f.indexOf("com.sap.vocabularies.UI.v1.Chart")>-1){A=o.$path+f;w.chart=M.getObject(A);w.chartPath=A;w.chartPresentationVariantQualifier=s.chartPresentationQualifier;w.chartQualifier=A.split("#")[1]||"";}});if(!w.chart){var e=new Error("Error: No chart annotations found with chartPresentationVariantQualifier "+s.chartPresentationQualifier,"./manifest.json");throw e;}}}if(!s.chartPresentationQualifier&&!w.chart){A=o.$path+"/com.sap.vocabularies.UI.v1.Chart";w.chart=M.getObject(A);w.chartPath=A;w.chartQualifier="";}m.setProperty("/workingContext",w);return"/workingContext";};a.hasDeterminingActionsForALP=function(t,c,e,m){if(e&&m&&m["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]&&sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper._hasCustomDeterminingActionsInALP(e,m["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]["sap.ui.generic.app"])){return true;}for(var r=0;r<t.length;r++){if((t[r].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t[r].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&t[r].Determining&&t[r].Determining.Bool==="true"){return true;}}for(var r=0;r<c.length;r++){if((c[r].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||c[r].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&c[r].Determining&&c[r].Determining.Bool==="true"){return true;}}return false;};a.hasGlobalActionsForALP=function(t,c,e,m){if(e&&m&&m["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]&&sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper._hasCustomGlobalActions(e,m["sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"]["sap.ui.generic.app"])){return true;}return false;};a.getAreaShrinkRatio=function(t,c,e,m){var g=sap.suite.ui.generic.template.AnalyticalListPage.util.AnnotationHelper.hasGlobalActionsForALP(t,c,e,m);if(g){return"0:3:0.7";}else{return"0:3:0.1";}};a._hasCustomDeterminingActionsInALP=function(e,m){if(m&&m[e]){var M=m[e];if(M.Actions){for(var b in M.Actions){if(M.Actions[b].determining){return true;}}}}return false;};a._hasCustomGlobalActions=function(e,m){if(m&&m[e]){var M=m[e];if(M.Actions){for(var b in M.Actions){if(M.Actions[b].global){return true;}}}}return false;};a.getFilterableKPIs=function(k){var m=k.getModel();var b={};var K=k.getObject();b.filterableKPIs=[];b.globalKPIs=[];if(K){for(var i=0;i<Object.keys(K).length;i++){if(K[Object.keys(K)[i]]["filterable"]){b.filterableKPIs.push(K[Object.keys(K)[i]]);}else{b.globalKPIs.push(K[Object.keys(K)[i]]);}}}m.setProperty("/kpiContext",b);return"/kpiContext";};a.generateKPIToolbarId=function(k){for(var i=0;Object.keys(k).length;i++){if(k[Object.keys(k)[i]]["filterable"]){return"template::KPITagContainer::filterableKPIs";}else{return"template::KPITagContainer::globalKPIs";}}};a.generateKPITagID=function(k){return"template::KPITag::"+k.model+"::"+k.qualifier;};a._resolveLineItemCriticality=function(l,b){if(l){var c;if(b){c=l["com.sap.vocabularies.UI.v1.Criticality#"+b];}else{c=l["com.sap.vocabularies.UI.v1.Criticality"];}if(!c){return"";}else{return c.Path?"\\{\"Path\": \""+c.Path+"\"\\}":"\\{\"EnumMember\": \""+c.EnumMember+"\"\\}";}}else{L.error("Please add LineItem annotation for your application");return undefined;}};a.getAnnotationfromSPV=function(e,A,s,S,q,b){if(s&&s[b]){A=s[b].Path||s[b].AnnotationPath||S+"/"+b;if(A.indexOf("@")===0){A=e.$path+"/"+A.substr(1);}}else{A=e.$path+"/com.sap.vocabularies.UI.v1."+b+(q?"#"+q:"");}return A;};a.createSVAnnotation=function(e,m,q){var A=e.$path+"/com.sap.vocabularies.UI.v1.SelectionPresentationVariant"+(q?"#"+q:""),s=m.getObject(A),S=A;A=this.getAnnotationfromSPV(e,A,s,S,q,"SelectionVariant");var o=m.getObject(A);return o;};a.resolveParameterStringValue=function(p){if(p){p.forEach(function(P){P.PropertyName.PropertyPath=(P.PropertyName.PropertyPath.split("/")[1]||P.PropertyName.PropertyPath);});}return p;};return a;},true);
