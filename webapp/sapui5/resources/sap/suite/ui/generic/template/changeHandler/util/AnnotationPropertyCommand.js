/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/rta/command/FlexCommand","sap/ui/fl/FlexControllerFactory","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/Utils","sap/base/util/merge"],function(F,a,J,f,m){"use strict";var A=F.extend("sap.suite.ui.generic.template.changeHandler.util.AnnotationPropertyCommand",{metadata:{library:"sap.suite.ui.generic.template",properties:{propertyName:{type:"string"},newValue:{type:"any"},semanticMeaning:{type:"string"},changeType:{type:"string",defaultValue:"propertyChange"}},associations:{},events:{}}});A.prototype._getChangeSpecificData=function(){var e=this.getElement();return{changeType:this.getChangeType(),selector:{id:this.getElementId(),type:e.getMetadata().getName()},content:{property:this.getPropertyName(),newValue:this.getNewValue(),semantic:this.getSemanticMeaning()}};};A.getSelector=function(c,o,b){var C=c;if(typeof C!=="string"){C=(c)?this.getId(c):undefined;}else if(!o){throw new Error("App Component instance needed to get a selector from string ID");}if(b&&(b.id||b.idIsLocal)){throw new Error("A selector of control with the ID '"+C+"' was requested, "+"but core properties were overwritten by the additionally passed information.");}var s=Object.assign({},b,{id:"",idIsLocal:false});s.id=C;return s;};A.createChange=function(c,C){var o,b;if(!C){throw new Error("A flexibility change cannot be created without a targeted control.");}var s=C.id||C.getId();if(!c.selector){c.selector={};}var d=C.appComponent||f.getAppComponentForControl(C);if(!d){throw new Error("No Application Component found - to offer flexibility the control with the id '"+s+"' has to have a valid relation to its owning application component.");}Object.assign(c.selector,A.getSelector(s,d));var e=a.createForControl(d);o=e.createBaseChange(c,d);var g=C.controlType||f.getControlType(C);if(!g){throw new Error("No control type found - the change handler can not be retrieved.");}b=e._getChangeHandler(o,g,C,J);if(b){b.completeChangeContent(o,c,{modifier:J,appComponent:d});}else{throw new Error("Change handler could not be retrieved for change "+JSON.stringify(c)+".");}return o;};A.prototype._createChangeFromData=function(c,b,v){if(b){c=m({},c,b);}c.jsOnly=this.getJsOnly();var M=this.getAppComponent().getModel("$FlexVariants");var V;if(M&&v){V=M.getCurrentVariantReference(v);}var d={"variantManagementReference":v,"variantReference":V};if(V){c=Object.assign({},c,d);}var C=A.createChange(c,this._validateControlForChange(b));if(b&&b.originalSelector){C.getDefinition().selector=A.getSelector(this.getSelector().id,this.getSelector().appComponent);C.setContent(Object.assign({},C.getContent(),b.content));}return C;};return A;},true);
