sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library"],function(q,B,F,f){"use strict";var L=f.LayoutType;function o(O){sap.ui.require(["sap/suite/ui/generic/template/lib/routingHelper"],O);}var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function e(i){return c[t(i)];}function h(R){return R.name.length>5&&R.name.lastIndexOf("query")===R.name.length-"query".length;}function j(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function k(T){var i=j(T);var R=i?i[0]:false;return R;}function l(n,N){var M=N.oTemplateContract.oAppComponent.getConfig();var p=M.settings.flexibleColumnLayout;var s=F.getInstanceFor(n,p);var D=s.getDefaultLayouts();var R;var u;var U;var C;var S;var v=-1;var T=N.oTemplateContract,w=N.oRouter;var x=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var y=x>1&&p.initialColumnsCount===2;var z=p.displayNextObjectAfterDelete===true;function A(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&y);}function E(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var w1=p.initialColumnsCount||1;var x1=Math.max(i.fCLLevel+1,w1);return sap.ui.Device.system.tablet&&x1>2?2:x1;}function G(i,w1,x1,y1){var z1=E(y1);i.showBeginColumn=y1.fCLLevel===0||z1>1;i.showMidColumn=y1.fCLLevel===1||z1>1;i.showEndColumn=y1.fCLLevel>1;if(z1===1){i.target=w1;}else if(y1.level===0){i.target=[w1,i.pages[0].entitySet];}else{i.target=x1.concat([w1]);}return g(y1.fCLLevel);}function H(i,w1){if(i==="OneColumn"&&y){return false;}var x1=w1&&T.mRoutingTree[N.removeQueryInRouteName(w1)];var y1=x1&&x1.defaultLayoutType;if(y1){return i===y1;}return i===D.defaultLayoutType||i===D.defaultTwoColumnLayoutType||i===D.defaultThreeColumnLayoutType;}function I(i,w1,x1){var y1=T.mRouteToTemplateComponentPromise[x1];if(y1){return y1.then(function(z1){return N.activateOneComponent(w1,i,z1);});}return r;}function J(i,w1){var x1=H(i,u&&u.name);if(u&&h(u)){u.arguments.query=u.arguments["?query"];if(x1){delete u.arguments.query.FCLLayout;if(q.isEmptyObject(u.arguments.query)){delete u.arguments.query;u.name=N.removeQueryInRouteName(u.name);}}else{u.arguments.query.FCLLayout=i;}}else if(!x1){u.name=u.name+"query";u.arguments.query={FCLLayout:i};}var y1=w.getURL(u.name,u.arguments);y1=y1.replace("/?","?");N.navigate(y1,w1);}function K(i){var w1=function(x1,y1){if(!u){y1();return;}o(function(z1){var A1={};var B1=N.removeQueryInRouteName(u.event.getParameter("config").name);var C1=true;for(var D1=T.mRoutingTree[B1];C1;D1=T.mRoutingTree[D1.parentRoute]){var E1=D1.fCLLevel;var F1=e(E1);A1[F1]={route:D1.sRouteName,path:z1.determinePath(D1,u.event,i)||"",isVisible:E1>2||U.columnsVisibility[F1+"Column"]};C1=E1===1||E1===2;}x1(A1);});};return new Promise(w1);}function O(i,w1){var x1=K();return x1.then(function(y1){var z1=[];w1=w1||y1;for(var A1 in w1){var B1=y1[A1];if(B1.isVisible){z1.push(I(i,B1.path,B1.route));}else{var C1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var D1=T.mRoutingTree[B1.route];var E1=(C1===D1.level)?2:(3+Z(C));N.setVisibilityOfRoute(B1.route,E1);}}return Promise.all(z1).then(N.afterActivation);});}function P(i){var w1=N.getActivationInfo();O(w1,i);}function Q(){return!(U.columnsVisibility.beginColumn?U.columnsVisibility.midColumn:U.columnsVisibility.midColumn&&U.columnsVisibility.endColumn);}function V(i){var w1=s.getCurrentUIState();var x1={};x1.end=U&&(U.columnsVisibility.endColumn!==w1.columnsVisibility.endColumn);x1.mid=U&&(U.columnsVisibility.midColumn!==w1.columnsVisibility.midColumn);x1.begin=U&&(U.columnsVisibility.beginColumn!==w1.columnsVisibility.beginColumn);U=w1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:U.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:U.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.endColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",Q());var y1;if(U.columnsVisibility.endColumn){y1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}else if(U.columnsVisibility.midColumn){y1=1;}else{y1=0;}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",y1);var z1;if(U.columnsVisibility.midColumn){z1=1;}else{z1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",z1);if(u&&C!==U.layout){J(U.layout,true);}else if((x1.begin||x1.mid||x1.end)&&!i){P(x1);}}function W(i){i=q.extend({},i);var w1=i.getParameter("name");u={name:w1,arguments:i.getParameter("arguments"),event:i};var x1=T.mRoutingTree[N.removeQueryInRouteName(w1)];if(A(x1)){var y1=u.arguments["?query"];C=(y1&&y1.FCLLayout)||x1.defaultLayoutType;if(!C){switch(x1.fCLLevel){case 0:var z1=s.getNextUIState(0).columnsVisibility;if(z1.midColumn){C=D.defaultTwoColumnLayoutType;}else{C=D.defaultLayoutType;J(D.defaultLayoutType,true);}break;case 1:C=D.defaultTwoColumnLayoutType;break;case 2:C=D.defaultThreeColumnLayoutType;}}}else{C=x1.fCLLevel===0?D.defaultLayoutType:L.EndColumnFullScreen;}n.setLayout(C);}function X(i,w1,x1,y1){v=-1;var z1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");R=z1===2?i:null;u.path=x1;u.routeConfig=w1;if(y1){V(true);return O(y1);}}function Y(i,w1){return H(i,w1)?{}:{FCLLayout:[i]};}function Z(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function $(i,w1){var x1=i.fCLLevel===1?U.actionButtonsInfo.endColumn.closeColumn:"OneColumn";q.extend(w1,Y(x1,i.sRouteName));var y1=[];for(var z1=i;z1;z1=z1.fCLLevel&&T.mRoutingTree[z1.parentRoute]){y1.push(N.addUrlParameterInfoForRoute(z1.sRouteName,w1));}return Promise.all(y1);}function _(w1,x1){var y1=T.mRoutingTree[w1];if(!A(y1)){return null;}var z1=S||y1.defaultLayoutType||s.getNextUIState(y1.fCLLevel).layout;q.extend(x1,Y(z1,w1));S=null;if(Z(z1)){return null;}var A1=[];for(var i=y1.fCLLevel;i>0;i--){var B1=y1.parentRoute;A1.push(N.addUrlParameterInfoForRoute(B1,x1));y1=T.mRoutingTree[B1];}return Promise.all(A1);}function a1(i){T.oApplicationProxy.performAfterSideEffectExecution(function(){K(true).then(function(w1){var x1=e(i.fCLLevel);S=U.actionButtonsInfo[x1+"Column"].closeColumn;var y1=e(i.fCLLevel-1);N.navigateToContext(w1[y1].path,null,true,0);});},true);}function b1(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function c1(i){T.oApplicationProxy.performAfterSideEffectExecution(function(){var w1=e(i.fCLLevel);var x1=U.actionButtonsInfo[w1+"Column"].fullScreen;var y1=Y(x1,i.sRouteName);var z1=N.getApplicableStateForComponentAddedPromise(i.componentId,null,y1).then(N.navigateByReplacingAppState.bind(null,y1));T.oBusyHelper.setBusy(z1);},true);}function d1(i){T.oApplicationProxy.performAfterSideEffectExecution(function(){var w1=e(i.fCLLevel);var x1=U.actionButtonsInfo[w1+"Column"].exitFullScreen;var y1=Y(x1,i.sRouteName);var z1=K();var A1=z1.then(function(B1){var C1=[];var D1=i;for(var E1=i.fCLLevel;E1>=0;E1--){if(D1.componentId){var F1=B1[e(E1)].path;var G1=N.getApplicableStateForComponentAddedPromise(D1.componentId,F1,y1);C1.push(G1);}D1=T.mRoutingTree[i.parentRoute];}return Promise.all(C1).then(N.navigateByReplacingAppState.bind(null,y1));});T.oBusyHelper.setBusy(A1);},true);}function e1(i){return{onCloseColumnPressed:a1.bind(null,i),onFullscreenColumnPressed:c1.bind(null,i),onExitFullscreenColumnPressed:d1.bind(null,i)};}function f1(i){return T.oApplicationProxy.getDraftSiblingPromise(i);}function g1(i){if(i.routingSpec&&i.routingSpec.noOData){var w1=i.pattern.replace("{?query}","").split("/")[1];var x1=N.getCurrentKeys(2)[2];return w1.replace("{keys2}",x1);}}function h1(i){if(T.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/highestViewLevel")===2){var w1=function(y1){var B1=i.getPath()+"/"+y1;S=U.layout;N.navigateToContext(B1,null,true,2,true);};var x1=R.getParameter("config");var y1=g1(x1);if(y1){w1(y1);return;}var z1=T.mRouteToTemplateComponentPromise[N.removeQueryInRouteName(x1.name)];var A1=new Promise(function(B1,C1){z1.then(function(D1){var E1=D1.getBindingContext();var F1=f1(E1,true);F1.then(function(G1){o(function(H1){var I1=x1.navigationProperty;w1(H1.determineNavigationPath(G1,I1).path);B1();});},C1);},C1);});T.oBusyHelper.setBusy(A1);}else{N.navigateToContext(i,null,true,2,true);}}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function i1(i){var w1=T.mEntityTree[i.entitySet];var x1=T.oNavigationControllerProxy.getCurrentIdentity();var y1=x1.treeNode;return w1.level>y1.level;}function j1(i){C=s.getNextUIState(i).layout;n.setLayout(C);}function k1(){return!Q();}function l1(i,w1){var x1=0;for(var y1 in w1){var z1=T.mRoutingTree[y1];if(z1.level>=i.viewLevel&&w1[y1]===1){if(z1.level===i.viewLevel){x1=z1.fCLLevel;}w1[y1]=5+(z1.level>i.viewLevel);}}v=t(x1);j1(x1);var A1=N.oRouter.getTargets();var B1=b(x1);A1.display(B1);}function m1(i){if(i<v||v<0){return U.columnsVisibility[e(i)+"Column"];}return false;}function n1(i,w1){if(!A(w1)){return;}var x1=b1(w1.level);if(H(x1,w1.sRouteName)){return;}i.FCLLayout=[x1];}function o1(){return x;}function p1(i,w1){if(!y){return;}var x1=false;var y1=s.getNextUIState(0).columnsVisibility;if(y1.midColumn){var z1=u.event.getParameter("config").viewLevel;if(z1===0){x1=true;if(h(u)){u.arguments.query=u.arguments["?query"];if(u.arguments.query.FCLLayout==="OneColumn"){x1=false;}}}}if(x1){if(i){w1(i);}else{N.navigateToRoot(true);}}}function q1(){return z;}function r1(){return y;}function s1(i,w1){var x1=k(i);p1(x1,w1);}function t1(){S=L.OneColumn;}function u1(i){if(i>2){S="";}else{S=b1(i);}}function v1(i){var w1={};if(i.fCLLevel<3&&i.level===1){w1.navigateToDraft=h1;}if(i.fCLLevel===1||i.fCLLevel===2){w1.oActionButtonHandlers=e1(i);}if(i.level===0){w1.handleDataReceived=(r1&&r1())?s1:q.noop;w1.isListAndFirstEntryLoadedOnStartup=r1;}return w1;}n.attachStateChange(V.bind(null,false));return{adaptRoutingInfo:G,createMessagePageTargets:a,displayMessagePage:l1,isLevelActive:m1,handleBeforeRouteMatched:W,handleRouteMatched:X,getAppStatesPromiseForColumnClose:$,getFCLAppStatesPromise:_,isNewHistoryEntryRequired:i1,adaptBreadCrumbUrlParameters:n1,isAppTitlePrefered:k1,getFullscreenLayout:b1,getMaxColumnCountInFCL:o1,isNextObjectLoadedAfterDelete:q1,getFclProxy:v1,setStoredTargetLayoutToOneColumn:t1,isListAndFirstEntryLoadedOnStartup:r1,setStoredTargetLayoutToFullscreen:u1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(i,n){q.extend(this,l(i,n));}});});
