sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","./library.designtime"],function(U,A){"use strict";var F="com.sap.vocabularies.UI.v1.FieldGroup";var a="com.sap.vocabularies.UI.v1.Facets";var L="com.sap.vocabularies.UI.v1.LineItem";var C="com.sap.vocabularies.UI.v1.Chart";var b="com.sap.vocabularies.UI.v1.CollectionFacet";var R="com.sap.vocabularies.UI.v1.ReferenceFacet";var I="com.sap.vocabularies.UI.v1.Identification";var D="com.sap.vocabularies.UI.v1.DataField";var c="com.sap.vocabularies.UI.v1.FieldGroupType";var S="SmartForm";var d="SmartTable";var e="SmartChart";var r=sap.ui.getCore().getModel("i18nDesigntime").getResourceBundle();var s={getSectionTypeValues:function(E){var v={SmartForm:{displayName:"Smart Form"},SmartTable:{displayName:"Smart Table"},SmartChart:{displayName:"Smart Chart"}};return v;},getFacetIndexFromID:function(f,g){var h;for(var i=0;i<g.length;i++){h=g[i].ID&&g[i].ID.String;if(h===f){return i;}h=g[i].Target&&g[i].Target.AnnotationPath;h=h&&h.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");if(h===f){return i;}}},getSectionAnnotationInfo:function(o){var E=U.getODataEntityType(U.getComponent(o));var f,g=E[a];var h=o.getId();h=h.split("--")[1];if(h){h=h.substring(0,h.lastIndexOf("::"));}var i=s.getFacetIndexFromID(h,g);if(i===undefined){return;}f=g[i];var j={};j.RecordType=f.RecordType;j.AnnotationPath=f.Target&&f.Target.AnnotationPath;return j;},getSectionType:function(o){var i,f;var E=U.getODataEntityType(U.getComponent(o));var g=E[a];var h=o.getId();h=h.split("--")[1];if(h){h=h.substring(0,h.lastIndexOf("::"));var j=s.getFacetIndexFromID(h,g);if(j===undefined){return;}f=g[j];if(f.RecordType===b){var n=f.Facets;var k,t,l;for(i=0;i<n.length;i++){if(n[i].RecordType===b){return;}if(n[i].Target.AnnotationPath.indexOf(F)>-1||n[i].Target.AnnotationPath.indexOf(I)>-1){k=true;}else if(n[i].Target.AnnotationPath.indexOf(L)>-1){t=true;}}if(k&&t){l="invalid";}else{l=k?S:d;}return l;}else{if(f.Target&&(f.Target.AnnotationPath.indexOf(F)>-1||f.Target.AnnotationPath.indexOf(I)>-1)){return S;}if(f.Target&&f.Target.AnnotationPath.indexOf(L)>-1){return d;}if(f.Target&&f.Target.AnnotationPath.indexOf(C)>-1){return e;}}}},setSectionType:function(o,v){var f,g,O=s.getSectionType(o);if(O===v){return;}switch(v){case S:g=F;break;case d:g=L;break;case e:g=C;break;default:break;}if(!g){return;}var E=U.getODataEntityType(U.getComponent(o));var h=E[a];h.splice();var i=o.getId().split("--")[1];i=i.substring(0,i.lastIndexOf("::"));f=s.getFacetIndexFromID(i,h);if(f===undefined){return;}var j=h[f];var n=[],k=[],l={},m;var t=U.getEntityType(U.getComponent(o));n.push.apply(n,h);if(v===S){m=U.createFieldGroupTerm(E);l[m]={"Data":[{"RecordType":D}],"RecordType":c};}var N=s.createNewSection(j,m);if(v===S&&!(N.ID&&N.ID.String)){N.ID={"String":v+f};}n.splice(f,1,N);var p=A.createCustomAnnotationTermChange(t,n,h,a);var q=A.createCustomAnnotationTermChange(t,l[m],{},m);k.push(p);k.push(q);return k;},createNewSection:function(o,f){var n,N={"Label":{"String":"New Group"},"ID":{},"Target":{},"RecordType":R};if(f){N.Target.AnnotationPath="@"+f;n={"ID":{},"Label":{},"Facets":[N],"RecordType":b};}var g=f?n:N;for(var p in o){if(p!=="RecordType"&&p!=="Target"&&p!=="Facets"&&g[p]){jQuery.extend(g[p],o[p]);}if(jQuery.isEmptyObject(g[p])){delete g[p];}}return g;},getDesigntime:function(E){return{name:{singular:function(){return r.getText("FE_SECTION");},plural:function(){return r.getText("FE_SECTIONS");}},getCommonInstanceData:function(E){var t=U.getTemplatingInfo(E);if(t&&t.path){var T=t.target+'/'+t.path.substr(t.path.indexOf(a));return{target:T,annotation:t.annotation,qualifier:null};}},aggregations:{subSections:{childNames:{plural:function(){return r.getText("FE_SUB_SECTIONS");},singular:function(){return r.getText("FE_SUB_SECTION");}},actions:{move:"moveSubSection",createContainer:{changeType:"addSubSection",isEnabled:true,changeOnRelevantContainer:true,getCreatedContainerId:function(n){return n;}}}}},propagateRelevantContainer:true,propagateMetadata:function(E){switch(E.getMetadata().getElementName()){case"sap.m.ColumnListItem":return{aggregations:{cells:{ignore:true}}};case"sap.ui.comp.smarttable.SmartTable":return{name:{singular:function(){return r.getText("FE_SECTION");}},aggregations:{semanticKeyAdditionalControl:{ignore:true}}};}},properties:{sectionType:{name:"Section Type",virtual:true,ignore:false,type:"EnumType",group:"header",possibleValues:s.getSectionTypeValues(E),get:s.getSectionType.bind(E),set:s.setSectionType.bind(E)}},links:{developer:[{href:"/api/sap.uxap.ObjectPageSection",text:function(){return r.getText("FE_SECTIONS");}},{href:"/topic/facfea09018d4376acaceddb7e3f03b6",text:function(){return r.getText("FE_SDK_GUIDE_SECTIONS");}}]},actions:{remove:{changeType:"removeSection",changeOnRelevantContainer:true}},annotations:{referenceFacet:{namespace:"com.sap.vocabularies.UI.v1",annotation:"ReferenceFacet",defaultValue:null,whiteList:{properties:["Label","ID","Target"]},ignore:function(){var o=this.getSectionAnnotationInfo(E);if(o){return o.RecordType!==R;}}.bind(this),appliesTo:["ObjectPage/Sections"],group:["Appearance"],links:{developer:[{href:"/topic/facfea09018d4376acaceddb7e3f03b6.html",text:function(){return r.getText("FE_SDK_GUIDE_SECTIONS");}}]}},collectionFacet:{namespace:"com.sap.vocabularies.UI.v1",annotation:"CollectionFacet",defaultValue:null,ignore:function(){var o=this.getSectionAnnotationInfo(E);if(o){return o.RecordType!==b;}}.bind(this),whiteList:{properties:["Label","ID"]},appliesTo:["ObjectPage/Sections"],group:["Appearance"],links:{developer:[{href:"/topic/facfea09018d4376acaceddb7e3f03b6.html",text:"Defining and Adapting Sections"}]}}}};}};return s;});
