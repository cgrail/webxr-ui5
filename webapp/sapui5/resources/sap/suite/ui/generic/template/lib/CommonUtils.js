sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/base/Event","sap/ui/core/mvc/ControllerExtension","sap/ui/model/Context","sap/ui/model/Filter","sap/m/Table","sap/m/ListBase","sap/m/MessageBox","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/generic/app/navigation/service/NavError","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log"],function(q,B,E,C,a,F,R,L,M,N,b,t,c){"use strict";var o=sap.ui.getCore();function d(e,P){var i=sap.ui.require(P);return typeof i==="function"&&(e instanceof i);}function f(e){return d(e,"sap/ui/comp/smarttable/SmartTable");}function g(e){return d(e,"sap/ui/comp/smartchart/SmartChart");}function h(e){return d(e,"sap/ui/table/Table");}function l(e){return d(e,"sap/ui/table/AnalyticalTable");}function m(e){return d(e,"sap/ui/table/TreeTable");}function n(e){return d(e,"sap/m/Table");}function p(e){if(g(e)||f(e)){return e.getEntitySet();}else if(f(e.getParent())){return e.getParent().getEntitySet();}}function r(e){var T=e&&sap.ui.getCore().byId(e);if(T){T.focus();}}var f=t.testableStatic(f,"CommonUtils_isSmartTable");function s(u,S,v){var w;var x=Object.create(null);function y(e){var i,j,k,L1;i=e.getEntitySet();j=u.getOwnerComponent().getModel().getMetaModel();k=j.getODataEntitySet(i);L1=j.getODataEntityType(k.entityType);return L1;}function z(e,i,j){var k=e instanceof E?e.getSource():e;var L1=k.getId();var M1=x[L1];if(!M1){if(j){return null;}M1={control:k,infoObject:Object.create(null),categories:[]};(i||q.noop)(M1.infoObject,M1.categories,k);x[L1]=M1;}return M1.infoObject;}function A(e,i){for(var j in x){var k=x[j];if(k.categories.indexOf(e)>=0){i(k.infoObject,k.control);}}}function D(e){S.oApplication.attachControlToParent(e,u.getView());}function G(e){if(e.getVisible&&!e.getVisible()){return null;}return e.getParent()||e.oContainer;}function H(e){var i=u.getView();var j=false;for(var k=i.getVisible()&&o.byId(e);k&&!j;k=G(k)){j=k===i;}return j;}function I(e){for(var i=0;i<e.length;i++){var j=e[i];if(H(j)){return j;}}return"";}function J(e,i,j,k){return S.oApplication.getDialogFragmentForView(u.getView(),e,i,j,k);}var K;function O(){var e=u.getOwnerComponent();K=K||e.getModel("i18n").getResourceBundle();return K.getText.apply(K,arguments);}function P(k,e,i,j){var L1,M1,N1,O1;var P1=u.getOwnerComponent();var Q1=e.indexOf("::"+P1.getEntitySet()+"--")+2;L1=e.substring(Q1,e.lastIndexOf("::"));L1=L1.replace(/--/g,"|").replace(/::/g,"|");M1=k+"|"+L1;N1=i||k;O1=O(M1,j);if(O1===M1){O1=O(N1,j);}return O1;}function Q(e,i){var i=i||e.getSelectionBehavior();if(i==="DATAPOINT"){return{"dataPoints":e.getSelectedDataPoints().dataPoints,"count":e.getSelectedDataPoints().count};}else if(i==="CATEGORY"){return{"dataPoints":e.getSelectedCategories().categories,"count":e.getSelectedCategories().count};}else if(i==="SERIES"){return{"dataPoints":e.getSelectedSeries().series,"count":e.getSelectedSeries().count};}}function T(e,j,k){var L1=[];if(f(e)){e=e.getTable();}else if(g(e)){e=e.getChart();if(e&&e.getMetadata().getName()==="sap.chart.Chart"){var M1=false;j=j||e.getSelectionBehavior();k=k||Q(e,j);if(k&&k.count>0){if(j==="DATAPOINT"){M1=true;}var N1=k.dataPoints;var O1=[];for(var i=0;i<N1.length;i++){if(M1){if(N1[i].context){L1.push(N1[i].context);}}else{O1.push(N1[i].dimensions);}}if(!M1){L1[0]=O1;}}}}if(e instanceof L){L1=e.getSelectedContexts();}else if(h(e)){var P1=e.getSelectedIndices();if(P1){for(var i=0;i<P1.length;i++){L1.push(e.getContextByIndex(P1[i]));}}}return L1;}function U(e){var i={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(j){i[j.getKey()]=j.getValue();});}return i;}function V(e){var k,L1,M1,N1;var O1=f1(e);if(!f(O1)&&!g(O1)){O1=O1.getParent();}var P1=T(O1);var Q1=O1.getModel();L1=c1(O1);a1(L1,P1,Q1,O1);if(f(O1)){k=O1.getCustomToolbar()&&O1.getCustomToolbar().getContent();}else if(g(O1)){k=O1.getToolbar()&&O1.getToolbar().getContent();}if(k&&k.length>0){for(var i=0;i<k.length;i++){M1=k[i];if(M1.getMetadata().getName()==="sap.m.Button"){W(M1,Q1,P1,O1);}else if(M1.getMetadata().getName()==="sap.m.MenuButton"){N1=M1.getMenu().getItems();if(N1&&N1.length>0){for(var j=0;j<N1.length;j++){M1=N1[j];if(M1.getVisible()){W(M1,Q1,P1,O1);}}}}}}}function W(e,i,j,k){var L1,M1;var N1=U(e);var O1=u.getView();var P1=i.getMetaModel();if(N1&&N1.Type){if(N1.originalButtonId){L1=O1.getLocalId(N1.originalButtonId);}else{L1=O1.getLocalId(e.getId());}if(N1.Type==="CRUDActionDelete"){M1=$(i,P1,j,k);k.getModel("_templPriv").setProperty("/listReport/deleteEnabled",M1);}else if(N1.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||N1.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){M1=Z(i,P1,j,N1.Type,N1.Action,k);}}if(/generic\/controlProperties/.test(e.getBindingPath("enabled"))&&M1!==undefined){Y(L1,"enabled",M1);}}function X(e){var i;var j=f1(e);var k=T(j);var L1=e.getModel();i=d1();a1(i,k,L1,j);}function Y(i,e,j){var k=u.getView().getModel("_templPriv");var L1=k.getProperty("/generic/controlProperties/"+i);if(!L1){L1={};L1[e]=j;k.setProperty("/generic/controlProperties/"+i,L1);}else{k.setProperty("/generic/controlProperties/"+i+"/"+e,j);}}function Z(e,i,k,L1,M1,N1){var O1,P1,Q1,R1;var S1=false;if(L1==="com.sap.vocabularies.UI.v1.DataFieldForAction"){O1=i.getODataFunctionImport(M1);Q1=O1&&O1["sap:action-for"];if(Q1&&Q1!==""&&Q1!==" "){if(k.length>0){R1=O1["sap:applicable-path"];if(R1&&R1!==""&&R1!==" "){for(var j=0;j<k.length;j++){if(!k[j]){continue;}P1=e.getObject(k[j].getPath());if(P1&&P1[R1]){S1=true;break;}}}else{S1=true;}}}else{S1=true;}}else if(L1==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(k.length>0||(g(N1)&&N1.getDrillStackFilters().length>0)){S1=true;}}return S1;}function $(e,j,k,L1){var M1=_(L1);var N1=false;var O1;var P1=j.getODataEntitySet(L1.getEntitySet());if(sap.suite.ui.generic.template.js.AnnotationHelper.areDeleteRestrictionsValid(j,P1.entityType,M1)){if(k.length>0){var Q1=M1&&M1.Deletable&&M1.Deletable.Path;for(var i=0;i<k.length;i++){O1=e.getObject(k[i].getPath());if(!O1){break;}if(Q1){if(k[i]&&e.getProperty(Q1,k[i])){if(!(O1.IsActiveEntity&&O1.HasDraftEntity&&O1.DraftAdministrativeData&&e.getProperty("DraftAdministrativeData/InProcessByUser",k[i]))){N1=true;break;}}}else{if(!(O1.IsActiveEntity&&O1.HasDraftEntity&&O1.DraftAdministrativeData&&e.getProperty("DraftAdministrativeData/InProcessByUser",k[i]))){N1=true;break;}}}}}return N1;}function _(e){var i=e.getModel()&&e.getModel().getMetaModel();var j=i&&i.getODataEntitySet(e.getEntitySet());var k=j&&j["Org.OData.Capabilities.V1.DeleteRestrictions"];return k;}function a1(e,i,j,k){var L1=e1(k);var M1=u.getView().getModel("_templPriv");var N1=M1.getProperty("/generic/listCommons/breakoutActionsEnabled");if(L1){var O1=u.byId("template::IconTabBar");var P1="";if(O1){P1=O1.getSelectedKey();}b1(N1,L1,e,i,j,P1,k);}M1.setProperty("/generic/listCommons/breakoutActionsEnabled",N1);}function b1(e,i,j,k,L1,M1,N1){var O1;for(var P1 in i){O1=true;var Q1=i[P1].id+((M1&&!i[P1].determining)?"-"+M1:"");if(N1&&N1.getId().indexOf("AnalyticalListPage")>-1){O1=!!e[Q1].enabled;}if(i[P1].requiresSelection){if(k.length>0){if(N1&&g(N1)){if(i[P1].filter==="chart"){O1=true;}}else if(N1&&f(N1)){if(i[P1].filter!=="chart"){O1=true;}}if(i[P1].applicablePath!==undefined&&i[P1].applicablePath!==""){O1=false;for(var R1=0;R1<k.length;R1++){var S1="";var T1=i[P1].applicablePath.split("/");if(T1.length>1){for(var U1=0;U1<T1.length-1;U1++){S1+="/"+T1[U1];}}var V1=L1.getObject(k[R1].getPath()+S1);var W1=T1[T1.length-1];if(V1[W1]===true){O1=true;break;}}}}else if(g(N1)){if((N1.getId().indexOf("AnalyticalListPage")>-1?i[P1].filter==="chart":true)){if(N1.getDrillStackFilters().length>0){O1=true;}else{O1=false;}}}else{if(i[P1].filter!=="chart"){O1=false;}}}e[Q1]={enabled:O1};}}function c1(e){var i=[];var j=e1(e);for(var k in j){i.push(j[k].id);}return i;}function d1(){var e=[];var i=e1();for(var j in i){if(i[j].determining){e.push(j);}}return e;}function e1(e){var i=u.getOwnerComponent();var j=i.getAppComponent().getManifestEntry("sap.ui5");var k=j.extends&&j.extends.extensions&&j.extends.extensions["sap.ui.controllerExtensions"];k=k&&k[i.getTemplateName()];k=k&&k["sap.ui.generic.app"];var L1=i.getEntitySet();var M1=U(e).sectionId;if(!M1){return k&&k[L1]&&k[L1]["Actions"];}else{var N1=k&&k[L1]&&k[L1]["Sections"];return N1&&N1[M1]&&N1[M1].Actions;}}function f1(e){var i=e;while(i){if(i instanceof R||h(i)||f(i)||g(i)){return i;}i=i.getParent&&i.getParent();}return null;}function g1(e){if(f(e)){e=e.getTable();}if(h(e)){return e.getBindingInfo("rows");}else if(e instanceof R){return e.getBindingInfo("items");}return null;}function h1(e){var i=g1(e);if(i&&i.binding){i.binding.refresh();}else if(e&&e.rebindTable){e.rebindTable();}}function i1(e){var i=u.getOwnerComponent();var j=i.getModel();var k,L1;var M1=!S.oApplication.checkEtags();if(M1){L1=g1(e);if(L1){k=L1.path;var N1=e.getEntitySet();var O1=j.getMetaModel();var P1=O1.getODataEntitySet(N1);if(u.getMetadata().getName()==='sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage'&&j1(j,P1)){j.invalidateEntityType(P1.entityType);}else{j.invalidate(k1.bind(null,k));}var Q1=i.getId();var R1=Object.create(null);R1[Q1]=true;S.oApplication.refreshAllComponents(R1);}}}function j1(e,i){q.sap.require("sap.ui.model.analytics.odata4analytics");var j=new sap.ui.model.analytics.odata4analytics.Model(sap.ui.model.analytics.odata4analytics.Model.ReferenceByModel(e));var k=j.findQueryResultByName(i.name);var L1=k&&k.getParameterization();return!!L1;}function k1(e,k,i){var j=e[0]==="/"?e.substr(1):e;if(k.split("(")[0]===j){return true;}else{return false;}}function l1(e,i){var j=e.getPath();var k=u.getOwnerComponent();var L1=k.getComponentContainer().getElementBinding();var M1=L1?L1.getPath():"";var N1=null;if(j.indexOf(M1)!==0){N1=g1(i).path;}var O1=!S.oApplication.isNewHistoryEntryRequired(e,N1);var P1;if(v.isDraftEnabled()){P1=S.oDraftController.isActiveEntity(e)?1:6;}else{P1=k.getModel("ui").getProperty("/editable")?6:1;}var Q1=v.getViewLevel();if(Q1===0){var R1=S.oApplication.getForwardNavigationProperty(Q1);}if(R1){var S1=new Promise(function(U1){e.getModel().createBindingContext(R1,e,null,function(V1){if(V1){S.oNavigationController.navigateToContext(V1,N1,O1,P1);U1();}else{v.navigateToDataLoadedFailedPage();U1();}});});var T1=S.oApplication.getBusyHelper();T1.setBusy(S1);}else{S.oNavigationController.navigateToContext(e,N1,O1,P1);}}function m1(e,i){if(e instanceof a){S.oNavigationController.navigateToContext(e,i&&i.navigationProperty,i&&i.replaceInHistory);return;}var j=i&&i.routeName;if(j){v.navigateRoute(j,e,null,i&&i.replaceInHistory);return;}c.warning("navigateToContext called without context or route");}function n1(e){if(e instanceof b){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){M.show(O("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:O("ST_GENERIC_ERROR_TITLE")});}else{M.show(e.getErrorCode(),{title:O("ST_GENERIC_ERROR_TITLE")});}}}function o1(e,i){C1(function(){w=J1();var j={semanticObject:e.semanticObject,action:e.action};var k=w.mixAttributesAndSelectionVariant(e.parameters);u.adaptNavigationParameterExtension(k,j);w.navigate(e.semanticObject,e.action,k.toJSONString(),null,n1);},q.noop,i,"LeavePage");}function p1(e){var L1=[],M1,N1,O1;var P1=u.getOwnerComponent();var Q1=P1.getModel().getMetaModel();if(!e){return{};}var R1=P1.getAppComponent().getConfig().pages[0];if(!R1){return{};}var S1=function(i){O1=Q1.getODataEntitySet(i.entitySet).entityType;N1=Q1.getODataEntityType(O1);M1={};M1={entitySet:i.entitySet,aKeys:Q1.getODataEntityType(O1).key.propertyRef,navigationProperty:i.navigationProperty};for(var j=0,U1=M1.aKeys.length;j<U1;j++){var k=0,V1=N1.property.length;for(k;k<V1;k++){if(M1.aKeys[j].name===N1.property[k].name){M1.aKeys[j].type=N1.property[k].type;break;}}}};var T1=function(e,R1){if(!R1.pages){return L1;}for(var i=0,j=R1.pages.length;i<j;i++){if(!R1.pages[i]){break;}if(e===R1.pages[i].entitySet){S1(R1.pages[i]);L1.splice(0,0,M1);break;}L1=T1(e,R1.pages[i]);if(L1.length>0){S1(R1.pages[i]);L1.splice(0,0,M1);}}return L1;};return T1(e,R1);}function q1(k,e){var L1,M1,i,N1;for(i=0,N1=k.length;i<N1;i++){if(k[i].navigationProperty){M1+="/"+k[i].navigationProperty;}else{M1="/"+k[i].entitySet;}for(var j=0,O1=k[i].aKeys.length;j<O1;j++){if(j===0){M1+="(";L1="";}else{L1=",";}switch(k[i].aKeys[j].type){case"Edm.Guid":if(e.DraftAdministrativeData&&e.DraftAdministrativeData.DraftIsCreatedByMe){M1+=L1+k[i].aKeys[j].name+"="+"guid'"+e.DraftAdministrativeData[k[i].aKeys[j].name]+"'";}else{M1+=L1+k[i].aKeys[j].name+"="+"guid'"+e[k[i].aKeys[j].name]+"'";}break;case"Edm.Boolean":if(e.DraftAdministrativeData&&e.DraftAdministrativeData.DraftIsCreatedByMe){M1+=L1+k[i].aKeys[j].name+"="+false;}else{M1+=L1+k[i].aKeys[j].name+"="+e[k[i].aKeys[j].name];}break;default:if(typeof e[k[i].aKeys[j].name]==="string"){M1+=L1+k[i].aKeys[j].name+"="+"'"+e[k[i].aKeys[j].name]+"'";}else{M1+=L1+k[i].aKeys[j].name+"="+e[k[i].aKeys[j].name];}break;}if(j===(O1-1)){M1+=")";}}}return M1;}function r1(e,k,u){var L1,M1,N1,O1,P1,Q1,R1;var S1={semanticObject:"",action:""};w=J1();for(O1 in e.semanticAttributesOfSemanticObjects){L1=w.mixAttributesAndSelectionVariant({},k);for(N1 in e.semanticAttributesOfSemanticObjects[O1]){if(!L1.getSelectOption(N1)){L1.addParameter(N1,"");}}P1=L1.getPropertyNames();S1.semanticObject=O1;u.adaptNavigationParameterExtension(L1,S1);Q1=L1.getSelectOptionsPropertyNames();R1=L1.getParameterNames();for(var i=0,T1=P1.length;i<T1;i++){if(Q1.indexOf(P1[i])<0&&R1.indexOf(P1[i])<0){delete e.semanticAttributesOfSemanticObjects[O1][P1[i]];L1.removeSelectOption(P1[i]);}}if(O1===e.semanticObject){var U1=e.semanticAttributesOfSemanticObjects[""];for(var j=0,T1=R1.length;j<T1;j++){if(R1[j]in U1){L1.removeParameter(R1[j]);}else{L1.removeParameter(R1[j]);var V1=e.semanticAttributesOfSemanticObjects[e.semanticObject][R1[j]];if(typeof V1==="undefined"||V1===null){V1="";}else{V1=String(V1);}L1.addParameter(R1[j],V1);}}L1=w.mixAttributesAndSelectionVariant(e.semanticAttributesOfSemanticObjects[O1],k);M1=L1.toJSONString();}}delete e.semanticAttributes;w.processBeforeSmartLinkPopoverOpens(e,M1);}function s1(e,j){var k=function(P1){for(var i=0;i<P1.length;i++){j(P1[i].name);}};var L1=u.getView().getModel().getMetaModel();var M1=L1.getODataEntitySet(e,false);var N1=L1.getODataEntityType(M1.entityType,false);k(N1.key.propertyRef);var O1=S.oDraftController.getDraftContext();if(O1.isDraftEnabled(e)){k(O1.getSemanticKey(e));j("IsActiveEntity");j("HasDraftEntity");j("HasActiveEntity");}}function t1(e,i){if(!v.isDraftEnabled()||!e){return;}var j=e.getControlByKey("EditState");var k=j&&j.getSelectedKey()||"";switch(k){case"1":i.filters.push(new F("IsActiveEntity","EQ",true));i.filters.push(new F("HasDraftEntity","EQ",false));break;case"2":i.filters.push(new F("IsActiveEntity","EQ",false));break;case"3":i.filters.push(new F("IsActiveEntity","EQ",true));i.filters.push(new F("SiblingEntity/IsActiveEntity","EQ",null));i.filters.push(new F("DraftAdministrativeData/InProcessByUser","NE",""));break;case"4":i.filters.push(new F("IsActiveEntity","EQ",true));i.filters.push(new F("SiblingEntity/IsActiveEntity","EQ",null));i.filters.push(new F("DraftAdministrativeData/InProcessByUser","EQ",""));break;default:var L1=new F({filters:[new F("IsActiveEntity","EQ",false),new F("SiblingEntity/IsActiveEntity","EQ",null)],and:false});if(i.filters[0]&&i.filters[0].aFilters){var M1=i.filters[0];i.filters[0]=new F([M1,L1],true);}else{i.filters.push(L1);}break;}}function u1(e,i){if(i){e.filters.push(new F("IsActiveEntity","EQ",true));}else{var j=new F({filters:[new F("IsActiveEntity","EQ",false),new F("SiblingEntity/IsActiveEntity","EQ",null)],and:false});if(e.filters[0]&&e.filters[0].aFilters){var k=e.filters[0];e.filters[0]=new F([k,j],true);}else{e.filters.push(j);}}}function v1(i,j,k){if(j&&i&&i.getAnalyticBindingPath&&i.getConsiderAnalyticalParameters()){try{var L1=i.getAnalyticBindingPath();if(L1){j(L1);}}catch(e){c.warning("Mandatory parameters have no values","",k);}}}function w1(e,j,k){for(var i=0;i<j.length;i++){var L1=j[i];var M1=L1.lastIndexOf("/");var N1;if(M1<0){if(S.oApplication.getNavigationProperty(e,L1)){N1=L1;}else{continue;}}else{N1=L1.substring(0,M1);}if(k.indexOf(N1)===-1){k.push(N1);}}}function x1(e,i,j){var k=e.getParameter("bindingParams"),L1=e.getSource().getId();k.parameters=k.parameters||{};var M1=v.getTemplatePrivateModel();var N1=M1.getProperty("/listReport/vDraftState");var O1=M1.getProperty("/listReport/activeObjectEnabled");var P1=function(W1,X1,L1){if(i&&i[W1]){var Y1=true;var Z1=function(){var $1=arguments[0];if(!($1 instanceof C)){throw new Error("Please provide a valid ControllerExtension in order to execute extension "+W1);}if(!Y1){throw new Error("Extension "+W1+" must be executed synchronously");}var _1=Array.prototype.slice.call(arguments,1);X1.apply(null,_1);};i[W1](Z1,L1);Y1=false;}};var Q1=function(W1){if(!L1||u.byId(L1)===e.getSource()){k.filters.push(W1);}};if((u.getMetadata().getName()!=='sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage')||(u.getMetadata().getName()!=='sap.suite.ui.generic.template.ObjectPage.view.Details')){if(N1=="0"&&v.isDraftEnabled()){u1(k,O1);}else{t1(j,k);}}P1("addExtensionFilters",Q1,L1);if(u.getMetadata().getName()!=='sap.suite.ui.generic.template.ObjectPage.view.Details'){v1(j,i.setBindingPath,i.isAnalyticalListPage?"AnalyticalListPage":"ListReport");}var R1=e.getSource();var S1=R1.getEntitySet();var T1=k.parameters.select&&k.parameters.select.split(",")||[];var U1=k.parameters.expand&&k.parameters.expand.split(",")||[];var V1=function(W1,L1){if(W1&&(!L1||u.byId(L1)===e.getSource())){var X1=W1.split(',');X1.forEach(function(Y1){if(Y1&&q.inArray(Y1,T1)===-1){T1.push(Y1);}});}};if(!i.isAnalyticalListPage){s1(S1,V1);}P1("ensureExtensionFields",V1,L1);(i.addNecessaryFields||q.noop)(T1,V1,S1);w1(S1,T1,U1);if(U1.length>0){k.parameters.expand=U1.join(",");}if(T1.length>0){k.parameters.select=T1.join(",");}}function y1(e,i,j){if(!e){return O("DRAFT_OBJECT");}else if(i){return O(j?"LOCKED_OBJECT":"UNSAVED_CHANGES");}else{return"";}}function z1(){var e=J("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var i=Array.prototype.slice.call(arguments,1);var k=arguments[0];if(!k){return"";}if(i.length>0&&(i[0]===null||i[0]===undefined||i[0]==="")){if(i.length>3&&(i[3]===null||i[3]===undefined||i[3]==="")){return(i.length>2&&(i[1]===null||i[1]===undefined||i[1]===""))?"":i[2];}else{return O(k,i[3]);}}else{return O(k,i[0]);}},closeDraftAdminPopover:function(){e.close();},formatDraftLockText:y1},"admin");return e;}function A1(e,i,j,k,L1,M1){var N1=S.oApplication.getBusyHelper();if(!L1&&N1.isBusy()){return;}if(!v.isDraftEnabled()){var O1=false;if(j&&j.aUnsavedDataCheckFunctions){O1=j.aUnsavedDataCheckFunctions.some(function(S1){return S1();});}var P1=u.getView();var Q1=P1.getModel();if(O1||Q1.hasPendingChanges()){var R1;E1(function(){P1.setBindingContext(null);Q1.resetChanges();P1.setBindingContext();v.fire(u,"AfterCancel",{});R1=e();},function(){R1=i();},k,M1);return R1;}}return e();}function B1(e,i,j,k){var L1=false;if(j&&j.aUnsavedDataCheckFunctions){L1=j.aUnsavedDataCheckFunctions.some(function(N1){return N1();});}if(L1||u.getView().getModel().hasPendingChanges()){var M1;G1(function(){u.getView().getModel().resetChanges();v.fire(u,"AfterCancel",{});M1=e();},function(){M1=i();},k);return M1;}return e();}function C1(e,i,j,k,L1,M1){if(L1){return A1(e,i,j,k,true,M1);}S.oApplication.performAfterSideEffectExecution(A1.bind(null,e,i,j,k,false,M1));}var D1;function E1(e,i,j,k){var L1;D1=e;if(!j||!k){var M1=J("sap.suite.ui.generic.template.fragments.DataLoss",{onDataLossOK:function(){M1.close();D1();},onDataLossCancel:function(){M1.close();i();}},"dataLoss");if(!j){j="LeavePage";}L1=M1.getModel("dataLoss");L1.setProperty("/mode",j);M1.open();}else{var N1=J("sap.suite.ui.generic.template.fragments.DiscardDraftPopover",{onDiscardConfirm:function(){D1();}},"discard");L1=N1.getModel("discard");L1.setProperty("/placement",sap.m.PlacementType.Top);if(j!=="Proceed"){L1.setProperty("/isCreateDraft",true);}else{L1.setProperty("/isCreateDraft",false);}L1.setProperty("/mode",j);N1.openBy(k.getSource());}}var F1;function G1(e,i,j){F1=e;if(!j){j="LeavePage";}var k=J("sap.suite.ui.generic.template.fragments.DataLossTechnicalError",{onDataLossOK:function(){k.close();F1();},onDataLossCancel:function(){k.close();i();}},"dataLoss");var L1=k.getModel("dataLoss");L1.setProperty("/mode",j);k.open();}function H1(e,i,j,k,L1,M1){if(i.busy.check&&k.isBusy()){M1();return;}var N1=i.busy.set?function(){k.setBusy(Promise.resolve(),false,{actionLabel:i.sActionLabel});return e();}:e;var O1=i.mConsiderObjectsAsDeleted?function(Q1){S.oApplication.prepareDeletion(i.mConsiderObjectsAsDeleted);return N1();}:N1;var P1=(i.dataloss.popup?C1(O1,M1,j,(i.dataloss.navigation?"LeavePage":"Proceed"),true):O1());if(P1 instanceof Promise){P1.then(L1,M1);}else{L1();}}function I1(e,i,j){i=q.extend(true,{busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},i);var k=S.oApplication.getBusyHelper();var L1=new Promise(function(M1,N1){S.oApplication.performAfterSideEffectExecution(H1.bind(null,e,i,j,k,M1,N1));});if(i.busy.set){k.setBusy(L1,false,{actionLabel:i.sActionLabel});}return L1;}function J1(){w=w||new N(u);return w;}function K1(e){var j;var k=v.getTemplatePrivateModel();var L1=u.getOwnerComponent();var M1,N1,O1,P1,Q1,R1=[],S1=[],i,T1,U1,V1,W1,X1,Y1;var Z1,$1;M1=L1.getAppComponent();N1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");O1=k.getProperty("/generic/supportedIntents/");if(g(e)){j=e.getToolbar();}else if(f(e)){j=e.getCustomToolbar();}P1=j.getContent();Q1=P1.length;for(i=0;i<Q1;i++){T1=U(P1[i]);if(T1.hasOwnProperty("SemanticObject")&&T1.hasOwnProperty("Action")){U1=T1.SemanticObject;V1=T1.Action;W1={semanticObject:U1,action:V1,ui5Component:M1};R1.push([W1]);X1=q.extend({},W1);X1.bLinkIsSupported=false;S1.push(X1);}}if(R1.length>0&&N1){Y1=N1.getLinks(R1);Y1.done(function(_1){O1=k.getProperty("/generic/supportedIntents/");Z1=_1.length;for(i=0;i<Z1;i++){if(_1[i][0].length>0){S1[i].bLinkIsSupported=true;}U1=S1[i].semanticObject;V1=S1[i].action;$1=k.getProperty("/generic/supportedIntents/"+U1);if(!$1){O1[U1]={};O1[U1][V1]={"visible":S1[i].bLinkIsSupported};}else if(!$1[V1]){$1[V1]={"visible":S1[i].bLinkIsSupported};}else{$1[V1]["visible"]=S1[i].bLinkIsSupported;}}k.updateBindings();});}}var J1=t.testable(J1,"getNavigationHandler");var a1=t.testable(a1,"fillEnabledMapForBreakoutActions");var c1=t.testable(c1,"getBreakoutActionIds");var f1=t.testable(f1,"getOwnerControl");var T=t.testable(T,"getSelectedContexts");return{isSmartTable:f,isSmartChart:g,isUiTable:h,isAnalyticalTable:l,isTreeTable:m,isMTable:n,getPositionableControlId:I,getCurrentEntitySetName:p,getMetaModelEntityType:y,getText:O,getContextText:P,getNavigationHandler:J1,getNavigationKeyProperties:p1,mergeNavigationKeyPropertiesWithValues:q1,executeGlobalSideEffect:function(){if(v.isDraftEnabled()){var e=u.getView();e.attachBrowserEvent("keydown",function(i){var j=(i.target.type==="search")?true:false;var k=(i.target.type==="textarea")?true:false;if(i.keyCode===13&&i.ctrlKey!==true&&e.getModel("ui").getProperty("/editable")&&!j&&!k){var L1=u.getOwnerComponent().getAppComponent().getConfig();var M1=L1.settings&&L1.settings.forceGlobalRefresh;var N1;S.oApplication.addSideEffectPromise(new Promise(function(O1){N1=O1;}));setTimeout(function(){var O1=S.oApplicationController.executeSideEffects(e.getBindingContext(),null,null,M1);O1.then(function(){N1();setTimeout(function(){document.getElementById(i.target.id).focus();});});});}});}},setEnabledToolbarButtons:V,setEnabledFooterButtons:X,fillEnabledMapForBreakoutActions:a1,getBreakoutActions:e1,getSelectedContexts:T,getSelectionPoints:Q,getDeleteRestrictions:_,setPrivateModelControlProperty:Y,navigateFromListItem:l1,navigateToContext:m1,navigateExternal:o1,semanticObjectLinkNavigation:r1,getCustomData:function(e){var j=e.getSource().getCustomData();var k={};for(var i=0;i<j.length;i++){k[j[i].getKey()]=j[i].getValue();}return k;},onBeforeRebindTableOrChart:x1,formatDraftLockText:y1,showDraftPopover:function(e,i){var j=z1();var k=j.getModel("admin");k.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));k.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));j.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(j.getBindingContext()){j.openBy(i);}else{j.getObjectBinding().attachDataReceived(function(){j.openBy(i);});}},getContentDensityClass:function(){return S.oApplication.getContentDensityClass();},attachControlToView:D,getDialogFragment:J,processDataLossConfirmationIfNonDraft:C1,processDataLossTechnicalErrorConfirmation:B1,securedExecution:I1,getOwnerControl:f1,getTableBindingInfo:g1,refreshSmartTable:h1,refreshModel:i1,getElementCustomData:U,triggerAction:function(e,i,j,k,L1){C1(function(){S.oCRUDManager.callAction({functionImportPath:j.Action,contexts:e,sourceControl:k,label:j.Label,operationGrouping:"",navigationProperty:""}).then(function(M1){if(M1&&M1.length>0){var N1=M1[0];if(N1.response&&N1.response.context&&(!N1.actionContext||N1.actionContext&&N1.response.context.getPath()!==N1.actionContext.getPath())){S.oApplication.getBusyHelper().getUnbusy().then(S.oViewDependencyHelper.setMeToDirty.bind(null,u.getOwnerComponent(),i));}}});},q.noop,L1,"Proceed");},checkToolbarIntentsSupported:K1,getControlInformation:z,executeForAllInformationObjects:A,focusControl:r};}return B.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,S,i){q.extend(this,s(e,S,i));}});});
