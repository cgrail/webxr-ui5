sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ControllerExtension","sap/ui/core/format/DateFormat","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/controller/SideContentHandler","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/js/AnnotationHelper","sap/m/Table","sap/ui/layout/DynamicSideContent","sap/suite/ui/generic/template/lib/ShareUtils","sap/ui/dom/jquery/Selectors","sap/base/Log","sap/suite/ui/generic/template/ObjectPage/controller/MultipleViewsHandler"],function(q,C,D,M,F,S,a,t,d,b,E,A,R,c,f,g,L,h){"use strict";function s(o){o.setSelectedSection(null);}function I(o){return o.data("inlineCreate")==="true";}function l(B,e){if(B.getBindings){var j=B.getBindings();for(var i=0;i<j.length;i++){l(j[i],e);}}else{var T=B.getType();B.setType(T,e);}}var r=/[A-Za-z].*[A-Za-z]/;var m={getMethods:function(v,T,o){var n={"oMultipleViewsHandler":{}};var B=d.getControllerBase(v,T,o);B.state.aUnsavedDataCheckFunctions=[];v.oController=o;var p;var O;var u=new b(o,T,B.stateChanged);var w;function y(e){var i=e.getParameter("bindingParams");i.parameters=i.parameters||{};i.parameters.usePreliminaryContext=true;i.parameters.batchGroupId="facets";return i;}function z(){L.info("Activate object");var e=T.oServices.oCRUDManager.activateDraftEntity();e.then(function(i){T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(i&&i.context){var j=o.getOwnerComponent();T.oServices.oViewDependencyHelper.setAllPagesDirty([j.getId()]);T.oServices.oViewDependencyHelper.unbindChildren(j);var k=j.getNavToListOnSave();T.oServices.oApplication.invalidatePaginatorInfo();if(k){T.oServices.oNavigationController.navigateToRoot(true);}else{T.oServices.oNavigationController.navigateToContext(i.context,undefined,true,undefined,true);}}var x={activationPromise:e};T.oComponentUtils.fire(o,"AfterActivate",x);},q.noop);}function G(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,z);}function H(){var e=o.getView();var i=e.getBindingContext();var j=e.getModel().getPendingChanges();j=j&&j[i.getPath().replace("/","")]||{};var k=Object.keys(j)||[];var x=T.oComponentUtils.isNonDraftCreate();var F1=k.indexOf("__metadata");if(F1>-1){k.splice(F1,1);}var G1=T.oServices.oCRUDManager.saveEntity();G1.then(function(I1){var J1=T.oComponentUtils.getTemplatePrivateModel();J1.setProperty("/objectPage/displayMode",1);v.setEditable(false);T.oServices.oViewDependencyHelper.setRootPageToDirty();T.oServices.oViewDependencyHelper.unbindChildren(o.getOwnerComponent());T.oServices.oApplication.invalidatePaginatorInfo();if(x){if(I1&&I1.getPath()!=="/undefined"){T.oServices.oNavigationController.navigateToContext(I1,undefined,true);}else{T.oServices.oNavigationController.navigateBack();}T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_CREATED"));}else{T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(!T.oComponentUtils.isDraftEnabled()&&!p){T.oServices.oNavigationController.navigateBack();}}if(k.length>0){T.oServices.oApplicationController.executeSideEffects(i,k);}});var H1={saveEntityPromise:G1};T.oComponentUtils.fire(o,"AfterSave",H1);}function J(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,H);}function K(e){if(I(e.getSource())){var i=e.getParameter("bindingParams");if(i.filters&&i.filters.length){var j=new F(i.filters);i.filters=new F({filters:[new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:true}),j],and:true}),new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:false}),new F({filters:[j,new F({path:"HasActiveEntity",operator:"EQ",value1:false})],and:true})],and:true})],and:false});}var k=i.sorter[0]&&i.sorter[0].getGroupFunction();var x=k&&function(F1){var G1=F1.getObject();if(G1.IsActiveEntity||G1.HasActiveEntity){var H1=q.extend({},k(F1));H1.key=H1.key.charAt(0)==="ยง"?"ยง"+H1.key:H1.key;return H1;}return{key:"ยง",text:T.oCommonUtils.getText("NEW_ENTRY_GROUP")};};if(e.getSource().data("disableInlineCreateSort")==="false"){i.sorter.unshift(new S("HasActiveEntity",false,x));}}}function N(){return O.getHeaderTitle();}function P(e){var i=T.oComponentUtils.getTemplatePrivateModel();var j={shareEmailPressed:function(){var k=i.getProperty("/objectPage/headerInfo/objectTitle");var x=i.getProperty("/objectPage/headerInfo/objectSubtitle");if(x){k=k+" - "+x;}var F1=document.URL.replace(/\(/g,'%28').replace(/\)/g,'%29');sap.m.URLHelper.triggerEmail(null,k,F1);},shareJamPressed:function(){f.openJamShareDialog(i.getProperty("/objectPage/headerInfo/objectTitle")+" "+i.getProperty("/objectPage/headerInfo/objectSubtitle"));},getModelData:function(){return{title:i.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:i.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:document.URL};}};f.openSharePopup(T.oCommonUtils,e.getSource(),j);}function Q(){var e=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(i){var j=i.getSource();var k=j.getBindingContext("buttons");var x=k.getProperty("link");var F1=k.getProperty("param");var G1=x.intent;var H1=G1.split("#")[1].split("-")[0];var I1=G1.split("-")[1].split("?")[0].split("~")[0];var J1={target:{semanticObject:H1,action:I1},params:F1};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(J1);}},"buttons");return e;}var U;function V(){U=function(e){var i=e.getSource().getParent();var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=o.getOwnerComponent();var x=k.getModel("_templPrivGlobal");var F1={objectPage:{currentEntitySet:k.getProperty("entitySet")}};x.setProperty("/generic/multipleViews",F1);var G1=T.oServices.oCRUDManager.deleteEntity();var H1=k.getBindingContext().getPath();var I1=Object.create(null);I1[H1]=G1;T.oServices.oApplication.prepareDeletion(I1);var e={deleteEntityPromise:G1};j.setBusy(G1);T.oComponentUtils.fire(o,"AfterDelete",e);i.close();};return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(e){var i=e.getSource().getParent();i.close();},onDelete:function(e){U(e);}},"delete");}function W(){var e=T.oServices.oApplication.getBusyHelper();if(e.isBusy()){return;}var i=T.oCommonUtils;var j=T.oComponentUtils.getTemplatePrivateModel();var k=(j.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var x=j.getProperty("/objectPage/headerInfo/objectSubtitle");var F1;var G1={};G1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");if(k){if(x){F1=[" ",k,x];G1.text=i.getText("DELETE_WITH_OBJECTINFO",F1);}else{F1=[k];G1.text=i.getText("DELETE_WITH_OBJECTTITLE",F1);}}else{G1.text=i.getText("ST_GENERIC_DELETE_SELECTED");}var H1=Promise.resolve(o.beforeDeleteExtension());H1.then(function(I1){q.extend(G1,I1);var J1=V();var K1=J1.getModel("delete");K1.setData(G1);J1.open();},q.noop);}function X(e){T.oServices.oApplication.performAfterSideEffectExecution(W);}function Y(e,i){var j,k;if(e){k=e.context||e;if(T.oServices.oDraftController.getDraftContext().hasDraft(k)){T.oServices.oViewDependencyHelper.setRootPageToDirty();j=k.context||k;}}if(j){T.oServices.oApplication.invalidatePaginatorInfo();T.oServices.oApplication.switchToDraft(j);}else{var x=T.oComponentUtils.getTemplatePrivateModel();x.setProperty("/objectPage/displayMode",2);}v.setEditable(true);}var Z;function $(e){T.oServices.oCRUDManager.editEntity(e).then(function(i){if(i.draftAdministrativeData){Z(i.draftAdministrativeData.CreatedByUserDescription||i.draftAdministrativeData.CreatedByUser);}else{Y(i.context,false);}});}Z=function(e){var i=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){i.close();$(true);},onCancel:function(){i.close();}},"Dialog");var j=i.getModel("Dialog");var k=T.oCommonUtils.getText("DRAFT_LOCK_EXPIRED",[e]);j.setProperty("/unsavedChangesQuestion",k);i.open();};function _(){var j="{\"SelectionVariantID\":\"\"}";var k=o.getOwnerComponent();var F1=k.getEntitySet();var G1=k.getModel();var H1=G1.getMetaModel();var I1=H1.getODataEntitySet(F1);var J1=H1.getODataEntityType(I1.entityType);var K1=J1.property;var L1=[];for(var x in K1){var M1=K1[x]["com.sap.vocabularies.Common.v1.FieldControl"]&&K1[x]["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(M1&&L1.indexOf(M1)<0){L1.push(M1);}}var N1=o.getView().getBindingContext();var O1=N1.getObject();var P1=new a();for(var i in K1){var Q1=K1[i].type;var R1=K1[i].name;var S1=O1[K1[i].name];if(L1.indexOf(R1)>-1){continue;}if(R1&&(S1||Q1==="Edm.Boolean")){if(Q1==="Edm.Time"&&S1.ms!==undefined){S1=S1.ms;}if(typeof S1!=="string"){try{S1=S1.toString();}catch(e){S1=S1+"";}}P1.addParameter(R1,S1);}}j=P1.toJSONString();return j;}function a1(e,c1){var i=true;var j=c1.getModel();c1=c1 instanceof R?c1.getParent():c1;var k=T.oCommonUtils.getDeleteRestrictions(c1);var x=k&&k.Deletable&&k.Deletable.Path;if(x){i=j.getProperty(x,e);}return i;}var b1;var c1;function d1(e,j){b1=e;c1=j instanceof R?j.getParent():j;var k=[];U=function(x){var F1=T.oServices.oApplication.getBusyHelper();var G1=x.getSource().getParent();var H1=T.oCommonUtils.getSelectedContexts(c1);k=[];var I1;var J1;var K1=o.getView().getModel().getObject(H1[0].getPath());for(var i=0;i<H1.length;i++){if(a1(H1[i],c1)){k.push(H1[i].getPath());}}var L1=T.oServices.oCRUDManager.deleteEntities(k);F1.setBusy(L1);T.oServices.oApplicationController.executeSideEffects(c1.getBindingContext(),[],[c1.getTableBindingPath()]);var M1=b1.getParent().getParent().getId();L1.then(function(O1){T.oServices.oViewDependencyHelper.unbindChildren(o.getOwnerComponent());T.oCommonUtils.refreshSmartTable(c1);if(K1.IsActiveEntity===false){J1=0;}else{J1=O1.length;}I1=k.length-J1;var P1="";if(I1>0){if(I1>1){P1=T.oCommonUtils.getContextText("DELETE_SUCCESS_PLURAL_WITH_COUNT",c1.getId(),null,[I1]);}else{if(J1>0){P1=T.oCommonUtils.getContextText("DELETE_SUCCESS_WITH_COUNT",c1.getId(),null,[I1]);}else{P1=T.oCommonUtils.getContextText("ITEM_DELETED",c1.getId());}}}if(J1>0){if(J1>1){P1+=P1&&P1+"\n";P1+=T.oCommonUtils.getContextText("DELETE_ERROR_PLURAL_WITH_COUNT",c1.getId(),null,[J1]);}else{if(I1>0){P1+="\n";P1+=T.oCommonUtils.getContextText("DELETE_ERROR_WITH_COUNT",c1.getId(),null,[J1]);}else{P1+=T.oCommonUtils.getContextText("DELETE_ERROR",c1.getId());}}}if(P1){if(J1>0){M.error(P1);}else{T.oServices.oApplication.showMessageToast(P1);}}});var N1={deleteEntitiesPromise:L1,sUiElementId:M1,aContexts:H1};T.oComponentUtils.fire(o,"AfterLineItemDelete",N1);G1.close();};return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(i){var x=i.getSource().getParent();x.close();},onDelete:function(i){U(i);}},"delete");}function e1(e){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var b1=e.getSource();var c1=T.oCommonUtils.getOwnerControl(b1);if(!T.oCommonUtils.isSmartTable(c1)){c1=c1.getParent();}var k=T.oCommonUtils.getSelectedContexts(c1);if(k.length===0){M.error(T.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:T.oCommonUtils.getContentDensityClass()});return;}var x=[];var F1=[];for(var i=0;i<k.length;i++){if(a1(k[i],c1)){x.push(k[i].getPath());}else{F1.push(k[i]);}}var G1={};if(k.length>1){G1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[k.length]);G1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEMS",c1.getId());}else{G1.title=T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");G1.text=T.oCommonUtils.getContextText("DELETE_SELECTED_ITEM",c1.getId());}if(F1.length>0){G1.undeletableText=T.oCommonUtils.getContextText("DELETE_UNDELETABLE_ITEMS",c1.getId(),null,[F1.length,k.length]);}var H1={sUiElementId:b1.getParent().getParent().getId(),aContexts:k};var I1=Promise.resolve(o.beforeLineItemDeleteExtension(H1));I1.then(function(J1){q.extend(G1,J1);var K1=d1(b1,c1);if(!F1.length){G1.undeletableText=undefined;}var L1=K1.getModel("delete");L1.setData(G1);K1.open();},q.noop);}function f1(){var i=o.byId("imageDialog")||T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.ImageDialog",{onImageDialogClose:function(){i.close();}},"headerImage");return i;}function g1(){var e=o.byId("template::ObjectPage::TitleImage");if(!e){return;}var i=o.getView().byId("template::ObjectPage::ObjectPageHeader");e.setVisible(false);i.attachStateChange(function(j){var k=j.getParameter("isExpanded");e.setVisible(!k);});}function h1(){var e;var j=T.oComponentUtils.getTemplatePrivateModel();var k=function(i){return function(x){var F1=x.getSource();var G1=F1.getExternalValue();j.setProperty("/objectPage/headerInfo/"+i,G1);if(!G1&&i==="objectTitle"){var H1=T.oComponentUtils.getHeaderDataAvailablePromise();H1.then(function(I1){G1=F1.getExternalValue();if(G1){return;}var J1=o.getView();var K1=I1.getObject();var L1=J1.getModel("ui");var M1=L1.getProperty("/createMode");if(M1&&K1&&(K1.IsActiveEntity===undefined||K1.IsActiveEntity===false||K1.HasActiveEntity===false)){e=e||T.oCommonUtils.getText("NEW_OBJECT");j.setProperty("/objectPage/headerInfo/objectTitle",e);}});}};};O.getCustomData().forEach(function(x){var F1=x.getKey();if(F1==="objectTitle"||F1==="objectSubtitle"){var G1=x.getBinding("value");var H1=!G1&&x.getBindingInfo("value");if(!G1&&!H1){j.setProperty("/objectPage/headerInfo/"+F1,x.getValue());return;}var I1=k(F1);if(G1){G1.attachChange(I1);l(G1,"string");}else{H1.events={change:I1};for(var i=0;i<H1.parts.length;i++){H1.parts[i].targetType="string";}}}});}function i1(e){e.preventDefault();var i=T.oCommonUtils.getControlInformation(e,null,true);if(!i){return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=T.oComponentUtils.getTemplatePrivateModel();var k=j.getProperty("/objectPage/displayMode");T.oServices.oNavigationController.navigateToContext(i.internalHash,null,false,k);},q.noop,B.state);}function j1(e,i){L.info("Set binding context to "+e,"Subsection: "+i.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i.setBindingContext(e);}function k1(e,i,j,k){if(i){var x=e?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();x.then(function(){j1(undefined,j);var F1=j.getId();L.info("Start refreshing of Subsection: "+F1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");k.refresh(null,true);L.info("End refreshing of Subsection: "+F1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");});}else{j1(null,j);}}var l1={lazyLoading:k1.bind(null,false),lazyLoadingAfterHeader:k1.bind(null,true),reuseComponent:function(i,e){var j=e.getBlocks()[0];var k=i?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();k.then(T.oComponentUtils.onVisibilityChangeOfReuseComponent.bind(null,i,j));}};function m1(e,i,j){if(j instanceof c){j=j.getMainContent()[0];}else if(!j.getContent){return;}j.getContent().forEach(function(k){if(T.oCommonUtils.isSmartTable(k)){if(i||e[k.getEntitySet()]){if(k.isInitialised()){T.oCommonUtils.refreshSmartTable(k);}else{k.attachInitialise(function(){T.oCommonUtils.refreshSmartTable(k);});}if(!i){T.oServices.oApplicationController.executeSideEffects(o.getOwnerComponent().getBindingContext(),[],[k.getTableBindingPath()]);}}}});}function n1(e){return T.oCommonUtils.getControlInformation(e);}function o1(e){T.oCommonUtils.getControlInformation(e,function(i,j){var k=e.getBlocks();u.initSideContentInfoObject(k[0]);var x=k.concat(e.getMoreBlocks());i.refresh=function(H1,I1){var J1=m1.bind(null,H1,I1);x.forEach(J1);};var F1=T.oCommonUtils.getElementCustomData(e).strategyForVisibilityChange;var G1=l1[F1];i.strategyForVisibilityChange=G1||q.noop;if(G1){j.push("subSectionListeningToVisibilityChange");}});}function p1(i,e,j){e=e||n1(j);if(e.isVisible===i){return;}e.isVisible=i;e.strategyForVisibilityChange(i,j,e);}function q1(i){T.oCommonUtils.executeForAllInformationObjects("subSectionListeningToVisibilityChange",p1.bind(null,i));}function r1(e){var i=e&&e.getParameter("section");w=i?i.getId():O.getSelectedSection();}function s1(e){r1(e);B.stateChanged();}function t1(e,i,j,k,x){var F1=A.createP13NColumnKey(x);var G1=A.getBindingForHiddenPath(x);if(G1==="{= !${} }"){e.push(F1);return false;}if(typeof(G1)==="string"){var H1=G1.match(r)&&G1.match(r)[0];if(H1&&H1.indexOf("/")>0&&k.navigationProperty){var I1=o.getOwnerComponent().getEntitySet();var J1=H1.split("/",1)[0];if(j.getODataAssociationSetEnd(k,J1).entitySet===I1){i[F1]=H1.split("/").slice(1).join("/");return true;}}}else if(!G1){e.push(F1);}return false;}function u1(c1,e,j,k,x,F1){var G1=[];var H1=Object.create(null);var I1=false;for(var i=0;i<F1.length;i++){var J1=F1[i];I1=t1(G1,H1,k,x,J1)||I1;}if(I1){e.dynamicHideInfos={staticHiddenColumns:G1,columnKeyToHiddenPath:H1};j.push("smartTableWithDynamicColumnHide");}if(G1.length){c1.deactivateColumns(G1);}}function v1(e,j,c1){j.push("smartTable");c1=T.oCommonUtils.isMTable(c1)?c1.getParent():c1;var k=c1.getModel().getMetaModel();var x=k.getODataEntitySet(c1.getEntitySet());var F1=k.getODataEntityType(x.entityType);var G1=F1["com.sap.vocabularies.UI.v1.LineItem"];var H1=c1.getCustomData();for(var i=0;i<H1.length;i++){if(H1[i].getKey()==="lineItemQualifier"){G1=F1["com.sap.vocabularies.UI.v1.LineItem#"+H1[i].getValue()];break;}}u1(c1,e,j,k,F1,G1);}function w1(c1){return T.oCommonUtils.getControlInformation(c1,v1);}function x1(e,i){var j,k;j=i.split(e)[1];k=j&&j.substring(0,j.lastIndexOf("::Table"));return k;}function y1(e,i,j){i.push("searchField");var k=T.oCommonUtils.isMTable(j.getParent().getParent())?j.getParent().getParent().getParent():j.getParent().getParent();e.table=k;var x=w1(k);x.searchField=j;}function z1(e){return T.oCommonUtils.getControlInformation(e,y1);}function A1(e){z1(e);}function B1(e){var i=z1(e);i.searchString=e.getSource().getValue();i.table.rebindTable();}function C1(e,i){i.setValue("");if(e.searchString){e.searchString="";e.table.rebindTable();}}function D1(){T.oCommonUtils.executeForAllInformationObjects("searchField",C1);}v.refreshFacets=function(e){var i=function(j){var k=n1(j);k.refresh(e,false);};O.getSections().forEach(function(j){j.getSubSections().forEach(i);});};v.getHeaderInfoTitleForNavigationMenue=function(){var e=T.oComponentUtils.getTemplatePrivateModel();var i=e.getProperty("/generic/viewLevel");var j=e.getProperty("/objectPage/headerInfo/objectTitle");T.oServices.oApplication.subTitleForViewLevelChanged(i,j);};v.onComponentActivate=B.onComponentActivate;v.getCurrentState=function(){var e=Object.create(null);if(w){e.section={data:w,lifecycle:{permanent:true,pagination:true}};}e.sideContent=u.getCurrentState();var i=Object.create(null);o.provideCustomStateExtension(i);for(var j in i){e["$custom$"+j]=i[j];}var k=true;var x=function(F1,G1){if(!(F1 instanceof C)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}var H1=F1.getMetadata().getNamespace();if(G1){for(var I1 in G1){e["$extension$"+H1+"$"+I1]=G1[I1];}}};o.templateBaseExtension.provideExtensionStateData(x);k=false;return e;};v.applyState=function(n,i){var e=Object.create(null);var j=Object.create(null);for(var k in n){if(k.indexOf("$custom$")===0){e[k.substring(8)]=n[k];}else if(k.indexOf("$extension$")===0){var x=k.substring(11,k.indexOf("$",11));var F1=j[x];if(!F1){F1=Object.create(null);j[x]=F1;}var G1=k.substring(k.indexOf("$",11)+1,k.length);F1[G1]=n[k];}}o.applyCustomStateExtension(e,i);var H1=true;var I1=function(J1){if(!(J1 instanceof C)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}if(!H1){throw new Error("State must always be restored synchronously");}var x=J1.getMetadata().getNamespace();return j[x];};o.templateBaseExtension.restoreExtensionStateData(I1,i);H1=false;u.applyState(n.sideContent,i);if(i){if(w!==(n.section||"")){B.stateChanged();}return;}D1();if(n.section){O.setSelectedSection(n.section);r1();}else{Promise.all([T.oComponentUtils.getHeaderDataAvailablePromise(),T.oComponentUtils.getNavigationFinishedPromise()]).then(s.bind(null,O));w="";}};v.beforeRebind=function(){q1(false);};v.afterRebind=function(){L.info("Call of _triggerVisibleSubSectionsEvents","","Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");O._triggerVisibleSubSectionsEvents();};v.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var i=function(j,c1){var k=j.dynamicHideInfos.staticHiddenColumns.slice();for(var x in j.dynamicHideInfos.columnKeyToHiddenPath){var F1=j.dynamicHideInfos.columnKeyToHiddenPath[x];if(e.getProperty(F1)){k.push(x);}}c1.deactivateColumns(k);};T.oCommonUtils.executeForAllInformationObjects("smartTableWithDynamicColumnHide",i);};var $=t.testable($,"editEntity");var a1=t.testable(a1,"isEntryDeletable");var z=t.testable(z,"onActivateImpl");var E1={onInit:function(){O=o.byId("objectPage");var e=o.getOwnerComponent();var i=O.getSections();for(var k=0;k<i.length;k++){var j=i[k];var x=j.getSubSections();x.forEach(o1);}var F1=N();var G1=e.getAppComponent().getConfig();var H1=G1&&G1.settings&&G1.settings.objectPageDynamicHeaderTitleWithVM;v.aBreadCrumbs=F1&&(H1?F1.getBreadcrumbs().getLinks():F1.getBreadCrumbsLinks());if(H1){g1();}B.onInit(null,q1.bind(null,true));h1();T.oCommonUtils.executeGlobalSideEffect();O.attachEvent("subSectionEnteredViewPort",function(K1){var L1=K1.getParameter("subSection");L.info("Viewport entered ","Subsection: "+L1.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");p1(true,null,L1);});var I1=o.getOwnerComponent()&&o.getOwnerComponent().getSections();for(var J1 in I1){if(I1.hasOwnProperty(J1)){I1[J1]["key"]=J1;n.oMultipleViewsHandler[J1]=new h(n,o,T,I1[J1]);n.oMultipleViewsHandler[J1]["oSmartTable"]=o.byId(J1+"::Table");}}},handlers:{onEditAndActiveToggle:function(e,i){T.oServices.oApplication.performAfterSideEffectExecution(function(){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var k=e.getBindingContext();var x=T.oServices.oApplication.getDraftSiblingPromise(k);j.setBusy(x.then(function(F1){if(i){L.info("Navigating to draft entity");Y(F1,true);}else{L.info("Navigating to active entity");T.oServices.oNavigationController.navigateToContext(F1,null,true,1,true);}g(':focus').blur();}));});},addEntry:function(e){var b1=e.getSource();var c1=T.oCommonUtils.getOwnerControl(b1);c1=T.oCommonUtils.isMTable(c1)?c1.getParent():c1;var i=I(c1);if(!b1.data("CrossNavigation")&&i){T.oCommonEventHandlers.addEntry(b1,true);return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.addEntry(b1,false);},q.noop,B.state);},submitChangesForSmartMultiInput:function(){if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.submitChangesForSmartMultiInput();}},deleteEntries:e1,onSelectionChange:function(e){T.oCommonUtils.setEnabledToolbarButtons(e.getSource());},onCancel:function(e){var i="Proceed";var j;if(T.oComponentUtils.isNonDraftCreate()||!p){i="LeavePage";}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var k=T.oComponentUtils.getTemplatePrivateModel();k.setProperty("/objectPage/displayMode",1);if(T.oComponentUtils.isNonDraftCreate()){v.setEditable(false);}else if(p){v.setEditable(false);}if(T.oComponentUtils.isNonDraftCreate()||!p){T.oServices.oNavigationController.navigateBack();}},q.noop,B.state,i,j,e);},onContactDetails:function(e){T.oCommonEventHandlers.onContactDetails(e);},onPressDraftInfo:function(e){var i=o.getView().getBindingContext();var j=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));T.oCommonUtils.showDraftPopover(i,j);},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var i=o.getView().getBindingContext();var j=o.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");T.oCommonUtils.showDraftPopover(i,j);},onShareObjectPageActionButtonPress:P,onRelatedApps:function(e){var x,F1,G1,H1,I1,J1,K1;var L1,M1,N1,O1,P1;x=e.getSource();N1=sap.ushell&&sap.ushell.Container;F1=N1&&N1.getService("URLParsing");G1=F1.parseShellHash(document.location.hash);O1=G1.semanticObject;P1=G1.action;H1=o.getView&&o.getView().getBindingContext();var Q1=o.getOwnerComponent().getModel().getMetaModel();var R1=H1.getObject();var S1=R1.__metadata.type;var T1=Q1.getODataEntityType(S1);var U1=T1["com.sap.vocabularies.Common.v1.SemanticKey"];var V1={};if(U1&&U1.length>0){for(var j=0;j<U1.length;j++){var W1=U1[j].PropertyPath;if(!V1[W1]){V1[W1]=[];V1[W1].push(R1[W1]);}}}else{for(var k in T1.key.propertyRef){var X1=T1.key.propertyRef[k].name;if(!V1[X1]){V1[X1]=[];V1[X1].push(R1[X1]);}}}I1=o.getOwnerComponent().getAppComponent();J1=N1&&N1.getService("CrossApplicationNavigation");K1=J1.getLinks({semanticObject:O1,params:V1,ui5Component:I1});L1=Q();M1=L1.getModel("buttons");M1.setProperty("/buttons",[]);L1.openBy(x);K1.done(function(Y1){var Z1=[];Y1.sort(function(b2,c2){if(b2.text<c2.text){return-1;}if(b2.text>c2.text){return 1;}return 0;});for(var i=0;i<Y1.length;i++){var $1=Y1[i];var _1=$1.intent;var a2=_1.split("-")[1].split("?")[0];if(a2!==P1){Z1.push({enabled:true,text:$1.text,link:$1,param:V1});}}if(Z1.length===0){Z1.push({enabled:false,text:T.oCommonUtils.getText("NO_RELATED_APPS")});}M1.setProperty("/buttons",Z1);});},onSemanticObjectLinkPopoverLinkPressed:function(e){T.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(e,B.state);},onEdit:function(e){var b1=e.getSource();if(b1.data("CrossNavigation")){T.oCommonEventHandlers.onEditNavigateIntent(b1);return;}p=true;$();},onSave:J,onActivate:G,onSmartFieldUrlPressed:function(e){T.oCommonEventHandlers.onSmartFieldUrlPressed(e,B.state);},onBreadCrumbUrlPressed:i1,onDiscardDraft:function(e){T.oCommonEventHandlers.onDiscardDraft(e,B.state.beforeSaveHelper);},onDelete:X,onCallActionFromToolBar:function(e){T.oCommonEventHandlers.onCallActionFromToolBar(e,B.state);},onCallAction:function(e){var i=o.getOwnerComponent();var j=i.getEntitySet();var k=T.oCommonUtils.getCustomData(e);var x=[];x.push(o.getView().getBindingContext());if(x[0]&&k.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var F1={functionImportPath:k.Action,contexts:x,sourceControl:"",label:k.Label,operationGrouping:k.InvocationGrouping,navigationProperty:i.getNavigationProperty()};T.oServices.oCRUDManager.callAction(F1).then(function(G1){var H1=G1&&G1[0];if(H1&&H1.response&&H1.response.context&&(!H1.actionContext||H1.actionContext&&H1.response.context.getPath()!==H1.actionContext.getPath())){T.oServices.oViewDependencyHelper.setParentToDirty(i,j,1);}});},q.noop,B.state,"Proceed");}else if(k.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);}},onDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);},onDataFieldWithIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,B.state);},onDataFieldWithNavigationPath:function(e){T.oCommonEventHandlers.onDataFieldWithNavigationPath(e);},onChartInit:function(e){var i=e.getSource().getChart();var j=o._templateEventHandlers.onSelectionChange;i.attachSelectData(j).attachDeselectData(j);var k=i.getParent();T.oCommonUtils.checkToolbarIntentsSupported(k);},onDataRequested:function(i){L.info("Data requested","SmartTable: "+i,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");var e=(o&&o.getView()&&o.getView().getId())+"--";var j=x1(e,i);n.oMultipleViewsHandler[j]&&n.oMultipleViewsHandler[j].onDataRequested();},onDataReceived:function(e){T.oCommonEventHandlers.onDataReceived(e);},onBeforeRebindDetailTable:function(e){var i,j,k;var c1=e.getSource();var x=y(e);var F1=w1(c1);var G1=F1.searchField;if(G1){var H1=T.oCommonUtils.getControlInformation(G1);if(H1.searchString){x.parameters.custom={search:H1.searchString};}}T.oCommonEventHandlers.onBeforeRebindTable(e,{ensureExtensionFields:o.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:o.templateBaseExtension.addFilters});o.onBeforeRebindTableExtension(e);k=o&&typeof o.getView==="function"&&o.getView()&&typeof o.getView().getId==="function"&&o.getView().getId();if(k){k=k+"--";j=c1&&c1.getId();i=x1(k,j);n.oMultipleViewsHandler[i]&&n.oMultipleViewsHandler[i].onRebindContentControl(e);}K(e);if(T.oCommonUtils.isAnalyticalTable(c1.getTable())){x.parameters.entitySet=c1.getEntitySet();}},onShowDetails:function(e){T.oCommonEventHandlers.onShowDetails(e.getSource(),B.state);},onListNavigate:function(e){T.oCommonEventHandlers.onListNavigate(e,B.state,o.onListNavigationExtension.bind(o));},onBeforeSemanticObjectLinkPopoverOpens:function(e){var i=e.getParameters();T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=_();T.oCommonUtils.semanticObjectLinkNavigation(i,j,o);},q.noop,B.state,q.noop);},onSemanticObjectLinkNavigationPressed:function(e){var i=e.getParameters();var b1=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(b1,i);},onSemanticObjectLinkNavigationTargetObtained:function(e){var i=e.getParameters();var b1=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(b1,i,B.state);},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var i,b1;i=e.getParameters();b1=e.getSource();b1=b1.getParent().getParent().getParent().getParent();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(b1,i,B.state);},onHeaderImagePress:function(e){var i=f1();var j=e.getSource().getId();i.addAriaLabelledBy(j);var k=i.getModel("headerImage");k.setProperty("/src",e.getSource().getSrc());if(sap.ui.Device.system.phone){i.setProperty("stretch",true);}i.open();},sectionNavigate:s1,onInlineDataFieldForAction:function(e){T.oCommonEventHandlers.onInlineDataFieldForAction(e,B.state);},onInlineDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),B.state);},onDeterminingDataFieldForAction:function(e){T.oCommonEventHandlers.onDeterminingDataFieldForAction(e);},onBeforeRebindChart:function(e){y(e);var i=e.getSource();i.oModels=i.getChart().oPropagatedProperties.oModels;var j={ensureExtensionFields:q.noop,addExtensionFilters:o.templateBaseExtension.addFilters};T.oCommonUtils.onBeforeRebindTableOrChart(e,j);},onToggleDynamicSideContent:u.onToggleDynamicSideContent,sideContentBreakpointChanged:u.sideContentBreakpointChanged,onTableInit:function(e){var i;var c1=e.getSource();var j=c1.getTable();w1(c1);T.oCommonUtils.checkToolbarIntentsSupported(c1);var k=(o&&typeof o.getView==="function"&&o.getView()&&o.getView().getId())+"--";var x=c1&&c1.getId();i=x1(k,x);n.oMultipleViewsHandler[i]&&n.oMultipleViewsHandler[i].init(e);if(I(c1)&&!c1.data("CrossNavigation")){j.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===q.sap.KeyCodes.ENTER&&c1.getEditable()){T.oCommonEventHandlers.addEntry(c1,true);e.preventDefault();e.setMarked();}}});}},onSearchObjectPage:B1,onSearchLiveChange:A1},formatters:{sideContentActionButtonText:u.formatSideContentActionButtonText,setNoDataTextForSmartTable:function(){var e=T.oCommonUtils.getText("NOITEMS_SMARTTABLE");if(e!=="NOITEMS_SMARTTABLE"){return e;}return"";},setVMVisibilityForVendor:function(){var e=q.sap.getUriParameters();if(e.mParams["sap-ui-layer"]){var j=e.mParams["sap-ui-layer"];for(var i=0;i<j.length;i++){if(j[i].toUpperCase()==="VENDOR"){return true;}}}return false;},formatItemTextForMultipleView:function(i){var e=i&&i.facetId;return n.oMultipleViewsHandler[e]?n.oMultipleViewsHandler[e].formatItemTextForMultipleView(i):"";}},extensionAPI:new E(T,o,B)};E1.handlers=q.extend(B.handlers,E1.handlers);return E1;}};return m;});
