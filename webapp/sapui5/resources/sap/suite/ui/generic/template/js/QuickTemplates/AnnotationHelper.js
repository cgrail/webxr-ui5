sap.ui.define(["sap/ui/base/Object","sap/ui/model/Context","sap/ui/model/odata/AnnotationHelper","sap/ui/model/json/JSONModel"],function(B,C,O,J){"use strict";var A=B.extend("sap.suite.ui.generic.template.js.QuickTemplates.AnnotationHelper");A.TITLE_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/Title/Value","com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value","com.sap.vocabularies.UI.v1.Identification/0/Value"];A.HEADLINE_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/HeadLine/Value","com.sap.vocabularies.Communication.v1.Contact/role","com.sap.vocabularies.UI.v1.HeaderInfo/Description/Value","com.sap.vocabularies.UI.v1.Identification/0/Value","com.sap.vocabularies.UI.v1.Identification/1/Value"];A.IMAGEURL_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/ImageUrl/Value","com.sap.vocabularies.UI.v1.HeaderInfo/ImageUrl/Value"];A.ICONURL_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.Badge/TypeImageUrl/Value"];A.TYPENAME_ANNO_HEURISTIC=["com.sap.vocabularies.UI.v1.HeaderInfo/TypeName/Value","com.sap.vocabularies.Common.v1.SemanticObject/String"];A._getAnnotationItem=function(c,v,f,F){if(c&&v&&f){var V=c.getProperty(v);if(F&&V&&V[f]){var i=V[f];return i[F];}return V?V[f]:null;}return undefined;};A.getAnnotationItemForVocabulary=function(c,v){if(v){var p=v.split("/");return A._getAnnotationItem(c,p[0],p.length>1?p[1]:null,p.length>2?p[2]:null);}return undefined;};A.getAnnotationFirstItemFromVocabularies=function(c,v,s){var I=null;if(v&&Array.isArray(v)){for(var i=0;!I&&i<v.length;++i){I=A.getAnnotationItemForVocabulary(c,v[i]);if(s&&I&&A._isEqualValues(s,I)){I=null;}}}return I;};A._resolveBadgeImgUrl=function(c){return A.getAnnotationFirstItemFromVocabularies(c,A.IMAGEURL_ANNO_HEURISTIC);};A._resolveBadgeIconUrl=function(c){var i=A.getAnnotationFirstItemFromVocabularies(c,A.ICONURL_ANNO_HEURISTIC);if(!i){i="sap-icon://form";}return i;};A._resolveBadgeTitle=function(c){return A.getAnnotationFirstItemFromVocabularies(c,A.TITLE_ANNO_HEURISTIC);};A._resolveBadgeTypeName=function(c){return A.getAnnotationFirstItemFromVocabularies(c,A.TYPENAME_ANNO_HEURISTIC);};A._resolveBadgeHeadline=function(c,t){return A.getAnnotationFirstItemFromVocabularies(c,A.HEADLINE_ANNO_HEURISTIC,t);};A._getAnnotationObject=function(i){if(i){var p={};if(i.Label){p.Path=i.Label.Path||i.Label;}else if(i.Value){p.Path=i.Value.Path||i.Value;}else if(i.String){p.String=i.String;}else if(i.Path){p.Path=i.Path;}else{p.String=i;}return p;}return undefined;};A._isEqualValues=function(i,I){if(i&&I){if(i.String&&I.String){return i.String===I.String;}if(i.Value&&I.Value){return i.Value.Path===I.Value.Path;}if(i.Label&&I.Label){return i.Label.Path===I.Label.Path;}}return false;};A._createBadgeContext=function(i,t,T,o,s){var m=new J();var b=new C(m,"/");var I={};var a=A._getAnnotationObject(i);var c=A._getAnnotationObject(t);if(a&&a.String&&a.String.toLowerCase().indexOf("sap-icon://")<0){I.ImageUrl=a;}else{I.TypeImageUrl=c||a;}I.Title=A._getAnnotationObject(T);I.TypeName=A._getAnnotationObject(o);I.SubTitle=A._getAnnotationObject(s);m.setData(I);return b;};A.resolveBadgeTarget=function(c){if(c){var i=A._resolveBadgeImgUrl(c);var t=A._resolveBadgeIconUrl(c);var T=A._resolveBadgeTitle(c);var s=A._resolveBadgeTypeName(c);var h=A._resolveBadgeHeadline(c,T);return A._createBadgeContext(i,t,T,s,h);}return undefined;};A.resolveFieldGroupTarget=function(c){var f=A._getFacetOfType(c,"FieldGroup");if(f){return O.resolvePath(c.getModel().createBindingContext(c.getPath()+"/"+f.index+"/Target"));}return null;};A.resolveLineItemTarget=function(c){var f=A._getFacetOfType(c,"LineItem");if(f){return O.resolvePath(c.getModel().createBindingContext(c.getPath()+"/"+f.index+"/Target"));}return null;};A.resolveFieldGroupFacet=function(c){var f=A._getFacetOfType(c,"FieldGroup");if(f){return c.getPath()+"/"+f.index;}return undefined;};A.resolveLineItemFacet=function(c){var f=A._getFacetOfType(c,"LineItem");if(f){return c.getPath()+"/"+f.index;}return undefined;};A.getTooltip=function(v){var t="";if(v.String){t=v.String;}return t;};A._getFacetOfType=function(c,f){var a=c.getObject();var t=-1;var b=null;if(Array.isArray(a)){jQuery.each(a,function(i,d){if(d.Target&&d.Target.AnnotationPath&&d.Target.AnnotationPath.indexOf(f)>=0){t=i;b=d;}});}if(t>=0){return{facet:b,index:t};}return undefined;};A.getAllPropertyPathsFromFacet=function(c,f){var i=A.createFormatterInterface(c);var m=c.getModel().getMetaModel();var M=A.getMetaDataForContext(c);var o=A.getMetaModelContextForFacetType(i,M.entityType.namespace+"."+M.entityType.name,f);var r=O.resolvePath(o);var R=m.getProperty(r);var a=R.Data||R;var p=[];if(a&&Array.isArray(a)){jQuery.each(a,function(b,d){if(d.RecordType==='com.sap.vocabularies.UI.v1.DataField'&&d.Value&&d.Value.Path){p.push(d.Value.Path);}});}return p;};A.getMetaModelContextForFacetType=function(I,e,f){var m=I.getModel()||I.getModel(0);var E=m.getODataEntityType(e);var s=["QuickCreate","QuickView"];var F="";var M=null;var a=null;for(var i=0;i<s.length;i++){F="com.sap.vocabularies.UI.v1."+s[i]+"Facets";if(E[F]){a=E[F];break;}}if(a){var t=-1;if(Array.isArray(a)){jQuery.each(a,function(i,b){if(b.Target&&b.Target.AnnotationPath&&b.Target.AnnotationPath.indexOf(f)>=0){t=i;}});}if(t>=0){M=new C(m,E.$path+"/"+F+"/"+t+"/Target");}}return M;};A.formatExpandBindingPathForHeaderObject=function(i,e){var h=A.getNavigationPathsFromFacet(i,e,"FieldGroup");return A.formatExpandPaths(h);};A.getMetaDataForContext=function(c){var m=c.getModel().getMetaModel();var e=m.getODataEntityType(c.getObject().__metadata.type);var E=null;var o=m.getProperty(m.getODataEntityContainer(true)).entitySet;jQuery.each(o,function(i,b){if(b.entityType===c.getObject().__metadata.type){E=b.name;}});var a=m.getODataEntitySet(E);return{entityType:e,entitySet:a};};A.getNavigationPathsUsingAnnotationHeuristics=function(o,e){var m={};var M=o.getModel().getMetaModel();if(o&&o.getObject()){m=A.getMetaDataForContext(o);}else if(e){m.entityType=M.getODataEntityType(e);}var n={};if(m&&m.entityType){var t=A.TITLE_ANNO_HEURISTIC.concat(A.HEADLINE_ANNO_HEURISTIC);var i=0;for(;i<t.length;i++){var a=new C(M,m.entityType.$path+"/"+t[i]);var b=O.getNavigationPath(a);if(b){b=b.replace(/[{}]/g,'');if(b){n[b]="";}}}}return Object.keys(n);};A.getNavigationPathsFromFacet=function(I,e,f){var m=I.getModel()||I.getModel(0);var M=A.getMetaModelContextForFacetType(I,e,f);if(!M){return[];}var r=O.resolvePath(M);var R=m.getProperty(r);var n={};var p="/";if(R.Data){p+="Data/";}var a=R.Data||R;if(a&&Array.isArray(a)){jQuery.each(a,function(i,d){if(d.RecordType=='com.sap.vocabularies.UI.v1.DataField'&&d.Value&&d.Value.Path){var b=new C(m,r+p+i+"/Value");var c=O.getNavigationPath(b);c=c.replace(/[{}]/g,'');if(c){n[c]="";}}});}return Object.keys(n);};A.getLineItemsNavPropertyName=function(i,e){var m=A.getMetaModelContextForFacetType(i,e,"LineItem");if(m){var c=O.getNavigationPath(m);c=c.replace(/[{}]/g,'');return c;}return undefined;};A.formatBindingPathForLineItems=function(i,e,I){var l=A.getLineItemsNavPropertyName(i,e);if(arguments.length===2){I=false;}if(I){var a=A.getNavigationPathsFromFacet(i,e,"LineItem");if(a&&a.length>0){return"{path: '"+l+"', parameters : {expand:'"+A.formatExpandPaths(a)+"'}}";}}return"{path: '"+l+"'}";};A.formatExpandPaths=function(e){var E="";for(var i=0;i<e.length;i++){E+=e[i];if(i<e.length-1){E+=",";}}return E;};A.createFormatterInterface=function(b){var m=b.getModel().getMetaModel().getMetaContext(b.getPath());var i={getModel:function(){return b.getModel().getMetaModel();},getContext:function(){return m;},getPath:function(){return m.getPath();}};return i;};A.formatBindingPathForLineItems.requiresIContext=true;A.getMetaModelContextForFacetType.requiresIContext=true;A.formatExpandBindingPathForHeaderObject.requiresIContext=true;A.resolveFieldGroupTarget.requiresIContext=true;A.resolveLineItemTarget.requiresIContext=true;A.resolveLineItemFacet.requiresIContext=true;A.resolveFieldGroupFacet.requiresIContext=true;A.resolveBadgeTarget.requiresIContext=true;return A;},true);
