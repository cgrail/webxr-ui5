/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2"],function(q,U,A){"use strict";var a={};var L="com.sap.vocabularies.UI.v1.LineItem";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";var I="com.sap.vocabularies.UI.v1.Importance";var b="com.sap.vocabularies.UI.v1.ImportanceType/High";a.applyChange=function(c,C,p){var d=c.getDefinition();if(!d.transferred){var P=c.getContent().customChanges[0].parentElementId;var o=p.modifier.byId(P);var n=c.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var e=new sap.m.Button(N,{text:'New Action'});e.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("--template::ListReport::TableToolbar")>-1){o.insertContent(e,c.getContent().customChanges[0].targetIndex);}else{o.getHeaderToolbar().insertContent(e,c.getContent().customChanges[0].targetIndex);}}};a.completeChangeContent=function(c,s,p){var m=U.getMetaModel(s,p);var S=p.modifier.bySelector(s.selector.id,p.appComponent);var P=S.getParent();var C=U.getComponent(S);var e=U.getODataEntitySet(C).entityType;var E=m.getODataEntityType(e);var l=E[L];var d=l.slice();var B=[];if(S.getParent().getId().indexOf("--template::ListReport::TableToolbar")>-1){B=S.getParent().getContent();}else{B=S.getContent();}var f=-1;B.some(function(o,i){if(o.getId&&o.getId()===s.selector.id){f=i;return true;}});var g=-1;for(var i=f+1;i<B.length;i++){g=U.getLineItemRecordIndexForButton(B[i],l);if(g>=0){break;}}if(g===-1){g=l.length;}var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D};n[I]={EnumMember:b};l.splice(g,0,n);var h=A.createCustomAnnotationTermChange(e,l,d,L);h.targetIndex=f+1;h.parentElementId=P.getId();var j=A.createCustomChanges(h);q.extend(true,c.getContent(),j);};return a;},true);
