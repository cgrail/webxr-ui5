sap.ui.define(["jquery.sap.global","sap/ui/core/routing/HashChanger","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/m/DraftIndicator"],function(q,H,N,M,t,P,D,a){"use strict";var b=sap.m.DraftIndicatorState;function g(C,o,v){function i(){var T=o.getTemplatePrivateModel();T.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""}});o.setStatePreserverPromise(v);}function d(B,I){var U=C.getModel("ui");var T=o.getTemplatePrivateModel();if(o.getEditableNDC()){U.setProperty("/editable",true);var k=o.isNonDraftCreate();U.setProperty("/createMode",k);T.setProperty("/objectPage/displayMode",k?4:2);}else if(!o.isDraftEnabled()){U.setProperty("/editable",false);U.setProperty("/createMode",false);T.setProperty("/objectPage/displayMode",1);}(v.onComponentActivate||q.noop)(B,I);}function u(){var B=C.getBindingContext();var k=o.registerContext(B);var T=C.getModel("_templPrivGlobal");T.setProperty("/generic/draftIndicatorState",b.Clear);(v.getHeaderInfoTitleForNavigationMenue||q.noop)();(v.applyHeaderContextToSmartTablesDynamicColumnHide||q.noop)(B);var U=C.getModel("ui");var I;var l=o.getTemplatePrivateModel();if(k.bIsDraft){I=true;U.setProperty("/enabled",true);l.setProperty("/objectPage/displayMode",k.bIsCreate?4:2);}else{I=o.getEditableNDC();l.setProperty("/objectPage/displayMode",I?2:1);U.setProperty("/enabled",true);}U.setProperty("/createMode",k.bIsCreate);U.setProperty("/editable",I);}function f(){return o.getDraftRootPath();}function n(){v.navigateUp();}function e(p,A){return v.oStatePreserverPromise.then(function(s){return s.getUrlParameterInfo(p,A);});}function h(O){return v.getMessageFilters(O);}function j(k){return v.getScrollFunction&&v.getScrollFunction(k);}return{init:i,onActivate:d,getTitle:o.getTitleFromTreeNode,updateBindingContext:u,currentDraftModified:f,navigateUp:n,getUrlParameterInfo:e,getMessageFilters:h,getScrollFunction:j};}function c(v,T,C){var o;var l;var p;var h;function G(){return h||H.getInstance();}function f(j,i){return function(){T.oServices.oApplication.subTitleForViewLevelChanged(j,i.getText());};}function s(i){var I=!T.oComponentUtils.isDraftEnabled();if(I||!i){var U=C.getView().getModel("ui");U.setProperty("/editable",i);}if(I){T.oComponentUtils.setEditableNDC(i);}}function O(){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var i=T.oComponentUtils.isDraftEnabled();if(!i){s(false);}T.oServices.oNavigationController.navigateBack();},q.noop,o.state);}function A(L,i){var j=G();var B=i.fullLink;var E=j.hrefForAppSpecificHash?j.hrefForAppSpecificHash(B):"#/"+B;L.setHref(E);}function d(){var U=T.oServices.oApplication.getLinkToUpperLayersInfo(false,false,C.getOwnerComponent().getEntitySet());l=U.aInfoObjects[U.aInfoObjects.length-1].link;var B=v.aBreadCrumbs;if(!B){return;}var j=T.oServices.oApplication.getBusyHelper();for(var i=0;i<B.length;i++){var L=B[i];var I=U.aInfoObjects[i+1];var E=T.oCommonUtils.getControlInformation(L);E.internalHash=I.link;var J=I.entitySet;j.setBusy(U.aInfoObjectPromises[i+1].then(A.bind(null,L)));var K=I.section.split("(");var Q="/"+J+"("+K[1];var R=L.getBindingInfo("text")||{};R.events={change:f(i+1,L)};L.bindElement({path:Q});}}function e(i){var j=i.getBindingContext();var B=G().getHash();return T.oServices.oApplicationController.propertyChanged(B,j);}function n(){if(l){T.oServices.oNavigationController.navigateToContext(l,"",true);}else{T.oServices.oNavigationController.navigateToRoot(true);}}function k(i){var B=T.oServices.oApplication.getBusyHelper();var U=C.getView().getModel("ui");var j=C.getOwnerComponent().getModel("_templPrivGlobal");var E=e(i).then(function(R){if(!o.fclInfo.isContainedInFCL||j.getProperty("/generic/FCL/isVisuallyFullScreen")){n();}},function(){B.getUnbusy().then(function(R){if(!o.fclInfo.isContainedInFCL||j.getProperty("/generic/FCL/isVisuallyFullScreen")){T.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){n();U.setProperty("/enabled",true);},q.noop,o.state);}else{T.oCommonUtils.processDataLossTechnicalErrorConfirmation(q.noop,q.noop,o.state,"StayOnPage");}});});B.setBusy(E);}function m(E){var i=E.getSource();o.state.beforeSaveHelper.prepareAndRunSaveOperation(false,k.bind(null,i));}function r(){o.state.messageButtonHelper.toggleMessagePopover();}function u(i){return o.state.messageButtonHelper&&o.state.messageButtonHelper.getMessageFilters(i);}function w(){var i;return function(){i=i||new N(T,C,o.state);return i;};}function x(){var i;return function(){if(!i){var j=T.oComponentUtils.isDraftEnabled()?D:a;i=new j(T,C,o.state);}return i;};}function y(){p.handleShowNextObject();}function z(){p.handleShowPrevObject();}var G=t.testable(G,"getHashChangerInstance");var d=t.testable(d,"adaptLinksToUpperLevels");o={onInit:function(R,i){if(!R||R.footerBar){var I=T.oComponentUtils.isODataBased();var j={controller:C,prepareAllMessagesForNavigation:i};o.state.messageButtonHelper=new M(T.oCommonUtils,j,I);o.state.beforeSaveHelper=T.oServices.oApplication.getBeforeSaveHelper(C,T.oCommonUtils);T.oServices.oTemplateCapabilities.oMessageButtonHelper=o.state.messageButtonHelper;}if(!R||R.paginatorButtons){p=new P(o,C,T);}v.getScrollFunction=function(B){var E=T.oCommonUtils.getPositionableControlId(B);return E&&T.oCommonUtils.focusControl.bind(null,E);};},handlers:{handleShowNextObject:y,handleShowPrevObject:z,onShowMessages:r,applyAndUp:m,onBack:O},extensionAPI:{getNavigationControllerFunction:w,getTransactionControllerFunction:x},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(B,i){if(o.state.messageButtonHelper){o.state.messageButtonHelper.adaptToContext(B);}T.oComponentUtils.setBackNavigation(O);d();if(p){p.computeAndSetVisibleParamsForNavigationBtns();}v.oStatePreserverPromise.then(function(S){S.applyAppState(B,i);});}};v.navigateUp=n;v.setEditable=s;v.getMessageFilters=u;var F=T.oComponentUtils.getFclProxy();if(F.oActionButtonHandlers){o.handlers.fclActionButtonHandlers=F.oActionButtonHandlers;o.fclInfo.isContainedInFCL=true;}o.fclInfo.navigateToDraft=F.navigateToDraft;o.stateChanged=function(){v.oStatePreserverPromise.then(function(S){S.stateChanged();});};return o;}return{getComponentBase:g,getControllerBase:c};});
