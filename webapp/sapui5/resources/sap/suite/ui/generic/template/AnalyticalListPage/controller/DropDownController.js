sap.ui.define(['jquery.sap.global','sap/ui/core/mvc/Controller','sap/ui/model/Filter','sap/ui/model/json/JSONModel',"sap/m/Button","sap/m/StandardListItem","sap/m/List","sap/m/ToolbarSpacer","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/ResponsivePopover","sap/m/Label","sap/m/ToggleButton","sap/m/SearchField","sap/m/Toolbar","sap/ui/core/Icon","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/library"],function(q,C,F,J,B,S,L,T,a,R,b,c,d,e,I,f,g,h){"use strict";var s=false,t={},o={},u="",D=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController",{});sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createDropdown=function(i,k,m,l,p,n){u=(p.filterRestriction=='multiple')?q.extend(true,{items:[],ranges:[],value:null},k.getDimensionFilter()):k.getDimensionFilter();var r=i.getModel('i18n'),v=sap.ui.getCore().byId(k.getSmartFilterId()),w={"descriptionAndId":p.dimensionFieldDisplay,"descriptionOnly":p.dimensionFieldDisplay,"idAndDescription":p.dimensionField,"idOnly":p.dimensionField},w=(Object.keys(w).indexOf(p.textArrangement)!==-1)?w[p.textArrangement]:p.dimensionFieldDisplay,x=new c({icon:"sap-icon://menu",type:"Transparent",iconFirst:true,enabled:(u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u),tooltip:r.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED")}),y=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem(m,k,r,l,p,x,v,w),z=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList(m,k,r,p,l,y,w,x,n,v),O=new B({text:r.getResourceBundle().getText("OK"),press:function(E){k.setDimensionFilter(u);k.fireFilterChange();z.close();}}),A=new B({text:r.getResourceBundle().getText("CANCEL"),press:function(){z.close();}});s=false;z.addContent(y);y.attachSelectionChange(function(E){var G=y.getModel().getData(E.mParameters.listItem.getBindingContext().sPath);G=G[p.dimensionField];var H=E.getParameters().listItem.mProperties.selected;if(p.filterRestriction==='multiple'){if(u.items&&u.items.length){for(var j=0;j<u.items.length;j++){if(u.items[j].key===G){u.items.splice(j,1);}else if(H){u.items.push({key:G});break;}}}else if(u.items){u.items.push({key:G});}else{u.items=[];}if(u.items.length){t.setVisible(true);o.setText(r.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[l,u.items.length]));}t.setVisible(Boolean(u.items.length));x.setEnabled(this.bUpdateToolbarButton||Boolean(u.items.length));}else if(p.filterRestriction==='single'){u=G;if(u){t.setVisible(true);o.setText(r.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[l,+Boolean(u)]));}x.setEnabled(Boolean(u));}}.bind(this));z.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");z.setBeginButton(O);z.setEndButton(A);z.openBy(i);};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createPopoverWithList=function(m,i,j,p,k,l,n,r,v,w){if(this._oPopoverDialog&&this._oPopoverDialog.isOpen){this._oPopoverDialog.close();}if(l){var A=function(E){if(E.getParameter("clearButtonPressed")){return;}var x=this.fnApplyFilterFromSearchField(n,E.getSource().getValue());var y=l.getBinding("items");s=false;r.setPressed(false);r.setTooltip(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));y.filter(x);}.bind(this);this.oSearchField=new d({liveChange:A,search:A,enabled:v,initialFocus:true});this._oPopoverDialog=new R('',{placement:h.PlacementType.Bottom,verticalScrolling:true,title:k,subHeader:[new e({content:[this.oSearchField,r]})],content:[l]});if(w.isDialogOpen()){this._oPopoverDialog.setModel(i.getModel("_dialogFilter"),"_dialogFilter");}else{this._oPopoverDialog.setModel(i.getModel("_filter"),"_filter");}}this._oPopoverDialog.setInitialFocus(this.oSearchField);this._oPopoverDialog.setContentWidth("320px");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.createStandardListItem=function(m,i,j,k,p,l,n,r){var v="/"+p.entitySet,w=sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation(i,p,n);o=new b({text:j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[k,typeof(i.getDimensionFilter())==="object"&&i.getDimensionFilter()!==null?i.getDimensionFilter().items.length:+Boolean(i.getDimensionFilter())])});t=new e({content:[o,new T(),new I({src:"sap-icon://sys-cancel",tooltip:j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_CLEAR_SELECTION"),press:function(E){t.setVisible(false);s=false;l.setTooltip(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));l.setEnabled(false);l.setPressed(false);A.removeSelections(true);(u&&u.hasOwnProperty("items"))?u.items=[]:u="";o.setText(j.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_SELECTED_COUNT",[k,(u&&u.hasOwnProperty("items"))?u.items.length:+Boolean(u)]));A.getBinding("items").filter(this.fnApplyFilterFromSearchField(r,this.oSearchField.getValue()));}.bind(this)}).addStyleClass("sapSmartTemplatesAnalyticalListPageDropdownDialogCancelButton")],"visible":(u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u)});if(i.getSmartFilterId()){var x=sap.ui.getCore().byId(i.getSmartFilterId());if(x&&x.getEntitySet()===p.entitySet){v=i.considerAnalyticBinding(v,x);}}var y=[p.measureField,p.dimensionField,p.dimensionFieldDisplay],z=a.IsNavigationProperty(i.getModel(),p.entitySet,p.dimensionFieldDisplay)?p.dimensionFieldDisplay.split("/")[0]:null,U={select:y.join(",")};if(z){q.extend(U,{"expand":z});}var A=new L({mode:p.filterRestriction==="single"?h.ListMode.SingleSelectMaster:h.ListMode.MultiSelect,growing:true,growingThreshold:15,showNoData:false,infoToolbar:t,items:{path:v,template:w,sorter:sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject(p),parameters:U}});if(n.isDialogOpen()){w.setModel(i.getModel("_dialogFilter"),"_dialogFilter");}else{w.setModel(i.getModel("_filter"),"_filter");}A.setModel(m);l.attachPress(function(E){if(p.filterRestriction=="multiple"&&u.items.length||u&&u.hasOwnProperty('items')&&!u.items.length&&s){sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings(A,l,j,p.filterRestriction,p.dimensionField);}else if(p.filterRestriction=="single"&&u!=null||u==null&&s){sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings(A,l,j,p.filterRestriction,p.dimensionField);}});return A;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.selectedVisibilityUpdateFormatter=function(u,j){for(var i=0;i<u.items.length;i++){if(u.items[i].key===j){return true;}}return false;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.standardListItemTemplateCreation=function(j,p,k){var l=p.textArrangement,m=[];m.push({path:p.measureField});var n=k.isDialogOpen()?["_dialogFilter>/"+j.getParentProperty(),p.dimensionField]:["_filter>/"+j.getParentProperty(),p.dimensionField];p.unitField?m.push({path:p.unitField}):"";var r=new S({title:{parts:[p.dimensionFieldDisplay,p.dimensionField],formatter:function(i,v){return a.getTextArrangement(i,v,l);}},description:{parts:m,formatter:function(i,v){return sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroChart.prototype._getFormattedNumberWithUoM(i,v);}},selected:{parts:n,formatter:function(v,w){if(s){return true;}else{if(typeof(u)==="object"&&u!==null){for(var i=0;i<u.items.length;i++){if(u.items[i].key===w){return true;}}}else{return(u!==null&&u===w)?true:false;}}}}});return r;};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.getSortObject=function(p){if(p.sortOrder&&p.sortOrder.length){return new f((p.sortOrder[0].Field)?p.sortOrder[0].Field.String:"",p.sortOrder[0].Descending.Boolean);}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.updateFilterWithListBindings=function(l,j,k,m,n){var p=[];s=!s;this.bUpdateToolbarButton=s;if(s){j.setTooltip(k.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_ALL"));j.setEnabled(true);if(m==='multiple'){for(var i=0;i<u.items.length;i++){var r=new F(n,g.EQ,(m==="multiple")?u.items[i].key:u);p.push(r);}}else if(m==='single'){var r=new F(n,g.EQ,u);p.push(r);}l.getBinding("items").filter(p);}else{j.setTooltip(k.getResourceBundle().getText("VIS_VALUEHELP_DROPDOWN_VIEW_SELECTED"));j.setEnabled((u&&u.hasOwnProperty("items"))?Boolean(u.items.length):Boolean(u));l.getBinding("items").filter(p);}};sap.suite.ui.generic.template.AnalyticalListPage.controller.DropDownController.fnApplyFilterFromSearchField=function(i,Q){var j=[];if(Q&&Q.length>0){var k=new F(i,g.Contains,Q);j.push(k);}return j;};return D;});
