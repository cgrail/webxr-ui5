/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2"],function(q,U,A){"use strict";var a={};var I="com.sap.vocabularies.UI.v1.Identification";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";var b="com.sap.vocabularies.UI.v1.Importance";var c="com.sap.vocabularies.UI.v1.ImportanceType/High";a.applyChange=function(C,o,p){var d=C.getDefinition();if(!d.transferred){var P=C.getContent().customChanges[0].parentElementId;var e=p.modifier.byId(P);var n=C.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var f=new sap.m.Button(N,{text:'New Action'});f.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("objectPageHeader")>-1||P.indexOf("--template::ObjectPage::ObjectPageHeader")>-1){e.insertAction(f,C.getContent().customChanges[0].targetIndex);}else{e=e.getHeaderTitle();e.insertAction(f,C.getContent().customChanges[0].targetIndex);}}};a.completeChangeContent=function(C,s,p){var S=p.modifier.bySelector(s.selector.id,p.appComponent);var o=U.getComponent(S);var P=S.getParent();var e=U.getODataEntityType(o);var E=e.entityType;var d=e[I];var f=d.slice();var B=[];if(S.getParent().getId().indexOf("--objectPageHeader")>-1||S.getParent().getId().indexOf("--template::ObjectPage::ObjectPageHeader")>-1){B=S.getParent().getActions();}else{B=S.getActions();}var g=-1,h=-1,j=-1,r=-1;B.some(function(t,i){if(t.getId&&t.getId()===s.selector.id){g=i;}if(t.getId&&t.getId().indexOf("--edit")>0){h=i;}if(t.getId&&t.getId().indexOf("--delete")>0){j=i;}if(t.getId&&t.getId().indexOf("--relatedApps")>0){r=i;if(g>0){return true;}}});var k=-1;k=U.getIndexFromInstanceMetadataPath(B[g]);k++;var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D};if(g<(h||j||r)){n[b]={EnumMember:c};}d.splice(k,0,n);var m=A.createCustomAnnotationTermChange(E,d,f,I);m.targetIndex=g+1;m.parentElementId=P.getId();var l=A.createCustomChanges(m);q.extend(true,C.getContent(),l);};return a;},true);
