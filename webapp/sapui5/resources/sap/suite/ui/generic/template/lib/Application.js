sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/BeforeSaveHelper","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/StatePreserver","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log"],function(q,B,D,J,M,A,a,P,d,r,b,C,S,t,L){"use strict";var c=(t.testableStatic(function(T,o){var s="sapUiSizeCozy",h="sapUiSizeCompact";if(o.hasClass(s)||o.hasClass(h)){return"";}else{return T?s:h;}},"Application_determineContentDensityClass")(D.support.touch,q(document.body)));function g(){return c;}function f(o,p){q.sap.syncStyleClass(c,p,o);p.addDependent(o);}var f=t.testableStatic(f,"Application_attachControlToParent");function e(T){var o=new C(T.oAppComponent);var E;var n=Object.create(null);function h(i){var j=T.oNavigationControllerProxy.getActiveComponents();return j.indexOf(i.getId())>=0;}var I=false;function k(i){T.fnAddSideEffectPromise(i);}function p(i,j){if(I){return;}var l1=q.grep(T.aRunningSideEffectExecutions,function(m1){return!!m1;});if(l1.length){I=true;Promise.all(l1).then(function(){I=false;p(i,j);});}else if(!(j&&T.oBusyHelper.isBusy())){i();}}function m(i){var j;if(i instanceof a){j="open";}else if(i instanceof P||i instanceof A){j="openBy";}if(j){var l1=i[j];i[j]=function(){var m1=arguments;p(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){l1.apply(i,m1);});}});};}}var F={};function l(i,j,l1,m1,n1){i=i||T.oNavigationHost;var o1=i.getId();var p1=F[o1]||(F[o1]={});var q1=p1[j];if(!q1){q1=sap.ui.xmlfragment(o1,j,l1);f(q1,i);var r1;if(m1){r1=new J();q1.setModel(r1,m1);}(n1||q.noop)(q1,r1);p1[j]=q1;m(q1);}return q1;}function s(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function u(i){T.oShellServicePromise.then(function(j){j.setBackNavigation(i);});}var v=false;function w(i){v=i;}function x(i,j){if(!T.oFlexibleColumnLayoutHandler){return true;}var l1=r.determineNavigationPath(i,j);return T.oFlexibleColumnLayoutHandler.isNewHistoryEntryRequired(l1);}function R(i){T.aStateChangers.push(i);}function y(i,j){j.then(function(){o.adaptAfterObjectDeleted(i);});}function z(i,j,l1){var m1=T.mEntityTree[i];var n1;if(m1.navigationProperty&&m1.parent){n1=j?m1.entitySet:m1.navigationProperty;}else{n1=i;}if(l1.indexOf(n1)<0){l1.unshift(n1);if(m1.navigationProperty&&m1.parent){z(m1.parent,j,l1);}}}function G(i,j){var l1=[];z(i,j,l1);return l1;}function H(j){var l1=G(j);l1.pop();var m1="";var n1="";var o1=[];for(var i=0;i<l1.length;i++){m1=m1+n1+l1[i];o1.push(m1);n1="/";}return o1;}function K(){var i=T.oNavigationControllerProxy.oHashChanger.getHash();var j=i.split("?")[0];var l1=j.split("/");if(l1[0]===""||l1[0]==="#"){l1.splice(0,1);}return l1;}function N(j,l1,m1){var n1=[];var o1=T.mEntityTree[m1];var p1=K();var q1=o1.level-(l1?0:1);var r1="";var s1="";for(var i=0;i<=q1;i++){var t1={link:r1};if(i>0){t1.section=p1[i-1];}n1.push(t1);if(i<q1){r1=r1+s1+p1[i];s1="/";}}var u1=[];var v1=function(x1){var t1=n1[x1.level];t1.entitySet=x1.entitySet;t1.mAppStates=Object.create(null);var y1=T.oNavigationControllerProxy.getApplicableStateForComponentAddedPromise(x1.componentId,t1.link,t1.mAppStates);u1[x1.level]=y1.then(function(){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(t1.mAppStates,x1);}t1.fullLink=T.oNavigationControllerProxy.concatPathAndAppStates(t1.link,t1.mAppStates);return t1;});};if(l1){v1(o1);}for(var w1=j?0:1;o1.level>w1;){o1=T.mRoutingTree[o1.parentRoute];v1(o1);}return{aInfoObjects:n1,aInfoObjectPromises:u1};}function O(){var j=T.oNavigationControllerProxy.getActiveComponents();var l1=0;var m1;for(var i=0;i<j.length;i++){var n1=T.componentRegistry[j[i]];if(n1.viewLevel>0&&(l1===0||n1.viewLevel<l1)){l1=n1.viewLevel;m1=n1.oComponent;}}var o1=m1?Promise.resolve(m1):T.oNavigationControllerProxy.getRootComponentPromise();return o1.then(function(p1){return p1.getModel("i18n").getResourceBundle();});}function Q(){return T.oNavigationControllerProxy.getAppTitle();}function U(i,j){T.oNavigationControllerProxy.subTitleForViewLevelChanged(i,j);}function V(i){return T.oNavigationControllerProxy.getCurrentKeys(i);}function W(){for(var i in T.componentRegistry){var j=T.componentRegistry[i];if(j.viewLevel===1){if(h(j.oComponent)){var l1=j.oComponent.getComponentContainer().getElementBinding();return l1&&l1.getPath();}else{return null;}}}return null;}function X(i){if(i.viewLevel){var j=i.oComponent.getEntitySet();return T.mEntityTree[j];}return T.mRoutingTree.root;}function Y(l1,m1,n1,o1,p1){var q1=X(n1);var r1=false;var s1;var t1=true;for(var i=0;i<q1.children.length&&!s1;i++){var u1=q1.children[i];var v1=T.mEntityTree[u1];if(v1[n1.viewLevel?"navigationProperty":"sRouteName"]===l1){s1=v1.sRouteName;t1=!v1.noKey;}}if(o1&&!s1){var w1=q1.embeddedComponents[o1];if(w1){for(var j=0;j<w1.pages.length&&!r1;j++){var x1=w1.pages[j];if(x1.navigationProperty===l1){r1=true;s1=n1.route+"/"+o1+"/"+l1;t1=!(x1.routingSpec&&x1.routingSpec.noKey);}}}}if(s1){var y1=r1?o1+r.getPatternDelimiter():"";var z1=t1?"("+m1+")":"";var A1=y1+l1+z1;T.oNavigationControllerProxy.navigateToSuffix(A1,n1.viewLevel+1,s1,p1);}}var Z;function $(j,l1){var i=l1||0;if(i>0){return null;}var m1=j.getEntitySet();var n1=T.mEntityTree[m1];var o1=n1&&n1.communicationObject;for(;i<0&&o1;){n1=T.mEntityTree[n1.parent];if(n1.communicationObject!==o1){i++;o1=n1.communicationObject;}}if(i<0||o1){return o1;}Z=Z||{};return Z;}function _(i){for(var j in T.mEntityTree){if(T.mEntityTree[j].navigationProperty&&(T.mEntityTree[j].level===i+1)){return T.mEntityTree[j].navigationProperty;}}}function a1(){return T.oFlexibleColumnLayoutHandler?T.oFlexibleColumnLayoutHandler.getMaxColumnCountInFCL():false;}function b1(){var j=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<j.length;i++){var l1=j[i];var m1=T.componentRegistry[l1];var n1=m1.methods.currentDraftModified&&m1.methods.currentDraftModified();if(n1){o.markDraftAsModified(n1);}}}function c1(){if(E!==undefined){return E;}var i,j,l1,m1,n1,o1,p1=true;var q1=T.oAppComponent.getModel();var r1=q1.getMetaModel();var s1=q1.mContexts;for(l1 in s1){p1=false;n1=s1[l1].sPath;m1=n1&&n1.substring(1,n1.indexOf('('));o1=m1&&r1.getODataEntitySet(m1);if(o1){i=q1.getProperty(n1);j=i&&q1.getETag(undefined,undefined,i)||null;if(j){E=true;return E;}}}if(p1){return true;}E=false;return E;}function d1(j){var i,l1,m1;var n1=T.oNavigationControllerProxy.getAllComponents();for(i=0;i<n1.length;i++){l1=n1[i];if(!j||!j[l1]){m1=T.componentRegistry[l1];m1.utils.refreshBinding(true);}}}function e1(i){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(i);}}function f1(){T.oPaginatorInfo={};}function g1(i){return new S(T,i);}function h1(i,j){return new b(T,i,j);}function i1(j,l1){var m1=n[j];if(!m1){m1=Object.create(null);n[j]=m1;var n1=T.oAppComponent.getModel();var o1=n1.getMetaModel();var p1=o1.getODataEntitySet(j);var q1=p1&&o1.getODataEntityType(p1.entityType);var r1=(q1&&q1.navigationProperty)||[];for(var i=0;i<r1.length;i++){var s1=r1[i];m1[s1.name]=s1;}}return m1[l1];}function j1(i){var j=T.oNavigationControllerProxy.getSwitchToSiblingPromise(i);T.oBusyHelper.setBusy(j.then(function(l1){l1();}));}function k1(i){var j=i&&i.getObject();var l1=j&&j.IsActiveEntity;if(!l1){return Promise.resolve(d.getNavigateAfterDeletionOfCreateDraft(T));}return T.oNavigationControllerProxy.getSwitchToSiblingPromise(i).then(function(m1){return function(){var n1=i.getModel();n1.invalidateEntry(i);m1();};});}T.oApplicationProxy={getDraftSiblingPromise:o.getDraftSiblingPromise,getSiblingPromise:o.getSiblingPromise,getAlternativeContextPromise:o.getAlternativeContextPromise,getPathOfLastShownDraftRoot:o.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:o.areTwoKnownPathesIdentical,getResourceBundleForEditPromise:O,getHierarchySectionsFromCurrentHash:K,getLinkToUpperLayersInfo:N,getContentDensityClass:g,setEditableNDC:w,getDialogFragment:l.bind(null,null),destroyView:function(i){delete F[i];},markCurrentDraftAsModified:b1,prepareDeletion:y,performAfterSideEffectExecution:p};return{setEditableNDC:w,getEditableNDC:function(){return v;},getContentDensityClass:g,attachControlToParent:f,getDialogFragmentForView:l,getBusyHelper:function(){return T.oBusyHelper;},addSideEffectPromise:k,performAfterSideEffectExecution:p,isComponentActive:h,showMessageToast:function(){var i=arguments;var j=function(){L.info("Show message toast");M.show.apply(M,i);};Promise.all([s(true),T.oBusyHelper.getUnbusy()]).then(j);},setBackNavigation:u,isNewHistoryEntryRequired:x,registerStateChanger:R,getDraftSiblingPromise:o.getDraftSiblingPromise,registerContext:o.registerContext,activationStarted:o.activationStarted,cancellationStarted:o.cancellationStarted,editingStarted:o.editingStarted,getBreadCrumbInfo:H,getSections:G,getHierarchySectionsFromCurrentHash:K,getLinkToUpperLayersInfo:N,getAppTitle:Q,subTitleForViewLevelChanged:U,getCurrentKeys:V,getPathForViewLevelOneIfVisible:W,getCommunicationObject:$,navigateRoute:Y,getForwardNavigationProperty:_,getMaxColumnCountInFCL:a1,markCurrentDraftAsModified:b1,checkEtags:c1,refreshAllComponents:d1,getIsDraftModified:o.getIsDraftModified,prepareDeletion:d.prepareDeletion.bind(null,T),setStoredTargetLayoutToFullscreen:e1,invalidatePaginatorInfo:f1,getStatePreserver:g1,getBeforeSaveHelper:h1,getNavigationProperty:i1,switchToDraft:j1,getNavigateAfterCancelPromise:k1};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){q.extend(this,e(T));}});});
