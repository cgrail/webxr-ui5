sap.ui.define(["jquery.sap.global","sap/ui/core/CustomizingConfiguration","sap/ui/core/library","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/suite/ui/generic/template/lib/reuseComponentHelper","sap/ui/core/CustomData","sap/suite/ui/generic/template/lib/StableIdDefinition","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/Log"],function(q,C,c,a,U,J,R,D,r,b,S,d,L){"use strict";var V=c.mvc.ViewType;function g(O){var i=O&&typeof O==="string"?O:(O&&a.getOwnerIdFor(O));var t=i&&sap.ui.component(i);if(t instanceof T){t=t.getAppComponent();}return t;}var G=C.getViewExtension;C.getViewExtension=function(v,i,O){var t=g(O),u=t&&t.getId(),w=G.call(C,v,i,u);return w;};var f=C.getControllerExtension;C.getControllerExtension=function(i,O){var t=g(O),u=t&&t.getId(),v=f.call(C,i,u);return v;};function e(t){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var u=[];var M=t.getAppComponent().getModel("i18n|"+t.getMetadata().getComponentName()+"|"+t.getEntitySet());if(M){u.push(M);}var v=t.getModel("i18n");if(v){u.push(v);}var w=t.getModel("@i18n");if(w){u.push(w);}var P=true;for(var x="i18n";P;){x=x+"||Parent";P=t.getModel(x);if(P){u.push(P);}}for(var i=u.length-1;i>=0;i--){I.enhance(u[i].getResourceBundle());}t.setModel(I,"i18n");}function E(i,M){var t=i.getAppComponent().getManifestEntry("sap.ui5");var u=t.extends&&t.extends.extensions&&t.extends.extensions["sap.ui.controllerExtensions"];var v=i.getTemplateName();var w=u&&u[v]&&u[v]["sap.ui.generic.app"];var x=i.getEntitySet();var B=w&&w[x]&&w[x].Actions;var y={};var z=h(i);if(B){if(z){A(y,B,z);}else{j(y,B);}}else{var F=w&&w[x]&&w[x]["Sections"];for(var H in F){B=F[H]["Actions"];if(B){j(y,B);}}}i.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",y);}function h(i){var t;var u=i.getAppComponent().getConfig();var v=u&&u.pages[0]&&u.pages[0].component&&u.pages[0].component.settings;if(v&&v.quickVariantSelectionX){t=v.quickVariantSelectionX.variants;}return t;}function A(B,t,u){var v;for(var w in t){v=true;if(t[w].requiresSelection){v=false;}for(var i in u){var x=t[w].id;var y=u[i];var z=sap.suite.ui.generic.template.js.AnnotationHelper.getSuffixFromIconTabFilterKey(y);if(z){x=x.concat(z);}B[x]={enabled:v};}}}function j(B,i){var t;for(var u in i){t=true;if(i[u].requiresSelection){t=false;}B[i[u].id]={enabled:t};}}function k(i){if(i.getAppComponent().getMetadata().getComponentName()===""||i.getTemplateName()===""||i.getEntitySet()===""){}return i.getAppComponent().getMetadata().getComponentName()+"::"+i.getTemplateName()+"::"+i.getEntitySet();}function l(i,t,M,u){var v=t.oComponent;var w=v.getAppComponent();var x=t.oTemplateContract.mRoutingTree[t.route];var y=v.getEntitySet();var z=t.utils.isDraftEnabled();var B=null;var F=v.getComponentContainer().getSettings();B=q.extend({},F);delete B.appComponent;delete B.entitySet;delete B.navigationProperty;B.subPages=t.routeConfig.pages;B.routeConfig=t.routeConfig;return new J({entitySet:y,entityType:i,constants:{annotations:{selectionFields:"com.sap.vocabularies.UI.v1.SelectionFields",facets:"com.sap.vocabularies.UI.v1.Facets",identification:"com.sap.vocabularies.UI.v1.Identification",headerfacets:"com.sap.vocabularies.UI.v1.HeaderFacets"}},treeNode:x,routingSpec:t.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:z,settings:B,manifest:w.getInternalManifest(),metaModel:M,templateSpecific:u&&u(),appComponentName:v.getAppComponent().getMetadata().getComponentName(),helper:{bool:{"true":true,"false":false}},stableId:{definition:S,aParameter:[],getStableId:d.getStableId}});}function m(i,t){var u=i.oComponent,v=i.createViewController,w=i.methods&&i.methods.getTemplateSpecificParameters,M=u.getModel(),x,y,z,B,F,N=i.routingSpec&&i.routingSpec.noOData;if(N){x=new J({entitySet:{},entityType:{}});B=x.createBindingContext("/entitySet");F=x.createBindingContext("/entityType");}else{x=M&&M.getMetaModel();y=M&&u.getEntitySet();var H=y&&x.getODataEntitySet(y);z=H&&H.entityType;if(!z){return{loaded:function(){return Promise.reject(new Error("Unknown entityset "+y));}};}B=x.createBindingContext(x.getODataEntitySet(y,true));F=x.createBindingContext(x.getODataEntityType(z,true));}e(u);E(u,M);q.sap.require("sap.ui.model.odata.AnnotationHelper");var I=k(u);var K=sap.ui.getCore().byId(I);if(K){L.warning("View with ID: "+I+" already exists - old view is getting destroyed now!");try{K.destroy();}catch(O){L.warning("Error destroying view: "+O);}K=null;}var P=new J(D);P.setDefaultBindingMode("OneWay");i.oParameterModel=l(z,i,x,w);u.runAsOwner(function(){var Q=i.preprocessorsData;var W={async:true,preprocessors:{xml:{bindingContexts:{entitySet:B,entityType:F},models:{device:P,entitySet:x,entityType:x,parameter:i.oParameterModel},preprocessorsData:Q}},id:I,type:V.XML,viewName:u.getTemplateName(),height:"100%",cache:{keys:t,additionalData:[Q]}};if(u.getDesigntimePath||u.getFlexibilityPath){var X={key:"sap-ui-custom-settings",value:{}};if(u.getDesigntimePath){X.value["sap.ui.dt"]={"designtime":u.getDesigntimePath()};}if(u.getFlexibilityPath){X.value["sap.ui.fl"]={"flexibility":u.getFlexibilityPath()};}W.customData=[new b(X)];}W.controller=v();K=sap.ui.view(W);});return K;}function n(i,t,u){var v=i.oController.extensionAPI;var w=q.extend({},v);if(v.getNavigationController){var N=q.extend({},v.getNavigationController());var x=N.navigateInternal;N.navigateInternal=function(y,z){var B=z&&z.routeName;if(B){i.utils.navigateRoute(B,y,t,z&&z.replaceInHistory);}else{x(y,z);}};w.getNavigationController=function(){return N;};}w.getCommunicationObject=function(y){return y===1?u.communicationObject:i.utils.getCommunicationObject(y);};(i.methods.enhanceExtensionAPI4Reuse||q.noop)(w,u);return w;}function p(i,t,u,v,w){v.extensionAPI=n(i,u,v);r.transferEmbeddedComponentProxy(i,t,u,v,w);var x=i.oController.byId(v.containerId);var y=x.getSettings();var P=w.getMetadata().getAllProperties();for(var z in y){if((z==="uiMode"||z==="semanticObject"||z.startsWith("st"))&&!P[z]){delete y[z];}}w.applySettings(y);x.setComponent(w);}function o(i,t,u){return u.componentUsage?i.createComponent({usage:u.componentUsage,id:t}):i.runAsOwner(function(){return a.create({name:u.componentName,id:t});});}function s(i){i.reuseComponentsReady=new Promise(function(t,u){var v=Object.create(null);var w=t.bind(null,v);if(i.viewLevel>0){var x=i.oTemplateContract.mEntityTree[i.routeConfig.entitySet];if(x){var y=function(z,B){L.error("Failed to load reuse component for key "+z,B instanceof Error?B.message:"","sap.suite.ui.generic.template.lib.TemplateComponent");};i.viewRegistered.then(function(){var z=[];for(var B in x.embeddedComponents){var F=x.embeddedComponents[B];var H=F.sectionId&&i.oController.byId(F.sectionId);if(H&&H.getStashed()){delete x.embeddedComponents[B];}else{var I=i.oController.createId(F.containerId+"Content");var K=o(i.oAppComponent,I,F);z.push(K);K.catch(y.bind(null,B));K.then(p.bind(null,i,v,B,F));i.oTemplateContract.oBusyHelper.setBusy(K);}}Promise.all(z).then(w,function(M){var N=i.oAppComponent.getNavigationController();N.navigateToMessagePage({text:i.oTemplateContract.getText("ST_ERROR"),description:M instanceof Error?M.message:""});u();});});return;}}w();});}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||q.noop).apply(this);var u=new J({editable:false,enabled:false});this.setModel(u,"ui");var i=this.getComponentData();var t=i.registryEntry;var v=Object.create(null);var w=(t.routeConfig&&t.routeConfig.embeddedComponents)||{};for(var K in w){var x=w[K];var y={hidden:!!x.hiddenByDefault};v[K]=y;}var z=new J({generic:{isActive:false,listCommons:{},viewLevel:t.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:v}});z.setDefaultBindingMode("TwoWay");this.setModel(z,"_templPriv");s(t);},getManifestEntry:function(K){var v=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(K)){v=q.extend(true,{},v,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return v;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(t){if(t){var u=t.oComponent.getComponentContainer();var M=!t.createViewStarted&&u&&u.getModel();if(M){M.getMetaModel().loaded().then(function(){if(!t.createViewStarted){var v=[];var w=M.metadataLoaded().then(function(P){var i;if(P&&P.lastModified){i=new Date(P.lastModified).getTime()+"";}else{L.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");i=new Date().getTime()+"";}return i;});v.push(w);var x=M.annotationsLoaded().then(function(P){var y=0;if(P){for(var i=0;i<P.length;i++){if(P[i].lastModified){var z=new Date(P[i].lastModified).getTime();if(z>y){y=z;}}else{L.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");y=new Date().getTime()+"";}}}if(y===0){L.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");y=new Date().getTime();}return y+"";});v.push(x);t.createViewStarted=true;m(t,v).loaded().then(function(i){t.oComponent.setAggregation("rootControl",i);t.fnViewRegisteredResolve();u.invalidate();},function(i){t.fnViewRegisteredResolve(i||{});});}});}}},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
