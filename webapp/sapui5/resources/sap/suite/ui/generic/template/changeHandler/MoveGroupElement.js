sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2"],function(q,U,A){"use strict";var F="com.sap.vocabularies.UI.v1.FieldGroup";var D="com.sap.vocabularies.UI.v1.DataField";var M={};var h=function(c,s,p){U.isRevert=!U.isRevert;if(!U.isRevert){return;}var r=[],C={},S={},t={},o={},a="",b={},d={},e=[],m={},f={};f=U.getMetaModel(s,p);S=p.modifier.bySelector(s.source.id,p.appComponent);t=U.getTemplatingInfo(S);o=f.getODataEntityType(t.target);a=(t.value.indexOf("/")>0)?t.value.split("/")[1].substr(1):t.value.substr(1);b=o[a];d=JSON.parse(JSON.stringify(b));e=(a.indexOf(F)>=0)?b.Data:b;if(s.source.id===s.target.id){var g=[],u={},i=-1,j={},T=-1;g=S.getFormElements();g.splice(s.movedElements[0].sourceIndex,0,g.splice(s.movedElements[0].targetIndex,1)[0]);u=g[s.movedElements[0].sourceIndex];i=s.custom.fnGetAnnotationIndex(u);j=g[s.movedElements[0].targetIndex];T=s.custom.fnGetAnnotationIndex(j);g.splice(s.movedElements[0].targetIndex,0,(g.splice(s.movedElements[0].sourceIndex,1))[0]);e.splice(T,0,e.splice(i,1)[0]);m=A.createCustomAnnotationTermChange(t.target,b,d,a);C=A.createCustomChanges(m);}else{var k={},l={},n={},v="",w={},x={},y=[],z={};k=p.modifier.bySelector(s.target.id,p.appComponent);l=U.getTemplatingInfo(k);n=f.getODataEntityType(l.target);v=(l.value.indexOf("/")>0)?l.value.split("/")[1].substr(1):l.value.substr(1);w=n[v];x=JSON.parse(JSON.stringify(w));y=(v.indexOf(F)>=0)?w.Data:w;z=p.modifier.bySelector(s.movedElements[0].id,p.appComponent);i=s.custom.fnGetAnnotationIndex(z);if(e.length===1){var B={"RecordType":D};r=e.splice(i,1,B);}else{r=e.splice(i,1);}if(t.target!==l.target){if(r[0]&&r[0].Target&&r[0].Target.AnnotationPath&&r[0].Target.AnnotationPath.indexOf("/")>0){r[0].Target.AnnotationPath=r[0].Target.AnnotationPath.substr(r[0].Target.AnnotationPath.indexOf("/")+1);}}if(s.movedElements[0].targetIndex>0){j=k.getFormElements()[s.movedElements[0].targetIndex-1];T=s.custom.fnGetAnnotationIndex(j);y.splice(T+1,0,r[0]);}else{y.splice(0,0,r[0]);}C={customChanges:[]};var E=A.createCustomAnnotationTermChange(t.target,b,d,a);var G=A.createCustomAnnotationTermChange(l.target,w,x,v);C.customChanges.push(E);C.customChanges.push(G);}q.extend(true,c.getContent(),C);};M.applyChange=function(c,C,p){};M.completeChangeContent=function(c,s,p){s.custom={};s.custom.fnGetAnnotationIndex=U.getIndexFromInstanceMetadataPath;h(c,s,p);};return M;},true);
