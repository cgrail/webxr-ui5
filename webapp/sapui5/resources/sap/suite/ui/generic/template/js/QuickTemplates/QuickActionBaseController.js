sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./AnnotationHelper"],function(M,a,A){"use strict";var B=M.extend("sap.suite.ui.generic.template.js.QuickTemplates.QuickActionBaseController",{onInit:function(){if(!this._bIsInitialized){this._bIsInitialized=true;this.oComponent=this.getOwnerComponent()||this.getView().getViewData().component;var v=this.getView();v.setModel(this.oComponent.getModel());this.sEntitySet=this.oComponent.getEntitySet();this.oDraftController=this.oComponent.getTransactionController().getDraftController();this.bDraftEnabled=this.oDraftController.getDraftContext().isDraftEnabled(this.sEntitySet);var m=this.getView().getModel().getMetaModel();this.oEntitySetMeta=m.getODataEntitySet(this.sEntitySet);this.oEntityTypeMeta=m.getODataEntityType(this.oEntitySetMeta.entityType);this.oSmartFieldEventDelegate={onAfterRendering:jQuery.proxy(function(e){this._onSmartFieldAfterRendering(e);},this)};}},_onMetaModelLoaded:function(){},_onSmartFieldAfterRendering:function(e){},onBeforeRendering:function(){if(!this._bMetaDataInit){this._bMetaDataInit=true;this.getView().getModel().getMetaModel().loaded().then(jQuery.proxy(this._onMetaModelLoaded,this),jQuery.proxy(this.onError,this));}this.setBusy(false);},setBusy:function(b){if(this.getView().getModel("ui")){this.getView().getModel("ui").setProperty("/busy",b);this.getView().getModel("ui").updateBindings();}},bindView:function(c){var i=this._getFormatterInterface(c);var e=A.formatExpandBindingPathForHeaderObject(i,this.oEntityTypeMeta.namespace+"."+this.oEntityTypeMeta.name);this.oContext=c;this.getView().bindElement({path:c.getPath(),parameters:{expand:e}});},onError:function(e){this.setBusy(false);if(e.message){this._showErrorMessage(e);}else if(e.response){this._showErrorMessage(e.response);}else{this._showErrorMessage({message:this.formatI18NMessage("QuickAction_Generic_Error")});}},onSmartFieldsCreated:function(e){var c=e.getParameters()[0];if(c&&typeof c.addEventDelegate==='function'){c.removeEventDelegate(this.oSmartFieldEventDelegate);c.addEventDelegate(this.oSmartFieldEventDelegate);}},formatI18NMessage:function(){if(arguments&&arguments[0]){var i=arguments[0];var r=this.getView().getModel("i18n").getResourceBundle();if(arguments.length>1){var b=Array.prototype.slice.call(arguments);return r.getText(i,b.splice(1,arguments.length-1));}return r.getText(i);}return arguments;},_getFormatterInterface:function(c){var b=c?c:this.getView().getBindingContext();return A.createFormatterInterface(b);},_setBindingContext:function(c){this.getView().setBindingContext(c);this.setBusy(false);},_showErrorMessage:function(e){var b=e.response||e;var d=b.message;if(b.statusText){d=b.statusText;}if(b&&b.responseText){try{var E=jQuery.parseJSON(b.responseText);var s=this._getErrorDetail(E);d=(s&&s.length>0)?s:d;}catch(c){}}a.show(d,{icon:a.Icon.ERROR,title:this.formatI18NMessage("QuickAction_Error_Popover"),actions:[a.Action.OK]});},_displaySeverity:function(e){var b;switch(e){case"error":b="Error_Severity_Error";break;case"abort":b="Error_Severity_Abort";break;case"warning":b="Error_Severity_Warning";break;case"info":b="Error_Severity_Info";break;case"termination":b="Error_Severity_Termination";break;case"success":b="Error_Severity_Success";break;}return b;},_getErrorDetail:function(e){var d="";if(e&&e.error&&e.error.message){if(e.error.innererror&&e.error.innererror.errordetails&&e.error.innererror.errordetails.length>0){jQuery.each(e.error.innererror.errordetails,jQuery.proxy(function(i,b){d+=b.message+'\n';},this));}else if(e.error.message.value){d=e.error.message.value;}}return d;}});return B;},true);
