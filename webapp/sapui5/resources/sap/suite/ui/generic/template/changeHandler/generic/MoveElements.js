/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/ui/fl/changeHandler/MoveControls"],function(q,U,A,M){"use strict";var a={};var I="com.sap.vocabularies.UI.v1.Importance";var b="com.sap.vocabularies.UI.v1.ImportanceType/High";var c="com.sap.vocabularies.UI.v1.ImportanceType/Low";a.applyChange=function(C,o,p){M.applyChange(C,o,p);};a.completeChangeContent=function(C,s,p){U.isRevert=!U.isRevert;if(!U.isRevert){return;}var m=U.getMetaModel(s,p);var o=p.modifier.bySelector(s.source.id,p.appComponent);var e=o.getAggregation(s.source.aggregation)||(o.getActions&&o.getActions());if(!U.isReveal){e.splice(s.movedElements[0].sourceIndex,0,e.splice(s.movedElements[0].targetIndex,1)[0]);}var u=e[s.movedElements[0].sourceIndex];var d=e[s.movedElements[0].targetIndex];var t=s.movedElements[0].targetIndex;var E,D,r;e.some(function(z,i){if(z&&z.getId&&z.getId().indexOf("--edit")>0){E=i;}if(z&&z.getId&&z.getId().indexOf("--delete")>0){D=i;}if(z&&z.getId&&z.getId().indexOf("--relatedApps")>0){r=i;}});var R=u;if(s.custom.fnGetRelevantElement){R=s.custom.fnGetRelevantElement(u);}var f={};var g="";var h={};var j=[];var k=[];var l="";var T=U.getTemplatingInfo(R);if(T&&T.target&&T.annotation){g=T.target;h=m.getODataEntityType(g);l=T.annotation;j=h[l];}else{g=U.getEntityType(o);h=m.getODataEntityType(g);l=s.custom.annotation;j=h[l];}k=j.slice();if(u&&u.setOrder){u.setOrder(s.movedElements[0].targetIndex);}if(U.isReveal){U.isReveal=false;}else{e.splice(s.movedElements[0].targetIndex,0,(e.splice(s.movedElements[0].sourceIndex,1))[0]);}if(s.custom.fnPerformCustomMove){var P=p.modifier.bySelector(s.source.id,p.appComponent);var n=p.modifier.bySelector(s.target.id,p.appComponent);var v=s.movedElements[0].sourceIndex;var w=s.movedElements[0].targetIndex;s.custom.fnPerformCustomMove(P,n,v,w,j);}else{var v=s.custom.fnGetAnnotationIndex(u,j);var w=s.custom.fnGetAnnotationIndex(d,j);var x=E||D||r;if(x){if(t<x){j[v][I]={EnumMember:b};}else{j[v][I]={EnumMember:c};}}j.splice(w,0,j.splice(v,1)[0]);}if(s.custom.MoveConcreteElement){s.custom.MoveConcreteElement.completeChangeContent(C,s,p);}if(v>=0&&w>=0){var f=A.createCustomAnnotationTermChange(g,j,k,l);var y=A.createCustomChanges(f);q.extend(true,C.getContent(),y);}};return a;},true);
