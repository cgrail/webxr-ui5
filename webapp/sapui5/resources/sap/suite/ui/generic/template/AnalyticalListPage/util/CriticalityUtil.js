sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","jquery.sap.global","sap/m/library","sap/base/Log"],function(B,F,q,S,L){"use strict";var P="Positive",N="Negative",C="Critical",a="Neutral",T="Target",M="Maximize",b="Minimize",c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;var e=B.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.CriticalityUtil");e.setVals=function(t,v,D,f,V){this.deviationLow=D;this.deviationHigh=f;this.toleranceLow=t;this.toleranceHigh=v;this._value=V;this.state=undefined;};e.setValuesForOmittedThresholds=function(t,v,D,f){this.deviationLow=(D||D===0)?D:d;this.deviationHigh=(f||f===0)?f:c;this.toleranceLow=(t||t===0)?t:this.deviationLow;this.toleranceHigh=(v||v===0)?v:this.deviationHigh;};e.Maximize=function(){if(this.toleranceLow||this.deviationLow||this.toleranceLow===0||this.deviationLow===0){this.setValuesForOmittedThresholds(this.toleranceLow,this.toleranceHigh,this.deviationLow,this.deviationHigh);if(this._value>=this.toleranceLow){this.state=S.ValueColor.Good;}else if(this._value<this.deviationLow){this.state=S.ValueColor.Error;}else{this.state=S.ValueColor.Critical;}}return this.state;};e.Maximizing=function(){this.Maximize();};e.Minimize=function(){if(this.toleranceHigh||this.deviationHigh||this.toleranceHigh===0||this.deviationHigh===0){this.setValuesForOmittedThresholds(this.toleranceLow,this.toleranceHigh,this.deviationLow,this.deviationHigh);if(this._value<=this.toleranceHigh){this.state=S.ValueColor.Good;}else if(this._value>this.deviationHigh){this.state=S.ValueColor.Error;}else{this.state=S.ValueColor.Critical;}}return this.state;};e.Minimizing=function(){this.Minimize();};e.Target=function(){if(this.toleranceHigh||this.toleranceLow||this.deviationHigh||this.deviationLow||this.toleranceHigh===0||this.toleranceLow===0||this.deviationHigh===0||this.deviationLow===0){this.setValuesForOmittedThresholds(this.toleranceLow,this.toleranceHigh,this.deviationLow,this.deviationHigh);if(this._value>=this.toleranceLow&&this._value<=this.toleranceHigh){this.state=S.ValueColor.Good;}else if(this._value<this.deviationLow||this._value>this.deviationHigh){this.state=S.ValueColor.Error;}else if((this._value>=this.deviationLow&&this._value<this.toleranceLow)||(this._value<=this.deviationHigh&&this._value>this.toleranceHigh)){this.state=S.ValueColor.Critical;}}return this.state;};e.getDataPoint=function(m,f){var g=m.getMetaModel(),E=g.getODataEntityType(g.getODataEntitySet(f.getEntitySet()).entityType),o=f.getChartQualifier()in E?E[f.getChartQualifier()]:undefined,D,h=0,j=o?o.MeasureAttributes:undefined;if(j){for(var i=0;i<j.length;i++){if(j[i].Measure&&j[i].Measure.PropertyPath===f.getMeasureField()){D=j[i].DataPoint?E[j[i].DataPoint.AnnotationPath.substring(1)]:undefined;if(D){h++;break;}}}}if(h===0){L.info("There is no datapoint for the measure "+f.getMeasureField());}return D;};e.getCriticalityRefProperties=function(D){var r=[];var f=D.Criticality;if(f){var s=F.readProperty(f,"Path");if(s){r.push(s);}}else{var g=D.CriticalityCalculation,i=F.readProperty(D,"CriticalityCalculation.ImprovementDirection.EnumMember")?F.getPrimitiveValue(D.CriticalityCalculation.ImprovementDirection):undefined,h=F.readProperty(g,"DeviationRangeLowValue.Path"),j=F.readProperty(g,"DeviationRangeHighValue.Path"),t=F.readProperty(g,"ToleranceRangeLowValue.Path"),k=F.readProperty(g,"ToleranceRangeHighValue.Path");if(i===M){if(h){r.push(h);}if(t){r.push(t);}}else if(i===b){if(k){r.push(k);}if(j){r.push(j);}}else if(i===T){if(h){r.push(h);}if(t){r.push(t);}if(j){r.push(j);}if(k){r.push(k);}}}return r.length>0?r:undefined;};e.getCriticalityIndicatorFromEnum=function(s){var i;if(s===N){i=S.ValueColor.Error;}else if(s===P){i=S.ValueColor.Good;}else if(s===C){i=S.ValueColor.Critical;}else if(s===a){i=S.ValueColor.Neutral;}return i;};e.CalculateCriticality=function(D,f,m){for(var i=0;i<f.results.length;i++){if(D&&D.Criticality){var g=(D.Criticality.EnumMember||D.Criticality.Path)?F.getPathOrPrimitiveValue(D.Criticality):undefined;if(g){if(g.indexOf("path")!==-1){g=D.Criticality.Path?f.results[i][D.Criticality.Path]:undefined;}f.results[i].color=this.getCriticalityIndicatorFromEnum(g);}}else{var I=F.readProperty(D,"CriticalityCalculation.ImprovementDirection.EnumMember")?F.getPrimitiveValue(D.CriticalityCalculation.ImprovementDirection):undefined;if(I){if(F.readProperty(D,"CriticalityCalculation.ToleranceRangeLowValue")){var t=F.readProperty(D,"CriticalityCalculation.ToleranceRangeLowValue.Int")?Number(D.CriticalityCalculation.ToleranceRangeLowValue.Int):Number(f.results[i][D.CriticalityCalculation.ToleranceRangeLowValue.Path]);}if(F.readProperty(D,"CriticalityCalculation.ToleranceRangeHighValue")){var h=F.readProperty(D,"CriticalityCalculation.ToleranceRangeHighValue.Int")?Number(D.CriticalityCalculation.ToleranceRangeHighValue.Int):Number(f.results[i][D.CriticalityCalculation.ToleranceRangeHighValue.Path]);}if(F.readProperty(D,"CriticalityCalculation.DeviationRangeLowValue")){var j=F.readProperty(D,"CriticalityCalculation.DeviationRangeLowValue.Int")?Number(D.CriticalityCalculation.DeviationRangeLowValue.Int):Number(f.results[i][D.CriticalityCalculation.DeviationRangeLowValue.Path]);}if(F.readProperty(D,"CriticalityCalculation.DeviationRangeHighValue")){var k=F.readProperty(D,"CriticalityCalculation.DeviationRangeHighValue.Int")?Number(D.CriticalityCalculation.DeviationRangeHighValue.Int):Number(f.results[i][D.CriticalityCalculation.DeviationRangeHighValue.Path]);}if(isNaN(j)){j=undefined;}if(isNaN(k)){k=undefined;}if(isNaN(t)){t=undefined;}if(isNaN(h)){h=undefined;}var v=Number(f.results[i][m]);this.setVals(t,h,j,k,v);f.results[i].color=(this[I]());}}}return f;};return e;},true);
