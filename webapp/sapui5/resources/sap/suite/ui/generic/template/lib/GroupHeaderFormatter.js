sap.ui.define(["sap/ui/core/library","sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/suite/ui/generic/template/js/AnnotationHelper"],function(c,D,N,A){"use strict";function g(o){return new Date(o.valueOf()-o.getTimezoneOffset()*60*1000);}function a(t,p){var G=null,o,P,f,u,F=function(v){if(v&&v instanceof Date){if(t.dateFormatSettings&&t.dateFormatSettings.UTC){v=g(v);}v=o.format(v);}return v;},h=function(v){if(v&&v instanceof Date){v=o.format(v,true);}return v;};switch(t.type){case"Edm.Boolean":G=(function(){var y=(t.oResourceBundle)?t.oResourceBundle.getText("YES"):"{i18n>YES}",n=(t.oResourceBundle)?t.oResourceBundle.getText("NO"):"{i18n>NO}";return function(v){if(v===true){v=y;}else if(v===false){v=n;}return v;};}());break;case"Edm.DateTime":if(t.displayFormat==="Date"){o=D.getDateInstance(t.dateFormatSettings);G=h;}else{o=D.getDateTimeInstance(t.dateFormatSettings);G=F;}break;case"Edm.DateTimeOffset":o=D.getDateTimeInstance(t.dateFormatSettings);if(t.displayFormat==="Date"){G=h;}else{G=F;}break;case"Edm.Time":o=D.getTimeInstance(t.dateFormatSettings);G=function(v){if(v&&v.ms){v=o.format(new Date(v.ms),true);}return v;};break;case"Edm.Decimal":f="Org.OData.Measures.V1.ISOCurrency";if(p[f]){u=p[f].Path;o=N.getCurrencyInstance({showMeasure:false});}else{f="Org.OData.Measures.V1.Unit";if(p[f]){u=p[f].Path;}o=N.getFloatInstance({precision:p.precision,decimals:p.scale});}G=function(v,T,C){var U=(u&&C)?C.getProperty(u):"";v=o.format(v,U);if(U){v+=" "+U;}return v;};break;case"Edm.String":f="com.sap.vocabularies.Common.v1.IsCalendarDate";if(p[f]&&String(p[f].Bool)==="true"){o=D.getDateInstance(jQuery.extend({},t.dateFormatSettings,{UTC:false}));P=D.getDateInstance({UTC:false,pattern:"yyyyMMdd",calendarType:c.CalendarType.Gregorian});G=function(v,T){if(v!==null&&v!==""){v=P.parse(v,true);v=o.format(v);}return v;};}else{G=function(v,T){return v;};}break;case"Edm.Byte":G=function(v,T){return v;};break;default:break;}return G;}function b(C,p,f,o){var m=C.getModel("entitySet").getMetaModel(),M=m.getObject(m.getMetaContext(C.sPath).sPath),P=m.getObject(m.getMetaContext(C.sPath+"/"+p).sPath),t={path:p,type:P.type,displayFormat:"",dateFormatSettings:o||null,label:f,textPath:"",textArrangement:A.getTextArrangement(M,P),fnGroupingFormatter:null,oResourceBundle:null},h,T,S,l;if(P){if(P.extensions){l=P.extensions.length;for(var k=0;k<l;k++){h=P.extensions[k];if(h.namespace==="http://www.sap.com/Protocols/SAPData"){switch(h.name){case"display-format":t.displayFormat=h.value;break;case"label":if(!t.label){t.label=h.value;}break;case"text":T=h.value;S=p.split("/");S[S.length-1]=T;t.textPath=S.join("/");break;default:break;}}}}if(!t.label){t.label=p;}t.fnGroupingFormatter=a(t,P);}return t;}function d(S,p,C){var t,o=JSON.parse(S.data("dateFormatSettings"));return function(f){var P,k,h;if(!t){t=b(f,p,C,o);}P=f.getProperty(p);if(t.fnGroupingFormatter){P=t.fnGroupingFormatter(P,null,f);}if(t.textPath){h=f.getProperty(t.textPath);}if(h){switch(t.textArrangement){case"idAndDescription":k=P+" ("+h+")";break;case"idOnly":k=P;break;case"descriptionOnly":k=h;break;default:k=h+(P?" ("+P+")":"");break;}}else{k=P;}return{key:k||p,text:t.label?t.label+": "+k:k};};}function e(p,o,r){var t={path:p.name,type:p.type,displayFormat:"",dateFormatSettings:o||null,fnGroupingFormatter:null,oResourceBundle:r},P,l;if(p.extensions){l=p.extensions.length;for(var k=0;k<l;k++){P=p.extensions[k];if(P.namespace==="http://www.sap.com/Protocols/SAPData"){switch(P.name){case"display-format":t.displayFormat=P.value;break;default:break;}}}}t.fnGroupingFormatter=a(t,p);return t;}function s(S){var t=S.getTable(),G=t.getGroupedColumns();if(G.length){var o=JSON.parse(S.data("dateFormatSettings"));var r=S.getModel("i18n").getResourceBundle();var E=S.getEntitySet();var m=S.getModel().getMetaModel();var f=m.getODataEntitySet(E);var h=m.getODataEntityType(f.entityType);var C=t.getColumns();var j=C.reduce(function(l,n){l[n.getId()]=n;return l;},{});for(var i=0;i<G.length;i++){var k=j[G[i]];if(k){var p=k.getLeadingProperty();if(!k.getGroupHeaderFormatter()){var P=m.getODataProperty(h,p);var T=e(P,o,r);k.setGroupHeaderFormatter(T.fnGroupingFormatter);}else{}}}}}return{getGroupFunctionForMTable:d,setGroupFunctionForAnalyticalTable:s};});
