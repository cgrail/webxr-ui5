/*!
 * SAPUI5

(c) Copyright 2009-2019 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/m/library","sap/ui/core/Control","sap/suite/ui/microchart/RadialMicroChartRenderer","sap/ui/Device","sap/ui/core/ResizeHandler","sap/m/ValueColor","sap/base/Log","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","sap/m/ValueCSSColor"],function(q,l,M,C,R,D,a,V,L,K,b,c){"use strict";var d=C.extend("sap.suite.ui.microchart.RadialMicroChart",{constructor:function(i,s){var p;if(s&&typeof s.percentage==="number"){p=true;}else if(i&&typeof i.percentage==="number"){p=true;}else{p=false;}try{C.apply(this,arguments);this._bPercentageMode=p;}catch(e){this.destroy();throw e;}},metadata:{library:"sap.suite.ui.microchart",properties:{total:{group:"Data",type:"float",defaultValue:null},fraction:{group:"Data",type:"float",defaultValue:null},percentage:{group:"Data",type:"float",defaultValue:null},valueColor:{group:"Appearance",type:"sap.m.ValueCSSColor",defaultValue:"Neutral"},size:{group:"Misc",type:"sap.m.Size",defaultValue:"Auto"},width:{group:"Misc",type:"sap.ui.core.CSSSize"},height:{group:"Misc",type:"sap.ui.core.CSSSize"},alignContent:{group:"Misc",type:"sap.suite.ui.microchart.HorizontalAlignmentType",defaultValue:"Left"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{press:{}}}});d.THRESHOLD_LOOK_XS=1.125;d.THRESHOLD_LOOK_S=3.5;d.THRESHOLD_LOOK_M=4.5;d.THRESHOLD_LOOK_L=5.875;d.THRESHOLD_WIDTH_NO_LABEL=6;d.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=true;if(!sap.ui.getCore().isInitialized()){this._bThemeApplied=false;sap.ui.getCore().attachInit(this._handleCoreInitialized.bind(this));}else{this._handleCoreInitialized();}};d.prototype._handleCoreInitialized=function(){this._bThemeApplied=sap.ui.getCore().isThemeApplied();if(!this._bThemeApplied){sap.ui.getCore().attachThemeChanged(this._handleThemeApplied,this);}};d.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();sap.ui.getCore().detachThemeChanged(this._handleThemeApplied,this);};d.prototype.onBeforeRendering=function(){if(!this._getPercentageMode()){if(this.getTotal()===0){L.info("Total cannot be 0. Please add a valid total value.");}else{this.setProperty("percentage",Math.round((this.getFraction()*100/this.getTotal())*10)/10,true);}}this._unbindMouseEnterLeaveHandler();};d.prototype.onAfterRendering=function(){this._bindMouseEnterLeaveHandler();this._sResizeHandlerId=a.register(this,this._onResize.bind(this));this._onResize();};d.prototype.ontouchstart=function(e){if(this.hasListeners("press")===true){e.setMarked();}};d.prototype.ontap=function(e){if(D.browser.msie){this.$().focus();}if(this.hasListeners("press")===true){e.setMarked();}this.firePress();};d.prototype.onkeydown=function(e){if(e.which===K.SPACE){if(this.hasListeners("press")===true){e.setMarked();}e.preventDefault();}};d.prototype.onkeyup=function(e){if(e.which===K.ENTER||e.which===K.SPACE){if(this.hasListeners("press")===true){e.setMarked();}this.firePress();e.preventDefault();}};d.prototype.attachEvent=function(e,f,g,h){C.prototype.attachEvent.call(this,e,f,g,h);if(e==="press"){this.rerender();}return this;};d.prototype.detachEvent=function(e,f,g){C.prototype.detachEvent.call(this,e,f,g);if(e==="press"){this.rerender();}return this;};d.prototype.exit=function(){this._deregisterResizeHandler();};d.prototype._getPercentageMode=function(){return this._bPercentageMode;};d.prototype.setPercentage=function(p){if(q.type(p)==="number"){var f=Math.floor(p*10)/10;this._bPercentageMode=true;if(f!==this.getPercentage()){this.setProperty("percentage",f);}}else{this._bPercentageMode=false;this.setProperty("percentage",null);}return this;};d.prototype._onResize=function(){var $=this.$(),i=$.height(),e=$.width(),o=$.find(".sapSuiteRMCOutsideLabel"),I=$.find(".sapSuiteRMCInsideLabel"),f=$.find(".sapSuiteRMCInnerContainer");$.removeClass("sapSuiteRMCLookL sapSuiteRMCLookM sapSuiteRMCLookS sapSuiteRMCLookXS");o.removeClass("sapSuiteRMCLabelHide");I.removeClass("sapSuiteRMCLabelHide");f.css("width",f.height());if(i<this.convertRemToPixels(d.THRESHOLD_LOOK_S)){$.addClass("sapSuiteRMCLookXS");I.addClass("sapSuiteRMCLabelHide");}else if(i<this.convertRemToPixels(d.THRESHOLD_LOOK_M)||e<this.convertRemToPixels(d.THRESHOLD_LOOK_M)){$.addClass("sapSuiteRMCLookS");o.addClass("sapSuiteRMCLabelHide");}else if(i<this.convertRemToPixels(d.THRESHOLD_LOOK_L)||e<this.convertRemToPixels(d.THRESHOLD_LOOK_L)){$.addClass("sapSuiteRMCLookM");o.addClass("sapSuiteRMCLabelHide");}else{$.addClass("sapSuiteRMCLookL");o.addClass("sapSuiteRMCLabelHide");}if(this._isAnyLabelTruncated(o)){o.addClass("sapSuiteRMCLabelHide");}if(this._isAnyLabelTruncated(I)){I.addClass("sapSuiteRMCLabelHide");}};d.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_RADIALMICROCHART");};d.prototype._isValueColorValid=function(){return V.hasOwnProperty(this.getValueColor());};d.prototype._isTooltipSuppressed=function(){var t=this.getTooltip_Text();if(t&&q.trim(t).length===0){return true;}else{return false;}};d.prototype._getAltHeaderText=function(i){var t=this._oRb.getText("RADIALMICROCHART");if(i){t+=" "+this._oRb.getText("IS_ACTIVE");}t+="\n";if(!this._hasData()){t+=this._oRb.getText("NO_DATA");return t;}var p=this.getPercentage();if(p>100){p=100;}else if(p<0){p=0;}if(this._isValueColorValid()){t+=this._oRb.getText("RADIALMICROCHART_ARIA_LABEL",[this.getPercentage(),this._getStatusText()]);}else{t+=this._oRb.getText("RADIALMICROCHART_PERCENTAGE_TEXT",p);}return t;};d.prototype._getStatusText=function(){var v=this.getValueColor();switch(v){case V.Error:return this._oRb.getText("SEMANTIC_COLOR_ERROR");case V.Critical:return this._oRb.getText("SEMANTIC_COLOR_CRITICAL");case V.Good:return this._oRb.getText("SEMANTIC_COLOR_GOOD");case V.Neutral:return this._oRb.getText("SEMANTIC_COLOR_NEUTRAL");default:return"";}};d.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString());}};d.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title");}};d.prototype._bindMouseEnterLeaveHandler=function(){this.$().bind("mouseenter.tooltip",this._addTitleAttribute.bind(this));this.$().bind("mouseleave.tooltip",this._removeTitleAttribute.bind(this));};d.prototype._unbindMouseEnterLeaveHandler=function(){this.$().unbind("mouseenter.tooltip");this.$().unbind("mouseleave.tooltip");};d.prototype._hasData=function(){return this._getPercentageMode()||(this.getTotal()!==0);};d.prototype.firePress=function(){if(this._hasData()){C.prototype.fireEvent.call(this,"press",arguments);}};d.prototype._deregisterResizeHandler=function(){if(this._sResizeHandlerId){a.deregister(this._sResizeHandlerId);this._sResizeHandlerId=null;}};b.extendMicroChart(d);return d;});
