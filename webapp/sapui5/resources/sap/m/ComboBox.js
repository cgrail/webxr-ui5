/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./InputBase','./ComboBoxTextField','./ComboBoxBase','./SuggestionsPopover','./List','./library','sap/ui/Device','sap/ui/core/Item','./StandardListItem','./ComboBoxRenderer',"sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","./Toolbar","sap/base/assert","sap/base/security/encodeXML","sap/ui/core/Core"],function(I,C,a,S,L,l,D,b,c,d,e,K,T,f,g,h){"use strict";var j=l.ListType;var k=l.ListMode;var m=l.ListSeparators;var n=a.extend("sap.m.ComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/ComboBox.designtime",properties:{selectedKey:{type:"string",group:"Data",defaultValue:""},selectedItemId:{type:"string",group:"Misc",defaultValue:""},filterSecondaryValues:{type:"boolean",group:"Misc",defaultValue:false}},associations:{selectedItem:{type:"sap.ui.core.Item",multiple:false}},events:{change:{parameters:{value:{type:"string"},itemPressed:{type:"boolean"}}},selectionChange:{parameters:{selectedItem:{type:"sap.ui.core.Item"}}}}}});function H(i,p){if(!p){return;}var q=i.getFocusDomRef(),r=i._getSelectionRange().start,t=q.value.substring(0,q.selectionStart),u=i._shouldResetSelectionStart(p),v=i.getSelectedItem(),G=p.isA("sap.ui.core.SeparatorItem"),w;i.setSelection(p);if(p!==v&&!G){i.updateDomValue(p.getText());i.fireSelectionChange({selectedItem:p});p=i.getSelectedItem();if(u){r=0;}i.selectText(r,q.value.length);i._bIsLastFocusedItemHeader=false;}if(G){i.setSelectedItem(null);i.fireSelectionChange({selectedItem:null});i.updateDomValue(t);i._bIsLastFocusedItemHeader=true;}w=this.getListItem(p);i.handleListItemsVisualFocus(w);if(i.isOpen()){i.$().removeClass("sapMFocus");i._getList().addStyleClass("sapMListFocus");}else{i.$().addClass("sapMFocus");}i.scrollToItem(p);}n.prototype.scrollToItem=function(i){var p=this.getPicker(),P=p.getDomRef("cont"),q=this.getListItem(i),r=i&&q&&q.getDomRef();if(!p||!P||!r){return;}var t=P.scrollTop,u=r.offsetTop,v=P.clientHeight,w=r.offsetHeight;if(t>u){P.scrollTop=u;}else if((u+w)>(t+v)){P.scrollTop=Math.ceil(u+w-v);}};function s(i,E){if(document.activeElement===this.getFocusDomRef()){this.selectText(i,E);}}function o(i){var p=this.getSelectedItem(),q=this.getListItem(p),r=p&&q&&q.getDomRef(),t=r&&r.offsetTop,u=r&&r.offsetHeight,P=this.getPicker(),v=P.getDomRef("cont"),w=v.clientHeight;if(p&&((t+u)>(w))){if(!i){this._getList().$().css("visibility","hidden");}else{v.scrollTop=t-u/2;this._getList().$().css("visibility","visible");}}}n.prototype._handleAriaActiveDescendant=function(i){var p=this.getFocusDomRef(),q=this.getListItem(i),A="aria-activedescendant";if(p){if(i&&q&&q.getDomRef()&&this.isOpen()){p.setAttribute(A,q.getId());}else{p.removeAttribute(A);}}};n.prototype._getSelectedItemText=function(i){i=i||this.getSelectedItem();if(!i){i=this.getDefaultSelectedItem();}if(i){return i.getText();}return"";};n.prototype._setItemVisibility=function(i,v){var O=i&&this.getListItem(i).$(),p="sapMSelectListItemBaseInvisible";if(v){i.bVisible=true;O.length&&O.removeClass(p);}else{i.bVisible=false;O.length&&O.addClass(p);}};n.prototype._highlightList=function(v){var i=[],p=[],q,r;this._oList.getItems().forEach(function(t){r=t.getDomRef();if(r){i.push({ref:r.getElementsByClassName("sapMSLITitleOnly")[0],text:t.getTitle()});q=r.querySelector(".sapMSLIInfo");if(q&&t.getInfo){p.push({ref:q,text:t.getInfo()});}}});this.highLightList(v,i);this.highLightList(v,p);};n.prototype.setSelectedIndex=function(i,_){var p;_=_||this.getItems();i=(i>_.length-1)?_.length-1:Math.max(0,i);p=_[i];if(p){this.setSelection(p);}};n.prototype.configureDropdown=function(i){i.setShowHeader(true);i.setInitialFocus(this);};n.prototype.configureDialog=function(i){var t=this,p=this.createPickerTextField(),q=p._handleEvent,P=this.getPickerInvisibleTextId();p._handleEvent=function(E){q.apply(this,arguments);if(/keydown|sapdown|sapup|saphome|sapend|sappagedown|sappageup|input/.test(E.type)){t._handleEvent(E);}};i._oPopupInput=p;i.setStretch(true).setCustomHeader(this.createPickerHeader()).setSubHeader(new T({content:p})).addButton(this.createPickerCloseButton()).attachBeforeOpen(function(){t.updatePickerHeaderTitle();}).attachAfterClose(function(){t.focus();l.closeKeyboard();});if(P){i.addAriaLabelledBy(P);}};n.prototype.createPickerTextField=function(){var t=new C({width:"100%",showValueStateMessage:false,showButton:false}).addEventDelegate({onsapenter:function(){this.updateDomValue(t.getValue());this.onChange();}},this);return t;};n.prototype.revertSelection=function(){var p,P=this.getPickerTextField();this.setSelectedItem(this._oSelectedItemBeforeOpen);this.setValue(this._sValueBeforeOpen);if(this.getSelectedItem()===null){p=this._sValueBeforeOpen;}else{p=this._oSelectedItemBeforeOpen.getText();}P&&P.setValue(p);};n.prototype.filterItems=function(O){var i=this.getItems(),F=[],p=[],q=O.properties.indexOf("additionalText")>-1,r=this.fnFilter||a.DEFAULT_TEXT_FILTER,G=[],t=false;this._oFirstItemTextMatched=null;i.forEach(function(u){if(u.isA("sap.ui.core.SeparatorItem")){if(!u.getText()){this.getListItem(u).setVisible(false);return;}G.push({separator:u,show:false});t=true;this.getListItem(u).setVisible(false);return;}var M=r.call(this,O.value,u,"getText");var v=r.call(this,O.value,u,"getAdditionalText");if((M||v)&&t){G[G.length-1].show=true;t=false;}if(M){p.push(u);F.push(u);}else if(v&&q){F.push(u);}}.bind(this));i.forEach(function(u){if(u.isA("sap.ui.core.SeparatorItem")){return;}var v=F.indexOf(u)>-1;var w=p.indexOf(u)>-1;if(!this._oFirstItemTextMatched&&w){this._oFirstItemTextMatched=u;}this.getListItem(u).setVisible(v);},this);G.forEach(function(u){if(u.show){this.getListItem(u.separator).setVisible(true);}}.bind(this));return F;};n.prototype._filterStartsWithItems=function(i,M){var p=i.toLowerCase();var q=this.getItems(),F=q.filter(function(r){return r[M]&&r[M]().toLowerCase().startsWith(p);});return F;};n.prototype._getFilters=function(){return this.getFilterSecondaryValues()?["text","additionalText"]:["text"];};n.prototype.getNextFocusableItem=function(i){var A=this.getSelectableItems(),p=this.getNonSeparatorSelectableItems(A),F=this.$().hasClass("sapMFocus"),q=this.getSelectedItem()||this._getItemByListItem(this._oLastFocusedListItem),N;if(F&&this.isOpen()){N=A[0];}else if(F){N=p[p.indexOf(q)+(i?1:-1)];}else{N=A[A.indexOf(q)+(i?1:-1)];}return N;};n.prototype.getNonSeparatorSelectableItems=function(i){return i.filter(function(p){return!p.isA("sap.ui.core.SeparatorItem");});};n.prototype._itemsTextStartsWithTypedValue=function(i,t){if(!i||typeof t!="string"||t==""){return false;}return i.getText().toLowerCase().startsWith(t.toLowerCase());};n.prototype._shouldResetSelectionStart=function(i){var p=this.getFocusDomRef(),q=this._getSelectionRange(),r=q.start!==q.end,t=p.value.substring(0,q.start),u=this._itemsTextStartsWithTypedValue(i,t);return!(u&&(r||this._bIsLastFocusedItemHeader));};n.prototype._getSelectionRange=function(){var i=this.getFocusDomRef(),v=this.getValue(),p=i.selectionStart,q=i.selectionEnd,r={start:p,end:q};if(!(D.browser.msie||D.browser.edge)){return r;}if(this._bIsLastFocusedItemHeader){r.start=v.length;r.end=v.length;}return r;};n.prototype.handleListItemsVisualFocus=function(i){if(this._oLastFocusedListItem){this._oLastFocusedListItem.removeStyleClass("sapMLIBFocused");this._oLastFocusedListItem=null;}if(i){this._oLastFocusedListItem=i;i.addStyleClass("sapMLIBFocused");}};n.prototype.init=function(){this._oRb=h.getLibraryResourceBundle("sap.m");a.prototype.init.apply(this,arguments);this.bOpenValueStateMessage=true;this._sValueBeforeOpen="";this._sInputValueBeforeOpen="";this._oSelectedItemBeforeOpen=null;this._oFirstItemTextMatched=null;this.bIsFocused=false;if(D.system.phone){this.attachEvent("_change",this.onPropertyChange,this);}this._oLastFocusedListItem=null;this._bIsLastFocusedItemHeader=null;};n.prototype.onBeforeRendering=function(){a.prototype.onBeforeRendering.apply(this,arguments);this._fillList();this.synchronizeSelection();};n.prototype._fillList=function(){var p=this._getList(),q,r,t,i,u;if(!p){return;}if(this._oLastFocusedListItem){u=this._getItemByListItem(this._oLastFocusedListItem);}p.destroyItems();q=this.getItems();if(this._sInputValueBeforeOpen){q=this.filterItems({properties:this._getFilters(),value:this._sInputValueBeforeOpen});}for(i=0,t=q.length;i<t;i++){r=this._mapItemToListItem(q[i]);p.addAggregation("items",r,true);}if(u){this._oLastFocusedListItem=this.getListItem(u);}};n.prototype.exit=function(){a.prototype.exit.apply(this,arguments);this._oRb=null;this._oSelectedItemBeforeOpen=null;this._oFirstItemTextMatched=null;this._oLastFocusedListItem=null;if(this._oSuggestionPopover){this._oSuggestionPopover.destroy();this._oSuggestionPopover=null;}};n.prototype.onBeforeRenderingPicker=function(){var O=this["onBeforeRendering"+this.getPickerType()];O&&O.call(this);};n.prototype.onBeforeRenderingDropdown=function(){var p=this.getPicker(),w=(this.$().outerWidth()/parseFloat(l.BaseFontSize))+"rem";if(p){p.setContentMinWidth(w);}};n.prototype.onBeforeRenderingList=function(){if(this.bProcessingLoadItemsEvent){var i=this._getList(),F=this.getFocusDomRef();if(i){i.setBusy(true);}if(F){F.setAttribute("aria-busy","true");}}};n.prototype.onAfterRenderingPicker=function(){var O=this["onAfterRendering"+this.getPickerType()];O&&O.call(this);o.call(this,false);};n.prototype.onAfterRenderingList=function(){var i=this.getSelectedItem();if(this.bProcessingLoadItemsEvent&&(this.getItems().length===0)){return;}var p=this._getList(),F=this.getFocusDomRef();this._highlightList(this._sInputValueBeforeOpen);if(i){p.setSelectedItem(this.getListItem(i));}if(p){p.setBusy(false);}if(F){F.removeAttribute("aria-busy");}};n.prototype.oninput=function(E){a.prototype.oninput.apply(this,arguments);if(E.isMarked("invalid")){return;}this.loadItems(function(){this.handleInputValidation(E,this.isComposingCharacter());},{name:"input",busyIndicator:false});if(this.bProcessingLoadItemsEvent&&(this.getPickerType()==="Dropdown")){this.open();}this.$().addClass("sapMFocus");this._getList().removeStyleClass("sapMListFocus");};n.prototype.handleInputValidation=function(E,i){var p=this.getSelectedItem(),v=E.target.value,q=v==="",r=E.srcControl,V,t=(this.getPickerType()==="Dropdown");if(q&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){V=this.getItems();}else{V=this.filterItems({properties:this._getFilters(),value:v});}var u=!!V.length;var F=V[0];if(!q&&F&&F.getEnabled()){this.handleTypeAhead(r,V,v,i);}if(q||!u||(!r._bDoTypeAhead&&(this._getSelectedItemText()!==v))){this.setSelection(null);if(p!==this.getSelectedItem()){this.fireSelectionChange({selectedItem:this.getSelectedItem()});}}this._sInputValueBeforeOpen=v;if(this.isOpen()){setTimeout(function(){this._highlightList(v);}.bind(this));}if(u){if(q&&!this.bOpenedByKeyboardOrButton){this.close();}else if(t){this.open();this.scrollToItem(this.getSelectedItem());}}else if(this.isOpen()){if(t&&!this.bOpenedByKeyboardOrButton){this.close();}}else{this.clearFilter();}};n.prototype.handleTypeAhead=function(i,p,v,q){var r=this.intersectItems(this._filterStartsWithItems(v,'getText'),p);var t=this.getFilterSecondaryValues();var u=D.system.desktop;var w=this.getSelectedItem();if(i._bDoTypeAhead){var x=this.intersectItems(this._filterStartsWithItems(v,'getAdditionalText'),p);if(t&&!r[0]&&x[0]){!q&&i.updateDomValue(x[0].getAdditionalText());this.setSelection(x[0]);}else if(r[0]){!q&&i.updateDomValue(r[0].getText());this.setSelection(r[0]);}}else{this.setSelection(r[0]);}if(w!==this.getSelectedItem()){this.fireSelectionChange({selectedItem:this.getSelectedItem()});}if(i._bDoTypeAhead){if(u){s.call(i,v.length,i.getValue().length);}else{setTimeout(s.bind(i,v.length,i.getValue().length),0);}}this.$().addClass("sapMFocus");this._getList().removeStyleClass("sapMListFocus");};n.prototype.onSelectionChange=function(i){var p=this._getItemByListItem(i.getParameter("listItem")),P=this.getChangeEventParams(),q=(p!==this.getSelectedItem());this.setSelection(p);this.fireSelectionChange({selectedItem:this.getSelectedItem()});if(q){P.itemPressed=true;this.onChange(null,P);}};n.prototype.onItemPress=function(i){var p=i.getParameter("listItem"),t=p.getTitle(),P=this.getChangeEventParams(),q=(p!==this.getListItem(this.getSelectedItem()));if(p.isA("sap.m.GroupHeaderListItem")){return;}this.handleListItemsVisualFocus(p);this.updateDomValue(t);if(!q){P.itemPressed=true;this.onChange(null,P);}this.setProperty("value",t,true);if(this.getPickerType()==="Dropdown"){setTimeout(this.selectText.bind(this,this.getValue().length,this.getValue().length),0);}setTimeout(this.close.bind(this));};n.prototype.onBeforeOpen=function(){var p=this["onBeforeOpen"+this.getPickerType()],i=this.getFocusDomRef();if(this.hasLoadItemsEventListeners()&&!this.bProcessingLoadItemsEvent){this.loadItems();}this.addStyleClass(I.ICON_PRESSED_CSS_CLASS);if(i){this.getRoleComboNodeDomRef().setAttribute("aria-owns",this._getList().getId());}this.addContent();p&&p.call(this);};n.prototype.onBeforeOpenDialog=function(){var p=this.getPickerTextField();this._oSelectedItemBeforeOpen=this.getSelectedItem();this._sValueBeforeOpen=this.getValue();if(this.getSelectedItem()){this.filterItems({properties:this._getFilters(),value:""});}p.setValue(this._sValueBeforeOpen);};n.prototype.onAfterOpen=function(){var i=this.getFocusDomRef(),p=this.getSelectedItem(),q=this.getListItem(p);if(i){this.getRoleComboNodeDomRef().setAttribute("aria-expanded","true");q&&i.setAttribute("aria-activedescendant",q.getId());}o.call(this,true);};n.prototype.onBeforeClose=function(){a.prototype.onBeforeClose.apply(this,arguments);var i=this.getFocusDomRef();if(i){this.getRoleComboNodeDomRef().removeAttribute("aria-owns");i.removeAttribute("aria-activedescendant");}this.removeStyleClass(I.ICON_PRESSED_CSS_CLASS);};n.prototype.onAfterClose=function(){var i=this.getFocusDomRef();if(i){this.getRoleComboNodeDomRef().setAttribute("aria-expanded","false");}this.clearFilter();this._sInputValueBeforeOpen="";if(this.shouldValueStateMessageBeOpened()&&(document.activeElement===i)){this.openValueStateMessage();}};n.prototype.onItemChange=function(i){var p=this.getAssociation("selectedItem"),N=i.getParameter("newValue"),P=i.getParameter("name");if(p===i.getParameter("id")){switch(P){case"text":if(!this.isBound("value")){this.setValue(N);}break;case"key":if(!this.isBound("selectedKey")){this.setSelectedKey(N);}break;}}};n.prototype._handleItemTap=function(E){var t=jQuery(E.target).control(0);if(!t.isA("sap.m.GroupHeaderListItem")){this.close();}};n.prototype.onkeydown=function(E){var i=E.srcControl;a.prototype.onkeydown.apply(i,arguments);if(!i.getEnabled()||!i.getEditable()){return;}var p=K;i._bDoTypeAhead=(E.which!==p.BACKSPACE)&&(E.which!==p.DELETE);};n.prototype.oncut=function(E){var i=E.srcControl;a.prototype.oncut.apply(i,arguments);i._bDoTypeAhead=false;};n.prototype.onsapenter=function(E){var i=E.srcControl,p=i.getSelectedItem();if(p&&this.getFilterSecondaryValues()){i.updateDomValue(p.getText());}a.prototype.onsapenter.apply(i,arguments);if(!i.getEnabled()||!i.getEditable()){return;}if(i.isOpen()&&!this.isComposingCharacter()){i.close();}};n.prototype.onsapdown=function(E){var i=E.srcControl;if(!i.getEnabled()||!i.getEditable()){return;}E.setMarked();E.preventDefault();this.loadItems(function navigateToNextSelectableItem(){H.call(this,i,this.getNextFocusableItem(true));});};n.prototype.onsapup=function(E){var i=E.srcControl;if(!i.getEnabled()||!i.getEditable()){return;}E.setMarked();E.preventDefault();this.loadItems(function navigateToPrevSelectableItem(){H.call(this,i,this.getNextFocusableItem(false));});};n.prototype.onsaphome=function(E){var i=E.srcControl;if(!i.getEnabled()||!i.getEditable()){return;}E.setMarked();E.preventDefault();this.loadItems(function navigateToFirstSelectableItem(){var F=this.getSelectableItems()[0];H.call(this,i,F);});};n.prototype.onsapend=function(E){var i=E.srcControl;if(!i.getEnabled()||!i.getEditable()){return;}E.setMarked();E.preventDefault();this.loadItems(function navigateToLastSelectableItem(){var p=this.findLastEnabledItem(this.getSelectableItems());H.call(this,i,p);});};n.prototype.onsappagedown=function(E){var i=E.srcControl;if(!i.getEnabled()||!i.getEditable()){return;}E.setMarked();E.preventDefault();this.loadItems(function(){var p=this.getNonSeparatorSelectableItems(this.getSelectableItems()),q=p.indexOf(this.getSelectedItem())+10,r;q=(q>p.length-1)?p.length-1:Math.max(0,q);r=p[q];H.call(this,i,r);});};n.prototype.onsappageup=function(E){var i=E.srcControl;if(!i.getEnabled()||!i.getEditable()){return;}E.setMarked();E.preventDefault();this.loadItems(function(){var p=this.getNonSeparatorSelectableItems(this.getSelectableItems()),q=p.indexOf(this.getSelectedItem())-10,r;q=(q>p.length-1)?p.length-1:Math.max(0,q);r=p[q];H.call(this,i,r);});};n.prototype.onsapshow=function(E){var i,p;a.prototype.onsapshow.apply(this,arguments);if(!this.getValue()){i=this.getSelectableItems();p=this.getNonSeparatorSelectableItems(i)[0];if(p){this.setSelection(p);this.updateDomValue(p.getText());this.fireSelectionChange({selectedItem:p});setTimeout(function(){this.selectText(0,p.getText().length);}.bind(this),0);}}};n.prototype.onsaphide=n.prototype.onsapshow;n.prototype.onfocusin=function(E){var i=this.getPickerType()==="Dropdown";if(this._bIsBeingDestroyed){return;}if(E.target===this.getOpenArea()){this.bOpenValueStateMessage=false;if(i&&!this.isPlatformTablet()){this.focus();}}else{if(i){setTimeout(function(){if(document.activeElement===this.getFocusDomRef()&&!this.bIsFocused&&!this.bFocusoutDueRendering&&!this.getSelectedText()){this.selectText(0,this.getValue().length);}this.bIsFocused=true;}.bind(this),0);}if(!this.isOpen()&&this.bOpenValueStateMessage&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage();}this.bOpenValueStateMessage=true;}if(this.getEnabled()&&(!this.isOpen()||!this.getSelectedItem()||!this._getList().hasStyleClass("sapMListFocus"))){this.$().addClass("sapMFocus");}};n.prototype.onsapfocusleave=function(E){this.bIsFocused=false;var t,p,r,F,i=this.getSelectedItem();if(i&&this.getFilterSecondaryValues()){this.updateDomValue(i.getText());}a.prototype.onsapfocusleave.apply(this,arguments);if(this.isPickerDialog()){return;}p=this.getAggregation("picker");if(!E.relatedControlId||!p){return;}t=this.isPlatformTablet();r=h.byId(E.relatedControlId);F=r&&r.getFocusDomRef();if(e(p.getFocusDomRef(),F)&&!t){this.focus();}};n.prototype.setSelection=function(i){var p=this._getList(),q,r;this.setAssociation("selectedItem",i,true);this.setProperty("selectedItemId",(i instanceof b)?i.getId():i,true);if(typeof i==="string"){i=h.byId(i);}if(p){q=this.getListItem(i);if(q){p.setSelectedItem(q,true);}else{p.removeSelections(true);}}r=i?i.getKey():"";this.setProperty("selectedKey",r,true);this._handleAriaActiveDescendant(i);if(this._oSuggestionPopover){this._oSuggestionPopover._iPopupListSelectedIndex=this.getItems().indexOf(i);}};n.prototype.isSelectionSynchronized=function(){var i=this.getSelectedItem();return this.getSelectedKey()===(i&&i.getKey());};n.prototype.synchronizeSelection=function(){if(this.isSelectionSynchronized()){return;}var i=this.getSelectedKey(),v=this.getItemByKey(""+i);if(v&&(i!=="")){this.setAssociation("selectedItem",v,true);this.setProperty("selectedItemId",v.getId(),true);if(this._sValue===this.getValue()){this.setValue(v.getText());this._sValue=this.getValue();}}};n.prototype.isFiltered=function(){var i=this._getList();return i&&(i.getVisibleItems().length!==this.getItems().length);};n.prototype.isItemVisible=function(i){return i&&(i.bVisible===undefined||i.bVisible);};n.prototype.createPicker=function(p){var P=this.getAggregation("picker"),r=this.getRenderer(),i=r.CSS_CLASS_COMBOBOXBASE;if(P){return P;}this._oSuggestionPopover=this._createSuggestionsPopover();P=this._oSuggestionPopover._oPopover;this.setAggregation("picker",P,true);this["configure"+p](P);P.setHorizontalScrolling(false).addStyleClass(i+"Picker").addStyleClass(i+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this);return P;};n.prototype._createSuggestionsPopover=function(){var u=this.isPickerDialog(),i;i=new S(this);if(u){i._oPopupInput=this.createPickerTextField();}i._createSuggestionPopup();i._createSuggestionPopupContent(false,false,false);this._oList=i._oList;this._configureList(this._oList);return i;};n.prototype._configureList=function(i){var r=this.getRenderer();if(!i){return;}i.setMode(k.SingleSelectMaster).setShowSeparators(m.None).setIncludeItemInSelection(true).setWidth("100%").setRememberSelections(false).setBusyIndicatorDelay(0).addStyleClass(r.CSS_CLASS_COMBOBOXBASE+"List").addStyleClass(r.CSS_CLASS_COMBOBOX+"List");i.attachSelectionChange(this.onSelectionChange,this).attachItemPress(this.onItemPress,this);i.addEventDelegate({ontap:this._handleItemTap,onBeforeRendering:this.onBeforeRenderingList,onAfterRendering:this.onAfterRenderingList},this);};n.prototype.destroyItems=function(){this.destroyAggregation("items");if(this._getList()){this._getList().destroyItems();}return this;};n.prototype._mapItemToListItem=function(i){var p,q,r,A;var R=this.getRenderer();if(!i){return null;}A=(i.getAdditionalText&&this.getShowSecondaryValues())?i.getAdditionalText():"";q=R.CSS_CLASS_COMBOBOXBASE+"Item";r=(this.isItemSelected(i))?q+"Selected":"";if(i.isA("sap.ui.core.SeparatorItem")){p=this._mapSeparatorItemToGroupHeader(i,R);}else{p=new c({type:j.Active,info:A,visible:i.getEnabled()}).addStyleClass(q+" "+r);}p.setTitle(i.getText());this.setSelectable(i,i.getEnabled());p.setTooltip(i.getTooltip());i.data(R.CSS_CLASS_COMBOBOXBASE+"ListItem",p);return p;};n.prototype.setSelectable=function(i,p){if(this.indexOfItem(i)<0){return;}i._bSelectable=p;var q=this.getListItem(i);if(q){q.setVisible(p);}};n.prototype.isItemSelected=function(i){return i&&(i.getId()===this.getAssociation("selectedItem"));};n.prototype.getDefaultSelectedItem=function(){return null;};n.prototype.getChangeEventParams=function(){return{itemPressed:false};};n.prototype.clearSelection=function(){this.setSelection(null);};n.prototype.selectText=function(i,p){a.prototype.selectText.apply(this,arguments);this.textSelectionStart=i;this.textSelectionEnd=p;return this;};n.prototype.setAssociation=function(A,i,p){var q=this._getList();if(q&&(A==="selectedItem")){if(!(i instanceof b)){i=this.findItem("id",i);}q.setSelectedItem(this.getListItem(i),true);}return a.prototype.setAssociation.apply(this,arguments);};n.prototype.removeAllAssociation=function(A,i){var p=this._getList();if(p&&(A==="selectedItem")){L.prototype.removeAllAssociation.apply(p,arguments);}return a.prototype.removeAllAssociation.apply(this,arguments);};n.prototype.clone=function(i){var p=a.prototype.clone.apply(this,arguments),q=this._getList();if(!this.isBound("items")&&q){p.setSelectedIndex(this.indexOfItem(this.getSelectedItem()));}return p;};n.prototype.open=function(){var i=this._getList();a.prototype.open.call(this);if(this.getSelectedItem()){i.addStyleClass("sapMListFocus");this.$().removeClass("sapMFocus");}return this;};n.prototype.close=function(){var i=this._getList();a.prototype.close.call(this);this.$().addClass("sapMFocus");i&&i.removeStyleClass("sapMListFocus");return this;};n.prototype.findAggregatedObjects=function(){var i=this._getList();if(i){return L.prototype.findAggregatedObjects.apply(i,arguments);}return[];};n.prototype.setSelectedItem=function(i){if(typeof i==="string"){this.setAssociation("selectedItem",i,true);i=h.byId(i);}if(!(i instanceof b)&&i!==null){return this;}if(!i){i=this.getDefaultSelectedItem();}this.setSelection(i);this.setValue(this._getSelectedItemText(i));return this;};n.prototype.setSelectedItemId=function(i){i=this.validateProperty("selectedItemId",i);if(!i){i=this.getDefaultSelectedItem();}this.setSelection(i);i=this.getSelectedItem();this.setValue(this._getSelectedItemText(i));return this;};n.prototype.setSelectedKey=function(i){i=this.validateProperty("selectedKey",i);var p=(i===""),q=this.isBound("selectedKey")&&this.isBound("value")&&this.getBindingInfo("selectedKey").skipModelUpdate;if(p){this.setSelection(null);if(!q){this.setValue("");}return this;}var r=this.getItemByKey(i);if(r){this.setSelection(r);if(!q){this.setValue(this._getSelectedItemText(r));}return this;}this._sValue=this.getValue();return this.setProperty("selectedKey",i);};n.prototype.getSelectedItem=function(){var v=this.getAssociation("selectedItem");return(v===null)?null:h.byId(v)||null;};n.prototype.updateItems=function(){var r,i=this.getSelectedItem(),r=a.prototype.updateItems.apply(this,arguments);clearTimeout(this._debounceItemsUpdate);this._debounceItemsUpdate=setTimeout(this["_syncItemsSelection"].bind(this,i),0);return r;};n.prototype._syncItemsSelection=function(i){var p,N,q=this.getSelectedKey();if(!i||i===this.getSelectedItem()){return;}N=this.getItems();p=N.some(function(r){return q===r.getKey();});this.setSelectedItem(p&&q?this.getItemByKey(q):null);};n.prototype.removeItem=function(i){i=a.prototype.removeItem.apply(this,arguments);var p;if(this._getList()){this._getList().removeItem(i&&this.getListItem(i));}if(this.isBound("items")&&!this.bItemsUpdated){return i;}var v=this.getValue();if(this.getItems().length===0){this.clearSelection();}else if(this.isItemSelected(i)){p=this.getDefaultSelectedItem();this.setSelection(p);this.setValue(v);}return i;};n.prototype.applyShowItemsFilters=function(){var p=this.getPicker(),P=function(){p.detachBeforeOpen(P,this);p=null;this.filterItems({value:this.getValue()||"_",properties:this._getFilters()});};p.attachBeforeOpen(P,this);};return n;});
