/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/base/ManagedObject','sap/ui/base/ManagedObjectObserver','sap/ui/unified/library','sap/ui/unified/calendar/CalendarUtils','sap/ui/unified/calendar/CalendarDate','sap/ui/unified/DateRange','sap/ui/unified/CalendarAppointment','sap/ui/unified/CalendarRow','sap/ui/unified/CalendarRowRenderer','sap/ui/unified/CalendarDateInterval','sap/ui/unified/CalendarWeekInterval','sap/ui/unified/CalendarOneMonthInterval','sap/ui/Device','sap/ui/core/Element','sap/ui/core/Renderer','sap/ui/core/ResizeHandler','sap/ui/core/Item','sap/ui/core/dnd/DragInfo','sap/ui/core/dnd/DropInfo','sap/ui/core/dnd/DragDropInfo','sap/m/Select','sap/m/Button','sap/m/OverflowToolbar','sap/m/Toolbar','sap/m/Table','sap/m/Column','sap/m/ColumnListItem','sap/m/ColumnListItemRenderer','sap/m/StandardListItem','sap/m/StandardListItemRenderer','sap/m/PlanningCalendarRow','sap/m/PlanningCalendarRenderer','sap/m/library',"sap/base/util/deepEqual","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(C,M,a,u,b,c,D,d,e,f,g,h,k,l,E,R,m,I,n,o,p,S,B,O,T,q,r,s,t,v,w,P,x,y,z,L,Q){"use strict";var A=u.CalendarDayType;var F=y.ListMode;var G=y.ToolbarDesign;var H=y.ButtonType;var J=y.PlanningCalendarBuiltInView;var K=y.ScreenSize;var N=u.CalendarAppointmentVisualization;var U=u.GroupAppointmentsMode;var V=u.CalendarIntervalType;var W="DragDropConfig";var X="ResizeConfig";var Y="CreateConfig";var Z="-CLI";var $=C.extend("sap.m.PlanningCalendar",{metadata:{library:"sap.m",properties:{startDate:{type:"object",group:"Data"},viewKey:{type:"string",group:"Appearance",defaultValue:V.Hour},singleSelection:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showRowHeaders:{type:"boolean",group:"Appearance",defaultValue:true},noDataText:{type:"string",group:"Misc",defaultValue:null},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:U.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:false},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:N.Standard},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showDayNamesLine:{type:"boolean",group:"Appearance",defaultValue:false},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:false},builtInViews:{type:"string[]",group:"Appearance",defaultValue:[]},stickyHeader:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{rows:{type:"sap.m.PlanningCalendarRow",multiple:true,singularName:"row"},views:{type:"sap.m.PlanningCalendarView",multiple:true,singularName:"view"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},toolbarContent:{type:"sap.ui.core.Control",multiple:true,singularName:"toolbarContent",forwarding:{getter:"_getTableHeaderToolbar",aggregation:"content"},forwardBinding:true},table:{type:"sap.m.Table",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{appointmentSelect:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"},row:{type:"sap.m.PlanningCalendarRow"}}},rowSelectionChange:{parameters:{rows:{type:"sap.m.PlanningCalendarRow[]"}}},startDateChange:{},viewChange:{},rowHeaderClick:{row:{type:"sap.m.PlanningCalendarRow"}}},designtime:"sap/m/designtime/PlanningCalendar.designtime"},constructor:function(i,j){C.prototype.constructor.apply(this,arguments);if(typeof i!=="string"){j=i;}if(j&&typeof j.customAppointmentsSorterCallback==="function"){this._fnCustomSortedAppointments=j.customAppointmentsSorterCallback;}}});var _=["_oTimeInterval","_oDateInterval","_oMonthInterval","_oWeekInterval","_oOneMonthInterval"],a1={};a1[V.Day]={sInstanceName:"_oDateInterval",sIdSuffix:"-DateInt",oClass:g};a1[V.Week]={sInstanceName:"_oWeekInterval",sIdSuffix:"-WeekInt",oClass:h};a1[V.OneMonth]={sInstanceName:"_oOneMonthInterval",sIdSuffix:"-OneMonthInt",oClass:k};var b1=K.Desktop;var c1=[J.Hour,J.Day,J.Month,J.Week,J.OneMonth];var d1={PHONE:"600",TABLET:"1024"};var e1=["sap.ui.unified.CalendarTimeInterval","sap.ui.unified.CalendarDateInterval","sap.ui.unified.CalendarMonthInterval"];var f1=C.extend("CalendarHeader",{metadata:{aggregations:{"toolbar":{type:"sap.m.Toolbar",multiple:false},"allCheckBox":{type:"sap.m.CheckBox",multiple:false}}},renderer:function(i,j){i.write("<div");i.writeControlData(j);i.addClass("sapMPlanCalHead");i.writeClasses();i.write(">");var H1=j.getToolbar();if(H1){i.renderControl(H1);}var I1=j.getAllCheckBox();if(I1){i.renderControl(I1);}i.write("</div>");}});$.prototype.init=function(){this._iBreakPointTablet=l.media._predefinedRangeSets[l.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=l.media._predefinedRangeSets[l.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=l.media._predefinedRangeSets[l.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];if(l.system.phone||Q('html').hasClass("sapUiMedia-Std-Phone")){this._iSize=0;this._iSizeScreen=0;}else if(l.system.tablet||Q('html').hasClass("sapUiMedia-Std-Tablet")){this._iSize=1;this._iSizeScreen=1;}else{this._iSize=2;this._iSizeScreen=2;}this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.m");var i=this.getId();this._oIntervalTypeSelect=new S(i+"-IntType",{maxWidth:"15rem",ariaLabelledBy:i+"-SelDescr"});this._oIntervalTypeSelect.attachEvent("change",h1,this);this._oTodayButton=new B(i+"-Today",{text:this._oRB.getText("PLANNINGCALENDAR_TODAY"),type:H.Transparent});this._oTodayButton.attachEvent("press",this._handleTodayPress,this);this._oHeaderToolbar=new T(i+"-HeaderToolbar",{design:G.Transparent,content:[this._oIntervalTypeSelect,this._oTodayButton]});this._oCalendarHeader=new f1(i+"-CalHead",{toolbar:this._oHeaderToolbar});this._oInfoToolbar=new T(i+"-InfoToolbar",{height:"auto",design:G.Transparent,content:[this._oCalendarHeader,this._oTimeInterval]});var j=new O(this.getId()+"-Toolbar",{design:G.Transparent,visible:false});j._oPlanningCalendar=this;var H1=new q(i+"-Table",{sticky:[],infoToolbar:this._oInfoToolbar,headerToolbar:j,mode:F.SingleSelectMaster,columns:[new r({styleClass:"sapMPlanCalRowHead"}),new r({width:"80%",styleClass:"sapMPlanCalAppRow",minScreenWidth:b1,demandPopin:true})],ariaLabelledBy:i+"-Descr"});H1.attachEvent("selectionChange",x1,this);H1.addDelegate({onBeforeRendering:function(){if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off();}},onAfterRendering:function(){this._rowHeaderClickEvent=H1.$().find(".sapMPlanCalRowHead > div.sapMLIB").click(function(I1){var J1=Q(I1.currentTarget).control(0),K1=t1(J1.getParent());this.fireRowHeaderClick({row:K1});}.bind(this));}},false,this);this.setAggregation("table",H1,true);this.setStartDate(new Date());this._resizeProxy=Q.proxy(l1,this);this._fnCustomSortedAppointments=undefined;this.iWidth=0;};$.prototype.exit=function(){if(this._sResizeListener){m.deregister(this._sResizeListener);this._sResizeListener=undefined;}l.orientation.detachHandler(this._updateStickyHeader,this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}var i=this.getAggregation("table");i.removeAllItems();_.forEach(function(H1){if(this[H1]){this[H1]._oPlanningCalendar=undefined;this[H1].destroy();this[H1]=undefined;}},this);if(this._oViews){for(var j in this._oViews){this._oViews[j].destroy();}}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.destroy();}if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off();this._rowHeaderClickEvent=null;}};$.prototype.onBeforeRendering=function(){this._bBeforeRendering=true;if((!this._oTimeInterval&&!this._oDateInterval&&!this._oMonthInterval&&!this._oWeekInterval&&!this._oOneMonthInterval)||this._bCheckView){this.setViewKey(this.getViewKey());this._bCheckView=undefined;}A1.call(this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}this._updateTodayButtonState();l.orientation.detachHandler(this._updateStickyHeader,this);this._bBeforeRendering=undefined;};$.prototype.attachEvent=function(i,j,H1,I1){C.prototype.attachEvent.call(this,i,j,H1,I1);if(this.hasListeners("intervalSelect")){_.forEach(function(J1){if(this[J1]){this[J1]._setAriaRole("button");}},this);}return this;};$.prototype.detachEvent=function(i,j,H1){C.prototype.detachEvent.call(this,i,j,H1);if(!this.hasListeners("intervalSelect")){_.forEach(function(I1){if(this[I1]){this[I1]._setAriaRole("gridcell");}},this);}return this;};$.prototype._setAriaRole=function(i){if(this.hasListeners("intervalSelect")){i._setAriaRole("button");}else{i._setAriaRole("gridcell");}};$.prototype._updateTodayButtonState=function(){if(this._oTodayButton){this._oTodayButton.setEnabled(!this._dateMatchesVisibleRange(new Date(),this.getViewKey()));}};$.prototype._dateMatchesVisibleRange=function(i,j){var H1=this._getView(j,!this._bBeforeRendering);if(!H1){return false;}var I1=H1.getIntervalType(),J1=a1[I1],K1=J1?this[J1.sInstanceName]:null,L1=false;if(K1&&K1._dateMatchesVisibleRange){L1=K1._dateMatchesVisibleRange(i);}return L1;};$.prototype.onAfterRendering=function(i){i.size={width:this.getDomRef().offsetWidth};l1.call(this,i,true);if(!this._sResizeListener){this._sResizeListener=m.register(this,this._resizeProxy);}if(l.system.phone&&this.getStickyHeader()){l.orientation.attachHandler(this._updateStickyHeader,this);}this._updateCurrentTimeVisualization(false);if(this.getHeight()){var j=this.getDomRef().querySelector("table");var H1=this.$().height()-this._oInfoToolbar.$().height()-this._getTableHeaderToolbar().$().height()+"px";j.style.height=H1;}};$.prototype.addToolbarContent=function(i){this.addAggregation("toolbarContent",i);g1.call(this);return this;};$.prototype.insertToolbarContent=function(i,j){this.insertAggregation("toolbarContent",i,j);g1.call(this);return this;};$.prototype.removeToolbarContent=function(i){var j=this.removeAggregation("toolbarContent",i);g1.call(this);return j;};$.prototype.removeAllToolbarContent=function(){var i=this.removeAllAggregation("toolbarContent");g1.call(this);return i;};$.prototype.destroyToolbarContent=function(){var i=this.destroyAggregation("toolbarContent");g1.call(this);return i;};function g1(){this._getTableHeaderToolbar().setVisible(!!this.getToolbarContent().length);}$.prototype.setStartDate=function(i){var j,H1;if(!i){i=new Date();}else{b._checkJSDateObject(i);}if(this.getViewKey()===J.Week){j=b.getFirstDateOfWeek(b._createUniversalUTCDate(i,undefined,true));i.setTime(b._createLocalDate(j,true).getTime());}if(this.getViewKey()===J.OneMonth||this.getViewKey()===J.Month){H1=b.getFirstDateOfMonth(b._createUniversalUTCDate(i,undefined,true));i.setTime(b._createLocalDate(H1,true).getTime());}if(z(i,this.getStartDate())){this._updateTodayButtonState();return this;}var I1=i.getFullYear();b._checkYearInValidRange(I1);var J1=this.getMinDate();if(J1&&J1.getTime()>i.getTime()){L.warning("StartDate < minDate -> StartDate set to minDate",this);i=new Date(J1.getTime());}else{var K1=this.getMaxDate();if(K1&&K1.getTime()<i.getTime()){L.warning("StartDate > maxDate -> StartDate set to minDate",this);if(J1){i=new Date(J1.getTime());}else{i=new Date(1,0,1);i.setFullYear(1);}}}this.setProperty("startDate",i,true);_.forEach(function(L1){if(this[L1]){this[L1].setStartDate(new Date(i.getTime()));}},this);this._setRowsStartDate(new Date(i.getTime()));if(this.getViewKey()===J.Week||this.getViewKey()===J.OneMonth){this._updateTodayButtonState();}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);}return this;};$.prototype.setMinDate=function(i){if(z(i,this.getMinDate())){return this;}var j=this.getMaxDate();if(i){b._checkJSDateObject(i);var H1=i.getFullYear();b._checkYearInValidRange(H1);this.setProperty("minDate",i,true);this._bNoStartDateChange=true;_.forEach(function(K1){if(this[K1]){this[K1].setMinDate(new Date(i.getTime()));}},this);if(j&&j.getTime()<i.getTime()){L.warning("minDate > maxDate -> maxDate set to end of the month",this);j=new Date(i.getTime());j.setMonth(j.getMonth()+1,0);j.setHours(23);j.setMinutes(59);j.setSeconds(59);j.setMilliseconds(0);this.setMaxDate(j);}this._bNoStartDateChange=undefined;var I1=this.getStartDate();if(I1&&I1.getTime()<i.getTime()){L.warning("StartDate < minDate -> StartDate set to minDate",this);I1=new Date(i.getTime());this.setStartDate(I1);}}else{this.setProperty("minDate",undefined,true);_.forEach(function(K1){if(this[K1]){this[K1].setMinDate();}},this);}var J1=new Date();if(i&&J1.getTime()<i.getTime()){this._oTodayButton.setVisible(false);}else if(!j||J1.getTime()<j.getTime()){this._oTodayButton.setVisible(true);}return this;};$.prototype.setMaxDate=function(i){if(z(i,this.getMaxDate())){return this;}var j=this.getMinDate();if(i){b._checkJSDateObject(i);var H1=i.getFullYear();b._checkYearInValidRange(H1);this.setProperty("maxDate",i,true);this._bNoStartDateChange=true;_.forEach(function(K1){if(this[K1]){this[K1].setMaxDate(new Date(i.getTime()));}},this);if(j&&j.getTime()>i.getTime()){L.warning("maxDate < minDate -> maxDate set to begin of the month",this);j=new Date(i.getTime());j.setDate(1);j.setHours(0);j.setMinutes(0);j.setSeconds(0);j.setMilliseconds(0);this.setMinDate(j);}this._bNoStartDateChange=undefined;var I1=this.getStartDate();if(I1&&I1.getTime()>i.getTime()){L.warning("StartDate > maxDate -> StartDate set to minDate",this);if(j){I1=new Date(j.getTime());}else{I1=new Date(1,0,1);I1.setFullYear(1);}this.setStartDate(I1);}}else{this.setProperty("maxDate",undefined,true);_.forEach(function(K1){if(this[K1]){this[K1].setMaxDate();}},this);}var J1=new Date();if(i&&J1.getTime()>i.getTime()){this._oTodayButton.setVisible(false);}else if(!j||J1.getTime()>j.getTime()){this._oTodayButton.setVisible(true);}return this;};$.prototype.removeIntervalInstanceFromInfoToolbar=function(){var i=this._oInfoToolbar.getContent();i.forEach(function(j){if(j.isA(e1)){this._oInfoToolbar.removeContent(j);}}.bind(this));};$.prototype.setViewKey=function(j){var H1,I1,J1,K1=this.getViewKey(),L1;this.setProperty("viewKey",j,true);this._oIntervalTypeSelect.setSelectedKey(j);this.removeIntervalInstanceFromInfoToolbar();if(j===J.Week||j===J.OneMonth||j===J.Month){I1=this.getStartDate();this.setStartDate(new Date(I1.getTime()));if(I1.getTime()!==this.getStartDate().getTime()){this.fireStartDateChange();}}var M1=this.getStartDate();var N1=this.getMinDate();var O1=this.getMaxDate();var P1=this._getView(j,!this._bBeforeRendering);if(!P1){this._bCheckView=true;this.invalidate();}else{var Q1=P1.getIntervalType();var R1=this._getIntervals(P1);this._bCheckView=false;switch(Q1){case V.Hour:if(!this._oTimeInterval){this._oTimeInterval=new sap.ui.unified.CalendarTimeInterval(this.getId()+"-TimeInt",{startDate:new Date(M1.getTime()),items:R1,pickerPopup:true,legend:this.getLegend()});this._setAriaRole(this._oTimeInterval);this._oTimeInterval.attachEvent("startDateChange",this._handleStartDateChange,this);this._oTimeInterval.attachEvent("select",this._handleCalendarSelect,this);this._oTimeInterval._oPlanningCalendar=this;this._oTimeInterval.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates();};if(N1){this._oTimeInterval.setMinDate(new Date(N1.getTime()));}if(O1){this._oTimeInterval.setMaxDate(new Date(O1.getTime()));}}else if(this._oTimeInterval.getItems()!=R1){this._oTimeInterval.setItems(R1);}this._insertInterval(this._oTimeInterval);break;case V.Day:case V.Week:case V.OneMonth:J1=a1[Q1];H1=this[J1.sInstanceName];if(!H1){H1=new J1.oClass(this.getId()+J1.sIdSuffix,{startDate:new Date(M1.getTime()),days:R1,showDayNamesLine:this.getShowDayNamesLine(),pickerPopup:true,legend:this.getLegend(),showWeekNumbers:this.getShowWeekNumbers()});this._setAriaRole(H1);H1.attachEvent("startDateChange",this._handleStartDateChange,this);H1.attachEvent("select",this._handleCalendarSelect,this);if(j===J.OneMonth){H1._setRowsStartDate=this._setRowsStartDate.bind(this);}H1._oPlanningCalendar=this;H1.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates();};if(N1){H1.setMinDate(new Date(N1.getTime()));}if(O1){H1.setMaxDate(new Date(O1.getTime()));}}else if(H1.getDays()!==R1){H1.setDays(R1);}this._insertInterval(H1);this[J1.sInstanceName]=H1;break;case V.Month:if(!this._oMonthInterval){this._oMonthInterval=new sap.ui.unified.CalendarMonthInterval(this.getId()+"-MonthInt",{startDate:new Date(M1.getTime()),months:R1,pickerPopup:true,legend:this.getLegend()});this._setAriaRole(this._oMonthInterval);this._oMonthInterval.attachEvent("startDateChange",this._handleStartDateChange,this);this._oMonthInterval.attachEvent("select",this._handleCalendarSelect,this);this._oMonthInterval._oPlanningCalendar=this;this._oMonthInterval.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates();};if(N1){this._oMonthInterval.setMinDate(new Date(N1.getTime()));}if(O1){this._oMonthInterval.setMaxDate(new Date(O1.getTime()));}}else if(this._oMonthInterval.setMonths()!=R1){this._oMonthInterval.setMonths(R1);}this._insertInterval(this._oMonthInterval);break;default:throw new Error("Unknown IntervalType: "+Q1+"; "+this);}var S1=this.getRows();for(var i=0;i<S1.length;i++){var T1=S1[i];var U1=w1(T1);U1.setIntervalType(Q1);U1.setIntervals(R1);U1.setShowSubIntervals(P1.getShowSubIntervals());}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);j1.call(this,this.getShowWeekNumbers(),this._viewAllowsWeekNumbers(j));k1.call(this,this.getShowDayNamesLine(),!!H1);}}if(this._oOneMonthInterval&&j===J.OneMonth){this._oOneMonthInterval._setDisplayMode(this._iSize);this._oOneMonthInterval._adjustSelectedDate(c.fromLocalJSDate(I1));if(this._iSize<2){this._setRowsStartDate(I1);}}else if(this._oOneMonthInterval&&K1===J.OneMonth&&this._oOneMonthInterval.getSelectedDates().length){L1=this._oOneMonthInterval.getSelectedDates()[0].getStartDate();if(L1){this.setStartDate(L1);}}this._updateTodayButtonState();return this;};$.prototype._insertInterval=function(i){if(this._iSizeScreen>1){this._oInfoToolbar.addContent(i);}else{this._oInfoToolbar.insertContent(i,1);}};$.prototype._viewAllowsWeekNumbers=function(i){var j=this._getView(i).getIntervalType(),H1=a1[j];return!!H1&&!!H1.oClass.prototype.setShowWeekNumbers;};$.prototype._viewAllowsDayNamesLine=function(i){var j=this._getView(i).getIntervalType(),H1=a1[j];return!!H1&&!!H1.oClass.prototype.setShowDayNamesLine;};$.prototype._getIntervalInstanceByViewKey=function(i){var j=this._getView(i).getIntervalType(),H1=a1[j],I1;if(H1){I1=this[H1.sInstanceName];}return I1;};$.prototype.setShowWeekNumbers=function(i){this.setProperty("showWeekNumbers",i,true);this._getViews().forEach(function(j){var H1=j.getKey(),I1=this._viewAllowsWeekNumbers(H1),J1=this._getIntervalInstanceByViewKey(H1);if(J1&&I1){this._getIntervalInstanceByViewKey(H1).setShowWeekNumbers(i);}if(this.getDomRef()&&this.getViewKey()===H1){j1.call(this,i,I1);}},this);return this;};$.prototype.setShowIntervalHeaders=function(j){this.setProperty("showIntervalHeaders",j,true);var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];w1(I1).setShowIntervalHeaders(j);}return this;};$.prototype.setShowEmptyIntervalHeaders=function(j){this.setProperty("showEmptyIntervalHeaders",j,true);var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];w1(I1).setShowEmptyIntervalHeaders(j);}return this;};$.prototype.setGroupAppointmentsMode=function(j){this.setProperty("groupAppointmentsMode",j,true);var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];w1(I1).setGroupAppointmentsMode(j);}return this;};$.prototype.setAppointmentsReducedHeight=function(j){this.setProperty("appointmentsReducedHeight",j,true);var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];w1(I1).setAppointmentsReducedHeight(j);}return this;};$.prototype.setAppointmentsVisualization=function(j){this.setProperty("appointmentsVisualization",j,true);var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];w1(I1).setAppointmentsVisualization(j);}return this;};$.prototype.setShowRowHeaders=function(i){this.setProperty("showRowHeaders",i,true);var j=this.getAggregation("table");j.getColumns()[0].setVisible(i);this._toggleAppointmentsColumnPopinState(i);this.$().toggleClass("sapMPlanCalNoHead",!i);E1.call(this);F1.call(this);return this;};$.prototype.setShowDayNamesLine=function(i){var j,H1,I1,J1=!!this.getDomRef(),K1=this.getViewKey();for(j in a1){H1=a1[j].sInstanceName;if(this[H1]){I1=this[H1];I1.setShowDayNamesLine(i);if(J1&&j===K1){k1.call(this,i,true);}}}return this.setProperty("showDayNamesLine",i,false);};$.prototype.setStickyHeader=function(i){if(this.getStickyHeader()===i){return this;}this.setProperty("stickyHeader",i,true);if(l.system.phone){if(i){l.orientation.attachHandler(this._updateStickyHeader,this);}else{l.orientation.detachHandler(this._updateStickyHeader,this);}}this._updateStickyHeader();return this;};$.prototype._updateStickyHeader=function(){var i=[],j=this.getStickyHeader(),H1=this.getViewKey()===J.OneMonth&&this._iSize<2,I1=j&&!l.system.phone&&!H1,J1=j&&!(l.system.phone&&l.orientation.landscape)&&!H1;if(I1){i.push(sap.m.Sticky.HeaderToolbar);}if(this._oInfoToolbar&&J1){i.push(sap.m.Sticky.InfoToolbar);}this.getAggregation("table").setSticky(i);};$.prototype.addRow=function(i){this.addAggregation("rows",i,true);this.getAggregation("table").addItem(this._createPlanningCalendarListItem(i));return this;};$.prototype.insertRow=function(i,j){this.insertAggregation("rows",i,j);this.getAggregation("table").insertItem(this._createPlanningCalendarListItem(i),j,true);return this;};$.prototype.removeRow=function(i){var j=this.removeAggregation("rows",i,true),H1=this.getAggregation("table");H1.removeItem(u1(j),true);this._handleRowRemoval(j);D1.call(this);F1.call(this);return j;};$.prototype.removeAllRows=function(){var i=this.removeAllAggregation("rows",true),j=this.getAggregation("table");j.removeAllItems(true);i.forEach(this._handleRowRemoval,this);D1.call(this);F1.call(this);return i;};$.prototype.destroyRows=function(){var i=this.destroyAggregation("rows",true);var j=this.getAggregation("table");j.destroyItems(true);D1.call(this);F1.call(this);return i;};$.prototype.setSingleSelection=function(i){this.setProperty("singleSelection",i,true);E1.call(this);F1.call(this);if(i){this.selectAllRows(false);}else{D1.call(this);}this.$().toggleClass("sapMPlanCalMultiSel",!i);return this;};$.prototype.setNoDataText=function(i){this.setProperty("noDataText",i,true);var j=this.getAggregation("table");j.setNoDataText(i);return this;};$.prototype.setLegend=function(j){this.setAssociation("legend",j,true);var H1=this.getRows(),I1=this.getLegend()&&sap.ui.getCore().byId(this.getLegend()),J1;for(var i=0;i<H1.length;i++){var K1=H1[i];w1(K1).setLegend(j);}_.forEach(function(L1){if(this[L1]){this[L1].setLegend(j);}},this);if(I1){J1=new a(function(L1){this.invalidate();}.bind(this));J1.observe(I1,{destroy:true});}return this;};$.prototype.addAriaLabelledBy=function(i){this.addAssociation("ariaLabelledBy",i,true);var j=this.getAggregation("table");j.addAriaLabelledBy(i);return this;};$.prototype.removeAriaLabelledBy=function(i){this.removeAssociation("ariaLabelledBy",i,true);var j=this.getAggregation("table");j.removeAriaLabelledBy(i);return this;};$.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);var i=this.getAggregation("table");i.removeAllAriaLabelledBy();i.addAriaLabelledBy(this.getId()+"-Descr");return this;};$.prototype.invalidate=function(i){var j=i&&i instanceof D;if(!this._bIsBeingDestroyed&&(this._bDateRangeChanged||j)){if(this.getDomRef()){var H1=this.getViewKey();var I1=this._getView(H1);var J1=I1.getIntervalType();switch(J1){case V.Hour:if(this._oTimeInterval){this._oTimeInterval.invalidate(arguments);}break;case V.Day:if(this._oDateInterval){this._oDateInterval.invalidate(arguments);}break;case V.Month:if(this._oMonthInterval){this._oMonthInterval.invalidate(arguments);}break;case V.OneMonth:if(this._oOneMonthInterval){this._oOneMonthInterval.invalidate(arguments);}break;case V.Week:if(this._oWeekInterval){this._oWeekInterval.invalidate(arguments);}break;default:throw new Error("Unknown IntervalType: "+J1+"; "+this);}}this._bDateRangeChanged=undefined;}else{if(i&&i instanceof sap.m.PlanningCalendarView){this._bCheckView=true;}C.prototype.invalidate.apply(this,arguments);}};$.prototype.addSpecialDate=function(i){this._bDateRangeChanged=true;return C.prototype.addAggregation.call(this,"specialDates",i);};$.prototype.insertSpecialDate=function(i,j){this._bDateRangeChanged=true;return C.prototype.insertAggregation.call(this,"specialDates",i,j);};$.prototype.removeSpecialDate=function(i){this._bDateRangeChanged=true;return C.prototype.removeAggregation.call(this,"specialDates",i);};$.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;return this.removeAllAggregation("specialDates");};$.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;return this.destroyAggregation("specialDates");};$.prototype.removeAllViews=function(){this._bCheckView=true;var i=this.removeAllAggregation("views"),j=this.getBuiltInViews();if(j.length){this.setViewKey(j[0]);}else{this.setViewKey(c1[0]);}return i;};$.prototype.destroyViews=function(){this._bCheckView=true;var i=this.destroyAggregation("views"),j=this.getBuiltInViews();if(j.length){this.setViewKey(j[0]);}else{this.setViewKey(c1[0]);}return i;};$.prototype.getSelectedRows=function(){return this.getRows().filter(function(i){return i.getSelected();});};$.prototype.selectAllRows=function(j){var H1=this.getRows();if(!(j&&this.getSingleSelection())){for(var i=0;i<H1.length;i++){var I1=H1[i];I1.setSelected(j);}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.setSelected(j);}}return this;};$.prototype.onsaphomemodifiers=function(i){if((i.metaKey||i.ctrlKey)&&!i.altKey&&!i.shiftKey){var j=this.getRows();var H1=j[0];var I1=new Q.Event("saphome");I1._bPlanningCalendar=true;w1(H1).onsaphome(I1);i.preventDefault();i.stopPropagation();}};$.prototype.onsapendmodifiers=function(i){if((i.metaKey||i.ctrlKey)&&!i.altKey&&!i.shiftKey){var j=this.getRows();var H1=j[j.length-1];var I1=new Q.Event("sapend");I1._bPlanningCalendar=true;w1(H1).onsapend(I1);i.preventDefault();i.stopPropagation();}};$.prototype.setBuiltInViews=function(i){this.setProperty("builtInViews",i);this.setViewKey(this._getViews()[0].getKey());return this;};$.prototype.removeView=function(i){var j=this.removeAggregation("views",i);if(!this.getViews().length){this.setViewKey(this._getViews()[0].getKey());}return j;};$.prototype._getIntervals=function(i){var j=0;switch(this._iSize){case 0:j=i.getIntervalsS();break;case 1:j=i.getIntervalsM();break;default:j=i.getIntervalsL();break;}return j;};$.prototype._getView=function(j,H1){var I1=this._getViews();var J1;for(var i=0;i<I1.length;i++){J1=I1[i];if(J1.getKey()!=j){J1=undefined;}else{break;}}if(!J1&&!H1){throw new Error("PlanningCalendarView with key "+j+"not assigned "+this);}return J1;};$.prototype._changeStartDate=function(i){if(this._bNoStartDateChange){return;}this.setStartDate(new Date(i.getTime()));this.fireStartDateChange();};$.prototype._updateCurrentTimeVisualization=function(j){if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}if(j){var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];w1(I1).updateCurrentTimeVisualization();}}var J1=new Date();var K1=this.getStartDate();var L1=this.getViewKey();var M1=this._getView(L1);var N1=M1.getIntervalType();var O1=this._getIntervals(M1);var P1=0;var Q1=0;var R1=0;switch(N1){case V.Hour:P1=60000;Q1=K1.getTime()-3600000;R1=K1.getTime()+O1*3600000;break;case V.Day:case V.Week:case V.OneMonth:P1=1800000;Q1=K1.getTime()-3600000;R1=K1.getTime()+O1*86400000;break;default:P1=-1;break;}if(J1.getTime()<=R1&&J1.getTime()>=Q1&&P1>0){this._sUpdateCurrentTime=setTimeout(this['_updateCurrentTimeVisualization'].bind(this,true),P1);}};function h1(i){this.setViewKey(i.getParameter("selectedItem").getKey());this.fireViewChange();}$.prototype._handleTodayPress=function(i){var j=new Date(),H1,I1=this.getViewKey();if(I1===J.OneMonth){H1=b.getFirstDateOfMonth(b._createUniversalUTCDate(j,undefined,true));this._oOneMonthInterval._adjustSelectedDate(c.fromLocalJSDate(j),false);j=b._createLocalDate(H1,true);}if(I1===J.Week){H1=this.getStartDate();j.setHours(H1.getHours());j.setMinutes(H1.getMinutes());j.setSeconds(H1.getSeconds());}this.setStartDate(j);this.fireStartDateChange();};$.prototype._handleStartDateChange=function(i){var j=i.oSource.getStartDate();if(this.getViewKey()!==V.Hour){var H1=this.getStartDate();j.setHours(H1.getHours());j.setMinutes(H1.getMinutes());j.setSeconds(H1.getSeconds());}this._changeStartDate(j);};$.prototype._handleCalendarSelect=function(i){var j=i.oSource.getSelectedDates();var H1=new Date(j[0].getStartDate());var I1=b._createUniversalUTCDate(H1,undefined,true);var J1=this.getViewKey();var K1=this._getView(J1);var L1=K1.getIntervalType();if(L1!==V.OneMonth||this._iSize>1){j[0].setStartDate();}switch(L1){case V.Hour:I1.setUTCHours(I1.getUTCHours()+1);break;case V.Day:case V.Week:I1.setUTCDate(I1.getUTCDate()+1);break;case V.OneMonth:if(this._iSize<2){var M1=new Date(H1.getTime());if(b.monthsDiffer(this.getStartDate(),H1)){this.setStartDate(H1);}this._setRowsStartDate(M1);this._oOneMonthInterval.getAggregation('month')[0]._focusDate(c.fromLocalJSDate(M1),true);}else if(b._isNextMonth(H1,this.getStartDate())){this._oOneMonthInterval._handleNext();return;}I1.setUTCDate(I1.getUTCDate()+1);break;case V.Month:I1.setUTCMonth(I1.getUTCMonth()+1);break;default:throw new Error("Unknown IntervalType: "+L1+"; "+this);}I1.setUTCMilliseconds(I1.getUTCMilliseconds()-1);I1=b._createLocalDate(I1,true);this.fireIntervalSelect({startDate:H1,endDate:I1,subInterval:false,row:undefined});};function i1(i){var j=i.getParameter("startDate");var H1=this.getViewKey();var I1=this._getView(H1);var J1=I1.getIntervalType();if(J1===V.OneMonth&&b._isNextMonth(j,this.getStartDate())){this._oOneMonthInterval._handleNext();return;}var K1=i.getParameter("endDate");var L1=i.getParameter("subInterval");var M1=t1(i.oSource.getParent());this.fireIntervalSelect({startDate:j,endDate:K1,subInterval:L1,row:M1});}$.prototype._applyContextualSettings=function(i){return C.prototype._applyContextualSettings.call(this,i||M._defaultContextualSettings);};$.prototype._getTableHeaderToolbar=function(){return this.getAggregation("table").getHeaderToolbar();};function j1(i,j){this.$().toggleClass("sapMPlanCalWithWeekNumbers",i&&j);}function k1(i,j){this.$().toggleClass("sapMPlanCalWithDayNamesLine",i&&j);}function l1(j,H1){if(j.size.width<=0){return;}if(Math.abs(this.iWidth-j.size.width)<15){return;}this.iWidth=j.size.width;this._applyContextualSettings({contextualWidth:this.iWidth});var I1=this.getRows();var J1;var i=0;var K1=this._iSize;y1.call(this,j.size.width);if(K1!=this._iSize){z1.call(this,this._iSize);var L1=this.getViewKey();var M1=this._getView(L1);var N1=M1.getIntervalType();var O1=this._getIntervals(M1);for(i=0;i<I1.length;i++){J1=I1[i];var P1=w1(J1);if(O1!=P1.getIntervals()){P1.setIntervals(O1);}else{P1.handleResize();}}switch(N1){case V.Hour:if(this._oTimeInterval&&this._oTimeInterval.getItems()!=O1){this._oTimeInterval.setItems(O1);}break;case V.Day:if(this._oDateInterval&&this._oDateInterval.getDays()!=O1){this._oDateInterval.setDays(O1);}break;case V.Month:if(this._oMonthInterval&&this._oMonthInterval.getMonths()!=O1){this._oMonthInterval.setMonths(O1);}break;case V.Week:if(this._oWeekInterval&&this._oWeekInterval.getDays()!=O1){this._oWeekInterval.setDays(O1);}break;case V.OneMonth:if(this._oOneMonthInterval&&this._oOneMonthInterval.getDays()!=O1){this._oOneMonthInterval.setDays(O1);if(this._iSize>1){this._setRowsStartDate(new Date(this.getStartDate().getTime()));}}break;default:throw new Error("Unknown IntervalType: "+N1+"; "+this);}E1.call(this);}else if(!H1){for(i=0;i<I1.length;i++){J1=I1[i];w1(J1).handleResize();}}if(this._oOneMonthInterval){this._oOneMonthInterval._setDisplayMode(this._iSize);}if(this.getStickyHeader()){this._updateStickyHeader();}}function m1(H1){var I1=H1.getParameter("appointment"),J1=H1.getParameter("multiSelect"),K1=H1.getParameter("appointments"),L1=H1.getParameter("domRefId"),M1,N1,O1,P1,Q1,i,j;if(!J1){N1=this.getRows();for(i=0;i<N1.length;i++){O1=N1[i];if(H1.oSource!=w1(O1)){P1=O1.getAppointments();for(j=0;j<P1.length;j++){Q1=P1[j];Q1.setSelected(false);}}}}M1={appointment:I1,appointments:K1,multiSelect:J1,domRefId:L1};this.fireAppointmentSelect(M1);}$.prototype._setRowsStartDate=function(j){var H1=this.getRows(),I1,i;for(i=0;i<H1.length;i++){I1=H1[i];w1(I1).setStartDate(j);}};$.prototype._toggleAppointmentsColumnPopinState=function(i){var j=this.getAggregation("table"),H1=j.getColumns()[1];H1.setDemandPopin(i);H1.setMinScreenWidth(i?b1:"");};$.prototype._getViews=function(){var i=this.getViews(),j=this.getBuiltInViews(),H1,I1=[],J1=J,K1=V;if(!this._oViews){this._oViews={};}if(j.length){I1=j;}else{I1=i.length?[]:c1;}H1=I1.map(function(M1){switch(M1){case J1.Hour:return this._oViews[J1.Hour]||(this._oViews[J1.Hour]=new sap.m.PlanningCalendarView(this.getId()+"-HourView",{key:J1.Hour,intervalType:K1.Hour,description:this._oRB.getText("PLANNINGCALENDAR_HOURS"),intervalsS:6,intervalsM:6,intervalsL:12}));case J1.Day:return this._oViews[J1.Day]||(this._oViews[J1.Day]=new sap.m.PlanningCalendarView(this.getId()+"-DayView",{key:J1.Day,intervalType:K1.Day,description:this._oRB.getText("PLANNINGCALENDAR_DAYS"),intervalsS:7,intervalsM:7,intervalsL:14}));case J1.Month:return this._oViews[J1.Month]||(this._oViews[J1.Month]=new sap.m.PlanningCalendarView(this.getId()+"-MonthView",{key:J1.Month,intervalType:K1.Month,description:this._oRB.getText("PLANNINGCALENDAR_MONTHS"),intervalsS:3,intervalsM:6,intervalsL:12}));case J1.Week:return this._oViews[J1.Week]||(this._oViews[J1.Week]=new sap.m.PlanningCalendarView(this.getId()+"-WeekView",{key:J1.Week,intervalType:K1.Week,description:this._oRB.getText("PLANNINGCALENDAR_WEEK"),intervalsS:7,intervalsM:7,intervalsL:7}));case J1.OneMonth:return this._oViews[J1.OneMonth]||(this._oViews[J1.OneMonth]=new sap.m.PlanningCalendarView(this.getId()+"-OneMonthView",{key:J1.OneMonth,intervalType:K1.OneMonth,description:this._oRB.getText("PLANNINGCALENDAR_ONE_MONTH"),intervalsS:1,intervalsM:1,intervalsL:31}));default:L.error("Cannot get PlanningCalendar views. Invalid view key "+M1);break;}},this);for(var L1 in this._oViews){if(I1.indexOf(L1)<0){this._oViews[L1].destroy();delete this._oViews[L1];}}if(i.length){H1=H1.concat(i);}return H1;};$.prototype.getSelectedAppointments=function(){var i=[];this.getRows().filter(function(j){i.push.apply(i,w1(j).aSelectedAppointments);});return i;};$.prototype.setCustomAppointmentsSorterCallback=function(i){if(typeof i==="function"||i===null||i===undefined){this.getRows().forEach(function(j){w1(j)._setCustomAppointmentsSorterCallback(i);});this._fnCustomSortedAppointments=i;}else{L.warning("Your custom sort function won't be used, but the old one will be preserved.",this);}return this;};$.prototype.getCustomAppointmentsSorterCallback=function(){return this._fnCustomSortedAppointments;};$.prototype._onRowDeselectAppointment=function(){var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=w1(H1[i]).aSelectedAppointments;for(var j=0;j<I1.length;j++){var J1=sap.ui.getCore().byId(I1[j]);if(J1){J1.setProperty("selected",false,true);J1.$().removeClass("sapUiCalendarAppSel");}}w1(H1[i]).aSelectedAppointments=[];}};$.prototype._updateRowTimeline=function(i){var j=w1(i),H1,I1,J1,K1;j.setNonWorkingDays(i.getNonWorkingDays());j.setNonWorkingHours(i.getNonWorkingHours());j.setStartDate(this.getStartDate());j.setShowIntervalHeaders(this.getShowIntervalHeaders());j.setShowEmptyIntervalHeaders(this.getShowEmptyIntervalHeaders());j.setGroupAppointmentsMode(this.getGroupAppointmentsMode());j.setAppointmentsReducedHeight(this.getAppointmentsReducedHeight());j.setLegend(this.getLegend());j.setAppointmentsVisualization(this.getAppointmentsVisualization());j.attachEvent("select",m1,this);j.attachEvent("startDateChange",this._handleStartDateChange,this);j.attachEvent("leaveRow",C1,this);j.attachEvent("intervalSelect",i1,this);D1.call(this);if(G1.call(this)){H1=this.getViewKey();I1=this._getView(H1);J1=I1.getIntervalType();K1=this._getIntervals(I1);j.setIntervalType(J1);j.setIntervals(K1);j.setShowSubIntervals(I1.getShowSubIntervals());}F1.call(this);if(this._fnCustomSortedAppointments){j._setCustomAppointmentsSorterCallback(this._fnCustomSortedAppointments);}};$.prototype._observeRowChanges=function(i){var j=u1(i),H1=v1(i),I1=w1(i);var J1={destroy:function(){j.destroy();},change:{title:function(K1){H1.setProperty(K1.name,K1.current);},icon:function(K1){H1.setProperty(K1.name,K1.current);},text:function(K1){I1.toggleStyleClass("sapMPlanCalRowLarge",!!K1.current);H1.setProperty("description",K1.current);},enableAppointmentsDragAndDrop:function(K1){this._enableAppointmentsDragAndDrop(i);}.bind(this),enableAppointmentsResize:function(K1){this._enableAppointmentsResize(i);}.bind(this),enableAppointmentsCreate:function(K1){this._enableAppointmentsCreate(i);}.bind(this),nonWorkingDays:function(K1){I1.setProperty(K1.name,K1.current);},nonWorkingHours:function(K1){I1.setProperty(K1.name,K1.current);},selected:function(K1){D1.call(this);j.setProperty(K1.name,K1.current);}.bind(this),intervalHeaders:function(K1){I1.invalidate();},appointments:function(K1){I1.invalidate();}}};new a(function(K1){if(K1.type==="destroy"){J1.destroy();}else if(J1.change[K1.name]){J1.change[K1.name](K1);}}).observe(i,{properties:["icon","text","title","nonWorkingDays","nonWorkingHours","selected","enableAppointmentsDragAndDrop","enableAppointmentsResize","enableAppointmentsCreate"],aggregations:["appointments","intervalHeaders"],destroy:true});i.invalidate=function(K1){if(!K1||!(K1 instanceof d)){E.prototype.invalidate.apply(this,arguments);}else if(j){I1.invalidate(K1);}};i.applyFocusInfo=function(K1){I1.applyFocusInfo(K1);return this;};};$.prototype._createPlanningCalendarListItem=function(i){var j,H1,I1;H1=new n1(i.getId()+"-Head",{icon:i.getIcon(),description:i.getText(),title:i.getTitle(),tooltip:i.getTooltip()});I1=new p1(i.getId()+"-CalRow",{checkResize:false,updateCurrentTime:false,ariaLabelledBy:H1.getId()});I1.getAppointments=function(){return i.getAppointments();};I1.getIntervalHeaders=function(){return i.getIntervalHeaders();};j=new r1(i.getId()+Z,{cells:[H1,I1]});this._updateRowTimeline(i);this._observeRowChanges(i);this._enableAppointmentsDragAndDrop(i);this._enableAppointmentsResize(i);this._enableAppointmentsCreate(i);return j;};$.prototype._handleRowRemoval=function(i){var j=w1(i);j.detachEvent("select",m1,this);j.detachEvent("startDateChange",this._handleStartDateChange,this);j.detachEvent("leaveRow",C1,this);j.detachEvent("intervalSelect",i1,this);if(this._fnCustomSortedAppointments){j._fnCustomSortedAppointments=undefined;}u1(i).destroy();};var n1=v.extend("PlanningCalendarRowHeader",{renderer:R.extend(w)});PlanningCalendarRowHeaderRenderer.openItemTag=function(i,j){i.write("<div");};PlanningCalendarRowHeaderRenderer.closeItemTag=function(i,j){i.write("</div>");};PlanningCalendarRowHeaderRenderer.renderTabIndex=function(i,j){};PlanningCalendarRowHeaderRenderer.getAriaRole=function(i,j){};var o1=R.extend(f);o1.getLegendItems=function(i){var j=[],H1,I1=i.getLegend();if(I1){H1=sap.ui.getCore().byId(I1);if(H1){j=H1.getAppointmentItems?H1.getAppointmentItems():H1.getItems();}else{L.error("PlanningCalendarLegend with id '"+I1+"' does not exist!",i);}}return j;};o1.renderBeforeAppointments=function(j,H1){var I1=t1(H1.getParent()),J1;if(!I1.getEnableAppointmentsDragAndDrop()&&!I1.getEnableAppointmentsResize()&&!I1.getEnableAppointmentsCreate()||H1._isOneMonthIntervalOnSmallSizes()){return;}J1=H1.getAggregation("_intervalPlaceholders");j.write("<div class=\"sapUiCalendarRowAppsOverlay\">");if(J1){for(var i=0;i<J1.length;i++){var K1=J1[i];K1.setWidth(100/J1.length+"%");j.renderControl(K1);}}j.write("</div>");};o1.renderResizeHandle=function(i,j,H1){if(!t1(j.getParent()).getEnableAppointmentsResize()||j._isOneMonthIntervalOnSmallSizes()||(H1._aAppointments&&H1._aAppointments.length>0)){return;}i.write("<span");i.addClass("sapUiCalendarAppResizeHandle");i.writeClasses();i.write(">");i.write("</span>");};o1.writeCustomAttributes=function(i,j){if(t1(j.getParent()).getEnableAppointmentsCreate()){i.writeAttribute("draggable","true");}};o1.renderInterval=function(j,H1,I1,J1,K1,L1,M1,N1,O1,P1,Q1,R1,S1){var T1=H1.getIntervalType();if(T1===V.Day||T1===V.Week||T1===V.OneMonth){var U1=t1(H1.getParent()),V1=U1.getParent(),W1=function(e2){return e2.getType()===A.NonWorking;},X1=U1.getSpecialDates().filter(W1),Y1=V1.getSpecialDates().filter(W1),Z1=H1.getStartDate(),$1,_1,a2,b2;if(Y1&&X1){$1=Y1.concat(X1);}else if(X1){$1=X1;}if($1&&$1.length){var c2=function(e2){return e2===_1.getDay();};_1=new Date(Z1.getTime());_1.setHours(0,0,0);_1.setDate(Z1.getDate()+I1);for(var i=0;i<$1.length;i++){if($1[i].getStartDate()){a2=new Date($1[i].getStartDate().getTime());}if($1[i].getEndDate()){b2=new Date($1[i].getEndDate().getTime());}else{b2=new Date($1[i].getStartDate().getTime());b2.setHours(23,59,59);}if(_1.getTime()>=a2.getTime()&&_1.getTime()<=b2.getTime()){var d2=L1.some(c2);if(!d2){j.addClass("sapUiCalendarRowAppsNoWork");}}}}}f.renderInterval(j,H1,I1,J1,K1,L1,M1,N1,O1,P1,Q1,R1,S1);};var p1=e.extend("PlanningCalendarRowTimeline",{metadata:{aggregations:{intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true},_intervalPlaceholders:{type:"IntervalPlaceholder",multiple:true,visibility:"hidden",dnd:{droppable:true}}},dnd:true},renderer:o1});p1.prototype._updatePlaceholders=function(){var j=this.getProperty("intervals");if(this.getIntervalType()===V.Hour){j*=2;}this.removeAllAggregation("_intervalPlaceholders");for(var i=0;i<j;i++){this.addAggregation("_intervalPlaceholders",new q1());}};p1.prototype.onBeforeRendering=function(){e.prototype.onBeforeRendering.call(this);this._updatePlaceholders();};p1.prototype.onmousedown=function(i){var j=i.target.classList;this._isResizeHandleMouseDownTarget=j.contains("sapUiCalendarAppResizeHandle");this._isRowAppsIntervalMouseDownTarget=j.contains("sapUiCalendarRowAppsInt");};p1.prototype._isResizingPerformed=function(){return this._isResizeHandleMouseDownTarget;};p1.prototype._isDraggingPerformed=function(){return!this._isResizeHandleMouseDownTarget&&!this._isRowAppsIntervalMouseDownTarget;};p1.prototype._isCreatingPerformed=function(){return this._isRowAppsIntervalMouseDownTarget;};var q1=C.extend("IntervalPlaceholder",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}}},renderer:function(i,j){i.write("<div");i.writeControlData(j);i.addStyle("width",j.getWidth());i.writeStyles();i.addClass("sapUiCalendarRowAppsPlaceholder");i.writeClasses();i.write("></div>");}});var r1=s.extend("sap.m.internal.PlanningCalendarRowListItem",{metadata:{library:"sap.m"},renderer:t});r1.prototype.getHeader=function(){return this.getCells()[0];};r1.prototype.getTimeline=function(){return this.getCells()[1];};r1.prototype.getCustomData=function(){return t1(this).getCustomData();};$.prototype._getSelectedDates=function(){var i=this.getViewKey(),j=this._getView(i),H1=j.getIntervalType(),I1=a1[H1];return this[I1.sInstanceName].getSelectedDates();};$.prototype._enableAppointmentsDragAndDrop=function(i){var j=w1(i),H1;if(i.getEnableAppointmentsDragAndDrop()){H1=i.getDragDropConfig().some(function(I1){return I1.getGroupName()===W;});if(!H1){this._addDragDropInfo(i,w1(i));}}else{i.getDragDropConfig().forEach(function(I1){if(I1.getGroupName()===W){i.removeDragDropConfig(I1);}});j.getDragDropConfig().forEach(function(I1){if(I1.getGroupName()===W){j.removeDragDropConfig(I1);}});}};$.prototype._enableAppointmentsResize=function(i){var j=i.getEnableAppointmentsResize(),H1=this._getConfigFromDragDropConfigAggregation(i.getAggregation("dragDropConfig"),X),I1=this._getResizeConfig(i);if(j&&!H1){i.addAggregation("dragDropConfig",I1,true);}if(!j){i.removeAggregation("dragDropConfig",H1,true);}};$.prototype._enableAppointmentsCreate=function(i){var j=i.getEnableAppointmentsCreate(),H1=w1(i),I1=this._getConfigFromDragDropConfigAggregation(H1.getAggregation("dragDropConfig"),Y),J1=this._getAppointmentsCreateConfig(i);if(j&&!I1){H1.addAggregation("dragDropConfig",J1,true);}if(!j){H1.removeAggregation("dragDropConfig",I1,true);}};$.prototype._addDragDropInfo=function(i,j){i.addDragDropConfig(new n({groupName:W,sourceAggregation:"appointments",dragStart:function(H1){var I1=function(){var J1=Q(".sapUiCalendarRowAppsOverlay");setTimeout(function(){J1.addClass("sapUiCalendarRowAppsOverlayDragging");},0);Q(document).one("dragend",function(){J1.removeClass("sapUiCalendarRowAppsOverlayDragging");});};if(j._isOneMonthIntervalOnSmallSizes()||!j._isDraggingPerformed()){H1.preventDefault();return;}I1();}}));j.addDragDropConfig(new o({groupName:W,targetAggregation:"_intervalPlaceholders",dragEnter:function(H1){var I1=H1.getParameter("dragSession"),J1=I1.getDragControl(),K1=j.getIntervalType(),L1=j.getStartDate(),M1=j.indexOfAggregation("_intervalPlaceholders",I1.getDropControl()),N1=j.getId(),O1,P1=function(){var R1=Q(I1.getIndicator()),S1=I1.getDropControl().getDomRef().getBoundingClientRect(),T1=sap.ui.getCore().byId(N1).getDomRef().getBoundingClientRect(),U1=I1.getDragControl().$().outerWidth(),V1=sap.ui.getCore().getConfiguration().getRTL(),W1=V1?Math.ceil(S1.right)-T1.left:T1.right-Math.ceil(S1.left);R1.css("min-width",(U1<W1)?U1:W1).css(V1?"border-left-width":"border-right-width",(U1>W1)?"0":"").css("margin-left",V1?-(R1.outerWidth()-parseFloat(R1.context.style.width)):"");};if(i.hasListeners("appointmentDragEnter")){if(K1===V.Hour){O1=this._calcNewHoursAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}else if(K1===V.Day||K1===V.Week||(K1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){O1=this._calcNewDaysAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}else if(K1===V.Month){O1=this._calcNewMonthsAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}var Q1=i.fireAppointmentDragEnter({appointment:J1,startDate:O1.startDate,endDate:O1.endDate,calendarRow:t1(j.getParent())});if(!Q1){H1.preventDefault();return;}}else if(w1(J1.getParent())!==j){H1.preventDefault();return;}if(j.getIntervalType()!==V.Hour){return;}if(!I1.getIndicator()){setTimeout(P1,0);}else{P1();}}.bind(this),drop:function(H1){var I1=H1.getParameter("dragSession"),J1=I1.getDragControl(),K1=j.getIntervalType(),L1=j.getStartDate(),M1=j.indexOfAggregation("_intervalPlaceholders",I1.getDropControl()),N1,O1=H1.getParameter("browserEvent"),P1=(O1.metaKey||O1.ctrlKey);if(K1===V.Hour){N1=this._calcNewHoursAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}else if(K1===V.Day||K1===V.Week||(K1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){N1=this._calcNewDaysAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}else if(K1===V.Month){N1=this._calcNewMonthsAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}j.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");if(J1.getStartDate().getTime()===N1.startDate.getTime()&&J1.getParent()===t1(j.getParent())){return;}i.fireAppointmentDrop({appointment:J1,startDate:N1.startDate,endDate:N1.endDate,calendarRow:t1(j.getParent()),copy:P1});}.bind(this)}));};$.prototype._calcNewHoursAppPos=function(i,j,H1,I1){var J1=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours());J1=new Date(J1.getTime()+(I1*30*60*1000));return{startDate:J1,endDate:new Date(J1.getTime()+H1.getTime()-j.getTime())};};$.prototype._calcNewDaysAppPos=function(i,j,H1,I1){var J1=new Date(i);J1.setDate(J1.getDate()+I1);J1=new Date(J1.getFullYear(),J1.getMonth(),J1.getDate(),j.getHours(),j.getMinutes(),j.getSeconds());return{startDate:J1,endDate:new Date(J1.getTime()+H1.getTime()-j.getTime())};};$.prototype._calcNewMonthsAppPos=function(i,j,H1,I1){var J1=new Date(i);J1.setMonth(J1.getMonth()+I1);J1=new Date(J1.getFullYear(),J1.getMonth(),j.getDate(),j.getHours(),j.getMinutes(),j.getSeconds());return{startDate:J1,endDate:new Date(J1.getTime()+H1.getTime()-j.getTime())};};$.prototype._getResizeConfig=function(i){var j=w1(i),H1=new p({sourceAggregation:"appointments",targetAggregation:"_intervalPlaceholders",targetElement:w1(i),dragStart:function(I1){if(!i.getEnableAppointmentsResize()||j._isOneMonthIntervalOnSmallSizes()||!j._isResizingPerformed()){I1.preventDefault();return;}var J1=I1.getParameter("dragSession"),K1=j.$().find(".sapUiCalendarRowAppsOverlay"),L1=Q(J1.getIndicator()),M1=J1.getDragControl().$();L1.addClass("sapUiDnDIndicatorHide");setTimeout(function(){K1.addClass("sapUiCalendarRowAppsOverlayDragging");},0);Q(document).one("dragend",function(){K1.removeClass("sapUiCalendarRowAppsOverlayDragging");L1.removeClass("sapUiDnDIndicatorHide");M1.css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});});if(!l.browser.msie&&!l.browser.edge){I1.getParameter("browserEvent").dataTransfer.setDragImage(s1(),0,0);}},dragEnter:function(I1){var J1=I1.getParameter("dragSession"),K1=this.getTargetElement(),L1=function(){var P1=Q(J1.getIndicator());P1.addClass("sapUiDnDIndicatorHide");},M1=J1.getDropControl().getDomRef().getBoundingClientRect(),N1=sap.ui.getCore().byId(K1).getDomRef().getBoundingClientRect(),O1={width:M1.left+M1.width-(J1.getDragControl().$().position().left+N1.left),"min-width":Math.min(J1.getDragControl().$().outerWidth(),J1.getDropControl().$().outerWidth()),"z-index":1,opacity:0.8};J1.getDragControl().$().css(O1);if(!J1.getIndicator()){setTimeout(L1,0);}else{L1();}},drop:function(I1){var j=w1(i),J1=I1.getParameter("dragSession"),K1=J1.getDragControl(),L1=j.getIntervalType(),M1=j.getStartDate(),N1=j.indexOfAggregation("_intervalPlaceholders",J1.getDropControl()),O1;if(L1===V.Hour){O1=this._calcResizeNewHoursAppPos(M1,K1.getStartDate(),K1.getEndDate(),N1);}else if(L1===V.Day||L1===V.Week||(L1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){O1=this._calcResizeNewDaysAppPos(M1,K1.getStartDate(),K1.getEndDate(),N1);}else if(L1===V.Month){O1=this._calcResizeNewMonthsAppPos(M1,K1.getStartDate(),K1.getEndDate(),N1);}j.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");Q(J1.getIndicator()).removeClass("sapUiDnDIndicatorHide");K1.$().css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});if(K1.getEndDate().getTime()===O1.endDate.getTime()){return;}i.fireAppointmentResize({appointment:K1,startDate:O1.startDate,endDate:O1.endDate,calendarRow:i});}.bind(this)});H1.setProperty("groupName",X);return H1;};$.prototype._calcResizeNewHoursAppPos=function(i,j,H1,I1){var J1=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()),K1=30*60*1000;J1=new Date(J1.getTime()+((I1+1)*K1));if(J1.getTime()<=j.getTime()){J1=new Date(j.getTime()+K1);}return{startDate:j,endDate:J1};};$.prototype._calcResizeNewDaysAppPos=function(i,j,H1,I1){var J1=new Date(i),K1=J1.getDate()+I1+1;if(K1<=j.getDate()){K1=j.getDate()+1;}J1.setDate(K1);J1=new Date(J1.getFullYear(),J1.getMonth(),J1.getDate());return{startDate:j,endDate:J1};};$.prototype._calcResizeNewMonthsAppPos=function(i,j,H1,I1){var J1=new Date(i),K1=J1.getMonth()+I1+1;if(K1<=j.getMonth()){K1=j.getMonth()+1;}J1.setMonth(K1);J1=new Date(J1.getFullYear(),J1.getMonth(),1);return{startDate:j,endDate:J1};};$.prototype._calcCreateNewAppHours=function(i,j,H1){var I1=30*60*1000,J1,K1;if(j<=H1){J1=new Date(i.getTime()+(j*I1));K1=new Date(i.getTime()+((H1+1)*I1));}else{J1=new Date(i.getTime()+(H1*I1));K1=new Date(i.getTime()+(j*I1));}return{startDate:J1,endDate:K1};};$.prototype._calcCreateNewAppDays=function(i,j,H1){var I1=new Date(i),J1=new Date(i);if(j<=H1){I1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+j);J1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+H1+1);}else{I1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+H1);J1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+j);}return{startDate:I1,endDate:J1};};$.prototype._calcCreateNewAppMonths=function(i,j,H1){var I1=new Date(i),J1=new Date(i);if(j<=H1){I1=new Date(i.getFullYear(),i.getMonth()+j,1);J1=new Date(i.getFullYear(),i.getMonth()+H1+1,1);}else{I1=new Date(i.getFullYear(),i.getMonth()+H1,1);J1=new Date(i.getFullYear(),i.getMonth()+j,1);}return{startDate:I1,endDate:J1};};$.prototype._getConfigFromDragDropConfigAggregation=function(j,H1){var I1=j,J1=I1&&I1.length;for(var i=0;i<J1;i++){if(I1[i].getGroupName()===H1){return I1[i];}}return null;};$.prototype._getAppointmentsCreateConfig=function(i){var j=w1(i),H1=new p({targetAggregation:"_intervalPlaceholders",dragStart:function(I1){if(!i.getEnableAppointmentsCreate()||j._isOneMonthIntervalOnSmallSizes()||!j._isCreatingPerformed()){I1.preventDefault();return;}var J1=I1.getParameter("dragSession"),K1=j.$().find(".sapUiCalendarRowAppsOverlay"),L1=Q(J1.getIndicator());setTimeout(function(){K1.addClass("sapUiCalendarRowAppsOverlayDragging");},0);Q(document).one("dragend",function(){K1.removeClass("sapUiCalendarRowAppsOverlayDragging");L1.html("");L1.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate");});if(!l.browser.msie&&!l.browser.edge){I1.getParameter("browserEvent").dataTransfer.setDragImage(s1(),0,0);}},dragEnter:function(I1){var J1=I1.getParameter("dragSession"),K1=J1.getDropControl().getDomRef().getBoundingClientRect(),L1=function(){var N1=Q(J1.getIndicator());N1.addClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate");};var M1=J1.getData("text")?parseFloat(J1.getData("text").split("|")[0]):0;if(M1){if(M1<=K1.left){J1.setIndicatorConfig({left:M1,width:Math.max((K1.left+K1.width-M1),K1.width)});}else{J1.setIndicatorConfig({left:K1.left,width:M1-K1.left});}}else{J1.setData("text",K1.left+"|"+j.indexOfAggregation("_intervalPlaceholders",J1.getDropControl()));}if(!J1.getIndicator()){setTimeout(L1,0);}else{L1();}},drop:function(I1){var J1=I1.getParameter("dragSession"),K1=Q(J1.getIndicator()),L1=j.getIntervalType(),M1=w1(i).getStartDate(),N1=parseInt(J1.getData("text").split("|")[1]),O1=j.indexOfAggregation("_intervalPlaceholders",J1.getDropControl()),P1;if(L1===V.Hour){P1=this._calcCreateNewAppHours(M1,N1,O1);}else if(L1===V.Day||L1===V.Week||(L1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){P1=this._calcCreateNewAppDays(M1,N1,O1);}else if(L1===V.Month){P1=this._calcCreateNewAppMonths(M1,N1,O1);}i.fireAppointmentCreate({startDate:P1.startDate,endDate:P1.endDate,calendarRow:i});K1.html("");K1.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate");}.bind(this)});H1.setProperty("groupName",Y);return H1;};function s1(){var i=Q("<span></span>").addClass("sapUiCalAppResizeGhost");i.appendTo(document.body);setTimeout(function(){i.remove();},0);return i.get(0);}function t1(i){var j=i.getId();return sap.ui.getCore().byId(j.substring(0,j.indexOf(Z)));}function u1(i){return sap.ui.getCore().byId(i.getId()+Z);}function v1(i){var j=u1(i);return j?j.getHeader():null;}function w1(i){var j=u1(i);return j?j.getTimeline():null;}function x1(j){var H1=[];var I1=this.getRows();for(var i=0;i<I1.length;i++){var J1=I1[i];var K1=u1(J1);var L1=K1.getSelected();if(J1.getSelected()!=L1){J1.setProperty("selected",L1,true);H1.push(J1);}}if(!this.getSingleSelection()){D1.call(this);}if(H1.length>0){this.fireRowSelectionChange({rows:H1});}}function y1(i){if(i<this._iBreakPointTablet){this._iSize=0;}else if(i<this._iBreakPointDesktop){this._iSize=1;}else{this._iSize=2;}if(i<d1.PHONE){this._iSizeScreen=0;}else if(i<d1.TABLET){this._iSizeScreen=1;}else{this._iSizeScreen=2;}}function z1(j){var H1='sapMSize'+j,I1=this.$(),i,J1;if(I1){for(i=0;i<3;i++){J1='sapMSize'+i;if(J1===H1){I1.addClass(J1);}else{I1.removeClass(J1);}}}}function A1(){var j=this._getViews();this._oIntervalTypeSelect.destroyItems();var i;var H1;for(i=0;i<j.length;i++){var I1=j[i];H1=new I(this.getId()+"-"+i,{key:I1.getKey(),text:I1.getDescription(),tooltip:I1.getTooltip()});this._oIntervalTypeSelect.addItem(H1);}this._oIntervalTypeSelect.setVisible(!(j.length===1));}function B1(i){var j=i.getParameter("selected");var H1=this.getRows();if(j){H1=this.getRows().filter(function(I1){return!I1.getSelected();});}this.selectAllRows(j);this.fireRowSelectionChange({rows:H1});}function C1(j){var H1=j.oSource;var I1=j.getParameter("type");var J1=this.getRows();var K1;var L1;var M1;var N1;var i=0;var O1=0;var P1;for(i=0;i<J1.length;i++){K1=J1[i];if(w1(K1)==H1){O1=i;break;}}switch(I1){case"sapup":M1=H1.getFocusedAppointment();N1=M1.getStartDate();if(O1>0){O1--;}L1=J1[O1];w1(L1).focusNearestAppointment(N1);break;case"sapdown":M1=H1.getFocusedAppointment();N1=M1.getStartDate();if(O1<J1.length-1){O1++;}L1=J1[O1];w1(L1).focusNearestAppointment(N1);break;case"saphome":if(O1>0){L1=J1[0];P1=new Q.Event(I1);P1._bPlanningCalendar=true;w1(L1).onsaphome(P1);}break;case"sapend":if(O1<J1.length-1){L1=J1[J1.length-1];P1=new Q.Event(I1);P1._bPlanningCalendar=true;w1(L1).onsapend(P1);}break;default:break;}}function D1(){if(this._oSelectAllCheckBox){var i=this.getRows();var j=this.getSelectedRows();if(i.length==j.length&&j.length>0){this._oSelectAllCheckBox.setSelected(true);}else{this._oSelectAllCheckBox.setSelected(false);}}}function E1(){if(this.getSingleSelection()){if(this._oCalendarHeader.getAllCheckBox()){this._oCalendarHeader.setAllCheckBox();}else if(this._oInfoToolbar.getContent().length>2){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox);}}else{if(!this._oSelectAllCheckBox){this._oSelectAllCheckBox=new sap.m.CheckBox(this.getId()+"-All",{text:this._oRB.getText("COLUMNSPANEL_SELECT_ALL")});this._oSelectAllCheckBox.attachEvent("select",B1,this);}if(this._iSizeScreen<2||!this.getShowRowHeaders()){var i=this._oInfoToolbar.indexOfContent(this._oSelectAllCheckBox);if(this._iSizeScreen<2){if(i<this._oInfoToolbar.getContent().length-1){this._oInfoToolbar.addContent(this._oSelectAllCheckBox);}}else if(i<0||i>1){if(i>1){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox);}this._oInfoToolbar.insertContent(this._oSelectAllCheckBox,1);}}else{this._oCalendarHeader.setAllCheckBox(this._oSelectAllCheckBox);}}}function F1(){var i=this.getAggregation("table");var j=i.getMode();var H1;if(this.getSingleSelection()){if(!this.getShowRowHeaders()&&this.getRows().length==1){H1=F.None;}else{H1=F.SingleSelectMaster;}}else{H1=F.MultiSelect;}if(j!=H1){i.setMode(H1);}}function G1(){return this._oTimeInterval||this._oDateInterval||this._oMonthInterval||this._oWeekInterval||this._oOneMonthInterval;}return $;});
