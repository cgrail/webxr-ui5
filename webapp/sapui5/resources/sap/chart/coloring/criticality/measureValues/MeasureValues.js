sap.ui.define(['sap/chart/coloring/ColoringUtils','sap/chart/coloring/ColorPalette','sap/chart/coloring/criticality/measureValues/MeasureUtils','sap/chart/ChartLog','sap/chart/data/MeasureSemantics',"sap/ui/thirdparty/jquery"],function(C,a,M,b,c,q){"use strict";var d={};var S=["Static","Calculated","DynamicThresholds","ConstantThresholds"];function e(t,T,m,D,A,h,o,j){var r={supportMultiMsr:false,supportHeatMap:false};var k=A.length>1;if(M[t].validate){q.extend(r,M[t].validate(h,m,D,T,j));}if(k&&!r.supportMultiMsr){throw new b('error','Colorings.Criticality','Only support multiple active measures when using Static Criticality.');}if(o.bMBC&&!r.supportHeatMap){throw new b('error','Colorings','Heatmap only support Criticality.MeasureValues.ConstantThresholds.');}}var v=function(h,t,D,A,o){var V=D.aMsr;C.checkColoringMeasure(A,V,h);var j=[];A.forEach(function(m,k){var l=Object.keys(h[m]).filter(function(p){return S.indexOf(p)>-1;}).sort();var n=i(l);if(l.length>1&&!n){throw new b('error','Colorings.Criticality.MeasureValues','The combination of "DynamicThresholds"and "ConstantThresholds" or only one of "Static", "Calculated", "DynamicThresholds", or "ConstantThresholds" can be applied to the measure, '+m+'.');}if(!n&&l.length===1){e(l[0],t,m,D,A,h,o,j);}});if(C.hasSeriesDim(D)||(o.bTimeChart&&o.bWaterfall&&D.aDim.length>1)||(o.bIsPie&&D.aDim.length)){throw new b('error','colorings.Criticality.MeasureValues','Semantic coloring could not be applied if chart already has coloring.');}};function i(t){return t.length===2&&t[0]=="ConstantThresholds"&&t[1]==="DynamicThresholds";}function f(h,m){var o=h.filter(function(j){return j.msr.getName()===m;})[0];return o;}function g(h,t,m){if(h.sMethod==='Static'){var E=[];t.forEach(function(T){q.each(c,function(j,k){var s=T[k];if(s){var o=f(h,T[k]);if(!o){q.each(c,function(l,n){if(k!==n){var p=f(h,T[n]);if(p){var r=m.filter(function(r){return r.getName()===s;})[0];var u={msr:r,settings:{Static:p.settings.Static},type:'Static'};E.push(u);}}});}else{T.criticalityType=o.settings.Static;}}});});h.push.apply(h,E);}}d.qualify=function(o,t,A,D,s,h){v(o,t,D,A,h);var j=[],m=[],k=D.aDim.map(function(l){return l.getName();}).sort();q.each(o,function(l,n){var p=Object.keys(n);var r=C.find(l,D.aMsr);var E=p.filter(function(F){return F!=="Legend";}).sort();if(A.length&&A.indexOf(l)===-1){return;}var w=false,K;for(var x=0;x<E.length&&!w;x++){K=E[x];j.sMethod=K;if(K==="ConstantThresholds"){var y=null,G=null;for(var z=0;z<n[K].AggregationLevels.length;z++){if(n[K].AggregationLevels[z].VisibleDimensions){var B=n[K].AggregationLevels[z].VisibleDimensions.sort();if(B.join(",")===k.join(",")){y=n[K].AggregationLevels[z];}}else{G=n[K].AggregationLevels[z];}}y=y||G;if(y){w=true;if(!h.bFiltered){j.push({type:K,msr:r,settings:n,byAggregation:y});m.push(r.getName());}}}else{w=true;j.push({type:K,msr:r,settings:n});m.push(r.getName());}}if(!w){throw new b("error",'Colorings.Criticality.MeasureValues.ConstantThresholds',"No aggregation levels matched with current visible dimensions.");}if(i(E)){e(K,t,r.getName(),D,A,o,h);}});g(j,t,D.aMsr);if(j.length){var u=0;t.forEach(function(T){var l=false;q.each(c,function(n,p){if(m.indexOf(T[p])>-1){l=true;return false;}});if(!l){T.iUnMentionedIndex=u++;}});if(u>3){throw new b("error",'Colorings.Criticality.MeasureValues',"Too many unmentioned measures (the maximum number is 3).");}}j.bShowUnmentionedMsr=h.bShowUnmentionedMsr;return j;};d.parse=function(o,D,s,O,l){var m=O.bMBC,h={aMsrs:D.aMsr,aDims:D.aDim,oStatus:s},p={msr:o.msr,callbacks:{},additionalDimensions:[],legend:{}};M[o.type].parse(o,h,p,m,l);return p;};d.getContextHandler=function(s,h,m,l){if(M[s].getContextHandler){return M[s].getContextHandler(h,m,l);}else{return null;}};return d;});
