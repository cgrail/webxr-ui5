/*
 * SAPUI5

(c) Copyright 2009-2019 SAP SE. All rights reserved
 */
sap.ui.define(['sap/chart/coloring/criticality/measureValues/MeasureValues','sap/chart/coloring/criticality/DimensionValues','sap/chart/coloring/ColoringUtils','sap/chart/coloring/ColorPalette','sap/chart/coloring/CriticalityType','sap/chart/data/MeasureSemantics',"sap/ui/thirdparty/jquery"],function(M,D,C,a,b,c,q){"use strict";var t=q.type;var S=['DimensionValues','MeasureValues'];var m=[b.Positive,b.Neutral,b.Critical,b.Negative,'Unmentioned'];var d=[b.Positive,b.Critical,b.Negative,b.Neutral];function e(i,l){var r=[];l.forEach(function(s){i.forEach(function(o){if(o.chartLog){throw o.chartLog;}var k=o.parsed.callbacks[s]||[];k.forEach(function(n,p){var u,v;if(s==="Unmentioned"){u=C.assignUnmentionedColor(a.CRITICALITY.Neutral,k.length);v=o.parsed.legend[p];}else{u=C.assignColor(a.CRITICALITY[s],k.length);var L=o.parsed.legend[s];v=(t(L)==="array")?L[p]:L;}var R={callback:n,properties:{color:u[p]},displayName:v};r.push(R);});});});return r;}function f(i){var o=i[0];var l=o.parsed.legend;var p=[],B=[];var n=l.segments[0].upperBound>l.min;var N=(l.segments.length<2)||(l.segments[l.segments.length-2].upperBound<l.max);l.segments.forEach(function(s){var r=C.assignColor(a.CRITICALITY[s.CriticalityType],1)[0];p.push(r);B.push(s.upperBound);});if(n){B=[l.min].concat(B);}else{p.splice(0,1);}if(N){B[B.length-1]=l.max;}else{p.splice(p.length-1,1);B.splice(B.length-1,1);}var k=p.length;if(p.length===1){p=[p[0],p[0]];k=2;}else if(p.length===0){return null;}return{feed:"color",palette:p,numOfSegments:k,legendValues:B};}function g(i){var l;if(i&&i.legendTitle){l={title:{text:i.legendTitle,visible:true}};}return l;}function h(i,l){return function(){var k,p;if(i.bMBC){k=f(i);}else{var r=e(i,l);p={plotArea:{dataPointStyle:{rules:r}},legend:g(i)};}return{colorScale:k,properties:p};};}function j(T,i){var s=[c.Actual,c.Projected,c.Reference];var m=[b.Positive,b.Neutral,b.Critical,b.Negative];var k=[];var n=[];var l=false;T.forEach(function(o){var p=false;var r=[];o.order=[];if(o.criticalityType){l=true;}s.forEach(function(u){if(o[u]){var v=i.filter(function(w){return o[u]===w.msr.getName();})[0];if(v){p=true;o.order.push(u);}else{r.push(u);}}});o.order=o.order.concat(r);if(p){k.push(o);}else{n.push(o);}});if(l){k.sort(function(o,p){return m.indexOf(o.criticalityType)-m.indexOf(p.criticalityType);});}T.splice(0,T.length);T.push.apply(T,k.concat(n));}return{getCandidateSetting:function(o,A,T,k,s,l,L){var n=o.Criticality||{},p=A.parameters||{};var u=C.dimOrMsrUse(n,p,S,'Criticality');var r={additionalMeasures:[],additionalDimensions:[]};var v=l.bMBC,Q,P,w;switch(u){case'DimensionValues':var x=p.dimension||Object.keys(n.DimensionValues);if(t(x)==='string'){x=[x];}Q=D.qualify(n.DimensionValues,x,k,l);if(Q){r.qualifiedSettings=Q;Q.parsed=D.parse(Q,k.aDim,s,L,l);r.contextHandler=D.getContextHandler(Q,L,l);r.ruleGenerator=h([Q],d);}break;case'MeasureValues':var y=p.measure||Object.keys(n.MeasureValues);if(t(y)==='string'){y=[y];}Q=M.qualify(n.MeasureValues,T,y,k,s,l);if(Q.sMethod){q.each(Q,function(i,z){P=M.parse(z,k,s,l,L);q.each(P.additionalMeasures,function(i,B){r.additionalMeasures.push(B);});q.each(P.additionalDimensions,function(i,B){r.additionalDimensions.push(B);});z.parsed=P;if(z.settings.Legend&&z.settings.Legend.Title){Q.legendTitle=z.settings.Legend.Title;}});w=Q.sMethod;r.contextHandler=M.getContextHandler(w,Q,v,L);r.qualifiedSettings=Q;r.ruleGenerator=h(Q,m);Q.bMBC=v;j(T,Q);}break;default:return{};}if(Q.length){r.subType=u;}return r;},getLegendProps:g};});
