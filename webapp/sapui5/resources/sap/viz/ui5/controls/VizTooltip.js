/*!
 * SAPUI5

(c) Copyright 2009-2019 SAP SE. All rights reserved
 */
sap.ui.define(['./common/BaseControl','./charttooltip/TooltipContainer','sap/ui/core/Popup','./common/utils/FormatDataUtil',"sap/ui/thirdparty/jquery"],function(B,T,P,F,q){"use strict";var V=B.extend("sap.viz.ui5.controls.VizTooltip",{metadata:{library:"sap.viz",properties:{formatString:{type:"any",defaultValue:null}}},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.writeClasses();r.writeStyles();r.write('>');r.write('</div>');}});V.prototype.init=function(){B.prototype.init.apply(this,arguments);this._uid=null;this._oTooltipContainer=null;this._oPopup=null;};V.prototype.exit=function(){B.prototype.exit.apply(this,arguments);var v=sap.ui.getCore().byId(this._uid);if(v){if(v._vizFrame){v._vizFrame.off('showInstantTooltip');v._vizFrame.off('hideInstantTooltip');var c=v._onConnectPopover()||{};if(c.ref===this){v._onConnectPopover(null);}}else{v._onConnectPopover(q.proxy(function(e){if(!v._vizFrame){return;}v._vizFrame.off('showInstantTooltip');v._vizFrame.off('hideInstantTooltip');},this));}}if(this._oPopup){this._oPopup.destroy();this._oPopup=null;}if(this._oTooltipContainer){this._oTooltipContainer.destroy();this._oTooltipContainer=null;}this._uid=null;};V.prototype.connect=function(u){this._uid=u;if(!this._oPopup){this._createTooltip();}var v=sap.ui.getCore().byId(this._uid);var a=v.getUiConfig();if(!a||a.applicationSet!=='fiori'){return;}var t=this;function c(){if(!v._vizFrame){return;}t._chartType=v._vizFrame.type();v._vizFrame.off('showTooltip');v._vizFrame.off('hideTooltip');v._vizFrame.on('showInstantTooltip',function(e){t._prepareTooltip(e.data);t._oPopup.close(0);t._oPopup.open(0);});v._vizFrame.on('hideInstantTooltip',function(){t._oPopup.close(0);});}c.ref=this;if(v._vizFrame){c();}v._onConnectPopover(c);};V.prototype._createTooltip=function(d){this._oTooltipContainer=new T();this._oPopup=new P();this._oPopup.setContent(this._oTooltipContainer);this._oPopup.setShadow(false);};V.prototype._prepareTooltip=function(d){var c={formatString:this.getFormatString(),chartType:this._chartType,mode:"tooltip"};var f=F.formatData(d,c);this._oTooltipContainer.setContent(f);var m=P.Dock.CenterBottom;var a=P.Dock.LeftTop;var x=d.point.x;var p=10;var y=d.point.y;var o=0+" "+(-p);var b=document.createEvent('MouseEvents');b.initMouseEvent("mousemove",true,true,window,0,0,0,x,y,false,false,false,false,0,null);b=q.event.fix(b);this._oPopup.setPosition(m,a,b,o,"flipfit");};V.prototype.addStyleClass=function(){this._oTooltipContainer.addStyleClass.apply(this._oTooltipContainer,arguments);};V.prototype.removeStyleClass=function(){this._oTooltipContainer.removeStyleClass.apply(this._oTooltipContainer,arguments);};return V;});
