/*!
 * SAPUI5

(c) Copyright 2009-2019 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/core/theming/Parameters','sap/viz/library','sap/viz/libs/sap-viz','./BaseStructuredType','./BaseChartMetadata',"sap/ui/thirdparty/jquery","sap/base/util/each"],function(C,P,l,s,B,a,q,e){"use strict";var b=C.extend("sap.viz.ui5.core.BaseChart",{metadata:{"abstract":true,library:"sap.viz",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'640px'},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'480px'},css:{type:"string",group:"Appearance",defaultValue:null}},aggregations:{dataset:{type:"sap.viz.ui5.data.Dataset",multiple:false},noData:{type:"sap.ui.core.Control",multiple:false}},events:{beforeCreateViz:{parameters:{usrOptions:{type:"object"}}}}}},a);b.prototype.getVIZChartType=function(){return this.getMetadata().getVIZChartType();};b.prototype._getSapVizCSS=function(){var c,d,f;var L=window.document.getElementById("sap-ui-theme-sap.viz");if(L){d=L.href;c=q.sap.syncGetText(d+"?",undefined,undefined);if(!c){c="";}}if(this.getCss()){f=c+this.getCss();}return f;};b.prototype._getMergedChartOptions=function(){var u=this._getOptions();var g=P.get('sapVizChartAxisGridlineColor');var c=P.get('sapVizChartAxisColor');var d={xAxis:{gridline:{color:g}},yAxis:{gridline:{color:g}}};var f=this.getVIZChartType();switch(f){case"viz/dual_bar":d.yAxis.color=c;break;case"viz/dual_combination":case"viz/dual_line":case"viz/dual_stacked_column":case"viz/100_dual_stacked_column":case"viz/dual_column":d.xAxis.color=c;break;default:d.xAxis.color=c;d.yAxis.color=c;break;}return q.extend(true,d,u);};b.prototype._unregisterListener=function(){if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);delete this._sResizeListenerId;}};b.prototype._registerListener=function(){this._sResizeListenerId=sap.ui.core.ResizeHandler.register(this.getDomRef(),q.proxy(this.onresize,this));};b.prototype._renderChart=function(){if(!sap.viz.__svg_support||!this.getDataset()||!this.getDataset().getVIZDataset()){return;}if(this._oVIZInstance){this._oVIZInstance.destroy();delete this._oVIZInstance;}var c=this._getSapVizCSS();var d=this._getMergedChartOptions();var u={type:this.getVIZChartType(),data:this.getDataset().getVIZDataset(),container:this.getDomRef(),options:d,css:c};this.fireBeforeCreateViz({usrOptions:u});this._oVIZInstance=sap.viz.core.createViz(u);var t=this;e(this._mVIZHandler,function(n,h){t._oVIZInstance.on(n+b.EVENT_SUFFIX,h);});};b.prototype.init=function(){sap.viz._initializeVIZ();this._mVIZHandler={};};b.prototype.exit=function(){this._unregisterListener();if(this._oVIZInstance){this._oVIZInstance.destroy();delete this._oVIZInstance;}};b.prototype.onBeforeRendering=function(){this._unregisterListener();};b.prototype.onAfterRendering=function(){this._renderChart();this._registerListener();};b.prototype.onresize=function(o){var c={width:this.$().width(),height:this.$().height()};if(this.getDomRef()&&this._oVIZInstance){this._oVIZInstance.size(c);}};b.prototype.setDefaultSelection=function(c){var d=this.getDataset();if(d){var v=d.getVIZDataset();if(v){v.info({'type':'defaultSelection','value':c});if(this._oVIZInstance){this._oVIZInstance.data(v);}}}};b.prototype.onThemeChanged=function(o){if(!this.getDomRef()){return;}this._renderChart();};b.prototype.onLocalizationChanged=function(o){if(!this.getDomRef()){return;}this._renderChart();};b.prototype.validateAggregation=function(A,o,m){if(A==="interaction"){o=B._convertAggregatedObject.call(this,A,o,m);}return C.prototype.validateAggregation.call(this,A,o,m);};b.EVENT_SUFFIX=".sap.viz.ui5.core";b.prototype._getOrCreate=B.prototype._getOrCreate;b.prototype._getOptions=B.prototype._getOptions;b.prototype._attachVIZEvent=function(n,d,h,L){var t=this;if(!this.hasListeners(n)){this._mVIZHandler[n]=function(o){t.fireEvent(n,o);};if(this._oVIZInstance){this._oVIZInstance.on(n+b.EVENT_SUFFIX,this._mVIZHandler[n]);}}C.prototype.attachEvent.apply(this,arguments);return this;};b.prototype._detachVIZEvent=function(n,d,h,L){C.prototype.detachEvent.apply(this,arguments);if(!this.hasListeners(n)){if(this._oVIZInstance){this._oVIZInstance.on(n+b.EVENT_SUFFIX,null);}delete this._mVIZHandler[n];}return this;};b.prototype.getVIZInstance=function(){return this._oVIZInstance||null;};b.prototype.selection=function(c,o){if(this._oVIZInstance){return this._oVIZInstance.selection.apply(this._oVIZInstance,arguments);}};return b;});
