/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/Base"],function(F,B){"use strict";var S={};S.applyChange=function(c,C,p){var o=c.getDefinition();var m=p.modifier;var A=p.appComponent;var v=p.view;var s=m.bySelector(o.content.sourceSelector,A,v);var l;var N;var d;var L;var f=function(a,b){if(a.index>b.index){return 1;}else if(a.index<b.index){return-1;}};var P=m.bySelector(o.content.parentSelector,A,v);var e=o.content.newElementIds.slice();var g=m.getAggregation(s,"elements");var h=m.getProperty(s,"elementForLabel");var G=m.getAggregation(P,"groupElements");var j=G.indexOf(s);L=m.getProperty(s,"label");if(L&&(typeof L!=="string")){l=m.getProperty(L,"text");}else{l=L;}var k=[];for(var i=0,n=g.length;i<n;i++){if(i!==h){N=e.pop();d=m.createControl("sap.ui.comp.smartform.GroupElement",p.appComponent,v,N);k.push({groupElementSelector:m.getSelector(d,A),index:i});m.removeAggregation(s,"elements",g[i]);m.insertAggregation(d,"elements",g[i],0,v);m.insertAggregation(P,"groupElements",d,j+i,v);L=m.getProperty(d,"label");if(L&&(typeof L!=="string")){m.setProperty(L,"text",l);}else{m.setProperty(d,"label",l);}}else{k.push({groupElementSelector:m.getSelector(s,A),index:i});if(h!==0){m.setProperty(s,"elementForLabel",0);}m.removeAggregation(s,"elements",g[i]);m.insertAggregation(s,"elements",g[i],0,v);L=m.getProperty(s,"label");if(L&&(typeof L!=="string")){m.setProperty(L,"text",l);}else{m.setProperty(s,"label",l);}}}c.setRevertData({sourceControlSelector:o.content.sourceSelector,labelText:l,splittedFields:k.sort(f)});return true;};S.completeChangeContent=function(c,s,p){var m=p.modifier;var a=p.appComponent;var C=c.getDefinition();if(s.newElementIds){C.content.newElementIds=s.newElementIds;}else{throw new Error("oSpecificChangeInfo.newElementIds attribute required");}if(s.sourceControlId){C.content.sourceSelector=m.getSelector(s.sourceControlId,a);c.addDependentControl(s.sourceControlId,"sourceControl",p);}else{throw new Error("oSpecificChangeInfo.sourceControlId attribute required");}if(s.parentId){C.content.parentSelector=m.getSelector(s.parentId,a);c.addDependentControl(s.parentId,"parent",p);}else{throw new Error("oSpecificChangeInfo.parentId attribute required");}};S.revertChange=function(c,C,p){var v=p.view;var m=p.modifier;var a=p.appComponent;var r=c.getRevertData();var s=r.splittedFields;var o=m.bySelector(r.sourceControlSelector,a,v);var g,f;for(var i=0,n=s.length;i<n;i++){g=m.bySelector(s[i].groupElementSelector,a,v);f=m.getAggregation(g,"elements")[0];m.removeAggregation(g,"elements",f);m.insertAggregation(o,"elements",f,s[i].index,v);if(g!==o){m.destroy(g);}}var l=m.getProperty(o,"label");if(l&&(typeof l!=="string")){m.setProperty(l,"text",r.labelText);}else{m.setProperty(o,"label",r.labelText);}c.resetRevertData();return true;};return S;},true);
