/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/Base","sap/ui/core/util/reflection/JsControlTreeModifier"],function(U,B,J){"use strict";var A={};A.applyChange=function(c,g,p){var C=c.getDefinition();var f=function(C){var d=C.content;var M=false;if(d){M=C.content.field&&(C.content.field.selector||C.content.field.id)&&C.content.field.jsTypes&&C.content.field.value&&C.content.field.valueProperty;}return d&&M;};var m=p.modifier;var a=p.appComponent;var v=p.view;if(f(C)){var F=C.content.field.selector;var s=C.content.field.id;var b=C.content.field.index;var G;if(m.bySelector(F||s,a,v)){return B.markAsNotApplicable("Control to be created already exists:"+F||s);}G=m.createControl("sap.ui.comp.smartform.GroupElement",a,v,F||s);if(!F){F=m.getSelector(s,a);}c.setRevertData({newFieldSelector:F});for(var i=0;i<C.content.field.jsTypes.length;i++){var j=C.content.field.jsTypes[i];var P=C.content.field.valueProperty[i];var o=C.content.field.value[i];var e=C.content.field.entitySet;this.addElementIntoGroupElement(m,v,G,j,P,o,e,i,a);}m.insertAggregation(g,"groupElements",G,b);return true;}else{U.log.error("Change does not contain sufficient information to be applied: ["+C.layer+"]"+C.namespace+"/"+C.fileName+"."+C.fileType);}};A.addElementIntoGroupElement=function(m,v,g,j,p,P,e,i,a){var V;try{V=m.createControl(j,a,v);}catch(E){return B.markAsNotApplicable(E&&E.message||"Control couldn't be created");}m.bindProperty(V,p,P);m.setProperty(V,"expandNavigationProperties",true);m.insertAggregation(g,"elements",V,i,v,true);if(e){m.setProperty(V,"entitySet",e);}};A.completeChangeContent=function(c,s,p){var a=p.appComponent;var C=c.getDefinition();if(!C.content){C.content={};}if(!C.content.field){C.content.field={};}if(s.fieldValues){C.content.field.value=s.fieldValues;}else if(s.bindingPath){C.content.field.value=[s.bindingPath];}else{throw new Error("oSpecificChangeInfo.fieldValue or bindingPath attribute required");}if(s.valueProperty){C.content.field.valueProperty=s.valueProperty;}else if(s.bindingPath){C.content.field.valueProperty=["value"];}else{throw new Error("oSpecificChangeInfo.valueProperty or bindingPath attribute required");}if(s.newControlId){C.content.field.selector=J.getSelector(s.newControlId,a);}else{throw new Error("oSpecificChangeInfo.newControlId attribute required");}if(s.jsTypes){C.content.field.jsTypes=s.jsTypes;}else if(s.bindingPath){C.content.field.jsTypes=["sap.ui.comp.smartfield.SmartField"];}else{throw new Error("oSpecificChangeInfo.jsTypes or bindingPath attribute required");}if(s.index===undefined){throw new Error("oSpecificChangeInfo.index attribute required");}else{C.content.field.index=s.index;}if(s.entitySet){C.content.field.entitySet=s.entitySet;}};A.revertChange=function(c,g,p){var a=p.appComponent;var v=p.view;var m=p.modifier;var f=c.getRevertData().newFieldSelector;var G=m.bySelector(f,a,v);m.removeAggregation(g,"groupElements",G);m.destroy(G);c.resetRevertData();return true;};return A;},true);
