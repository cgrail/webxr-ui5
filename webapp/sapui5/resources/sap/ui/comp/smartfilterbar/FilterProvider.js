/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery",'sap/m/DateTimePicker','sap/m/Select','sap/ui/core/Item','sap/m/ComboBox','sap/m/DatePicker','sap/m/DateRangeSelection','sap/m/TimePicker','sap/m/Input','sap/m/MultiComboBox','sap/m/MultiInput','sap/m/SearchField','sap/m/Token','sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/providers/ValueHelpProvider','sap/ui/comp/providers/ValueListProvider','sap/ui/model/Filter','sap/ui/model/json/JSONModel','sap/ui/comp/odata/ODataType','sap/ui/comp/util/FormatUtil','sap/ui/base/EventProvider','sap/ui/comp/util/IdentifierUtil','sap/ui/comp/providers/TokenParser','sap/ui/core/format/DateFormat','sap/ui/comp/library','sap/ui/core/library','sap/ui/model/analytics/odata4analytics','sap/ui/model/FilterOperator',"sap/base/Log","sap/base/util/UriParameters","sap/base/security/encodeURL"],function(q,D,S,I,C,a,b,T,c,M,d,f,g,h,V,l,F,J,O,m,E,o,p,r,s,t,u,v,L,U,w){"use strict";var x=s.smartfilterbar.ControlType;var y=s.smartfilterbar.DisplayBehaviour;var z=s.smartfilterbar.FilterType;var A=t.ValueState;var B=s.valuehelpdialog.ValueHelpRangeOperation;var G=s.smartfilterbar.MandatoryType;var H=function(P){if(!l){l=sap.ui.require("sap/ui/comp/providers/ValueListProvider");}if(!V){V=sap.ui.require("sap/ui/comp/providers/ValueHelpProvider");}this._bInitialized=false;this._bPending=true;this._bConsiderAnalyticalParameters=false;this._bAttachInitializedDone=false;this._sDeferredGroupId;if(P){this._oParentODataModel=P.model;this._sServiceURL=P.serviceUrl;this._sBasicSearchFieldName=P.basicSearchFieldName;this._isBasicSearchEnabled=P.enableBasicSearch;this._bUseContainsAsDefault=P.useContainsAsDefaultFilter==="true";this.sEntityType=P.entityType;this.sEntitySet=P.entitySet;this._isRunningInValueHelpDialog=P.isRunningInValueHelpDialog;this._oAdditionalConfiguration=P.additionalConfiguration;this.sDefaultDropDownDisplayBehaviour=P.defaultDropDownDisplayBehaviour;this.sDefaultTokenDisplayBehaviour=P.defaultTokenDisplayBehaviour;if(typeof P.dateFormatSettings==="string"){try{this._oDateFormatSettings=P.dateFormatSettings?JSON.parse(P.dateFormatSettings):undefined;}catch(e){}}else{this._oDateFormatSettings=P.dateFormatSettings;}if(!this._oDateFormatSettings){this._oDateFormatSettings={};}if(!this._oDateFormatSettings.hasOwnProperty("UTC")){this._oDateFormatSettings["UTC"]=true;}this._oSmartFilter=P.smartFilter;this._bConsiderAnalyticalParameters=P.considerAnalyticalParameters;this._bUseDateRangeType=P.useDateRangeType;this._bConsiderSelectionVariants=P.considerSelectionVariants;this._aConsiderNavigations=P.considerNavigations;}this.sFilterModelName=H.FILTER_MODEL_NAME;this._sBasicFilterAreaID=H.BASIC_FILTER_AREA_ID;this._aAnalyticalParameters=[];this._aFilterBarViewMetadata=[];this._aFilterBarFieldNames=[];this._aFilterBarMultiValueFieldMetadata=[];this._aFilterBarStringDateFieldNames=[];this._aFilterBarDateFieldNames=[];this._aFilterBarTimeFieldNames=[];this._aFilterBarTimeIntervalFieldNames=[];this._aFilterBarDateTimeMultiValueFieldNames=[];this._aFilterBarStringFieldNames=[];this._aFilterBarDateTimeFieldNames=[];this._aFieldGroupAnnotation=[];this._oMetadataAnalyser=new h(this._oParentODataModel||this._sServiceURL);this.oModel=new J();this._aValueListProvider=[];this._aValueHelpDialogProvider=[];this._mTokenHandler={};this._mConditionTypeFields={};this._aSelectionVariants=[];this._oParameterization=null;this._oNonAnaParameterization=null;this._aPromises=[];};H.FILTER_MODEL_NAME="fi1t3rM0d31";H.BASIC_FILTER_AREA_ID="_BASIC";H.BASIC_SEARCH_FIELD_ID="_BASIC_SEARCH_FIELD";H.CUSTOM_FIELDS_MODEL_PROPERTY="_CUSTOM";H.FIELD_NAME_REGEX=/\./g;H._createFilterProvider=function(P){var e=new H(P);return e._intialiseMetadata();};H.prototype._intialiseMetadata=function(){var e,k,n,K,N,i,j,P,Q,R,W,X;this._aPromises=[];this._aFilterBarViewMetadata.push({groupName:this._sBasicFilterAreaID,index:0,fields:[]});if(!this.sEntitySet&&this.sEntityType){this.sEntitySet=this._oMetadataAnalyser.getEntitySetNameFromEntityTypeName(this.sEntityType);}this.sEntityType=this._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.sEntitySet);N=this._oMetadataAnalyser.getAllFilterableFieldsByEntitySetName(this.sEntitySet,this._bConsiderAnalyticalParameters,this._aConsiderNavigations);if(N){this._updateDisplayBehaviour();this._aFieldGroupAnnotation=this._oMetadataAnalyser.getFieldGroupsByFilterFacetsAnnotation(this.sEntityType);n=this._oMetadataAnalyser.getSelectionFieldsAnnotation(this.sEntityType);if(n&&n.selectionFields){this._aSelectionFields=n.selectionFields;}if(this._aFieldGroupAnnotation){e=this._aFieldGroupAnnotation.length;for(i=0;i<e;i++){K=this._aFieldGroupAnnotation[i];R=this._createGroupMetadata(K);R.index=this._aFilterBarViewMetadata.length;this._aFilterBarViewMetadata.push(R);}}e=N.length;for(i=0;i<e;i++){K=N[i];k=K.fields.length;R=this._createGroupMetadata(K);this._aFilterBarViewMetadata.push(R);for(j=0;j<k;j++){P=K.fields[j];if(P.type.indexOf("Edm.")===0){Q=this._createFieldMetadata(P);R.fields.push(Q);this._aFilterBarFieldNames.push(Q.fieldName);}}}}X=this._getAdditionalConfigurationForCustomGroups(N);e=X.length;for(j=0;j<e;j++){R=this._createGroupMetadataForCustomGroup(X[j]);if(R){this._aFilterBarViewMetadata.push(R);}}W=this._getAdditionalConfigurationForCustomFilterFields();k=W.length;for(j=0;j<k;j++){Q=this._createFieldMetadataForCustomFilterFields(W[j]);if(Q){this._aFilterBarViewMetadata[0].fields.push(Q);}}if(this._hasBasicSearch()){Q=this._createBasicSearchFieldMetadata();this._aFilterBarViewMetadata[0].fields.push(Q);}if(!this._isRunningInValueHelpDialog){this._createParameters();}return new Promise(function(Y){Promise.all(this._aPromises).then(function(){if(this._bConsiderSelectionVariants){this._createSelectionVariants();}this._applyGroupId();this._applyIndexes();this._createInitialModel(true);this._initializeConditionTypeFields();this.setPending(this.isPending());this._bInitialized=true;Y(this);}.bind(this));}.bind(this));};H.prototype._createSelectionVariants=function(){this._aSelectionVariants=this._oMetadataAnalyser.getSelectionVariantAnnotationList(this.sEntityType);};H.prototype._createParameters=function(){if(this._oMetadataAnalyser.isSemanticAggregation(this.sEntityType)){if(this._bConsiderAnalyticalParameters){var e=sap.ui.require("sap/ui/model/analytics/odata4analytics");if(e){this._createAnalyticalParameters(e);}else{var P=new Promise(function(R){sap.ui.require(["sap/ui/model/analytics/odata4analytics"],function(e){this._createAnalyticalParameters(e);R();}.bind(this));}.bind(this));this._aPromises.push(P);}}}else{this._createNonAnalyticalParameters();}};H.prototype._createAnalyticalParameters=function(e){this._oParameterization=this._getAnalyticParameterization(e);this._createAnalyticParameters(this._oParameterization);};H.prototype._getAnalyticParameterization=function(i){var j,Q;try{j=new i.Model(new i.Model.ReferenceByModel(this._oParentODataModel));}catch(e){throw"Failed to instantiate analytical extensions for given OData model: "+e.message;}Q=j&&j.findQueryResultByName(this.sEntitySet);return(Q&&Q.getParameterization());};H.prototype._createNonAnalyticalParameters=function(){if(this.sEntitySet){this._oNonAnaParameterization=this._oMetadataAnalyser.getParametersByEntitySetName(this.sEntitySet);if(this._oNonAnaParameterization){this._createParametersByEntitySetName(this._oNonAnaParameterization.entitySetName,this._oNonAnaParameterization.parameters);}}};H.prototype.attachPendingChange=function(e){if(!this._oEventProvider){this._oEventProvider=new E();}this._oEventProvider.attachEvent("PendingChange",e);};H.prototype.detachPendingChange=function(e){if(this._oEventProvider){this._oEventProvider.detachEvent("PendingChange",e);}};H.prototype.setPending=function(e){var i=this._bPending!==e;this._bPending=e;if(i&&this._oEventProvider){var P={};P.pending=e;this._oEventProvider.fireEvent("PendingChange",P);}};H.prototype.isPending=function(){if(!this._bInitialized){return true;}for(var n in this._mConditionTypeFields){if(this._mConditionTypeFields[n].conditionType.isPending()){return true;}}return false;};H.prototype._updateDisplayBehaviour=function(){this._sTextArrangementDisplayBehaviour=this._oMetadataAnalyser.getTextArrangementValue(this.sEntityType);if(!this.sDefaultDropDownDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultDropDownDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultDropDownDisplayBehaviour=y.descriptionOnly;}}if(!this.sDefaultTokenDisplayBehaviour){if(this._sTextArrangementDisplayBehaviour){this.sDefaultTokenDisplayBehaviour=this._sTextArrangementDisplayBehaviour;}else{this.sDefaultTokenDisplayBehaviour=y.descriptionAndId;}}};H.prototype._hasBasicSearch=function(){return this._isBasicSearchEnabled;};H.prototype._getAdditionalConfigurationForCustomFilterFields=function(){var e,j,i,R;if(!this._oAdditionalConfiguration){return[];}e=this._oAdditionalConfiguration.getControlConfiguration();if(!this._aFilterBarFieldNames||!this._aFilterBarFieldNames.length){return e;}R=[];j=e.length;for(i=0;i<j;i++){if(this._aFilterBarFieldNames.indexOf(e[i].key)<0){R.push(e[i]);}}return R;};H.prototype._getAdditionalConfigurationForCustomGroups=function(e){var k,n,K,i,R,j,N,P;if(!this._oAdditionalConfiguration){return[];}k=this._oAdditionalConfiguration.getGroupConfiguration();if(!e||!e.length){return k;}R=[];K=e.length;n=k.length;for(i=0;i<n;i++){N=false;for(j=0;j<K;j++){P=e[j].groupName||e[j].groupEntitySetName;if(P===k[i].key){N=true;break;}}if(!N){R.push(k[i]);}}return R;};H.prototype._createInitialModelForField=function(j,e,i){var k=false,n,K,N=false,P=false,Q=null,R=null,W,X=null,Y=[],Z=[];if(!e||e.isCustomFilterField){return;}if(e.filterRestriction!==z.multiple){P=true;}if((e.filterType==="date")||(e.filterType==="time")||(e.filterType==="datetime")){k=true;}if(i){n=e.defaultFilterValues;N=n&&n.length;if(!N){if(e.defaultPropertyValue&&e.isParameter){K=e.defaultPropertyValue;if(e.filterType==="numeric"){K=this._getType(e).parseValue(K,"string");}n=[{low:K}];N=true;}else if(e.defaultFilterValue){n=[{low:e.defaultFilterValue,high:e.defaultFilterValue,operator:"EQ",sign:"I"}];N=true;}}}if(e.filterRestriction===z.single){if(N){K=n[0];Q=k?this._createDateTimeValue(e,K.low):K.low;}j[e.fieldName]=Q;}else if(e.filterRestriction===z.interval&&e.type!=="Edm.Time"){if(N){K=n[0];Q=k?this._createDateTimeValue(e,K.low):K.low;R=k?this._createDateTimeValue(e,K.high):K.high;}j[e.fieldName]={low:Q,high:R};}else{if(N){W=n.length;while(W--){K=n[W];if(P){X={"exclude":K.sign==="E","operation":K.operator==="CP"?"Contains":K.operator,"keyField":e.fieldName,"value1":k?this._createDateTimeValue(e,K.low):K.low,"value2":k?null:K.high};if((e.filterType==="time")&&K.high){X.value2=new Date(K.high);}}else{X={key:k?this._createDateTimeValue(e,K.low):K.low,text:k?"":K.low};}Y.push(X);}}this._aFilterBarMultiValueFieldMetadata.push(e);j[e.fieldName]={value:null};if(P){Z=Y.slice(0);Y=[];j[e.fieldName].ranges=Z;}j[e.fieldName].items=Y;this._updateMultiValueControl(e.control,Y,Z);}};H.prototype._createDateTimeValue=function(e,i){switch(e.type){case"Edm.Time":if(i.indexOf("PT")===0){return this._getTime(i);}else{L.error("Default value for "+e.fieldName+" could not be parsed.");}break;case"Edm.DateTime":if(typeof i=="string"&&e.displayFormat&&e.displayFormat.toLowerCase()=="date"){var P=i.split('T');i=P[0]+"T00:00:00";return new Date(i);}else{L.error("Default value for "+e.fieldName+" could not be parsed.");}break;case"Edm.DateTimeOffset":return new Date(i);default:L.error("Default value for "+e.fieldName+" could not be parsed.");}};H.prototype._createInitialModel=function(e){var k,n,K,N,j,i;k={};this._bCreatingInitialModel=true;this._aFilterBarMultiValueFieldMetadata=[];if(this._aFilterBarViewMetadata){n=this._aFilterBarViewMetadata.length;for(i=0;i<n;i++){N=this._aFilterBarViewMetadata[i];K=N.fields.length;for(j=0;j<K;j++){this._createInitialModelForField(k,N.fields[j],e);}}}if(this._aAnalyticalParameters){K=this._aAnalyticalParameters.length;for(j=0;j<K;j++){this._createInitialModelForField(k,this._aAnalyticalParameters[j],e);}}this.oModel.setData(k);if(!e){this._clearConditionTypeFields();}this._updateConditionTypeFields();this._bCreatingInitialModel=false;};H.prototype._updateMultiValueControl=function(e,j,R,k){var i=0,n=null,K=null,N=null,P=null,Q=null,W,X,Y;if(e&&j){i=j.length;if(e instanceof d){n=[];while(i--){P=j[i].text||j[i].key;n.push(new g({key:j[i].key,text:P,tooltip:P}));}if(R){i=R.length;while(i--){N=R[i];if((N.value1==="")&&(N.operation===v.EQ)){N.operation=B.Empty;N.tokenText=m.getFormattedRangeText(N.operation,null,null,N.exclude);}if(N.tokenText){P=N.tokenText;}else{W=N.value1;X=N.value2;if(k){var Z=["date","datetime","time"];if(Z.indexOf(k.filterType)>-1){Y=this._getType(k);if(Y){if(W){W=Y.formatValue(W,"string");}if(X){X=Y.formatValue(X,"string");}}}else if(k.filterType==="numeric"){Y=this._getType(k);if(Y){if(W!==""&&(W!==undefined)){W=Y.formatValue(W,"string");}if(X!==""&&(X!==undefined)){X=Y.formatValue(X,"string");}}}else{var $=k.isCalendarDate||((W instanceof Date)||(X instanceof Date));if($){Y=this._getType(k);if(W){W=Y.formatValue(W,"string");}if(X){X=Y.formatValue(X,"string");}}}}P=m.getFormattedRangeText(N.operation,W,X,N.exclude);}K=new g({text:P,tooltip:P});K.data("range",N);n.push(K);}}e.setTokens(n);}if(e instanceof M){Q=[];while(i--){Q.push(j[i].key);}e.setSelectedKeys(Q);}}};H.prototype._applyIndexes=function(){var e,i;if(!this._aFilterBarViewMetadata){return;}this._aFilterBarViewMetadata=this._sortByIndex(this._aFilterBarViewMetadata);e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(this._aFilterBarViewMetadata[i].fields){this._aFilterBarViewMetadata[i].fields=this._sortByIndex(this._aFilterBarViewMetadata[i].fields);}}};H.prototype._sortByIndex=function(e){var j,i,k,R,n,K;if(!e||!e.length){return e;}R=[];j=[];k=e.length;for(i=0;i<k;i++){K=e[i];n=K.index;if(n>=0){j.push(K);}else{R.push(K);}}k=j.length;if(k){j=j.sort(function(N,P){return N.index-P.index;});if(!R.length){R=j;}else{for(i=0;i<k;i++){K=j[i];if(K.index>=R.length){R.push(K);}else{R.splice(K.index,0,K);}}}}return R;};H.prototype._applyGroupId=function(){var e,i,n,j,K,N,k;e=this._aFilterBarViewMetadata.length;for(i=0;i<e;i++){if(!this._aFilterBarViewMetadata[i].fields){continue;}n=this._aFilterBarViewMetadata[i].fields.length;for(j=0;j<n;j++){K=this._aFilterBarViewMetadata[i].fields[j];if(K&&K.groupId&&K.groupId!==this._aFilterBarViewMetadata[i].groupName){N=undefined;for(k=0;k<e;k++){if(this._aFilterBarViewMetadata[k].groupName===K.groupId){N=this._aFilterBarViewMetadata[k];break;}}if(N){this._aFilterBarViewMetadata[i].fields.splice(j,1);j--;n--;N.fields=N.fields||[];N.fields.push(K);}}}}};H.prototype._createFilterControlId=function(e){var i=this._oSmartFilter?this._oSmartFilter.getId():"unit-test";var j=o.replace(e.groupId||"");var n=o.replace(e.fieldName);return i+"-filterItemControl"+j+"-"+n;};H.prototype._createGroupMetadata=function(e){var i,j=null,k;k=e.groupName||e.groupEntitySetName;if(this._oAdditionalConfiguration){j=this._oAdditionalConfiguration.getGroupConfigurationByKey(k);}i={};i.groupName=k;i.groupLabel=this._getGroupLabel(e,j);i.fields=[];i.index=this._getGroupIndex(j);return i;};H.prototype._createGroupMetadataForCustomGroup=function(e){var i;i={};i.groupName=e.key;i.groupLabel=e.label;i.fields=[];i.index=this._getGroupIndex(e);return i;};H.prototype._getTime=function(e){var i=r.getTimeInstance({pattern:"'PT'hh'H'mm'M'ss'S'"});return i.parse(e);};H.prototype._checkMetadataDefaultValue=function(e){var i=e.defaultFilterValue||e.defaultPropertyValue;if(i){try{if((e.type==="Edm.Time")&&(i.indexOf("PT")===0)){this._getTime(i);}else{this._getType(e);}}catch(j){e.defaultPropertyValue=null;e.defaultFilterValue=null;L.error("default value for "+e.fieldName+" could not be parsed.");}}};H.prototype._getType=function(e){if(e.ui5Type){return e.ui5Type;}var i,j={},k={};if(e.precision||e.scale){k.precision=e.precision;k.scale=e.scale;}if(e.maxLength){k.maxLength=e.maxLength;}if(e.displayFormat){k.displayFormat=e.displayFormat;}if(e.isDigitSequence){k.isDigitSequence=e.isDigitSequence;}if((e.filterType==="date")||(e.filterType==="time")||(e.filterType==="datetime")||e.isCalendarDate){j=q.extend({},this._oDateFormatSettings,{UTC:false});}i=O.getType(e.type,j,k,e.isCalendarDate);return i;};H.prototype._createControl=function(e){var i,j,k=false,n,K;if(e.customControl){return e.customControl;}j=this._getType(e);i=new e.fControlConstructor(this._createFilterControlId(e));if(e.fControlConstructor===b){if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style);}if(e.isCalendarDate){i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/low",type:j});i.bindProperty("secondDateValue",{path:this.sFilterModelName+">/"+e.fieldName+"/high",type:j});}else{i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName+"/low");i.bindProperty("secondDateValue",this.sFilterModelName+">/"+e.fieldName+"/high");}}else if((e.fControlConstructor===C)||(e.fControlConstructor===S)){if(i.setForceSelection){i.setForceSelection(true);}if(e.fControlConstructor===S){i.addItem(new I({key:"",text:""}));i.addItem(new I({key:false,text:j.formatValue(false,"string")}));i.addItem(new I({key:true,text:j.formatValue(true,"string")}));}else{this._associateValueList(i,"items",e);i.attachSelectionChange(function(){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}i.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));}i.bindProperty('selectedKey',this.sFilterModelName+">/"+e.fieldName);}else if(e.fControlConstructor===M){this._associateValueList(i,"items",e);i.attachSelectionChange(function(P){if(this._bUpdatingFilterData||this._bCreatingInitialModel){return;}var Q=P.getSource(),R=null,W=[],X;R=Q.getSelectedItems();if(R){X=R.length;while(X--){W.push({key:R[X].getKey(),text:R[X].getText()});}}if(this.oModel){this.oModel.setProperty("/"+e.fieldName+"/items",W);}Q.fireChange({filterChangeReason:e.fieldName,value:""});}.bind(this));i.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/value");}else if(e.fControlConstructor===d){if(e.controlType===x.date||e.type==="Edm.Time"||e.type==="Edm.DateTimeOffset"){i.setValueHelpOnly(true);if(e.filterRestriction===z.interval){this._associateValueHelpDialog(i,e,false,false);}else{this._associateValueHelpDialog(i,e,true,true);}}else{if(e.hasValueHelpDialog){this._associateValueHelpDialog(i,e,e.filterRestriction!==z.multiple,true);}else{i.setShowValueHelp(false);}i.bindProperty("value",{path:this.sFilterModelName+">/"+e.fieldName+"/value",type:j});}this._handleMultiInput(i,e,j);}else if(e.fControlConstructor===c){if(e.filterRestriction===z.interval){k=true;i.bindProperty("value",this.sFilterModelName+">/"+e.fieldName+"/low");if(!this.oResourceBundle){this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");}if(!this.sIntervalPlaceholder){this.sIntervalPlaceholder=this.oResourceBundle.getText("INTERVAL_PLACEHOLDER_TEXT");}i.setPlaceholder(this.sIntervalPlaceholder);}else{i.bindProperty('value',{path:this.sFilterModelName+">/"+e.fieldName,type:j});}if(e.hasValueHelpDialog){i.setShowValueHelp(true);this._associateValueHelpDialog(i,e,false,false);}}else if(e.isCalendarDate){if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style);}i.bindProperty("dateValue",{path:this.sFilterModelName+">/"+e.fieldName,type:j});}else if(e.fControlConstructor===a||e.fControlConstructor===T||e.fControlConstructor===D){i.bindProperty("dateValue",this.sFilterModelName+">/"+e.fieldName);if(this._oDateFormatSettings&&this._oDateFormatSettings.style){i.setDisplayFormat(this._oDateFormatSettings.style);}}if(i instanceof a){i.attachChange(function(P){var Q=P.getParameter("valid");i.data("__mandatoryEmpty",null);if(Q){i.setValueState(A.None);i.setValueStateText();}else{i.setValueState(A.Error);if(j){try{j.parseValue("foo","string");}catch(R){i.setValueStateText(R.message);}}}});}if(e.hasTypeAhead){i.setShowSuggestion(true);i.setFilterSuggests(false);this._associateValueList(i,"suggestionRows",e,true);}if((e.displayFormat==="UpperCase")&&(e.controlType!==x.dropDownList)&&i.attachChange&&i.getValue&&i.setValue){i.attachChange(function(P){var Q=i.getValue();if(Q){i.setValue(Q.toUpperCase());}});if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var N=this._mTokenHandler[i.getId()].parser;N.getKeyFields()[0].displayFormat=e.displayFormat;}}if(i instanceof c){if(e.maxLength){n=parseInt(e.maxLength);if(!isNaN(n)){if(this._mTokenHandler[i.getId()]&&this._mTokenHandler[i.getId()].parser){var N=this._mTokenHandler[i.getId()].parser;N.getKeyFields()[0].maxLength=n;}else{if(!e.hasValueListAnnotation&&!k){i.setMaxLength(n);}}}}}K=function(P){var Q=P.getParameter("exception");var R=P.getParameter("element");if(i&&R&&(i.getId()===R.getId())){if(Q){if(i.setValueStateText){i.setValueStateText(Q.message);}}if(i.setValueState){i.setValueState(A.Error);}i.data("__mandatoryEmpty",null);}};i.attachParseError(K);i.attachFormatError(K);i.attachValidationError(K);i.attachValidationSuccess(function(P){var Q=P.getParameter("element");if(i&&Q&&(i.getId()===Q.getId())){if(i.setValueState){i.setValueState(A.None);}if(i.setValueStateText){i.setValueStateText();}i.data("__mandatoryEmpty",null);delete i.__sValidationText;}});return i;};H.prototype._getControlConstructor=function(e,P){var i=c,j,k,n;n=P?P+e.fieldName:e.fieldName;if(e.isCustomFilterField){i=undefined;}else{j=(e.filterRestriction===z.single);k=(e.filterRestriction===z.interval);if(e.controlType===x.date){e.displayFormat="Date";if(j){i=a;}else{i=k?b:d;}if(e.isCalendarDate){this._aFilterBarStringDateFieldNames.push(n);}else{this._aFilterBarDateFieldNames.push(n);}if(e.filterRestriction===z.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(n);}}else if(e.controlType===x.dropDownList){if(j){i=this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)?S:C;}else{i=M;}if(!j){e.filterRestriction=z.multiple;}}else if(e.type==="Edm.Time"){if(j){i=T;}else{i=d;}this._aFilterBarTimeFieldNames.push(n);if(k){this._aFilterBarTimeIntervalFieldNames.push(n);}else if(e.filterRestriction===z.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(n);}}else if(!k&&e.controlType===x.dateTimePicker){if(j){i=D;}else{i=d;}this._aFilterBarDateTimeFieldNames.push(n);if(e.filterRestriction===z.multiple){this._aFilterBarDateTimeMultiValueFieldNames.push(n);}}else if(k&&e.type==="Edm.DateTimeOffset"){this._aFilterBarDateTimeFieldNames.push(n);}else if(!j&&!k){i=d;}}return i;};H.prototype._handleMultiInput=function(e,i,j){e.setEnableMultiLineMode(true);e.attachTokenChange(function(K){if(this._bUpdatingFilterData||this._bCreatingInitialModel||(K.getParameter("type")!=="tokensChanged")&&(K.getParameter("type")!=="removed")){return;}var N=K.getSource().getTokens(),P=[],Q,R=null,W=null,X=[];if(N){Q=N.length;while(Q--){R=N[Q];W=R.data("range");if(W){W.tokenText=R.getText();if(W&&(R.getKey().indexOf("range_")===0)){if(i.type==="Edm.Time"){if(W.value1&&W.value1.ms){W.value1=new Date(W.value1.ms);W.value1=new Date(W.value1.valueOf()+W.value1.getTimezoneOffset()*60*1000);}if(W.value2&&W.value2.ms){W.value2=new Date(W.value2.ms);W.value2=new Date(W.value2.valueOf()+W.value2.getTimezoneOffset()*60*1000);}}}X.push(W);}else{P.push({key:R.getKey(),text:R.getText()});}}}if(this.oModel){this.oModel.setProperty("/"+i.fieldName+"/items",P);this.oModel.setProperty("/"+i.fieldName+"/ranges",X);}if(e.__bValidatingToken){delete e.__bValidatingToken;}e.fireChange({filterChangeReason:i.fieldName,value:""});}.bind(this));var k,n=((i.type==="Edm.DateTime"&&i.displayFormat==="Date"));if(i.hasValueListAnnotation||(i.type==="Edm.String")||n){e.attachEvent("_validateOnPaste",function(K){var N=K.getParameter("texts"),P,Q,R,W,X;Q=N?N.length:0;if(Q>1){K.preventDefault();P=this.oModel.getProperty("/"+i.fieldName);X=P.ranges||[];e.setValue("");while(Q--){R=N[Q];if(R){W=null;if(n){k=this._getDateValue(R,j);if(isNaN(k.getDate())){continue;}else{W=R;R=k;}}X.push({"exclude":false,"operation":"EQ","keyField":i.fieldName,"value1":R,"value2":null,"tokenText":W});}}this.oModel.setProperty("/"+i.fieldName+"/ranges",X);this._updateMultiValueControl(e,P.items,X,i);}}.bind(this));}};H.prototype._associateValueHelpDialog=function(e,i,j,k){var P={loadAnnotation:i.hasValueListAnnotation,fullyQualifiedFieldName:i.fullName,metadataAnalyser:this._oMetadataAnalyser,control:e,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,preventInitialDataFetchInValueHelpDialog:i.preventInitialDataFetchInValueHelpDialog,dateFormatSettings:this._oDateFormatSettings,supportMultiSelect:k,supportRanges:j,isUnrestrictedFilter:i.filterRestriction!==z.multiple,isSingleIntervalRange:i.filterRestriction===z.interval,fieldName:i.fieldName,type:i.filterType,scale:i.scale,precision:i.precision,maxLength:i.maxLength,displayFormat:i.displayFormat,displayBehaviour:i.displayBehaviour,fieldViewMetadata:i};if(i.isCalendarDate){P.oType=this._getType(i);}var n=new V(P);n.attachValueListChanged(function(N){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(N);this._oSmartFilter.validateMandatoryFields();}}.bind(this));if(i.visibleInAdvancedArea||(i.groupId===H.BASIC_FILTER_AREA_ID)){n.loadAnnotation();}this._aValueHelpDialogProvider.push(n);if(j&&e.addValidator){var K=new p();K.addKeyField({key:i.fieldName,label:i.label,type:i.filterType,oType:i.ui5Type});if(i.filterType==="numeric"){K.setDefaultOperation("EQ");}K.associateInput(e);this._mTokenHandler[e.getId()]={parser:K};}};H.prototype._determineFieldLabel=function(e){var i,j=e.label;if(this._oSmartFilter&&this._oSmartFilter.determineFilterItemByName){i=this._oSmartFilter.determineFilterItemByName(e.name);if(i){j=i.getLabel();}}return j;};H.prototype._associateValueList=function(e,i,j,k){var n;if(this._oSmartFilter&&!this._bAttachInitializedDone&&new U(window.location.href).get("sap-ui-comp-filterbar-data-defer")){var P=this._oParentODataModel;this._sDeferredGroupId="sapUiCompFilterBarData";var K=P.getDeferredGroups?this._oParentODataModel.getDeferredGroups():null;if(K!==null){K.push(this._sDeferredGroupId);P.setDeferredGroups(K);var N=function(){P.submitChanges({groupId:this._sDeferredGroupId});var K=P.getDeferredGroups().filter(function(Q){return Q!==this._sDeferredGroupId;}.bind(this));P.setDeferredGroups(K);delete this._sDeferredGroupId;this._oSmartFilter.detachInitialized(N);}.bind(this);this._oSmartFilter.attachInitialized(N);this._bAttachInitializedDone=true;}}if(j.hasValueListAnnotation){n=new l({control:e,fieldName:j.fieldName,typeAheadEnabled:k,aggregation:i,displayFormat:j.displayFormat,displayBehaviour:j.displayBehaviour,dateFormatSettings:this._oDateFormatSettings,loadAnnotation:true,fullyQualifiedFieldName:j.fullName,metadataAnalyser:this._oMetadataAnalyser,filterModel:this.oModel,filterProvider:this,model:this._oParentODataModel,fieldViewMetadata:j,deferredGroupId:this._sDeferredGroupId});n.attachValueListChanged(function(Q){if(this._oSmartFilter){this._oSmartFilter.fireFilterChange(Q);this._oSmartFilter.validateMandatoryFields();}}.bind(this));if(j.visibleInAdvancedArea||(j.groupId===H.BASIC_FILTER_AREA_ID)){n.loadAnnotation();}this._aValueListProvider.push(n);}else if(this._mTokenHandler[e.getId()]&&this._mTokenHandler[e.getId()].parser){this._mTokenHandler[e.getId()].parser.setDefaultOperation("EQ");}};H.prototype._createAnalyticParameters=function(P){var e,i;if(P){i=P.getAllParameterNames();e=P.getEntitySet();if(e){this._createParametersByEntitySetName(e.getQName(),i);}}};H.prototype._createParametersByEntitySetName=function(e,P){var j,k=this._oMetadataAnalyser.getFieldsByEntitySetName(e);for(var i=0;i<k.length;i++){if(P.indexOf(k[i].name)>=0){j=this._createAnalyticParameterMetadata(k[i]);if(j&&j.visible){this._aAnalyticalParameters.push(j);}}}};H.prototype._createAnalyticParameterMetadata=function(P){var e,i=s.ANALYTICAL_PARAMETER_PREFIX;P.filterRestriction="single-value";e=this._createFieldMetadata(P,i);if(e){e.fieldName=i+P.name;e.isMandatory=true;e.isParameter=true;e.visibleInAdvancedArea=true;}else{L.error("_createAnalyticParameterMetadata issue with property: "+P.name);}return e;};H.prototype.getAnalyticParameters=function(){return this._aAnalyticalParameters;};H.prototype.getSelectionVariants=function(){return this._aSelectionVariants;};H.prototype.getAnalyticBindingPath=function(){var e,P=[],i=this.getAnalyticParameters();i.forEach(function(j){P.push(j.fieldName);});e=this.getFilledFilterData(P);if(this._oParameterization){return this._createAnalyticBindingPath(i,e);}else{return this._createNonAnalyticBindingPath(i,e);}};H.prototype._createAnalyticBindingPath=function(P,e){var i,j="",k;k=this._getParameterizationRequest(this._oParameterization);if(k){P.forEach(function(n){i=e[n.fieldName];if(!i){i="";}else if(n.type==="Edm.Time"&&i instanceof Date){if(this._oDateFormatSettings&&!this._oDateFormatSettings.UTC){i=new Date(i.valueOf()+i.getTimezoneOffset()*60*1000);}i={__edmType:"Edm.Time",ms:(((i.getHours()*60)+i.getMinutes())*60+i.getSeconds())*1000+i.getMilliseconds()};}else if((n.type!=="Edm.DateTimeOffset")&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&i instanceof Date){i=H.getDateInUTCOffset(i);}k.setParameterValue(n.name,i);}.bind(this));j=k.getURIToParameterizationEntry()+'/'+this._oParameterization.getNavigationPropertyToQueryResult();}return j;};H.prototype._createNonAnalyticBindingPath=function(P,e){var i,j="",k="";if(this._oNonAnaParameterization){j="/"+this._oNonAnaParameterization.entitySetName+'(';P.forEach(function(n){i=e[n.fieldName];if(!i){i="";}else if(n.type==="Edm.Time"&&i instanceof Date){i={__edmType:"Edm.Time",ms:(((i.getHours()*60)+i.getMinutes())*60+i.getSeconds())*1000+i.getMilliseconds()};}else if((n.type!=="Edm.DateTimeOffset")&&this._oDateFormatSettings&&this._oDateFormatSettings.UTC&&i instanceof Date){i=H.getDateInUTCOffset(i);}j+=(k+n.name+"="+w(this._oParentODataModel.formatValue(i,n.type)));k=",";}.bind(this));j+=(")/"+this._oNonAnaParameterization.navPropertyName);}return j;};H.prototype._getParameterizationRequest=function(){return this._oParameterization?new u.ParameterizationRequest(this._oParameterization):null;};H.prototype._constructContextUrl=function(e,i){var j=e._getServerUrl();if(j&&(j.lastIndexOf('/')===(j.length-1))){j=j.substr(0,j.length-1);}return j+e.sServiceUrl+"/$metadata#"+i;};H.prototype.getFilterContextUrl=function(){var e,i=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){e=this._oParentODataModel.getMetaModel().getODataEntitySet(this.sEntitySet);if(e){i=this._constructContextUrl(this._oParentODataModel,e.name);}}return i;};H.prototype.getParameterContextUrl=function(){var e,i=null;if(this._oParentODataModel&&this._oParentODataModel.isA("sap.ui.model.odata.v2.ODataModel")&&this._oParentODataModel.getMetaModel()){if(this._oParameterization&&this._oParameterization.getEntitySet()){e=this._oParameterization.getEntitySet().getQName();}else if(this._oNonAnaParameterization){e=this._oNonAnaParameterization.entitySetName;}if(e){i=this._constructContextUrl(this._oParentODataModel,e);}}return i;};H.prototype._createFieldMetadata=function(e,P){var i,j,k;e.fieldName=this._getFieldName(e);e.fieldNameOData=e.fieldName.replace(H.FIELD_NAME_REGEX,"/");j=this._oAdditionalConfiguration?this._oAdditionalConfiguration.getControlConfigurationByKey(e.fieldName):null;i=q.extend({},e);i.filterRestriction=this._getFilterRestriction(e,j);this._updateValueListMetadata(i,e);i.hasValueHelpDialog=this._hasValueHelpDialog(i,j);i.preventInitialDataFetchInValueHelpDialog=j?j.preventInitialDataFetchInValueHelpDialog:true;i.controlType=this._getControlType(i,j);if(j&&j.displayBehaviour&&j.displayBehaviour!=="auto"){i.displayBehaviour=j.displayBehaviour;}i.isCustomFilterField=!!(j&&j.customControl);i.visibleInAdvancedArea=!!(j&&j.visibleInAdvancedArea);i.label=this._getLabel(e,j);i.isMandatory=this._isMandatory(e,j);i.width=this._getWidth(j);i.isVisible=this._isVisible(j);i.groupId=this._getGroupID(e,j);i.index=this._getIndex(e,j);i.fControlConstructor=this._getControlConstructor(i,P);i.filterType=this._getFilterType(i);i.hasTypeAhead=this._hasTypeAhead(i,e,j);i.customControl=j?j.customControl:undefined;i.ui5Type=this._getType(i);if(i.ui5Type&&i.ui5Type.isA("sap.ui.model.odata.type.DateTime")){i.ui5Type.formatValue(new Date(),"string");i.ui5Type.oFormat.oFormatOptions.UTC=false;}i.fCreateControl=function(R){var W,X;R.control=this._createControl(R);W=this.oModel.getData();X=W[R.fieldName];if(X){this._updateMultiValueControl(R.control,X.items,X.ranges,R);}}.bind(this);this._applyWidth(i);i.defaultFilterValues=j?j.defaultFilterValues:undefined;if(i.type==="Edm.String"){this._aFilterBarStringFieldNames.push(i.fieldName);}i.conditionType=null;var n=j?j.conditionType:null;if(!n&&this._bUseDateRangeType&&(i.fControlConstructor===b)){n="sap.ui.comp.config.condition.DateRangeType";}if(n){var K="";if(typeof n==="object"){K=n.module;delete n.module;}else{K=n;n=null;}try{K=K.replace(/\./g,"/");var N=sap.ui.require(K);if(N){this._enhanceConditionTypeInfo(N,K,n,i);}else{k=new Promise(function(R){sap.ui.require([K],function(N){this._enhanceConditionTypeInfo(N,K,n,i);R();}.bind(this));}.bind(this));this._aPromises.push(k);}}catch(Q){L.error("Module "+K+" could not be loaded");}}else{this._checkMetadataDefaultValue(i);}return i;};H.prototype._requireConditionType=function(e,i,j){var e=e.replace(/\./g,"/");var k=sap.ui.require(e);if(k){this._enhanceConditionTypeInfo(k,e,i,j);}else{sap.ui.require([e],function(k){this._enhanceConditionTypeInfo(k,e,i,j);}.bind(this));}};H.prototype._enhanceConditionTypeInfo=function(e,i,j,k){var n=e;k.conditionType=new n(k.fieldName,this,k);this._mConditionTypeFields[k.fieldName]=k;if(j&&!this._bUseDateRangeType){k.conditionType.applySettings(j);}this._checkMetadataDefaultValue(k);};H.prototype._getFilterType=function(e){return m._getFilterType(e);};H.prototype._updateValueListMetadata=function(e,i){e.hasValueListAnnotation=i["sap:value-list"]!==undefined;if(e.hasValueListAnnotation){e.hasFixedValues=i["sap:value-list"]==="fixed-values";}else if(i["com.sap.vocabularies.Common.v1.ValueList"]){e.hasValueListAnnotation=true;e.hasFixedValues=this._oMetadataAnalyser.getValueListSemantics(i["com.sap.vocabularies.Common.v1.ValueList"])==="fixed-values";if(!e.hasFixedValues){e.hasFixedValues=h.isValueListWithFixedValues(i);}}};H.prototype._createBasicSearchFieldMetadata=function(){var e;var R=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");e={};e.filterRestriction=z.single;e.name=H.BASIC_SEARCH_FIELD_ID;e.fieldName=H.BASIC_SEARCH_FIELD_ID;e.label=undefined;e.isMandatory=false;e.isVisible=true;e.groupId=H.BASIC_FILTER_AREA_ID;e.index=-1;e.control=new f(this._oSmartFilter.getId()+"-btnBasicSearch",{showSearchButton:true});if(!this._isRunningInValueHelpDialog){e.control.setPlaceholder(R.getText("FILTER_BAR_BSEARCH_PLACE_HOLDER"));}e.control.bindProperty('value',this.sFilterModelName+">/"+e.fieldName);return e;};H.prototype._applyWidth=function(e){if(e&&e.width&&e.control&&e.control.setWidth&&(typeof e.control.setWidth==='function')){e.control.setWidth(e.width);}};H.prototype._createFieldMetadataForCustomFilterFields=function(e){var i;if(!e||!e.customControl){return undefined;}i={};i.name=e.key;i.fieldName=e.key;i.label=e.label;i.visibleInAdvancedArea=!!(e&&e.visibleInAdvancedArea);i.isVisible=this._isVisible(e);i.groupId=e.groupId;i.isMandatory=this._isMandatory(undefined,e);i.index=e.index;i.width=this._getWidth(e);i.control=e.customControl;i.isCustomFilterField=true;this._applyWidth(i);return i;};H.prototype._getFieldName=function(e){if(!e.parentPropertyName){return e.name;}else{return e.parentPropertyName+"."+e.name;}};H.prototype._hasValueHelpDialog=function(e,i){var j=true;if(i){if(i.controlType===x.dropDownList){j=false;}else if(i.hasValueHelpDialog!==true){j=false;}}if(e&&!e.hasValueListAnnotation){if(e.filterRestriction===z.single||e.filterRestriction===z.multiple){j=false;}}return j;};H.prototype._isVisible=function(e){if(e&&e.isVisible===false){return false;}return true;};H.prototype._getWidth=function(e){if(e&&e.width){return e.width;}return undefined;};H.prototype._isMandatory=function(e,i){if(i&&i.mandatory!==G.auto){return i.mandatory===G.mandatory;}if(e){return e.requiredFilterField;}return false;};H.prototype._getFilterRestriction=function(e,i){var j;if(i&&i.filterType&&i.filterType!==z.auto){j=i.filterType;}else if(e.filterRestriction==="single-value"){j=z.single;}else if(e.filterRestriction==="multi-value"){j=z.multiple;}else if(e.filterRestriction==="interval"){j=z.interval;}else{j=z.auto;}return j;};H.prototype._getControlType=function(e,i){var j;if(i&&i.controlType&&i.controlType!==x.auto){j=i.controlType;}else if(e.type==="Edm.DateTime"&&e.displayFormat==="Date"||e.isCalendarDate){j=x.date;}else if(e.type==="Edm.DateTimeOffset"){j=x.dateTimePicker;}else if(e.hasValueListAnnotation&&e.hasFixedValues){j=x.dropDownList;}else if(this._isBooleanWithFixedValuedButWithoutValueListAnnotation(e)){j=x.dropDownList;}else{j=x.input;}return j;};H.prototype._isBooleanWithFixedValuedButWithoutValueListAnnotation=function(e){if(e.type==="Edm.Boolean"&&!e.hasFixedValues&&!e.hasValueListAnnotation&&(e.filterRestriction==="single")){return true;}return false;};H.prototype._getGroupID=function(e,i){if(i&&i.groupId){return i.groupId;}else if(e&&(e.requiredFilterField||(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1))){return this._sBasicFilterAreaID;}return this._getGroupIDFromFieldGroup(e);};H.prototype._getGroupIDFromFieldGroup=function(e){var i=0,j=null,k;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){i=this._aFieldGroupAnnotation.length;while(i--){j=this._aFieldGroupAnnotation[i];if(j&&j.fields&&j.fields.indexOf(e.fieldNameOData)>-1){k=j.groupName;break;}}}return k;};H.prototype._getLabel=function(e,i){if(i&&i.label){return i.label;}return this._getLabelFromFieldGroup(e)||e.fieldLabel||e.fieldName;};H.prototype._getLabelFromFieldGroup=function(e){var i=0,j=null,k;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){i=this._aFieldGroupAnnotation.length;while(i--){j=this._aFieldGroupAnnotation[i];if(j&&j.fields&&j.fields.indexOf(e.fieldNameOData)>-1){k=j.labels[e.fieldNameOData];break;}}}return k;};H.prototype._getIndex=function(e,i){if(i&&(i.index>=0)){return i.index;}else if(this._aSelectionFields&&this._aSelectionFields.indexOf(e.fieldNameOData)>-1){return this._aSelectionFields.indexOf(e.fieldNameOData);}return this._getIndexFromFieldGroup(e);};H.prototype._getIndexFromFieldGroup=function(e){var i=0,j=null,k;if(e&&this._aFieldGroupAnnotation&&this._aFieldGroupAnnotation.length){i=this._aFieldGroupAnnotation.length;while(i--){j=this._aFieldGroupAnnotation[i];if(j&&j.fields){k=j.fields.indexOf(e.fieldNameOData);if(k>-1){break;}k=undefined;}}}return k;};H.prototype._getGroupIndex=function(e){if(e&&(e.index||e.index===0)){return e.index;}};H.prototype._getGroupLabel=function(e,i){if(i&&i.label){return i.label;}return e.groupLabel||e.groupName||e.groupEntitySetName;};H.prototype._hasTypeAhead=function(e,i,j){var k;k=true;if(j){k=j.hasTypeAhead;}else if(i.type!=="Edm.String"){return false;}if(!(e.fControlConstructor===c||e.fControlConstructor===d)){return false;}return k;};H.prototype.getModel=function(){return this.oModel;};H.prototype.getFilterBarViewMetadata=function(){return this._aFilterBarViewMetadata;};H.prototype.getAssociatedValueHelpProviders=function(){return this._aValueHelpDialogProvider;};H.prototype.getAssociatedValueListProviders=function(){return this._aValueListProvider;};H.prototype.getParameters=function(){var P,e=null;if(this.oModel){e=this.oModel.getProperty("/"+H.BASIC_SEARCH_FIELD_ID);}if(this._sBasicSearchFieldName||e){P={custom:{}};if(this._sBasicSearchFieldName){P.custom["search-focus"]=this._sBasicSearchFieldName;}P.custom["search"]=e||"";}return P;};H.prototype.getFilters=function(e){var i=null;if(this.oModel){i=this.oModel.getData();}return H.generateFilters(e,i,{dateSettings:this._oDateFormatSettings,useContainsAsDefault:this._bUseContainsAsDefault,stringFields:this._aFilterBarStringFieldNames,timeFields:this._aFilterBarTimeFieldNames,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,viewMetadataData:this._aFilterBarViewMetadata});};H.prototype.getFilterData=function(){return this.oModel?this.oModel.getData():null;};H.prototype.getFilterDataAsString=function(){return this.oModel?this.oModel.getJSON():null;};H.prototype.getFilledFilterData=function(e){var i,j={},k,n,K;i=this.oModel?this.oModel.getData():null;if(i&&e){k=e.length;while(k--){n=e[k];if(n&&n!==H.BASIC_SEARCH_FIELD_ID){K=i[n];if(K&&K.hasOwnProperty("low")){if(K.low){j[n]=K;}}else if(K&&K.hasOwnProperty("items")){if(K.value&&typeof K.value==="string"){K.value=K.value.trim();}if(K.items.length||(K.ranges&&K.ranges.length)||K.value){j[n]=K;}}else if(K){if(typeof K==="string"){K=K.trim();}if(K){j[n]=K;}}}if(k===0){n=H.CUSTOM_FIELDS_MODEL_PROPERTY;K=i[n];if(K){j[n]=K;}}}}return q.extend(true,{},j);};H.prototype.getFilledFilterDataAsString=function(e){return JSON.stringify(this.getFilledFilterData(e));};H.prototype.setFilterData=function(j,R){var e=null,i=null,k=null;if(this.oModel&&j){this._bUpdatingFilterData=true;try{if(R){this._createInitialModel(false);}e=this._parseFilterData(j,R);if(e){this.oModel.setData(e,true);i=[];var n=arguments[2];if(n){i.push(n);}for(k in e){i.push(k);}this._handleFilterDataUpdate(i);}}finally{this._bUpdatingFilterData=false;}}};H.prototype.setFilterDataAsString=function(j,R){if(j){this.setFilterData(JSON.parse(j),R);}};H.prototype._parseFilterData=function(j,R){return H.parseFilterData(this.oModel.getData(),j,{stringDateFields:this._aFilterBarStringDateFieldNames,dateFields:this._aFilterBarDateFieldNames,timeFields:this._aFilterBarTimeFieldNames,timeIntervalFields:this._aFilterBarTimeIntervalFieldNames,dateTimeMultiValueFields:this._aFilterBarDateTimeMultiValueFieldNames,conditionTypeFields:this._mConditionTypeFields,dateTimeOffsetValueFields:this._aFilterBarDateTimeFieldNames,viewMetadataData:this._aFilterBarViewMetadata,filterProvider:this},R);};H.prototype._handleFilterDataUpdate=function(e){var i=0,j,k,n;if(this._aFilterBarMultiValueFieldMetadata){i=this._aFilterBarMultiValueFieldMetadata.length;while(i--){if(!k){k=this.oModel.getData();}if(k){j=this._aFilterBarMultiValueFieldMetadata[i];if(e.indexOf(j.fieldName)>-1){n=k[j.fieldName];if(n){this._updateMultiValueControl(j.control,n.items,n.ranges,j);}}}}this._updateConditionTypeFields();}};H.prototype.clear=function(){this._createInitialModel(false);};H.prototype.reset=function(){this._createInitialModel(true);};H.prototype._initializeConditionTypeFields=function(){var e=function(i){this.setPending(this.isPending());}.bind(this);for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(this.oModel.getData()[n]);if(this._mConditionTypeFields[n].conditionType.getAsync()){this._mConditionTypeFields[n].conditionType.attachPendingChange(e);}}};H.prototype._updateConditionTypeFields=function(){var e=this._oldData;var i=this.oModel.getData();this._oldData=q.extend(true,{},i);if(e!==undefined){var j=[],n;for(n in i){var N=JSON.stringify(i[n]);var k=JSON.stringify(e[n]);if(N!==k){j.push(n);}}if(j.length>0){for(n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.providerDataUpdated(j,i);}}}};H.prototype._clearConditionTypeFields=function(){var e=this.oModel.getData();for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.initialize(e[n]);}};H.prototype._validateConditionTypeFields=function(){var i=false;for(var n in this._mConditionTypeFields){var e=this._mConditionTypeFields[n].conditionType.validate();if(!e&&!i){i=true;}}return i;};H._getFieldMetadata=function(e,i){var j=null;e.some(function(k){if(k&&k.fields){k.fields.some(function(n){if(n&&n.fieldName===i){j=n;}return j!==null;});}return j!==null;});return j;};H.generateFilters=function(e,i,j){var k=[],n=null,K=null,N=null,P=null,Q=H.FIELD_NAME_REGEX,R=null,W,X,Y=null,Z=0,$=0;var _,a1,b1,c1,d1,e1,f1,g1,h1,i1=[];if(j){_=j.dateSettings;a1=j.useContainsAsDefault;b1=j.stringFields;c1=j.timeFields;f1=j.dateTimeOffsetValueFields;i1=j.viewMetadataData||[];}if(e&&i){$=e.length;while($--){e1=false;g1=false;P=e[$];h1=H._getFieldMetadata(i1,P);if(P&&P!==H.BASIC_SEARCH_FIELD_ID){Y=null;d1=false;if(a1&&b1){if(b1.indexOf(P)>-1){d1=true;}}else if(c1&&c1.indexOf(P)>-1){e1=true;}else if(f1&&f1.indexOf(P)>-1){g1=true;}R=i[P];P=P.replace(Q,"/");if(R&&R.hasOwnProperty("low")){if(R.low&&R.high){W=R.low;X=R.high;if(!g1&&_&&_.UTC&&W instanceof Date&&X instanceof Date){W=H.getDateInUTCOffset(W);X=H.getDateInUTCOffset(X);}k.push(new F(P,v.BT,W,X));}else if(R.low){if(R.low instanceof Date){W=R.low;if(!g1&&_&&_.UTC){W=H.getDateInUTCOffset(W);}k.push(new F(P,v.EQ,W));}else if(typeof R.low==="string"){if(g1&&h1){Y=m.parseDateTimeOffsetInterval(R.low);Y[0]=h1.ui5Type.parseValue(Y[0],"string");if(Y.length===2){Y[1]=h1.ui5Type.parseValue(Y[1],"string");}}else{Y=m.parseFilterNumericIntervalData(R.low);}if(Y&&Y.length===2){k.push(new F(P,v.BT,Y[0],Y[1]));}else if(Y&&Y.length===1){k.push(new F(P,v.EQ,Y[0]));}else{k.push(new F(P,d1?v.Contains:v.EQ,R.low));}}}}else if(R&&R.hasOwnProperty("items")){n=[];N=[];K=null;if(R&&R.hasOwnProperty("ranges")){Y=R.ranges;Z=Y.length;while(Z--){W=Y[Z].value1;X=Y[Z].value2;if(e1){if(W instanceof Date){W=m.getEdmTimeFromDate(W);}if(X instanceof Date){X=m.getEdmTimeFromDate(X);}}else if(h1&&h1.isCalendarDate){if(W instanceof Date){W=h1.ui5Type.parseValue(W);}if(X instanceof Date){X=h1.ui5Type.parseValue(X);}}else if(!g1&&_&&_.UTC){if(W instanceof Date){W=H.getDateInUTCOffset(W);}if(X instanceof Date){X=H.getDateInUTCOffset(X);}}if(Y[Z].exclude){if(Y[Z].operation===B.Empty){N.push(new F(P,v.NE,""));}else if(Y[Z].operation===v.EQ){N.push(new F(P,v.NE,W));}}else{if(Y[Z].operation===B.Empty){n.push(new F(P,v.EQ,""));}else if(Y[Z].operation===sap.ui.model.FilterOperator.BT){n.push(new F(P,Y[Z].operation,W,X));}else{n.push(new F(P,Y[Z].operation,W));}}}if(N.length){K=new F(N,true);}}Y=R.items;Z=Y.length;while(Z--){n.push(new F(P,v.EQ,Y[Z].key));}if(h1&&((h1.fControlConstructor!==M)||(h1.hiddenFilter))){if(R.value||R.value===0||R.value===false){if(typeof R.value==="string"){R.value=R.value.trim();}if(R.value||R.value===0||R.value===false){n.push(new F(P,d1?v.Contains:v.EQ,R.value));}}}if(n.length){if(K){k.push(new F([new F(n,false),K],true));}else{k.push(new F(n,false));}}else if(K){k.push(K);}}else if(R||R===0||R===false){if(typeof R==="string"){R=R.trim();}if(R&&R instanceof Date){if(e1){R=m.getEdmTimeFromDate(R);}else if(!g1&&_&&_.UTC){R=H.getDateInUTCOffset(R);}}if(R||R===0||R===false){k.push(new F(P,d1?v.Contains:v.EQ,R));}}}}}return(k.length>1)?[new F(k,true)]:k;};H.parseFilterData=function(e,j,k,R){var n={},K=null,N=null,P=null,Q,W,i,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1;if(k){Z=k.stringDateFields;$=k.dateFields;_=k.timeFields;a1=k.timeIntervalFields;b1=k.dateTimeMultiValueFields;K=k.conditionTypeFields||{};c1=k.dateTimeOffsetValueFields;d1=k.viewMetadataData||[];f1=k.filterProvider||null;}if(!Z){Z=[];}if(!$){$=[];}if(!_){_=[];}if(!a1){a1=[];}if(!b1){b1=[];}if(!c1){c1=[];}if(e&&j){W=q.extend({},j,true);for(N in W){e1=H._getFieldMetadata(d1,N);if(e.hasOwnProperty(N)&&N!==H.CUSTOM_FIELDS_MODEL_PROPERTY){P=e[N];Q=W[N];if(N in K){if(Q&&(("conditionTypeInfo"in Q)||(!("conditionTypeInfo"in Q)&&Q.ranges))){K[N].conditionType.initialize(Q);}}else if(P&&P.hasOwnProperty("low")){n[N]=Q;if(Q){if(Q.low&&Q.high){if(($.indexOf(N)>-1)||(_.indexOf(N)>-1)){if(!(Q.low instanceof Date)){n[N].low=new Date(Q.low);}if(!(Q.high instanceof Date)){n[N].high=new Date(Q.high);}}else if(f1&&e1&&(c1.indexOf(N)>-1)){n[N].low=e1.ui5Type.formatValue(Q.low,"string")+'-'+e1.ui5Type.formatValue(Q.high,"string");n[N].high=null;}else if(Z.indexOf(N)===-1){n[N].low=Q.low+'-'+Q.high;n[N].high=null;}}else if((Q.low||Q.value)&&!Q.high){if(!Q.low&&Q.value){Q.low=Q.value;}if(($.indexOf(N)>-1||_.indexOf(N)>-1)&&!(Q.low instanceof Date)){n[N].low=new Date(Q.low);}else{n[N].low=Q.low;}n[N].high=null;}}}else if(P&&P.hasOwnProperty("items")){if(Q&&(Q.items||Q.ranges)){if(Q.ranges&&Q.ranges.length){if(a1.indexOf(N)>-1){X=Q.ranges.length;for(i=0;i<X;i++){Y=Q.ranges[i];if(!Y.exclude&&(Y.operation==="EQ"||Y.operation==="BT")){break;}Y=null;}if(Y){if(Y.value1&&typeof Y.value1==="string"){Y.value1=new Date(Y.value1);}if(Y.value2&&typeof Y.value2==="string"){Y.value2=new Date(Y.value2);}n[N]={ranges:[Y],items:[],value:""};}continue;}else if($.indexOf(N)>-1||_.indexOf(N)>-1||c1.indexOf(N)>-1){X=Q.ranges.length;for(i=0;i<X;i++){Y=Q.ranges[i];if(Y.value1&&typeof Y.value1==="string"){Y.value1=new Date(Y.value1);}if(Y.value2&&typeof Y.value2==="string"){Y.value2=new Date(Y.value2);}}}else if(e1&&e1.isCalendarDate){X=Q.ranges.length;for(i=0;i<X;i++){Y=Q.ranges[i];if(Y.value1&&(typeof Y.value1==="string")&&!Y.value1.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){Y.value1=e1.ui5Type.parseValue(new Date(Y.value1),"date");}if(Y.value2&&(typeof Y.value2==="string")&&!Y.value2.match(/([1-9][0-9]{3,}|0[0-9]{3})(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])/)){Y.value2=e1.ui5Type.parseValue(new Date(Y.value2),"date");}}}}n[N]=Q;if(!R&&n[N].ranges){for(i=0;i<n[N].ranges.length;i++){n[N].ranges[i].tokenText=null;}}}else if(typeof Q==="string"||typeof Q==="number"||Q instanceof Date){if(Q&&($.indexOf(N)>-1||_.indexOf(N)>-1)){if(typeof Q==="string"){Q=new Date(Q);}n[N]={ranges:[{"exclude":false,"operation":"EQ","keyField":N,"value1":Q,"value2":null}],items:[],value:""};}else{n[N]={value:Q,items:[]};}}}else{n[N]=null;if(typeof Q==="string"||typeof Q==="boolean"||typeof Q==="number"||Q instanceof Date){if(typeof Q==="string"&&($.indexOf(N)>-1||_.indexOf(N)>-1||c1.indexOf(N)>-1)){n[N]=new Date(Q);}else{n[N]=Q;}}else if(Q&&(Q.value||Q.value===0||Q.value===false)){n[N]=Q.value;}else if(Q&&Q.items&&Q.items.length){n[N]=Q.items[0].key;}else if(Q&&Q.ranges&&Q.ranges.length){X=Q.ranges.length;for(i=0;i<X;i++){Y=Q.ranges[i];if(!Y.exclude&&Y.operation==="EQ"){break;}Y=null;}if(Y&&Y.value1){if(typeof Y.value1==="string"&&($.indexOf(N)>-1||_.indexOf(N)>-1||c1.indexOf(N)>-1)){n[N]=new Date(Y.value1);}else{n[N]=Y.value1;}}}}}else if(R||N===H.CUSTOM_FIELDS_MODEL_PROPERTY){n[N]=W[N];}}}return n;};H.getDateInUTCOffset=function(e){return new Date(e.valueOf()-e.getTimezoneOffset()*60*1000);};H.prototype.destroy=function(){var e=function(K){var i;if(K){i=K.length;while(i--){K[i].destroy();}}};this._oParentODataModel=null;this._aAnalyticalParameters=null;this._aFilterBarViewMetadata=null;this._oParameterization=null;this._oNonAnaParameterization=null;this._aFilterBarFieldNames=null;this._aFilterBarStringDateFieldNames=null;this._aFilterBarDateFieldNames=null;this._aFilterBarTimeFieldNames=null;this._aFilterBarTimeIntervalFieldNames=null;this._aFilterBarDateTimeMultiValueFieldNames=null;this._aFilterBarStringFieldNames=null;this._aFilterBarMultiValueFieldMetadata=null;this._aFilterBarDateTimeFieldNames=null;this._aFieldGroupAnnotation=null;this._aSelectionFields=null;this._aSelectionVariants=null;if(this._oMetadataAnalyser&&this._oMetadataAnalyser.destroy){this._oMetadataAnalyser.destroy();}this._oMetadataAnalyser=null;e(this._aValueHelpDialogProvider);this._aValueHelpDialogProvider=null;e(this._aValueListProvider);this._aValueListProvider=null;if(this._mTokenHandler){for(var j in this._mTokenHandler){var k=this._mTokenHandler[j];if(k.parser){k.parser.destroy();k.parser=null;}}delete this._mTokenHandler;}this.oResourceBundle=null;this.sIntervalPlaceholder=null;this.sDefaultDropDownDisplayBehaviour=null;this.sDefaultTokenDisplayBehaviour=null;this._oSmartFilter=null;if(this._oEventProvider){if(this._oEventProvider.destroy){this._oEventProvider.destroy();}this._oEventProvider=null;}for(var n in this._mConditionTypeFields){this._mConditionTypeFields[n].conditionType.destroy();}this._mConditionTypeFields=null;if(this.oModel){this.oModel.destroy();this.oModel=null;}this._aPromises=[];this.bIsDestroyed=true;};return H;},true);
