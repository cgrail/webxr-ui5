/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/ui/comp/library','sap/ui/core/Element','sap/ui/layout/form/SimpleForm','sap/m/Title','sap/m/Label','sap/m/Text','sap/m/Image','sap/m/Link','sap/ui/base/ManagedObjectObserver','sap/ui/comp/odata/MetadataAnalyser','sap/base/Log',"sap/ui/layout/library","sap/ui/core/library"],function(q,C,E,S,T,L,c,I,d,M,e,f,l,g){"use strict";var h=g.TitleLevel;var i=l.form.SimpleFormLayout;var j=E.extend("sap.ui.comp.navpopover.ContactDetailsController",{metadata:{library:"sap.ui.comp"}});j.prototype.init=function(){this._oObserver=null;};j.prototype.exit=function(){if(this._oObserver){this._oObserver.disconnect();this._oObserver=null;}};j.prototype.getBindingPath4ContactAnnotation=function(b,s,k){if(s===undefined||s===null||!b){return Promise.resolve(null);}if(!this.getModel()){return Promise.resolve(null);}if(!this.getModel().getMetaModel()){return Promise.resolve(null);}var m=this.getModel().getMetaModel();return m.loaded().then(function(){var p;try{m.getMetaContext(b);}catch(o){f.error("sap.ui.comp.navpopover.ContactDetailsController.getBindingPath4ContactAnnotation: binding path '"+b+"' is not valid. Error has been caught: "+o);return null;}try{p="/"+s+"('"+k+"')";m.getMetaContext(p);return p;}catch(o){}try{p=s?b+"/"+s:b;m.getMetaContext(p);return p;}catch(o){f.error("sap.ui.comp.navpopover.ContactDetailsController.getBindingPath4ContactAnnotation: the path of sContactAnnotationPath '"+b+"/"+s+"' is not valid. Error has been caught: "+o);return null;}});};j.prototype.getContactDetailsAnnotation=function(b){if(!b){return null;}var m=new e(this.getModel());var o=m.getContactAnnotation(b);if(!o){return null;}return o;};j.prototype.getContactDetailsContainers=function(b){var o=this.getContactDetailsAnnotation(b);if(!o){return[];}var a=[];var k=[];var s=[];var m;this._oObserver=new M(function(n){if(n.type==="property"&&n.name==="visible"){var v=false;for(var p=1;p<m.getContent().length;p++){if(m.getContent()[p].getLabelFor&&m.getContent()[p].getLabelFor()){continue;}if(m.getContent()[p].getVisible()){v=true;}}m.setVisible(v);}});var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.addProperty2ExpandAndSelect("photo",o,b,k,s);this._addPhoto("photo",o,b,a,this._oObserver);this.addProperty2ExpandAndSelect("fn",o,b,k,s);this._addLabeledText("fn",r.getText("POPOVER_CONTACT_SECTION_NAME"),o,b,a,this._oObserver);this.addProperty2ExpandAndSelect("role",o,b,k,s);this._addLabeledText("role",r.getText("POPOVER_CONTACT_SECTION_ROLE"),o,b,a,this._oObserver);this.addProperty2ExpandAndSelect("title",o,b,k,s);this._addLabeledText("title",r.getText("POPOVER_CONTACT_SECTION_JOBTITLE"),o,b,a,this._oObserver);this.addProperty2ExpandAndSelect("org",o,b,k,s);this._addLabeledText("org",r.getText("POPOVER_CONTACT_SECTION_DEPARTMENT"),o,b,a,this._oObserver);this._addEmails(o,b,k,s,a,this._oObserver);this._addTels(o,b,k,s,a,this._oObserver);this._addAddresses(o,b,k,s,a,this._oObserver);if(!a.length){return[];}a.splice(0,0,new T({text:sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("POPOVER_CONTACT_SECTION_TITLE"),level:h.H2}));m=new S({maxContainerCols:1,editable:false,layout:i.ResponsiveGridLayout,content:a});this._requestData(m,b,k,s);return[m];};j.prototype._addPhoto=function(a,o,b,k,O){if(!o[a]){return;}var B=b+"/"+o[a].Path;if(this.isPropertyHidden(B)){return;}var m=new I({src:{path:B},visible:{path:B,formatter:function(v){return!!v;}},decorative:false});m.addStyleClass("sapUiIcon");m.addStyleClass("navigationPopoverThumbnail");O.observe(m,{properties:["visible"]});k.push(m);};j.prototype._addLabeledText=function(a,s,o,b,k,O){if(!o[a]){return;}var B=b+"/"+o[a].Path;if(this.isPropertyHidden(B)){return;}var m=new c({text:{path:B},visible:{path:B,formatter:function(v){return!!v;}}});var n=new L({text:s,labelFor:m.getId()});O.observe(m,{properties:["visible"]});k.push(n);k.push(m);};j.prototype._addEmails=function(o,B,k,s,m,O){if(!o.email||!o.email.length){return;}var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var n=q.extend(true,[],o.email);n.filter(function(a){return!a.processed&&a.type&&(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1||a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/work")>-1);}).sort(function(a,b){if(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return-1;}if(b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return 1;}return 0;}).forEach(function(a){this.addProperty2ExpandAndSelect("address",a,B,k,s);this._addLabeledEmail("address",r.getText("POPOVER_CONTACT_SECTION_EMAIL"),a,B,m,O);a.processed=true;},this);};j.prototype._addTels=function(o,B,k,s,m,O){if(!o.tel||!o.tel.length){return;}var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var t=q.extend(true,[],o.tel);t.filter(function(a){return!a.processed&&a.type&&a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/work")>-1;}).sort(function(a,b){if(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1;}if(b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1;}return 0;}).forEach(function(a){this.addProperty2ExpandAndSelect("uri",a,B,k,s);this._addLabeledTel("uri",r.getText("POPOVER_CONTACT_SECTION_PHONE"),a,B,m,O);a.processed=true;},this);t.filter(function(a){return!a.processed&&a.type&&a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/cell")>-1;}).sort(function(a,b){if(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1;}if(b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1;}return 0;}).forEach(function(a){this.addProperty2ExpandAndSelect("uri",a,B,k,s);this._addLabeledTel("uri",r.getText("POPOVER_CONTACT_SECTION_MOBILE"),a,B,m,O);a.processed=true;},this);t.filter(function(a){return!a.processed&&a.type&&a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/fax")>-1;}).sort(function(a,b){if(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return-1;}if(b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1){return 1;}return 0;}).forEach(function(a){this.addProperty2ExpandAndSelect("uri",a,B,k,s);this._addLabeledTel("uri",r.getText("POPOVER_CONTACT_SECTION_FAX"),a,B,m,O);a.processed=true;},this);t.filter(function(a){return!a.processed&&a.type&&a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.PhoneType/preferred")>-1;}).forEach(function(a){this.addProperty2ExpandAndSelect("uri",a,B,k,s);this._addLabeledTel("uri",r.getText("POPOVER_CONTACT_SECTION_PHONE"),a,B,m,O);a.processed=true;},this);};j.prototype._addAddresses=function(o,B,k,s,m,O){if(!o.adr||!o.adr.length){return;}var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var A=q.extend(true,[],o.adr);A.filter(function(a){return!a.processed&&a.type&&(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1||a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/work")>-1);}).sort(function(a,b){if(a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return-1;}if(b.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")>-1&&a.type.EnumMember.indexOf("com.sap.vocabularies.Communication.v1.ContactInformationType/preferred")<0){return 1;}return 0;}).forEach(function(a){this._addLabeledAddress(r.getText("POPOVER_CONTACT_SECTION_ADR"),a,B,k,s,m,O);a.processed=true;},this);};j.prototype._addLabeledAddress=function(s,a,b,k,m,n,o){var p=[];["street","code","locality","region","country"].forEach(function(A){this.addProperty2ExpandAndSelect(A,a,b,k,m);var B;if(a[A]){B=b+"/"+a[A].Path;}p.push(B&&!this.isPropertyHidden(B)?{path:B}:{path:"$notExisting"});},this);if(!p.length){return;}var r=new c({text:{parts:p,formatter:function(u,v,w,R,x){var V=[];if(u){V.push(u);}if(v&&w){V.push(v+" "+w);}else{if(v){V.push(v);}if(w){V.push(w);}}if(R){V.push(R);}if(x){V.push(x);}return V.join(', ');}},visible:{parts:p,formatter:function(u,v,w,R,x){return!!(u||v||w||R||x);}}});var t=new L({text:s,labelFor:r.getId()});o.observe(r,{properties:["visible"]});n.push(t);n.push(r);};j.prototype._addLabeledTel=function(a,s,t,b,k,o){if(!t[a]||!b){return;}var B=b+"/"+t[a].Path;if(this.isPropertyHidden(B)){return;}var m=new d({href:{path:B,formatter:function(v){return v?"tel:"+v:v;}},text:{path:B},visible:{path:B,formatter:function(v){return!!v;}}});var n=new L({text:s,labelFor:m.getId()});o.observe(m,{properties:["visible"]});k.push(n);k.push(m);};j.prototype._addLabeledEmail=function(a,s,o,b,k,O){if(!o[a]||!b){return;}var B=b+"/"+o[a].Path;if(this.isPropertyHidden(B)){return;}var m=new d({href:{path:B,formatter:function(v){return v?"mailto:"+v:v;}},text:{path:B},visible:{path:B,formatter:function(v){return!!v;}}});var n=new L({text:s,labelFor:m.getId()});O.observe(m,{properties:["visible"]});k.push(n);k.push(m);};j.prototype.addProperty2ExpandAndSelect=function(a,A,b,k,s){if(!A[a]||!b){return;}var B=b+"/"+A[a].Path;if(!B){return;}if(B.indexOf("/")!==0){throw("sap.ui.comp.navpopover.ContactDetailsController.addProperty2ExpandAndSelect: the path of sBindingPathOfProperty '"+B+"' is not valid.");}var p=B.split("/");p.shift();p.shift();var m=p.join("/");if(m){s.push(m);}p.pop();var n=p.join("/");if(!n){return;}var o=k.filter(function(P){return P===n;});if(!o.length){k.push(n);}};j.prototype.isPropertyHidden=function(p){var m;if(!this.getModel()){f.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the model does not exist");return false;}if(!this.getModel().getMetaModel()){f.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the model should be the ODataModel");return false;}try{m=this.getModel().getMetaModel().getMetaContext(p);}catch(o){f.error("sap.ui.comp.navpopover.ContactDetailsController.isPropertyHidden: the path of property path '"+p+"' is not valid. Error has been caught: "+o);return false;}var P=m.getProperty(m.getPath());return e.isHidden(P);};j.prototype._requestData=function(s,b,a,k){var p={};if(a.length){p.expand=a.join(",");}if(k.length){p.select=k.join(",");}var B="/"+b.split("/")[1];s.bindContext({path:B,parameters:p,events:{change:function(){s.invalidate();}}});};return j;},true);
