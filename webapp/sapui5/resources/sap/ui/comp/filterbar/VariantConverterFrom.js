/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/comp/library','sap/m/MultiComboBox','sap/m/MultiInput','sap/m/DatePicker','sap/m/DateRangeSelection',"sap/base/Log"],function(l,M,a,D,b,L){"use strict";var A=l.ANALYTICAL_PARAMETER_PREFIX;var V=l.valuehelpdialog.ValueHelpRangeOperation;var c=function(){};c.prototype.convert=function(s,f,S){var C=null,r=null,o;if(s){this._bStrictMode=S;o=JSON.parse(s);if(f&&f.getFilterBarViewMetadata&&o){this._sBasicSearchName=null;this._sBasicSearchValue=null;if(f.getBasicSearchName){this._sBasicSearchName=f.getBasicSearchName();}C={};if(o.Parameters){this._addParameters(o.Parameters,f,C);}if(o.SelectOptions){this._addSelectOptions(o.SelectOptions,f,C);}r={payload:null,variantId:null};r.payload=JSON.stringify(C);if(o.SelectionVariantID){r.variantId=o.SelectionVariantID;}if(this._sBasicSearchValue){r.basicSearch=this._sBasicSearchValue;}}}return r;};c.prototype.retrieveVariantId=function(s){var v=null;var S;if(s){S=JSON.parse(s);if(S&&S.SelectionVariantID){v=S.SelectionVariantID;}}return v;};c.prototype._getParameterMetaData=function(n,f,i){if(this._bStrictMode){return this._getParameterMetaDataStrictMode(n,f);}return this._getParameterMetaDataNonStrictMode(n,f,i);};c.prototype._getFilter=function(n,f){var i,j,g,F;F=f.getFilterBarViewMetadata();if(F){for(i=0;i<F.length;i++){g=F[i];for(j=0;j<g.fields.length;j++){if(n===g.fields[j].fieldName){return g.fields[j];}}}}return null;};c.prototype._getParameter=function(n,f){var j,d;if(f.getAnalyticalParameters){d=f.getAnalyticalParameters();if(d){for(j=0;j<d.length;j++){if(n===d[j].fieldName){return d[j];}}}}return null;};c.prototype._getParameterWithInnerPrefix=function(n,f){var p=n;if(n.indexOf(A)!==0){p=A+n;}return this._getParameter(p,f);};c.prototype._getParameterMetaDataStrictMode=function(n,f){var m=this._getExactFilterParameterMatch(n,f);if(m){return m;}return null;};c.prototype._getParameterMetaDataNonStrictMode=function(o,f,i){var m,n,N,t,s=o;if(o.indexOf(A)===0){s=o.substr(A.length);}if(s.indexOf("P_")===0){n=s;N=s.substr(2);}else{n="P_"+s;N=s;}if(s!==n){t=n;}else if(s!==N){t=N;}m=this._getExactParameterMatch(s,f);if(m){return m;}m=this._getExactParameterMatch(t,f);if(m){return m;}if(!i){m=this._getFilter(o,f);if(m){return m;}}return null;};c.prototype._getExactParameterMatch=function(n,f){var p;p=this._getParameterWithInnerPrefix(n,f);if(p){return p;}return null;};c.prototype._getExactFilterParameterMatch=function(n,f){var F,p;F=this._getFilter(n,f);if(F){return F;}p=this._getParameterWithInnerPrefix(n,f);if(p){return p;}return null;};c.prototype._addParameters=function(s,f,C){var i;var n,v;var F;for(i=0;i<s.length;i++){v=s[i].PropertyValue;n=s[i].PropertyName;if(this._sBasicSearchName&&(n===this._sBasicSearchName)){this._sBasicSearchValue=v;continue;}F=this._getParameterMetaData(n,f,true);if(F){f.determineControlByName(n);this._addAccordingMetaData(C,f,F,v);}else{L.error("neither metadata nor custom information for filter '"+n+"'");}}};c.prototype._addSelectOptions=function(s,f,C){var i;var n,r;var F,o;for(i=0;i<s.length;i++){n=s[i].PropertyName;r=s[i].Ranges;if(this._sBasicSearchName&&(n===this._sBasicSearchName)){if(r&&r.length>0){this._sBasicSearchValue=r[0].Low;}continue;}f.determineControlByName(n);F=this._getParameterMetaData(n,f,false);if(F){o=F.control;this._addRangesAccordingMetaData(C,f,F,r,o);}else{L.error("neither metadata nor custom information for filter '"+n+"'");}}};c.convertOption=function(s,v){var i;switch(s){case"CP":i=V.Contains;if(v){var n=v.indexOf('*');var d=v.lastIndexOf('*');if(n>-1){if((n===0)&&(d!==(v.length-1))){i=V.EndsWith;v=v.substring(1,v.length);}else if((n!==0)&&(d===(v.length-1))){i=V.StartsWith;v=v.substring(0,v.length-1);}else{v=v.substring(1,v.length-1);}}}break;case"EQ":case"BT":case"LE":case"GE":case"GT":case"LT":i=s;break;default:L.error("Suite Option is not supported '"+s+"'");i=undefined;v=undefined;}return{op:i,v:v};};c.prototype._addRangesAccordingMetaData=function(C,f,F,r,o,n){var i,O;var d=function(k){var m=k.split(".")[0];var p=k.split(".")[1];var P=m.split("T");var q=P[0].split("-");var t=P[1].split(":");return p?new Date(q[0],q[1]-1,q[2],t[0],t[1],t[2],p):new Date(q[0],q[1]-1,q[2],t[0],t[1],t[2]);};var e=function(v){var k=v;if(v&&F){if(F.filterType==="numeric"){if((F.type==="Edm.Decimal")||(F.type==="Edm.Float")||(F.type==="Edm.Double")||(F.type==="Edm.Single")){k=parseFloat(v);}else{k=parseInt(v);}}if((F.type==="Edm.DateTime")||(F.type==="Edm.Time")){if(f&&f.isInUTCMode&&(F.filterType==="date")){if(f.isInUTCMode()){v=v.split('T')[0]+"T00:00:00";}else if(!f.isInUTCMode()&&(v.split("T").length===1)){v+="T00:00:00";}}if(v.indexOf('Z')!==(v.length-1)){if(f&&f.isInUTCMode&&!f.isInUTCMode()&&f.getDateInUTCOffset){k=f.getDateInUTCOffset(new d(v)).toJSON();}else{k=new d(v).toJSON();}}else{L.error("Property '"+F.fieldName+"' was added with zulu time zone information.");}}else if(F.type==="Edm.DateTimeOffset"){k=v;}}return k;};var g=function(k,r){var i,I,O;for(i=0;i<r.length;i++){O=c.convertOption(r[i].Option,r[i].Low);if(O&&O.op){I={"exclude":(r[i].Sign==="E"),"operation":O.op,"keyField":k,"value1":e(O.v),"value2":e(r[i].High)};if(!C[k]){C[k]={ranges:[],items:[],value:null};}C[k].ranges.push(I);}}};var h=function(r){for(var i=0;i<r.length;i++){if(r[i].Sign==="E"){return true;}}return false;};if(r&&r.length>0){if(F.isCustomFilterField){if(!C._CUSTOM){C._CUSTOM={};}C._CUSTOM[F.fieldName]=r[0].Low;return;}if(F.conditionType){for(i=0;i<r.length;i++){if(!r[i].High){r[i].High=r[i].Low;}}g(F.fieldName,r);return;}if(F.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.single){if(!r[0].Low&&o&&(o instanceof D)){C[F.fieldName]=null;}else{C[F.fieldName]=e(r[0].Low);}}else if(F.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.interval){if(o&&(o instanceof b)){if(r[0].Low&&r[0].High){C[F.fieldName]={low:e(r[0].Low),high:e(r[0].High)};}else if(r[0].Low&&!r[0].High){C[F.fieldName]={low:e(r[0].Low),high:e(r[0].Low)};}else if(!r[0].Low&&r[0].High){C[F.fieldName]={low:e(r[0].High),high:e(r[0].High)};}else{C[F.fieldName]={low:null,high:null};}}else{if(F.type==="Edm.Time"){g(F.fieldName,r);}else{C[F.fieldName]={low:r[0].Low===undefined?null:e(r[0].Low),high:r[0].High===undefined?null:e(r[0].High)};}}}else if(F.filterRestriction===sap.ui.comp.smartfilterbar.FilterType.multiple){C[F.fieldName]={ranges:[],items:[],value:null};var s=(F.type==="Edm.DateTimeOffset")||F.isCalendarDate||(F.type==="Edm.DateTime")||(F.type==="Edm.Time");var j=(o instanceof a)&&h(r);if(o&&!s&&((o instanceof M)||(o instanceof a))&&!j){for(i=0;i<r.length;i++){O=c.convertOption(r[i].Option,e(r[i].Low));if(O.op===V.EQ){C[F.fieldName].items.push({key:e(O.v)});}}}else{g(F.fieldName,r);}}else{g(F.fieldName,r);}L.warning("potential reduced information for filter '"+F.fieldName+"'");}else{L.warning("no Ranges-section found for filter '"+F.fieldName+"'");}};c.prototype._addAccordingMetaData=function(C,f,F,v){var h=F.type==="Edm.DateTime"?"":v;var r=[{Sign:"I",Low:v,High:h,Option:"EQ"}];this._addRangesAccordingMetaData(C,f,F,r);};return c;},true);
