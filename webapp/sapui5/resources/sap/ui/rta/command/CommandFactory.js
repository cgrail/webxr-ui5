/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/base/ManagedObject','sap/ui/dt/ElementUtil','sap/ui/dt/OverlayUtil','sap/ui/dt/OverlayRegistry','sap/ui/fl/Utils','sap/ui/dt/Util','sap/base/util/merge'],function(M,E,O,a,F,D,m){"use strict";function e(y,z){var B=O.getAggregationInformation(y);if(B.elementId){var A=a.getOverlay(B.elementId);var P=A.getParentElementOverlay();var G=P?O.isInAggregationBinding(P,P.sParentAggregationName):false;if(G){throw D.createError("CommandFactory#evaluateTemplateBinding","Multiple template bindings are not supported","sap.ui.rta");}var T=E.extractTemplateId(B);if(T){return{templateSelector:B.elementId,originalSelector:T,content:{boundAggregation:B.aggregation}};}}return undefined;}function g(y){var z=(typeof y==="string")?sap.ui.getCore().byId(y):y;var A=a.getOverlay(z);if(A){var B=O.getAggregationInformation(A);return E.extractTemplateId(B);}else{return z.getId();}}function b(y){if(!y){throw new Error("adjustment for template failed");}}function c(y,z,A){var B;var J=false;if(typeof(A)==="string"){B=A;}else{B=A&&A.changeType;J=A&&A.jsOnly;}if(!B){return false;}z.setChangeType(B);z.setJsOnly(J);return true;}function d(y,S,z){var A={changeType:"addXML"};if(z){jQuery.extend(A,z.getAction("addXML",y));}return A;}function f(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);}function h(y,S,z){var N=S.element||sap.ui.getCore().byId(S.element.id);var A=z.getActionDataFromAggregations("createContainer",N)[0];return A;}function i(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);S.parentId=g(S.parentId);b(S.parentId);}function j(y,S,z){var A=S.movedElements[0].element||sap.ui.getCore().byId(S.movedElements[0].id);var B=z.getAction("move",A);if(!B&&z.getMetadata().getName()==="sap.ui.dt.ElementDesignTimeMetadata"){B=z.getActionDataFromAggregations("move",y).filter(function(G){return G.aggregation===S.source.aggregation;})[0];}return B;}function k(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);S.source.parent=sap.ui.getCore().byId(g(S.source.parent));b(S.source.parent);S.target.parent=sap.ui.getCore().byId(g(S.target.parent));b(S.target.parent);S.movedElements.forEach(function(y){y.element=sap.ui.getCore().byId(g(y.element));b(y.element);});}function l(y,S,z){var R=S.renamedElement;var A=z.getAction("rename",R);return A;}function n(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);S.renamedElement=sap.ui.getCore().byId(g(S.renamedElement));b(S.renamedElement);}function o(y,S,z){var R=S.removedElement;if(!R){R=y;}else if(!(R instanceof M)){throw new Error("No valid 'removedElement' found");}var A=z.getAction("remove",R);return A;}function p(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);S.removedElement=sap.ui.getCore().byId(g(S.removedElement));b(S.removedElement);}function q(y,S,z){var A=S.source;var B=z.getAction("combine",A);return B;}function r(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);S.source=sap.ui.getCore().byId(g(S.source));b(S.source);S.combineFields.forEach(function(y){y=sap.ui.getCore().byId(g(y));b(y);});}function s(y,S,z){var A=S.source;var B=z.getAction("split",A);return B;}function t(S){S.element=sap.ui.getCore().byId(g(S.element));b(S.element);S.parentElement=sap.ui.getCore().byId(g(S.parentElement));b(S.parentElement);S.source=sap.ui.getCore().byId(g(S.source));b(S.source);}function u(y,S,z){var N=S.element;var A=z.getAction("addODataProperty",N);return A;}function v(y,S,z){var R=S.element;var A=z.getAction("reveal",R);return A;}function w(y,S,z){var A=z.getAction("add",S.element);if(A&&A.custom&&typeof A.custom.getItems==="function"){var B={changeOnRelevantContainer:S.changeOnRelevantContainer,changeType:S.changeType};delete S["changeOnRelevantContainer"];return B;}}var C={"composite":{clazz:'sap.ui.rta.command.CompositeCommand',noSelector:true},"property":{clazz:'sap.ui.rta.command.Property'},"bindProperty":{clazz:'sap.ui.rta.command.BindProperty'},"addXML":{clazz:'sap.ui.rta.command.AddXML',configure:d,adjustForBinding:f},"createContainer":{clazz:'sap.ui.rta.command.CreateContainer',configure:h,adjustForBinding:i},"move":{clazz:'sap.ui.rta.command.Move',configure:j,adjustForBinding:k},"remove":{clazz:'sap.ui.rta.command.Remove',configure:o,adjustForBinding:p},"rename":{clazz:'sap.ui.rta.command.Rename',configure:l,adjustForBinding:n},"addODataProperty":{clazz:'sap.ui.rta.command.AddODataProperty',configure:u},"reveal":{clazz:'sap.ui.rta.command.Reveal',configure:v},"customAdd":{clazz:'sap.ui.rta.command.CustomAdd',configure:w},"combine":{clazz:'sap.ui.rta.command.Combine',configure:q,adjustForBinding:r},"split":{clazz:'sap.ui.rta.command.Split',configure:s,adjustForBinding:t},"switch":{clazz:'sap.ui.rta.command.ControlVariantSwitch'},"duplicate":{clazz:'sap.ui.rta.command.ControlVariantDuplicate'},"setTitle":{clazz:'sap.ui.rta.command.ControlVariantSetTitle'},"configure":{clazz:'sap.ui.rta.command.ControlVariantConfigure'},"settings":{clazz:'sap.ui.rta.command.Settings'},"addLibrary":{clazz:'sap.ui.rta.command.appDescriptor.AddLibrary',noSelector:true},"appDescriptor":{clazz:'sap.ui.rta.command.AppDescriptorCommand',noSelector:true}};function _(y,z,S,A,B,V){z=z[0].toLowerCase()+z.slice(1);var G=C[z];var H=B;if(!G){return Promise.reject(D.createError("CommandFactory#_getCommandFor","Command '"+z+"' doesn't exist, check typing","sap.ui.rta"));}return new Promise(function(R){var I=G.clazz;sap.ui.require([I.replace(/\./g,"/")],function(J){R(J);});}).then(function(I){var J,K,P,L,T;var N=y instanceof M;if(!G.noSelector){S=Object.assign({},S,!N&&{selector:y});}S=Object.assign({},S,{element:N?y:undefined,name:z});if(G.configure){J=G.configure(y,S,A);}if(N){K=a.getOverlay(y);}if(J&&J.changeOnRelevantContainer){Object.assign(S,{element:K.getRelevantContainer()});y=S.element;}if(K&&y.sParentAggregationName){T=e(K,y);}if(T){if(G.adjustForBinding){G.adjustForBinding(S);}H=m(T,H);}L=new I(S);var Q=true;if(G.configure){Q=c(y,L,J);}P=Q&&L.prepare(H,V);if(P){return L;}else{L.destroy();return undefined;}});}var x=M.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{"flexSettings":{type:"object"}},associations:{},events:{}}});x.prototype.init=function(){this.setProperty("flexSettings",{layer:"CUSTOMER",developerMode:true});};x.prototype.setFlexSettings=function(y){this.setProperty("flexSettings",jQuery.extend(this.getFlexSettings(),y));};x.prototype.getCommandFor=function(y,z,S,A,V){return _(y,z,S,A,this.getFlexSettings(),V);};x.getCommandFor=function(y,z,S,A,B){if(!B){B={layer:"CUSTOMER",developerMode:true};}if(B.scenario||B.baseId){var L=F.buildLrepRootNamespace(B.baseId,B.scenario,B.projectId);B.rootNamespace=L;B.namespace=L+"changes/";}return _(y,z,S,A,B);};return x;},true);
