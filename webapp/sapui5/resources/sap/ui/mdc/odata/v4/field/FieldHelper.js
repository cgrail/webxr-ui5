/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/odata/v4/CommonHelper","sap/ui/mdc/base/FieldBase","sap/ui/mdc/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/base/ManagedObject","sap/base/Log"],function(C,F,R,A,M,L){"use strict";var I="@Org.OData.Measures.V1.ISOCurrency",U="@Org.OData.Measures.V1.Unit",a={},b=', ';a[I]={ui5Type:"sap.ui.model.type.Currency",formatOptions:'parseAsString : true'};var c={displayMode:function(o,i){var t=o['@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement'];if(!o['@com.sap.vocabularies.Common.v1.Text']){return'Value';}else if(t){if(t.$EnumMember==='com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly'){return'Description';}else if(t.$EnumMember==='com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst'){return'DescriptionValue';}}return'ValueDescription';},isRequiredInFilter:function(p,d){var e,P,i=false,f,m=d.context.getModel(),s=d.context.getPath();e=C._getEntitySetPath(m,s);if(typeof p==="string"){P=p;}else{P=m.getObject(s+"@sapui.name");}f=m.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(f&&f.RequiredProperties){i=f.RequiredProperties.some(function(g){return g.$PropertyPath===P;});}return i;},buildExpressionForCriticalityIcon:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'sap-icon://status-negative' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'sap-icon://status-critical' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'sap-icon://status-positive' : "+"'sap-icon://status-inactive' }";return e;}return undefined;},buildExpressionForCriticalityColor:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'Error' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'Warning' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'Success' : "+"'None' }";return e;}return undefined;},buildExpressionForTextValue:function(p,d){var m=d.context.getModel(),P=d.context.getPath(),t=m.getObject(P+"@com.sap.vocabularies.Common.v1.Text"),T=t?A.value(t,d):undefined,e="";p=A.getNavigationPath(p);if(p.indexOf('/')>-1&&T){e="{"+p.substr(0,p.indexOf('/')+1)+T.substr(1,T.length-2)+"}";}else{e=T;}if(e){e="{ path : '"+e.substr(1,e.length-2)+"', mode : 'OneWay'}";}return e;},getStableIdPartFromDataField:function(d,p){var P="",s="";if(d.$Type&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return C.replaceSpecialCharsInId(d.Action);}else if(d.$Type&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){if(typeof d.SemanticObject=="string"){s=C.replaceSpecialCharsInId(d.SemanticObject);}else if(d.SemanticObject.$Path){s=C.replaceSpecialCharsInId(d.SemanticObject.$Path);}if(typeof d.Action=="string"){s=s+"::"+C.replaceSpecialCharsInId(d.Action);}else if(d.Action&&d.Action.$Path){s=s+"::"+C.replaceSpecialCharsInId(d.Action.$Path);}return s;}else if(d.$Type&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){return C.replaceSpecialCharsInId(d.Target.$AnnotationPath);}else if(d.Value&&d.Value.$Path){return C.replaceSpecialCharsInId(d.Value.$Path);}else if(d.Value&&d.Value.$Apply&&d.Value.$Function==="odata.concat"){for(var i=0;i<d.Value.$Apply.length;i++){if(d.Value.$Apply[i].$Path){if(P){P=P+"::";}P=P+C.replaceSpecialCharsInId(d.Value.$Apply[i].$Path);}}return P;}else if(p&&p.context&&p.context.getObject("@sapui.name")){return C.replaceSpecialCharsInId(p.context.getObject("@sapui.name"));}else{L.error("Annotation Helper: Unable to create a stable ID. Please check the annotations.");}return undefined;},isNotAlwaysHidden:function(d,D){var o=D.context,i=false;if(d.Value&&d.Value.$Path){i=o.getObject("Value/$Path@com.sap.vocabularies.UI.v1.Hidden");}if(!i||i.$Path){i=o.getObject("@com.sap.vocabularies.UI.v1.Hidden");if(!i||i.$Path){i=false;}}return!i;},isSemanticKey:function(s,v){return v&&s&&!(s.every(function(k){return k['$PropertyPath']!==v['$Path'];}))||false;},getEditMode:function(o,d,f,D,e){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return e;}var g,i,r,s,E,h,j,k;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return'Display';}if(o["@Org.OData.Core.V1.Computed"]){g=o["@Org.OData.Core.V1.Computed"].Bool?o["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(o["@Org.OData.Core.V1.Immutable"]){i=o["@Org.OData.Core.V1.Immutable"].Bool?o["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}r=g||i;j=typeof g==="undefined"?typeof i==="undefined"||i:!g;if(f){if(M.bindingParser(f)){k="$"+f+" === '1'";}else{r=(r||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly");}}var l;h=M.bindingParser(e)?"$"+e:"'"+e+"'";if(r){if(!j||!D){return'Display';}else{return"{= !%{IsActiveEntity} && !%{HasActiveEntity} ?"+h+" : 'Display'}";}}if(k){s=k+" ? 'Display' :"+h;l="{= "+s+"}";}else{s=h;l=e;}E=j||!D?l:"{= !%{IsActiveEntity} && !%{HasActiveEntity} ? 'Display' : "+s+"}";return E;},isLineItem:function(p,i){if(i.context.getPath().indexOf("@com.sap.vocabularies.UI.v1.LineItem")>-1){return true;}return false;},getRequiredForDataField:function(n,f,e){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return false;}if(n===false){return true;}if(f){if(M.bindingParser(f)){var E="{= %"+f+" === 7}";return E;}else{return(f=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory");}}return false;},isRequired:function(f,e){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return false;}if(f){if(M.bindingParser(f)){var E="{= %"+f+" === 7}";return E;}else{return(f=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory");}}return false;},_createBindingForDraftAdminBlock:function(m,e,f){var p="/"+e+"/DraftAdministrativeData/";return m.requestObject(p).then(function(d){var B="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(d.InProcessByUserDescription){B+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}";}if(d.LastChangedByUserDescription){B+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}";}B+="], formatter: 'sap.ui.mdc.odata.v4.field.FieldRuntime."+f+"'}";return B;});},getBindingForDraftAdminBlockInline:function(i,e){return c._createBindingForDraftAdminBlock(i.getModel(),e,'formatDraftOwnerTextInline');},getBindingForDraftAdminBlockInPopover:function(i,e){return c._createBindingForDraftAdminBlock(i.getModel(),e,'formatDraftOwnerTextInPopover');},propertyName:function(p,i){return typeof p==='string'?p:i.context.getObject("@sapui.name");},typeConstraints:function(p,P){var s="",m,t=p.$Type;s+=(p.$Nullable!==undefined&&!p.$Nullable?'nullable: '+p.$Nullable:'');if(["Edm.Decimal","Edm.DateTimeOffset"].indexOf(t)>-1){s+=(s?b:'');s+=(p.$Precision?'precision: '+p.$Precision:'');s+=(p.$Scale?(s?b:'')+'scale: '+(p.$Scale==="variable"?"'"+p.$Scale+"'":p.$Scale):'');}else if(t==="Edm.String"){m=p.$MaxLength;if(m){s+=(s?b:'');s+="maxLength: "+m;}if(P["@com.sap.vocabularies.Common.v1.IsUpperCase"]){}}return s;},value:function(p,i){var o=i.context,r=o.getObject("./$"),m=typeof p==='string'?p:(p.$Name||o.getObject("./$@sapui.name")),P=o.getObject("@");return Promise.resolve().then(function(v){var s='',d='',f='',e,g,u;if(m&&P){g=P.hasOwnProperty(I)&&I;if(g){e=P[g];u=a[g];s='{'+'parts: ['+'\''+m+'\',\''+e.$Path+'\''+'], type: \''+u.ui5Type+'\'';f+=u.formatOptions;}else{s='{path: \''+m+'\'';s+=',type: \''+F.mapEdmTypes[r.$Type]+'\'';}d+=(d?b:'')+c.typeConstraints(r,P);s+=d?',constraints: {'+d+'}':'';f+=['Edm.Date','Edm.DateTimeOffset'].indexOf(r.$Type)>-1?(f?b:'')+'style : \'medium\'':'';s+=f?',formatOptions : {'+f+'}':'';s+='}';}else{s=A.value(p,{context:o});}return s;});},_format:function(p,i){var o=i.context,d=p.$kind==="Property"?{$PropertyPath:o.getObject("./$@sapui.name")}:p;return A.format(d,{context:o});},constraints:function(p,i){return c.value(p,i).then(function(v){var m=v.match(/constraints:.*?({.*?})/);return m&&m[1]||undefined;});},formatOptions:function(p,i){return c.value(p,i).then(function(v){var m=v.match(/formatOptions:.*?({.*?})/);return m&&m[1]||undefined;});},getFieldGroupIds:function(o,p,e){var m=o.getInterface(0).getModel(),d=m.getObject('/'),f=o.getInterface(0).getSetting("sap.ui.mdc.odata.v4.Field"),s=f.sideEffects,g=function(k){return d[k]['$kind']==='EntitySet';},h=function(E){var e=d[E]['$Type'],k=m.getObject('/'+e+'@');Object.keys(k).filter(function(l){return l.indexOf('@com.sap.vocabularies.Common.v1.SideEffects')>-1;}).forEach(function(S){var q=S.indexOf('#')>-1&&S.substr(S.indexOf('#'))||'',l=k[S],r=l.SourceProperties||[],t=l.SourceEntities||[];r.forEach(function(u){var P=u['$PropertyPath'],n=A.getNavigationPath(P),O=e;if(n.indexOf('/')>-1){O=m.getObject('/'+e+'/'+n.substr(0,n.lastIndexOf('/')))['$Type'];P=n.substr(n.lastIndexOf('/')+1);}s[O]=s[O]||[[],{}];s[O][1][P]=s[O][1][P]||[];s[O][1][P].push(e+q);});t.forEach(function(u){var n=u['$NavigationPropertyPath'],O=m.getObject('/'+e+'/'+n)['$Type'];s[O]=s[O]||[[],{}];s[O][0].push(e+q);});});};if(!s){s={};Object.keys(d).filter(g).forEach(h);f.sideEffects=s;}var P=p,n=A.getNavigationPath(p),O=e,i,j;if(n.indexOf('/')>-1){O=m.getObject('/'+e+'/'+n.substr(0,n.lastIndexOf('/')))['$Type'];P=n.substr(n.lastIndexOf('/')+1);}i=(s[O]&&s[O][0].concat(s[O][1][P]||[]))||[];if(i.length){j=i.reduce(function(r,k){return(r&&r+','+k)||k;});}return j;},fieldControl:function(p,i){var m=i&&i.context.getModel();var P=i&&i.context.getPath();var f=m&&m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl");if(f){if(f.hasOwnProperty("$EnumMember")){return f.$EnumMember;}else if(f.hasOwnProperty("$Path")){return A.value(f,{context:i.context});}}else{return undefined;}},getNavigationEntity:function(p,o){var d=o&&o.context||p,P=A.getNavigationPath(d.getPath())+'/',e=d.getObject(P),f=Object.keys(e),l=f.length,i=0;for(;i<l;i++){if(e[f[i]].$kind==='NavigationProperty'&&e[f[i]].$ReferentialConstraint&&e[f[i]].$ReferentialConstraint.hasOwnProperty(d.getObject().$Path)){return o?A.getNavigationBinding(f[i]):P+f[i];}}},valueHelpProperty:function(p){var P=p.getPath()+'/$Path',s=P+"@",o=p.getObject(s),d;if(o){d=o.hasOwnProperty(I)&&I||o.hasOwnProperty(U)&&U;if(d){P=P+d+'/$Path';}}return P;}};c.buildExpressionForTextValue.requiresIContext=true;c.getEditMode.requiresIContext=true;c.getRequiredForDataField.requiresIContext=true;c.getBindingForDraftAdminBlockInline.requiresIContext=true;c.getBindingForDraftAdminBlockInPopover.requiresIContext=true;c.value.requiresIContext=true;c.getFieldGroupIds.requiresIContext=true;c.fieldControl.requiresIContext=true;return c;},true);
