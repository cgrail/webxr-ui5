/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/base/filterbar/FilterBarHelper","sap/ui/mdc/PropertyInfo","sap/ui/core/format/DateFormat","sap/ui/mdc/library"],function(F,P,D,m){"use strict";var a=m.FilterExpression;var O=Object.assign({},F);var d={"Edm.Boolean":"Bool","Edm.Byte":"Int","Edm.DateTime":"Date","Edm.DateTimeOffset":"DateTimeOffset","Edm.Decimal":"Decimal","Edm.Double":"Float","Edm.Float":"Float","Edm.Guid":"Guid","Edm.Int16":"Int","Edm.Int32":"Int","Edm.Int64":"Int","Edm.SByte":"Int","Edm.Single":"Float","Edm.String":"String","Edm.Time":"TimeOfDay"};O.fetchProperties=function(f){var p=[],o,e,E,M,b;var n=[],r=[],s=[],S=[],i=[];var c=f._getConditionModel(),l;if(c&&c._oListBinding&&c._oListBinding.getPath()){return new Promise(function(g){E=c._oListBinding.getPath();M=f.getModel();b=M.getMetaModel();var A=b.getObject(E+"@Org.OData.Capabilities.V1.FilterRestrictions");if(A){if(A.NonFilterableProperties){A.NonFilterableProperties.every(function(q){n.push(q.$PropertyPath);return true;});}if(A.RequiredProperties){A.RequiredProperties.every(function(q){r.push(q.$PropertyPath);return true;});}if(A.FilterExpressionType){A.FilterExpressionType.every(function(q){if(q.AllowedExpressions==="SingleValue"){S.push(q.Property.$PropertyPath);}else if(q.AllowedExpressions==="SingleInterval"){i.push(q.Property.$PropertyPath);}return true;});}}A=b.getObject(E+"/"+"@com.sap.vocabularies.UI.v1.SelectionFields");if(A){A.every(function(q){s.push(q.$PropertyPath);return true;});}var h,v,V,R,j,k,q,C,I;e=b.getObject(E+"/");for(var K in e){o=e[K];if(o&&o.$kind==="Property"){if(n.indexOf(K)>=0){continue;}if(b.getObject(E+"/"+K+"@com.sap.vocabularies.UI.v1.Hidden")){continue;}h=false;if(b.getObject(E+"/"+K+"@com.sap.vocabularies.UI.v1.HiddenFilter")){h=true;}I=false;if(b.getObject(E+"/"+K+"@com.sap.vocabularies.Common.v1.IsDigitSequence")){I=true;}v=null;k=b.getObject(E+"/"+K+"@com.sap.vocabularies.Common.v1.FilterDefaultValue");if(k){V=k["$"+d[o.$Type]];switch(o.$Type){case"Edm.DateTimeOffset":v=O._parseDateTimeOffset(V);break;default:v=V;}}R=(r.indexOf(K)>=0)?true:false;j=(s.indexOf(K)>=0)?true:false;l=b.getObject(E+"/"+K+"@com.sap.vocabularies.Common.v1.Label")||K;if(o.$MaxLength||o.$Precision||o.$Scale||I){C={};if(o.$MaxLength){C.maxLength=o.$MaxLength;}if(o.$Precision){C.precision=o.$Precision;}if(o.$Scale){C.precision=o.$Scale;}if(I){C.isDigitSequence=I;}}else{C=null;}q=new P({name:K,label:l,type:o.$Type,required:R,hiddenFilter:h,visible:j});if(C){q.setConstraints(C);}if(v){q.setDefaultFilterConditions([{fieldPath:K,operator:"EQ",values:[v]}]);}if(S.indexOf(K)>=0){q.setFilterExpression(a.Single);}else if(i.indexOf(K)>=0){q.setFilterExpression(a.Interval);}p.push(q);}}g(p);});}else{return Promise.resolve([]);}};O._parseDateTimeOffset=function(s){var b="\\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[12]\\d|3[01])",t="(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(\\.\\d{1,12})?)?",r=new RegExp("^"+b+"T"+t+"(?:Z|[-+](?:0\\d|1[0-3]):[0-5]\\d|[-+]14:00)$","i"),o,M=r.exec(s);if(M){if(M[1]&&M[1].length>4){s=s.replace(M[1],M[1].slice(0,4));}o=D.getDateTimeInstance({pattern:"yyyy-MM-dd'T'HH:mm:ss.SSSX",strictParsing:true}).parse(s.toUpperCase());}if(!o){throw new Error("Not a valid Edm.DateTimeOffset value: "+s);}return o;};return O;},false);
