/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['./FieldValueHelpContentWrapperBase','sap/ui/model/ChangeReason','sap/ui/base/ManagedObjectObserver','sap/base/strings/capitalize','sap/m/library'],function(F,C,M,c,l){"use strict";var L=l.ListMode;var S;var a=F.extend("sap.ui.mdc.base.FieldValueHelpMTableWrapper",{metadata:{library:"sap.ui.mdc",aggregations:{table:{type:"sap.m.Table",multiple:false}},defaultAggregation:"table",events:{dataUpdate:{}}}});a.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new M(b.bind(this));this._oObserver.observe(this,{properties:["selectedItems"],aggregations:["table"]});};a.prototype.exit=function(){F.prototype.exit.apply(this,arguments);if(this._oScrollContainer){this._oScrollContainer.destroy();delete this._oScrollContainer;}this._oObserver.disconnect();this._oObserver=undefined;};a.prototype.invalidate=function(O){if(O){var t=this.getTable();if(t&&O===t){if(O.bOutput&&!this._bIsBeingDestroyed){var P=this.getParent();if(P){P.invalidate(this);}}return;}}F.prototype.invalidate.apply(this,arguments);};a.prototype.initialize=function(s){if(s||this._oScrollContainer){return this;}if(!S&&!this._bScrollContainerRequested){S=sap.ui.require("sap/m/ScrollContainer");if(!S){sap.ui.require(["sap/m/ScrollContainer"],_.bind(this));this._bScrollContainerRequested=true;}}if(S&&!this._bScrollContainerRequested){this._oScrollContainer=new S(this.getId()+"-SC",{height:"100%",width:"100%",vertical:true});this._oScrollContainer._oWrapper=this;this._oScrollContainer.getContent=function(){var i=[];var t=this._oWrapper&&this._oWrapper.getTable();if(t){i.push(t);}return i;};}return this;};function _(s){S=s;this._bScrollContainerRequested=false;if(!this._bIsBeingDestroyed){this.initialize();this.fireDataUpdate({contentChange:true});}}a.prototype.getDialogContent=function(){return this._oScrollContainer;};a.prototype.getSuggestionContent=function(){return this.getTable();};a.prototype.fieldHelpOpen=function(s){F.prototype.fieldHelpOpen.apply(this,arguments);var t=this.getTable();if(t){e.call(this,t,s);m.call(this);if(s){var i=t.getSelectedItem();if(i&&i.getDomRef()){i.getDomRef().scrollIntoView();}}}return this;};a.prototype.navigate=function(s){var t=this.getTable();if(!p(t)){this._bNavigate=true;this._iStep=s;return;}var i=t.getSelectedItem();var I=t.getItems();var j=I.length;var q=0;if(i){q=t.indexOfItem(i);q=q+s;}else if(s>=0){q=s-1;}else{q=j+s;}if(q<0){q=0;}else if(q>=j-1){q=j-1;}var r=I[q];if(r&&r!==i){r.setSelected(true);var v=n.call(this,r);if(r.getDomRef()){r.getDomRef().scrollIntoView();}this._bNoTableUpdate=true;this.setSelectedItems([{key:v.key,description:v.description}]);this._bNoTableUpdate=false;this.fireNavigate({key:v.key,description:v.description});}};a.prototype.getTextForKey=function(K){var t="";var T=this.getTable();if(p(T)){var I=T.getItems();for(var i=0;i<I.length;i++){var j=I[i];var v=n.call(this,j);if(v.key===K){t=v.description;break;}}}return t;};a.prototype.getKeyForText=function(t){var K;var T=this.getTable();if(p(T)){var I=T.getItems();for(var i=0;i<I.length;i++){var j=I[i];var v=n.call(this,j);if(v.description===t){K=v.key;break;}}}return K;};a.prototype.getListBinding=function(){var t=this.getTable();var i;if(t){i=t.getBinding("items");}return i;};function b(i){if(i.name==="table"){d.call(this,i.mutation,i.child);}if(i.name==="selectedItems"){m.call(this);}}function d(s,t){if(s==="remove"){t.detachEvent("itemPress",f,this);t.detachEvent("selectionChange",g,this);t.detachEvent("updateFinished",k,this);t=undefined;}else{t.setMode(L.SingleSelectMaster);t.setRememberSelections(false);t.attachEvent("itemPress",f,this);t.attachEvent("selectionChange",g,this);t.attachEvent("updateFinished",k,this);e.call(this,t,this._bSuggestion);m.call(this);if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep);}}this.fireDataUpdate({contentChange:true});}function e(t,s){if(t&&this.getParent()){if(s){if(this._sTableWidth){t.setWidth(this._sTableWidth);}t.setMode(L.SingleSelectMaster);}else{if(t.getWidth()!=="100%"){this._sTableWidth=t.getWidth();t.setWidth("100%");}if(this._getMaxConditions()===1){t.setMode(L.SingleSelectLeft);}else{t.setMode(L.MultiSelect);}}}}function f(E){var i=E.getParameter("listItem");if(!this._bSuggestion){i.setSelected(!i.getSelected());}h.call(this);}function g(E){if(!this._bSuggestion){h.call(this);}}function h(){var I=[];var t=this.getTable();if(t){var s=this.getSelectedItems();var T=t.getItems();var i=0;var q;var v;if(s.length>0){for(i=0;i<T.length;i++){q=T[i];v=n.call(this,q);if(!v){throw new Error("Key of item cannot be determined"+this);}for(var j=s.length-1;j>=0;j--){var r=s[j];if(r.key===v.key){s.splice(j,1);break;}}}}if(s.length>0){I=s;}s=t.getSelectedItems();for(i=0;i<s.length;i++){q=s[i];v=n.call(this,q);if(!v){throw new Error("Key of item cannot be determined"+this);}I.push({key:v.key,description:v.description});}}this._bNoTableUpdate=true;this.setSelectedItems(I);this._bNoTableUpdate=false;this.fireSelectionChange({selectedItems:I});}function k(E){if(!this.getParent()){return;}m.call(this);if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep);}if(E.getParameter("reason")!==c(C.Filter)){this.fireDataUpdate({contentChange:false});}}function m(){if(this._bNoTableUpdate){return;}var t=this.getTable();if(p(t)){var s=this.getSelectedItems();var I=t.getItems();for(var j=0;j<I.length;j++){var q=I[j];var r=false;if(s.length>0){var v=n.call(this,q);for(var i=0;i<s.length;i++){var u=s[i];if(v.key===u.key){r=true;break;}}}if(q.getSelected()!==r){q.setSelected(r);}}}}function n(i){var v;var B=i.getBindingContext();if(B){v=o.call(this,B);}if(!v){var K=this._getKeyPath();var j;var D;if(!K&&i.getCells){var q=i.getCells();if(q.length>0&&q[0].getText){j=q[0].getText();}if(q.length>1&&q[1].getText){D=q[1].getText();}if(j!==undefined){v={key:j,description:D};}}}if(!v){throw new Error("Key could not be determined from item "+this);}return v;}function o(B){var K=this._getKeyPath();var D=this._getDescriptionPath();var i=B.getObject();var v;var s;if(i){if(K&&i.hasOwnProperty(K)){v=i[K];}if(D&&i.hasOwnProperty(D)){s=i[D];}}if(!v){return false;}return{key:v,description:s};}function p(t){if(!t){return false;}var B=t.getBinding("items");if(B&&B.getContexts().length===0){return false;}return true;}return a;},true);
