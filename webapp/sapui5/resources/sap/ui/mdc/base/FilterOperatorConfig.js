/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
*/
sap.ui.define(["sap/ui/base/Object","sap/ui/model/FilterOperator","sap/ui/model/Filter","jquery.sap.global","sap/base/Log","sap/base/util/ObjectPath",'./Condition'],function(B,M,F,q,L,O,C){"use strict";var a=B.extend("sap.ui.mdc.base.FilterOperatorConfig",{constructor:function(){B.apply(this);this.mOperators=q.extend(true,{},a._mOperators);this.mTypes=q.extend(true,{},a._mTypes);this.mOpsForType=q.extend(true,{},a._mOpsForType);}});sap.ui.model.type.String.extend("sap.ui.model.type.Key",{});a._mTypes={"base":undefined,"string":"base","numeric":"base","date":"base","datetime":"base","time":"base","boolean":"base","int":"numeric","float":"numeric","sap.ui.model.type.Boolean":"boolean","sap.ui.model.type.Date":"date","sap.ui.model.type.FileSize":"string","sap.ui.model.type.Float":"float","sap.ui.model.type.Integer":"int","sap.ui.model.type.String":"string","sap.ui.model.type.Time":"time","sap.ui.model.odata.type.Boolean":"boolean","sap.ui.model.odata.type.Byte":"int","sap.ui.model.odata.type.Date":"date","sap.ui.model.odata.type.DateTime":"datetime","sap.ui.model.odata.type.DateTimeOffset":"datetime","sap.ui.model.odata.type.Decimal":"float","sap.ui.model.odata.type.Double":"float","sap.ui.model.odata.type.Single":"float","sap.ui.model.odata.type.Guid":"string","sap.ui.model.odata.type.Int16":"int","sap.ui.model.odata.type.Int32":"int","sap.ui.model.odata.type.Int64":"int","sap.ui.model.odata.type.Raw":"string","sap.ui.model.odata.type.SByte":"int","sap.ui.model.odata.type.String":"string","sap.ui.model.odata.type.Time":"time","sap.ui.model.odata.type.TimeOfDay":"time","Edm.Boolean":"sap.ui.model.odata.type.Boolean","Edm.Byte":"sap.ui.model.odata.type.Byte","Edm.Date":"sap.ui.model.odata.type.Date","Edm.DateTime":"sap.ui.model.odata.type.DateTime","Edm.DateTimeOffset":"sap.ui.model.odata.type.DateTimeOffset","Edm.Decimal":"sap.ui.model.odata.type.Decimal","Edm.Double":"sap.ui.model.odata.type.Double","Edm.Single":"sap.ui.model.odata.type.Single","Edm.Guid":"sap.ui.model.odata.type.Guid","Edm.Int16":"sap.ui.model.odata.type.Int16","Edm.Int32":"sap.ui.model.odata.type.Int32","Edm.Int64":"sap.ui.model.odata.type.Int64","Edm.SByte":"sap.ui.model.odata.type.SByte","Edm.String":"sap.ui.model.odata.type.String","Edm.Time":"sap.ui.model.odata.type.Time","Edm.TimeOfDay":"sap.ui.model.odata.type.TimeOfDay"};Object.freeze(a._mTypes);a._mOpsForType={"base":{operators:["Contains","EQ","BT","StartsWith","EndsWith","LE","LT","GE","GT","NE"],defaultOperator:"EQ"},"string":{operators:["EEQ","Contains","EQ","BT","StartsWith","EndsWith","Empty","NotEmpty","LE","LT","GE","GT","NE"],defaultOperator:"Contains"},"date":{operators:["EQ","BT","LE","LT","GE","GT","NE"]},"datetime":{operators:["EQ","BT","LE","LT","GE","GT","NE"]},"numeric":{operators:["EQ","BT","LE","LT","GE","GT","NE"]},"time":{operators:["EQ","BT","LE","LT","GE","GT"]},"boolean":{operators:["EQ","NE"]}};Object.freeze(a._mOpsForType);a._mOperators={};var m=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");sap.ui.getCore().attachLocalizationChanged(function(){m=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");});function g(k,T){var h=k+(T?"."+T:""),i;if(m.hasText(h)){i=m.getText(h);}else if(T){i=m.getText(k);}else{i=h;}return i;}a._mInstances={};a._mClasses={undefined:a};a.getFor=function(o){var k=o&&o.getId();var h=a._mInstances[k];if(!h){var i=o&&o.getMetadata();var j=a._mClasses[i&&i.getName()];while(!j){i=i.getParent();j=a._mClasses[i&&i.getName()];}h=new j();a._mInstances[k]=h;}return h;};a.registerFor=function(h,o){a._mClasses[h]=o;};a.prototype._getConfig=function(T,h){var o=this.mOpsForType[T];if(o){return o[h];}};a.prototype._findConfig=function(T,h){if(typeof T==="object"){T=T.getMetadata().getName();}var o;while(T&&!(o=this._getConfig(T,h))){T=this.getParentType(T);}return o;};a.prototype.getOperatorsForType=function(T){return this._findConfig(T,"operators")||[];};a.prototype.getDefaultOperator=function(T){return this._findConfig(T,"defaultOperator")||[];};a.prototype.getMatchingOperators=function(T,v){var o=this.getOperatorsForType(T);return this._getMatchingOperators(o,v);};a.prototype._getMatchingOperators=function(o,v){var r=[],h;o.some(function(i){h=this.getOperator(i);if(h&&h.test(v)){r.push(h);}}.bind(this));return r;};a.prototype.addType=function(T,h){if(this.mTypes[T]){throw new Error("Type already exists: "+T);}else{this.mTypes[T]=h;}};a.prototype.getParentType=function(T){return this.mTypes[T];};a.prototype.addOperatorsToType=function(T,o){var h=T;if(typeof h==="object"){h=h.getMetadata().getName();}var i=this.getOperatorsForType(T);if(!(typeof o==="string")){i=i.concat(o);}else{i.push(o);}this.mOpsForType[h]=this.mOpsForType[h]||{};this.mOpsForType[h].operators=i;};a.prototype.addOperator=function(o){a._addOperatorTo(o,this.mOperators);};a._addOperatorTo=function(o,h){var i=h;if(!o.name){L.warning("Operator configuration expects a name property");}if(!o.filterOperator&&!o.getModelFilter){L.error("Operator configuration for "+o.name+" needs a default filter operator from sap.ui.model.FilterOperator or the function getModelFilter");return;}if(!D){if(i[o.name]&&!i[o.name].custom){L.warning("Duplicate Type Configuration: "+o.name+". A default type cannot be extended or overwritten.");return;}o.custom=true;}else{L.debug("Operator Configuration for "+o.name+" defined as default configuration");}o=e(o);if(D){}h[o.name]=o;};function e(o){var i;var T=o.textKey||"operators."+o.name;o.longText=o.longText||g(T+".longText")||"";o.tokenText=o.tokenText||g(T+".tokenText")||"";if(o.tokenParse){if(o.tokenText){o.tokenParse=o.tokenParse.replace(/#tokenText#/g,o.tokenText);var h=o.valueTypes.length;for(i=0;i<h;i++){var r=o.paramTypes?o.paramTypes[i]:o.valueTypes[i];o.tokenParse=o.tokenParse.replace(new RegExp("\\$"+i,"g"),r);}o.tokenParseRegExp=new RegExp(o.tokenParse,"i");}}else if(o.tokenText){o.tokenParseRegExp=new RegExp(o.tokenText,"i");}if(o.tokenFormat){if(o.tokenText){o.tokenFormat=o.tokenFormat.replace(/\#tokenText\#/g,o.tokenText);}}else if(o.tokenText){o.tokenFormat=o.tokenText;}o.format=o.format||f.bind(o);o.parse=o.parse||p.bind(o);o.test=o.test||t.bind(o);o.getCondition=o.getCondition||d.bind(o);o.getModelFilter=o.getModelFilter||b.bind(o);o._setOwner=s.bind(o);o.getTypeText=g.bind(o);o._createLocalType=c.bind(o);o.isEmpty=o.isEmpty||_.bind(o);o.createControl=o.createControl;return o;}function s(o){this.oFilterOperatorConfig=o;return this;}function b(o,h){var i=this.oFilterOperatorConfig.getOperator(o.operator);if(i.valueTypes.length==1){return new F({path:h,operator:i.filterOperator,value1:o.values[0]});}else{return new F({path:h,operator:i.filterOperator,value1:o.values[0],value2:o.values[1]});}}function _(o,T){var h=false;for(var i=0;i<this.valueTypes.length;i++){var v=o.values[i];if(v===null||v===undefined||v===""){h=true;break;}}return h;}function f(V,o,T){var h=this.tokenFormat,j=this.valueTypes.length;for(var i=0;i<j;i++){var v=V[i]!==undefined&&V[i]!==null?V[i]:"";if(this.valueTypes[i]!=="self"){T=this._createLocalType(this.valueTypes[i]);}var r=T?T.formatValue(v,"string"):v;h=h.replace(new RegExp("\\$"+i,"g"),r);}return h;}function p(T,o){var h=T.match(this.tokenParseRegExp);var r;if(h){r=[];for(var i=0;i<this.valueTypes.length;i++){if(this.valueTypes[i]!=="self"){o=this._createLocalType(this.valueTypes[i]);}try{var v=h[i+1];var j;if(o instanceof sap.ui.model.CompositeType&&o._aCurrentValue&&o.getParseWithValues()){j=o._aCurrentValue;}var V=o?o.parseValue(v,"string",j):v;if(j){j.forEach(function(l,i){if(V[i]===undefined){V[i]=l;}});}if(o){o.validateValue(V);if((o.oFormatOptions&&o.oFormatOptions.toUpperCase===true)||(o.oConstraints&&o.oConstraints.toUpperCase===true)){V=V.toUpperCase?V.toUpperCase():V;}}r.push(V);}catch(k){L.warning(k.message);throw k;}}}return r;}function c(T){if(!this._oType){q.sap.require(T);var o=O.get(T||"");this._oType=new o();}return this._oType;}function t(T,o){var h=this.tokenParseRegExp.test(T);if(h&&o){var v=this.parse(T,o);h=v.length==this.valueTypes.length;}return h;}function d(T,o){if(this.test(T,o)){var v=this.parse(T,o);return C.createCondition(this.name,v);}return null;}a.prototype.getOperator=function(o){var h=this.mOperators[o];return h?h._setOwner(this):undefined;};var D=true;a._addOperatorTo({name:"EEQ",showInSuggest:false,filterOperator:M.EQ,tokenParse:"^==(.*)$",tokenFormat:"$1 ($0)",valueTypes:["self"],longText:"EEQ",displayFormats:{DescriptionValue:"$1 ($0)",ValueDescription:"$0 ($1)",Description:"$1",Value:"$0"},format:function(v,o,T,h){h=h||"DescriptionValue";var j=this.valueTypes.length+1,k=this.displayFormats[h];if(!v[1]){k=this.displayFormats["Value"];j=1;}for(var i=0;i<j;i++){var r,V=v[i]||"";if(i==0&&T&&(typeof T.formatValue==="function")){r=T.formatValue(V,"string");}else{r=V;}k=r==null?null:k.replace(new RegExp("\\$"+i,"g"),r);}return k;}},a._mOperators);a._addOperatorTo({name:"EQ",filterOperator:M.EQ,tokenParse:"^=([^=].*)$",tokenFormat:"=$0",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"BT",filterOperator:M.BT,tokenParse:"^(.+)\\.\\.\\.(.+)$",tokenFormat:"$0...$1",valueTypes:["self","self"]},a._mOperators);a._addOperatorTo({name:"LT",filterOperator:M.LT,tokenParse:"^<(.*)$",tokenFormat:"<$0",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"GT",filterOperator:M.GT,tokenParse:"^>(.*)$",tokenFormat:">$0",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"LE",filterOperator:M.LE,tokenParse:"^<=(.*)$",tokenFormat:"<=$0",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"GE",filterOperator:M.GE,tokenParse:"^>=(.*)$",tokenFormat:">=$0",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"StartsWith",filterOperator:M.StartsWith,tokenParse:"^([^\*].*)\\*$",tokenFormat:"$0*",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"EndsWith",filterOperator:M.EndsWith,tokenParse:"^\\*(.*[^\*])$",tokenFormat:"*$0",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"Contains",filterOperator:M.Contains,tokenParse:"^\\*(.*)\\*$",tokenFormat:"*$0*",valueTypes:["self"]},a._mOperators);a._addOperatorTo({name:"NE",filterOperator:M.NE,tokenParse:"^!=(.+)$",tokenFormat:"!=$0",valueTypes:["self"],exclude:true},a._mOperators);a._addOperatorTo({name:"Empty",filterOperator:M.EQ,tokenParse:"^<#tokenText#>$",tokenFormat:"<#tokenText#>",valueTypes:[],getModelFilter:function(o,h){var i=this.oFilterOperatorConfig.getOperator(o.operator);return new F({path:h,operator:i.filterOperator,value1:""});}},a._mOperators);a._addOperatorTo({name:"NotEmpty",filterOperator:M.NE,tokenParse:"^!\\(<empty>\\)$",tokenFormat:"!(<empty>)",valueTypes:[],getModelFilter:function(o,h){var i=this.oFilterOperatorConfig.getOperator(o.operator);return new F({path:h,operator:i.filterOperator,value1:""});}},a._mOperators);D=false;Object.freeze(a._mOperators);return a;},true);
