/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/Control','sap/base/util/merge','sap/base/util/array/diff','sap/base/strings/hash','sap/ui/model/PropertyBinding','sap/ui/model/Context','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/base/Log','sap/ui/mdc/library','./FilterItemLayout','sap/ui/mdc/base/FilterField','sap/ui/mdc/base/FieldValueHelp','sap/ui/mdc/util/IdentifierUtil','sap/ui/mdc/util/ConditionUtil','sap/ui/layout/AlignedFlowLayout','sap/m/library','sap/m/Button','sap/ui/model/json/JSONModel',"sap/ui/fl/ControlPersonalizationAPI"],function(C,m,d,h,P,a,M,b,L,c,F,e,f,I,g,A,l,B,J,j){"use strict";var k=c.FilterExpression;var n=l.ButtonType;var o;var p=C.extend("sap.ui.mdc.base.filterbar.FilterBar",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/base/filterbar/FilterBar.designtime",defaultAggregation:"filterItems",properties:{metadataDelegate:{type:"string",defaultValue:"sap/ui/mdc/base/filterbar/FilterBarHelper"},conditionModelName:{type:"string",defaultValue:null},dataTypeFormatOptions:{type:"object",group:"Data",defaultValue:{style:'short'}},liveMode:{type:"boolean",defaultValue:false},showGoButton:{type:"boolean",defaultValue:true},showAdaptFiltersButton:{type:"boolean",defaultValue:true},supportP13N:{type:"boolean",defaultValue:false}},aggregations:{filterItems:{type:"sap.ui.mdc.base.FilterField",multiple:true},basicSearchField:{type:"sap.ui.mdc.base.FilterField",multiple:false},conditionsData:{type:"sap.ui.mdc.base.filterbar.ConditionsData",multiple:true,singularName:"conditionData"}},events:{search:{},reset:{},filtersChanged:{filtersText:{type:"string"}}}},renderer:function(R,i){R.write("<div ");R.writeControlData(i);R.writeClasses();R.write(">");R.renderControl(i._getContent());R.write("</div>");}});p.INNER_MODEL_NAME="$sap.ui.mdc.base.filterbar.FilterBar";var q=null;var r=null;p.prototype.init=function(){this.addStyleClass("sapUiMdcBaseFilterBar");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._createInnerModel();this._aProperties=null;this.attachModelContextChange(this._setModel,this);this._oObserver=new b(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["filterItems"]});this._oFilterBarLayout=new A();this._addButtons();this._fFilterBarInitialized=undefined;this._oInitializedPromise=new Promise(function(i){this._fFilterBarInitialized=i;}.bind(this));this._fConditionsModel=undefined;this._oConditionModelPromise=new Promise(function(i){this._fConditionsModel=i;}.bind(this));this._clearChanges();this._mConditions=null;this._fFilterBarMetadataApplied=undefined;this._oMetadataAppliedPromise=new Promise(function(i){this._fFilterBarMetadataApplied=i;}.bind(this));};p.prototype.initialized=function(){if(!this._oMetadataPromise){this._oMetadataPromise=this._retrieveMetadata();}return this._oInitializedPromise;};p.prototype.applySettings=function(s,S){var i;C.prototype.applySettings.apply(this,arguments);i=this.getAggregation("conditionsData",[]);if(i.length>0){this._oConditionModelPromise.then(function(t){this._applyConditions(t);}.bind(this));}};p.prototype.setMetadataDelegate=function(s){this.setProperty("metadataDelegate",s);};p.prototype._createInnerModel=function(){this._oModel=new M(this);this.setModel(this._oModel,p.INNER_MODEL_NAME);};p.prototype._addButtons=function(){if(this._oFilterBarLayout){this._btnAdapt=new B(this.getId()+"-btnAdapt",{text:this._oRb.getText("filterbar.ADAPT"),press:this.onAdaptFilters.bind(this)});this._btnAdapt.setModel(this._oModel,p.INNER_MODEL_NAME);this._btnAdapt.bindProperty("visible",{parts:[{path:'/showAdaptFiltersButton',model:p.INNER_MODEL_NAME},{path:"/supportP13N",model:p.INNER_MODEL_NAME}],formatter:function(v,V){return v&&V;}});this._btnAdapt.addStyleClass("sapUiMdcBaseFilterBarButtonPaddingRight");this._oFilterBarLayout.addEndContent(this._btnAdapt);this._btnSearch=new B(this.getId()+"-btnSearch",{text:this._oRb.getText("filterbar.GO"),press:this.onSearch.bind(this),type:n.Emphasized});this._btnSearch.setModel(this._oModel,p.INNER_MODEL_NAME);this._btnSearch.bindProperty("visible",{parts:[{path:'/showGoButton',model:p.INNER_MODEL_NAME},{path:"/liveMode",model:p.INNER_MODEL_NAME}],formatter:function(v,V){return v&&!V;}});this._oFilterBarLayout.addEndContent(this._btnSearch);}};p.prototype._initializeProvider=function(){var s=this.getMetadataDelegate();if(!s){return Promise.resolve(null);}return new Promise(function(R){sap.ui.require([s],function(i){R(i);});});};p.prototype.onAdaptFilters=function(E){this.showFiltersDialog();};p.prototype._setModel=function(){var i=null,s=this.getConditionModelName();if(s){i=this.getModel(s);}if(i&&!this._oConditionChangeBinding){this.detachModelContextChange(this._setModel,this);this._oConditionChangeBinding=i.bindProperty("/",i.getContext("/"));this._oConditionChangeBinding.attachChange(this._handleConditionModelChange.bind(this));this._fConditionsModel(i);}};p.prototype._getAssignedFilterNames=function(){var i,N,s=null,t=this._getConditionModel(),u;if(t){i=t.getAllConditions();s=[];for(N in i){if(s.indexOf(N)<0){var v=t.getConditions(N);if(v&&v.length>0){if(N==="$search"){s.push(this._oRb.getText("filterbar.ADAPT_SEARCHTERM"));}else{u=this._getFilterField(N);if(u){if(u.getVisible()){s.push(N);}}else{s.push(N);}}}}}}return s;};p.prototype._getAssignedFiltersText=function(s){var t,u;s=s||[];if(s.length>5){u=s.slice(0,5);u.push("...");}else{u=s;}t=Object.keys(u).map(function(i){return u[i];}).join(", ");if(s.length){return this._oRb.getText("filterbar.ADAPT_FILTERED",[s.length,t]);}return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");};p.prototype.getAssignedFiltersText=function(){return this._getAssignedFiltersText(this._getAssignedFilterNames());};p.prototype._handleConditionModelChange=function(E){var O={},i=this._getAssignedFilterNames();if(i){if(this._btnAdapt){this._btnAdapt.setText(this._oRb.getText(i.length?"filterbar.ADAPT_NONZERO":"filterbar.ADAPT",i.length));this._oFilterBarLayout._onRenderingOrThemeChanged();}O.filtersText=this._getAssignedFiltersText(i);this.fireFiltersChanged(O);if(this.getLiveMode()){this.fireSearch();}}};p.prototype.onReset=function(E){this.fireReset();};p.prototype.onSearch=function(E){this.fireSearch();};p.prototype.fireSearch=function(E){var i=this._getConditionModel();if(i){i.applyFilters();}};p.prototype._getConditionModel=function(){var i=null,s=this.getConditionModelName();if(s){i=this.getModel(s);if(!i||!i.isA("sap.ui.mdc.base.ConditionModel")){L.error("error during _getConditionModel - no condition model obtained.");i=null;}}return i;};p.prototype.getProvider=function(){return this._oProvider;};p.prototype.showFiltersDialog=function(){if(!this._oMetadataPromise){this._oMetadataPromise=this._retrieveMetadata();}if(!q){sap.ui.require(["sap/ui/mdc/base/filterbar/AdaptFiltersDialog","sap/ui/mdc/base/filterbar/AdaptFiltersDialogItem"],function(i,s){this._oMetadataPromise.then(function(){q=i;r=s;this._showFiltersDialog();}.bind(this));}.bind(this));}else{this._showFiltersDialog();}};p.prototype._showFiltersDialog=function(){this._clearChanges();var i=new J({showResetEnabled:false,items:this._setItemsForAdaptFiltersDialog()});var s=new r({key:"{$sapuimdcbasefilterbarAdaptFiltersDialog>key}",text:"{$sapuimdcbasefilterbarAdaptFiltersDialog>text}",tooltip:"{$sapuimdcbasefilterbarAdaptFiltersDialog>tooltip}",required:"{$sapuimdcbasefilterbarAdaptFiltersDialog>required}",visible:"{$sapuimdcbasefilterbarAdaptFiltersDialog>visible}",relativePosition:"{$sapuimdcbasefilterbarAdaptFiltersDialog>relativePosition}",controls:{path:'$sapuimdcbasefilterbarAdaptFiltersDialog>controls',templateShareable:false,factory:function(v,w){return w.getObject(w.getPath());}}});var t=new q({showReset:false,showResetEnabled:{path:'$sapuimdcbasefilterbarAdaptFiltersDialog>/showResetEnabled'},items:{path:'$sapuimdcbasefilterbarAdaptFiltersDialog>/items',templateShareable:false,template:s},visibilityChanged:function(E){this._addFilterVisibilityChange(E.getParameter("key"),E.getParameter("visible"));}.bind(this),positionChanged:function(E){this._addFilterPositionyChange(E.getParameter("key"),E.getParameter("relativePosition"));}.bind(this),ok:function(E){this._storeChanges();E.getSource().close();E.getSource().destroy();this._oAdaptFiltersDialog=null;}.bind(this),reset:function(){this._oAdaptFiltersDialog=null;}.bind(this),cancel:function(E){E.getSource().close();E.getSource().destroy();this._oAdaptFiltersDialog=null;}.bind(this)});t.setModel(i,"$sapuimdcbasefilterbarAdaptFiltersDialog");var u=this._getConditionModel().clone();t.setModel(u,"cmodel");this.addDependent(t);this._oAdaptFiltersDialog=t;t.open();};p.prototype._addFilterPositionyChange=function(N,i){var s=this._getFilterField(N);var t=s?s.getId():this._getFilterFieldId(N);this._removeSetFilterPositionChange(t);var u={id:t,position:i};this._aChanges.push({selectorControl:this,changeSpecificData:{changeType:"setFilterPosition",content:u}});};p.prototype._createFilterVisibilityChangeContentByProperty=function(i,N,s){var t=(s.getFilterExpression()===k.Multi)?-1:1;return{id:i,name:N,type:s.getType(),path:'\{'+this.getConditionModelName()+">/conditions/"+N+'\}',constraints:s.getConstraints(),required:s.getRequired(),label:s.getLabel(),maxConditions:t,hasFieldHelp:s.getHasFieldHelp(),fieldHelp:s.getFieldHelp(),fieldHelpShowConditionPanel:s.getFieldHelpShowConditionPanel(),fieldHelpDescriptionPath:s.getFieldHelpDescriptionPath()};};p.prototype._createFilterVisibilityChangeContentByFilterField=function(i,N,s){var t={id:i,name:N,type:s.getDataType(),path:'\{'+this.getConditionModelName()+">/conditions/"+N+'\}',constraints:s.getDataTypeConstraints(),required:s.getRequired(),label:s.getLabel(),maxConditions:s.getMaxConditions(),hasFieldHelp:s.getFieldHelp()?true:false,fieldHelp:s.getFieldHelp()};if(s.getFieldHelp()){s.getAggregation("dependents",[]).some(function(D){if(D.isA("sap.ui.mdc.base.FieldValueHelp")){if(D.getShowConditionPanel()){t.fieldHelpShowConditionPanel=s.getShowConditionPanel();}if(D.getDescriptionPath()){t.fieldHelpDescriptionPath=s.getDescriptionPath();}return true;}return false;});}return t;};p.prototype._addFilterVisibilityChange=function(N,v){var i=this._getFilterField(N),s=this._getNonHiddenPropertyByName(N);if(v){if(!i){this._aChanges.push({selectorControl:this,changeSpecificData:{changeType:"addFilter",content:this._createFilterVisibilityChangeContentByProperty(this._getFilterFieldId(N),N,s)}});}else{if(i.getVisible()){this._removeRemoveFilterChange(i);}else{this._aChanges.push({selectorControl:this,changeSpecificData:{changeType:"addFilter",content:this._createFilterVisibilityChangeContentByFilterField(this._getFilterFieldId(N),N,i)}});}}}else{if(i){this._aChanges.push({selectorControl:this,changeSpecificData:{changeType:"removeFilter",content:this._createFilterVisibilityChangeContentByFilterField(i.getId(),N,i)}});}else{this._removeAddFilterChange(s);}}};p.prototype._filterValueChanged=function(i,s,v){var t=i.getFieldPath();if(!t){return;}if(!s){return;}this._calculateConditionDelta(i,s);if(!this._oAdaptFiltersDialog){this._storeChanges();}};p.prototype._getOutValuesFromAggregation=function(i){var O=[];if(i&&i.outValues){O=i.outValues;}return O;};p.prototype._getOutValuesFromField=function(i){var O=[];if(i){}return O;};p.prototype._createAddRemoveConditionChange=function(s,i,t,O,u){var v={selectorControl:this,changeSpecificData:{changeType:s,content:{name:i,condition:t,index:u,outConditions:O?O:null}}};return v;};p.prototype._calculateConditionDelta=function(i,s){var t=null,u,v=null,w=null,x=null;var y=i.getFieldPath();if(!y){return;}if(!s){return;}u=this.getAggregation("conditionsData",[]);u.some(function(E){if(E.getFieldPath()===y){t=E;}return t!==null;});x=this._getOutValuesFromField(i);w=this._getOutValuesFromAggregation(t);if(t){v=t.getConditions();}if(!t||!v||(v.length===0)){s.forEach(function(E){this._aChanges.push(this._createAddRemoveConditionChange("addCondition",y,E,x));}.bind(this));return;}if(i.getMaxConditions()===1){if(v&&(v.length>0)){this._aChanges.push(this._createAddRemoveConditionChange("removeCondition",y,v[0],w));}if(s[0]){this._aChanges.push(this._createAddRemoveConditionChange("addCondition",y,s[0],x));}return;}var N=s.splice(0);var R=d(v,N);var z=[],D=[];R.forEach(function(E){var G=E.type==="delete"?v[E.index]:N[E.index];G.index=E.index;if(E.type==="delete"){v.splice(G.index,1);z.push(G);}else{v.splice(G.index,0,G);D.push(G);}});z.forEach(function(E){var G=E.index;delete E.index;this._aChanges.push(this._createAddRemoveConditionChange("removeCondition",y,E,undefined,G));}.bind(this));D.forEach(function(E){var G=E.index;delete E.index;this._aChanges.push(this._createAddRemoveConditionChange("addCondition",y,E,undefined,G));}.bind(this));};p.prototype._removeAddFilterChange=function(i){var s=-1;this._aChanges.some(function(t,u){if((t.changeSpecificData.changeType==="addFilter")&&(t.changeSpecificData.content.name===i.getName())){s=u;}return s>-1;});if(s>-1){this._aChanges.splice(s,1);}};p.prototype._removeRemoveFilterChange=function(i){var s=-1;this._aChanges.some(function(t,u){if((t.changeSpecificData.changeType==="removeFilter")&&(t.changeSpecificData.content.id===i.getId())){s=u;}return s>-1;});if(s>-1){this._aChanges.splice(s,1);}};p.prototype._removeSetFilterPositionChange=function(i){var s=-1;this._aChanges.some(function(t,u){if((t.changeSpecificData.changeType==="setFilterPosition")&&(t.changeSpecificData.content.id===i)){s=u;}return s>-1;});if(s>-1){this._aChanges.splice(s,1);}};p.prototype._clearChanges=function(){this._aChanges=[];};p.prototype._condenseChange=function(){var N,s,R=[];this._aChanges.every(function(t){var i,u,v=false;if(t.changeSpecificData.changeType==="setFilterPosition"){if(t.changeSpecificData.content.id){for(i=0;i<this._aChanges.length;i++){u=this._aChanges[i];if((u.changeSpecificData.changeType==="removeFilter")&&(u.changeSpecificData.content.id===t.changeSpecificData.content.id)){v=true;break;}}}else if(t.changeSpecificData.content.name){v=true;for(i=0;i<this._aChanges.length;i++){u=this._aChanges[i];if((u.changeSpecificData.changeType==="addFilter")&&(u.changeSpecificData.content.name===t.changeSpecificData.content.name)){v=false;break;}}}if(!v){R.push(t);}}else if(t.changeSpecificData.changeType==="addFilter"){N=t.changeSpecificData.content.name;s=this._getFilterField(N);if(s&&!s.getVisible()){s.setVisible(true);}else{R.push(t);}}else{R.push(t);}return true;}.bind(this));this._aChanges=R;};p.prototype._storeChanges=function(){if(!this.getSupportP13N()){this._clearChanges();return;}this._condenseChange();if(this._aChanges&&this._aChanges.length){var H=j.hasVariantManagement(this);j.addPersonalizationChanges({controlChanges:this._aChanges,ignoreVariantManagement:!H});this._clearChanges();}};p.prototype._setItemsForAdaptFiltersDialog=function(){var i=this.getFilterItems();if(this._getNonHiddenPropertyInfoSet().length>0){return this._getNonHiddenPropertyInfoSet().map(function(s,t){var K=s.getName();var u=this._getFilterField(K);var v=i.indexOf(u);var w=u?u.clone():this.createFilterField(s);w.setVisible(true);w.bindProperty("conditions",{path:"cmodel>/conditions/"+K});return{key:K,text:s.getLabel(),tooltip:s.getTooltip(),required:s.getRequired(),relativePosition:v,visible:(v>-1)&&u.getVisible(),controls:[w]};}.bind(this));}else{return i.map(function(s,t){var u=s.clone();u.bindProperty("conditions",{path:"cmodel>/conditions/"+u.getFieldPath()});return{key:u.getFieldPath(),text:u.getFieldPath(),tooltip:u.getTooltip(),required:u.getRequired(),relativePosition:t,visible:s.getVisible(),controls:[u]};});}};p.prototype._getContent=function(){return this._oFilterBarLayout;};p.prototype._insertFilterFieldtoContent=function(i,s){if(!F){return;}var t=new F();t.setFilterField(i);this._oFilterBarLayout.insertContent(t,s);};p.prototype._filterItemInserted=function(s){var t,u;if(!s.getVisible()){return;}if(!s.getDataTypeFormatOptions()){s.setDataTypeFormatOptions(this.getDataTypeFormatOptions());}u=this.indexOfAggregation("filterItems",s);if(this.getAggregation("basicSearchField")){u++;}if(!s.hasListeners("change")){s.attachChange(this._filterFieldValueChange.bind(this));}t=u;var v=this.getFilterItems();for(var i=0;i<t;i++){if(!v[i].getVisible()){u--;}}this._insertFilterFieldtoContent(s,u);if(!this._oObserver.isObserved(s,{properties:["visible"]})){this._oObserver.observe(s,{properties:["visible"]});}};p.prototype._filterItemRemoved=function(i){var s=null;this._oFilterBarLayout.getContent().some(function(t){if(t._getFilterField()===i){s=t;}return s!==null;});if(s){this._oFilterBarLayout.removeContent(s);s.destroy();}};p.prototype._observeChanges=function(i){if(i.type==="aggregation"&&i.name==="filterItems"){switch(i.mutation){case"insert":this._filterItemInserted(i.child);break;case"remove":this._filterItemRemoved(i.child);break;default:L.error("operation "+i.mutation+" not yet implemented");}}else if(i.type==="property"){var s,t;if(i.object.isA("sap.ui.mdc.base.FilterField")){t=i.object;if(t){if(i.current){this._filterItemInserted(t);}else{this._filterItemRemoved(t);}this._oFilterBarLayout.rerender();}}else if(i.object.isA("sap.ui.mdc.PropertyInfo")){t=this._getFilterField(i.object.getName());if(t){if((i.name==="tooltip")){t.setTooltip(i.current);}else{t.setProperty(i.name,i.current);s=this._getFilterItemLayout(t);if(s){s.rerender();}}}}}};p.prototype._getFilterItemLayout=function(i){var s=null;this._oFilterBarLayout.getContent().some(function(t){if(t._getFilterField()===i){s=t;}return s!==null;});return s;};p.prototype._getFilterField=function(N){var i=null;this.getFilterItems().some(function(s){if(s&&s.getFieldPath&&(s.getFieldPath()===N)){i=s;}return i!==null;});return i;};p.prototype._retrieveMetadata=function(){return new Promise(function(i){Promise.all([this._oConditionModelPromise,this._initializeProvider()]).then(function(s){this._oProvider=s[1];if(this._oProvider){this._oProvider.fetchProperties(this).then(function(t){this._aProperties=t;}.bind(this));}else{this._aProperties=[];}this._metadataApplied();i();}.bind(this));}.bind(this));};p.prototype._metadataApplied=function(){this._fFilterBarMetadataApplied();this._fFilterBarInitialized();};p.prototype.enrichFiltersWithMetadata=function(){this.getFilterItems().every(function(i){var N=i.getFieldPath();this._getNonHiddenPropertyInfoSet().some(function(s){var v,t=1;if((s.getName()===N)&&(N!=="$search")){if(!i.getDataTypeConstraints()&&s.getConstraints()){i.setDataTypeConstraints(s.getConstraints());}i.setDataType(s.getType());i.setRequired(s.getRequired());if(s.getFilterExpression()===k.Multi){t=-1;}i.setMaxConditions(t);v=s.getFilterConditions();if(v&&(v.length>0)){i.setConditions(v);}if(s.getTooltip()){i.setTooltip(s.getTooltip());}this._oObserver.observe(s,{properties:["required","label","toolbar","visible"]});return true;}return false;}.bind(this));return true;}.bind(this));};p.prototype.setBasicSearchField=function(i){var O=this.getAggregation("basicSearchField");if(O){this._filterItemRemoved(O);}this.setAggregation("basicSearchField",i);if(i){if(!i.hasListeners("change")){i.attachChange(this._filterFieldValueChange.bind(this));}if(!this._oObserver.isObserved(i,{properties:["visible"]})){this._oObserver.observe(i,{properties:["visible"]});}this._insertFilterFieldtoContent(i,0);}};p.prototype.applyVisibleInFilterBar=function(){var i=this.getFilterItems();this._getNonHiddenPropertyInfoSet().every(function(s){var t=false;if(s.getVisible()){i.some(function(u){if(u.getFieldPath()===s.getName()){t=true;}return t;});if(!t){this.addFilterItem(this.createFilterField(s));}}return true;}.bind(this));};p.prototype._applyDefaultValues=function(){var i=this._getConditionModel();if(i){this.getPropertyInfoSet().every(function(s){var v=s.getDefaultFilterConditions();if(v&&v.length){v.every(function(t){i.addCondition(s.getName(),t);return true;});}return true;});}};p.prototype.getPropertyInfoSet=function(){return this._aProperties||[];};p.prototype._getNonHiddenPropertyInfoSet=function(){var v=[];this.getPropertyInfoSet().every(function(i){if(!i.getHiddenFilter()){if(i.getName()!=="$search"){v.push(i);}}return true;});return v;};p.prototype._getNonHiddenPropertyByName=function(N){var i=null;this._getNonHiddenPropertyInfoSet().some(function(s){if(s.getName()===N){i=s;}return i!=null;});return i;};p.prototype._getFilterFieldId=function(N){return this.getId()+"--filter--"+I.replace(N);};p.prototype.createFilterField=function(i){var s,t=1,v=null;if(i.getFilterExpression()===k.Multi){t=-1;}s=new e(this._getFilterFieldId(i.getName()),{dataType:i.getType(),label:i.getLabel(),dataTypeConstraints:i.getConstraints(),required:i.getRequired(),dataTypeFormatOptions:this.getDataTypeFormatOptions(),maxConditions:t,visible:i.getVisible()});s.bindProperty("conditions",{path:this.getConditionModelName()+">/conditions/"+i.getName()},true);var V=i.getFilterConditions();if(V&&(V.length>0)){s.setConditions(V);}if(i.getTooltip()){s.setTooltip(i.getTooltip());}v=i.getFieldHelp();if(i.getHasFieldHelp()){v=this._createValueHelp(s,i);}if(v){s.setFieldHelp(v);}var u=this._getConditionModel();if(u){s.setModel(u,this.getConditionModelName());}s.attachChange(this._filterFieldValueChange.bind(this));return s;};p.prototype._createValueHelp=function(i,s){var v=null,V=s.getFieldHelp();if(!V){v=new f({title:s.getFieldHelpTitle(),showConditionPanel:s.getFieldHelpShowConditionPanel()});V=v.getId();}if(v){i.addAggregation("dependents",v);}return v.getId();};p.prototype._filterFieldValueChange=function(E){if(E&&E.getParameter("valid")){this._filterValueChanged(E.oSource,E.getParameter("conditions"),E.getParameter("value"));}};p.prototype.applyConditionsAfterChangesApplied=function(){if(o){this._applyConditionsAfterChangesApplied(o);}else{sap.ui.require(["sap/ui/fl/FlexControllerFactory"],function(i){o=i;this._applyConditionsAfterChangesApplied();}.bind(this));}};p.prototype._applyConditionsAfterChangesApplied=function(){if(this._oFlexPromise){return;}this._oFlexPromise=o.createForControl(this).waitForChangesToBeApplied(this);Promise.all([this._oFlexPromise,this._oConditionModelPromise]).then(function(v){var i=v[1];this._applyConditions(i);this._oFlexPromise=null;}.bind(this));};p.prototype._applyConditions=function(i){this.getAggregation("conditionsData",[]).forEach(function(s){var t=s.getFieldPath();var u=i.getAllConditions(t);var v=s.getConditions();if(!u[t]||!g.compareConditions(null,u[t],v)){if(u[t]){i.removeAllConditions(t);}v.forEach(function(w){i.addCondition(t,w);});}});};p.prototype.exit=function(){C.prototype.exit.apply(this,arguments);if(this._oFilterBarLayout){this._oFilterBarLayout.destroy();this._oFilterBarLayout=null;}this._btnAdapt=undefined;this._btnSearch=undefined;this._oRb=null;this.detachModelContextChange(this._setModel,this);if(this._oConditionChangeBinding){this._oConditionChangeBinding.detachChange(this._handleConditionModelChange.bind(this));this._oConditionChangeBinding=null;}if(this._oModel){this._oModel.destroy();this._oModel=null;}this._oObserver.disconnect();this._oObserver=undefined;this._oProvider=null;this._aProperties=null;this._oInitializedPromise=null;this._fFilterBarInitialized=undefined;this._oConditionModelPromise=null;this._fConditionModelPromise=undefined;this._oFlexPromise=null;this._oMetadataPromise=null;this._mConditions=null;this._aChanges=null;};return p;},true);
