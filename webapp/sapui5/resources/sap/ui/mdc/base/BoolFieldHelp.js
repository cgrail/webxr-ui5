/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/mdc/library','./FieldHelpBase','./Condition','sap/ui/base/ManagedObjectObserver','sap/ui/model/json/JSONModel'],function(l,F,C,M,J){"use strict";var L;var S;var m;var a;var B=F.extend("sap.ui.mdc.base.BoolFieldHelp",{metadata:{library:"sap.ui.mdc"}});B.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new M(c.bind(this));this._oObserver.observe(this,{properties:["filterValue","conditions"]});this._oModel=new J({"type":"","items":[{"key":true,"text":"true"},{"key":false,"text":"false"}]});};B.prototype.exit=function(){F.prototype.exit.apply(this,arguments);this._oObserver.disconnect();this._oObserver=undefined;this._oModel.destroy();this._oModel=undefined;};B.prototype.connect=function(o){F.prototype.connect.apply(this,arguments);k.call(this);return this;};B.prototype._createPopover=function(){var p=F.prototype._createPopover.apply(this,arguments);if((!L||!S||!m)&&!this._bListRequested){L=sap.ui.require("sap/m/List");S=sap.ui.require("sap/m/StandardListItem");m=sap.ui.require("sap/m/library");a=sap.ui.require("sap/ui/model/Filter");if(!L||!S||!m){sap.ui.require(["sap/m/List","sap/m/StandardListItem","sap/m/library","sap/ui/model/Filter"],b.bind(this));this._bListRequested=true;}}if(p){var o=this._getField();if(o){p.setInitialFocus(o);}_.call(this);}return p;};function _(){if(L&&S&&m&&!this._bListRequested){var i=new S({type:m.ListType.Active,title:"{text}"});this._oList=new L(this.getId()+"-List",{width:"100%",showNoData:false,mode:m.ListMode.SingleSelectMaster,rememberSelections:false,items:{path:"/items",template:i},itemPress:d.bind(this)});this._oList.setModel(this._oModel);e.call(this,this.getFilterValue());f.call(this);this._setContent(this._oList);if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep);this._iStep=null;}}}function b(i,s,n,o){L=i;S=s;m=n;a=o;this._bListRequested=false;if(!this._bIsBeingDestroyed){_.call(this);}}B.prototype.open=function(s){var p=this.getAggregation("_popover");if(p){var o=this._getField();p.setInitialFocus(o);}F.prototype.open.apply(this,arguments);return this;};B.prototype._handleAfterClose=function(E){F.prototype._handleAfterClose.apply(this,arguments);if(this._bUpdateFilterAfterClose){this._bUpdateFilterAfterClose=false;e.call(this);}};function c(o){if(o.name==="conditions"){g.call(this,o.current);}if(o.name==="filterValue"){if(this._oList){if(this._bClosing){this._bUpdateFilterAfterClose=true;}else{e.call(this,o.current);}}}}B.prototype.openByTyping=function(){return true;};B.prototype.navigate=function(s){var p=this._getPopover();if(!p||!this._oList){this._bNavigate=true;this._iStep=s;return;}var o=this._oList.getSelectedItem();var i=this._oList.getItems();var I=i.length;var n=0;if(o){n=this._oList.indexOfItem(o);n=n+s;if(n<0){n=0;}else if(n>=I-1){n=I-1;}}else if(s>=0){n=s-1;}else{n=I+s;}var q=i[n];if(q){if(!p.isOpen()){this.open();}if(q!==o){q.setSelected(true);var K=h.call(this,q);var r=j.call(this,K);this.setProperty("conditions",[r],true);this.fireNavigate({value:q.getTitle(),key:K});}}};B.prototype.getTextForKey=function(K){var I=this._oModel.getData()["items"];for(var i=0;i<I.length;i++){var o=I[i];if(o["key"]===K){return o["text"];}}return"";};B.prototype.getKeyForText=function(t){var I=this._oModel.getData()["items"];for(var i=0;i<I.length;i++){var o=I[i];if(o["text"]===t){return o["key"];}}return undefined;};function d(E){var i=E.getParameter("listItem");var s=i.getSelected();if(s){var K=h.call(this,i);var o=j.call(this,K);this.setProperty("conditions",[o],true);this.close();this.fireSelect({conditions:[o],add:true});}}function e(t){var o=this._oList.getBinding("items");if(t){var i=new a({path:"text",operator:"StartsWith",value1:t});o.filter(i);}else{o.filter();}this._oList.invalidate();f.call(this);}function f(){if(this._oList){var n=this.getConditions();var s;var t;var I=this._oList.getItems();if(n.length>0&&(n[0].operator==="EEQ"||n[0].operator==="EQ")){s=n[0].values[0];t=this.getTextForKey(s);}for(var i=0;i<I.length;i++){var o=I[i];if(o.getTitle()===t){o.setSelected(true);}else{o.setSelected(false);}}}}function g(i){f.call(this);}function h(i){var o=i.getBindingContext();var D=o&&o.getObject();if(D){return D["key"];}}function j(K){var o;var t=this.getTextForKey(K);if(t){o=C.createItemCondition(K,t);}return o;}function k(){if(this._oField){var t=this._oField._getDataType();var D=this._oModel.getData();if(t&&D["type"]!==t.getMetadata().getName()){D["type"]=t.getMetadata().getName();var I=D["items"];for(var i=0;i<I.length;i++){var o=I[i];o["text"]=t.formatValue(o["key"],"string");}}}}return B;},true);
