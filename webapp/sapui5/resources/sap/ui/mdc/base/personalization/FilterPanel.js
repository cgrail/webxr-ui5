/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/XMLComposite','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/base/ManagedObjectObserver','sap/base/Log','sap/ui/Device','sap/ui/model/json/JSONModel','sap/ui/core/ResizeHandler'],function(X,F,c,M,L,D,J,R){"use strict";var d=X.extend("sap.ui.mdc.base.personalization.FilterPanel",{metadata:{library:"sap.ui.mdc",properties:{showReset:{type:"boolean",defaultValue:false,invalidate:true},showResetEnabled:{type:"boolean",defaultValue:false,invalidate:true}},associations:{source:{type:"sap.ui.core.Control"}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.mdc.base.personalization.FilterPanelItem",multiple:true,singularName:"item"}},events:{initialOrderChanged:{keys:{type:"string[]"}},positionChanged:{key:{type:"string"},relativePosition:{type:"integer"}},reset:{}}}});d.prototype.init=function(){var o=new J(D);o.setDefaultBindingMode("OneWay");this.setModel(o,"device");this._sKeyOfMarkedItem=null;this.aFilters=[];this._oObserver=new M(_.bind(this));this._oObserver.observe(this,{properties:["showResetEnabled"]});var s=this.byId("idScrollContainer");this._fnHandleResize=function(){var C=false;if(!this.getParent){return C;}var p=this.getParent();if(!p||!p.$){return C;}var t=this._getCompositeAggregation().getContent()[0];var $=p.$("cont");var i,h;if($.children().length>0&&t.$().length>0){var S=s.$()[0].clientHeight;i=$.children()[0].clientHeight;h=t?t.$()[0].clientHeight:0;var a=i-h;if(S!==a){s.setHeight(a+'px');C=true;}}return C;}.bind(this);this._sContainerResizeListener=R.register(s,this._fnHandleResize);};d.prototype.initialize=function(){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());this.fireInitialOrderChanged({keys:this._getInitialItemOrder()});this._updateTableItems();var t=this._getVisibleTableItems()[0];this._toggleMarkedTableItem(t);this._updateEnableOfMoveButtons(t);};d.prototype.onSearchFieldLiveChange=function(e){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());var s=e.getSource();this._defineTableFiltersByText(s?s.getValue():"");this._filterTable(this.aFilters);this._toggleMarkedTableItem(this._getMarkedTableItem());this._updateEnableOfMoveButtons(this._getMarkedTableItem());};d.prototype.onPressButtonMoveToTop=function(){this._moveTableItem(this._getMarkedTableItem(),this._getVisibleTableItems()[0]);};d.prototype.onPressButtonMoveUp=function(){var v=this._getVisibleTableItems();this._moveTableItem(this._getMarkedTableItem(),v[v.indexOf(this._getMarkedTableItem())-1]);};d.prototype.onPressButtonMoveDown=function(){var v=this._getVisibleTableItems();this._moveTableItem(this._getMarkedTableItem(),v[v.indexOf(this._getMarkedTableItem())+1]);};d.prototype.onPressButtonMoveToBottom=function(){var v=this._getVisibleTableItems();this._moveTableItem(this._getMarkedTableItem(),v[v.length-1]);};d.prototype.onPressReset=function(){this.fireReset();};d.prototype._moveTableItem=function(t,T){this._removeMarkedStyleFromTableItem(this._getMarkedTableItem());this.firePositionChanged({key:this._getKeyByTableItem(t),position:this._getItemPositionOfKey(this._getKeyByTableItem(T))});this._filterTable(this.aFilters);this._toggleMarkedTableItem(this._getMarkedTableItem());this._updateEnableOfMoveButtons(this._getMarkedTableItem());};d.prototype._getInitialItemOrder=function(){return this.getItems().sort(function(a,b){if(a.getText()<b.getText()){return-1;}else if(a.getText()>b.getText()){return 1;}else{return 0;}}).map(function(i){return i.getKey();});};d.prototype._updateTableItems=function(){this._getTable().getItems().forEach(function(t){var i=this._getItemByKey(this._getKeyByTableItem(t));if(t.getCells().length===2){t.removeCell(t.getCells()[1]);}if(i.getControls()[0]){var C=i.getControls()[0].clone();t.insertCell(C,1);}}.bind(this));};d.prototype._isFilteredByShowSelected=function(){return false;};d.prototype._getSearchText=function(){var s=this.byId("idSearchField")||null;return s?s.getValue():"";};d.prototype._getTable=function(){return this.byId("idList")||null;};d.prototype._getTableBinding=function(){return this._getTable().getBinding("items");};d.prototype._getTableBindingContext=function(){return this._getTableBinding().getContexts();};d.prototype._setMarkedTableItem=function(t){this._sKeyOfMarkedItem=this._getKeyByTableItem(t);};d.prototype._getMarkedTableItem=function(){return this._getTableItemByKey(this._sKeyOfMarkedItem);};d.prototype._getVisibleTableItems=function(){return this._getTable().getItems().filter(function(t){return!!t.getVisible();});};d.prototype._getSelectedTableItems=function(){return this._getTable().getItems().filter(function(t){return this._isItemSelected(this._getItemByKey(this._getKeyByTableItem(t)));});};d.prototype._isItemSelected=function(i){return i.getControls()[0].getConditions().length>0;};d.prototype._getTableItemByKey=function(k){var C=this._getTableBindingContext();var t=this._getTable().getItems().filter(function(T,i){return C[i].getObject().getKey()===k;});return t[0];};d.prototype._getKeyByTableItem=function(t){var i=this._getTable().indexOfItem(t);return i<0?null:this._getTableBindingContext()[i].getObject().getKey();};d.prototype._getItemPositionOfKey=function(k){return this.getItems().indexOf(this._getItemByKey(k));};d.prototype._getItemByKey=function(k){var i=this.getItems().filter(function(I){return I.getKey()===k;});return i[0];};d.prototype._defineTableFiltersByText=function(s){this.aFilters=[];if(s){this.aFilters.push(new F([new F("text",c.Contains,s),new F("tooltip",c.Contains,s)],false));}};d.prototype._filterTable=function(f){this._getTableBinding().filter(f);this._updateTableItems();};d.prototype._toggleMarkedTableItem=function(t){};d.prototype._addMarkedStyleToTableItem=function(t){if(t){t.addStyleClass("sapUiMdcPersonalizationDialogMarked");}};d.prototype._removeMarkedStyleFromTableItem=function(t){};d.prototype._setFocus=function(i){i.getDomRef().focus();};d.prototype._updateCountOfItems=function(){this._getManagedObjectModel().setProperty("/@custom/countOfSelectedItems",this._getSelectedTableItems().length);};d.prototype._updateEnableOfMoveButtons=function(t){};d._getItemByKey=function(k,a){return a.filter(function(m){return m.key===k;})[0];};function _(C){if(C.object.isA("sap.ui.mdc.base.personalization.FilterPanel")){switch(C.name){case"showResetEnabled":if(C.current===false&&C.old===true){this._setFocus(this._getCompositeAggregation());}break;default:L.error("The property or aggregation '"+C.name+"' has not been registered.");}}}return d;},true);
