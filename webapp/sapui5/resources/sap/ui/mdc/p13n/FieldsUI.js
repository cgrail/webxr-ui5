/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/Device","sap/ui/core/Control","sap/m/List","sap/m/StandardListItem","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/Button","sap/m/SearchField","sap/m/FlexBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DragDropInfo"],function(D,C,L,S,O,T,c,B,d,F,e,f,J,g,h){"use strict";var i=C.extend("sap.ui.mdc.p13n.FieldsUI",{library:"sap.ui.mdc",metadata:{properties:{fetchFields:{type:"function"}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}}},init:function(){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");var s=(D.system.desktop||D.system.combi)?"Row":"Column";this._oAvailableList=new L(this.getId()+"-availableList",{mode:"MultiSelect",growing:true,growingThreshold:50,growingScrollToLoad:true,includeItemInSelection:true,rememberSelections:false,noDataText:r.getText("fieldsui.NO_FIELDS_TEXT"),sticky:["HeaderToolbar"],headerToolbar:new O({content:[new c({text:r.getText("fieldsui.AVAILABLE_FIELDS")}),new T(),new d({width:"15rem",liveChange:[this._onAvailableListSearch,this]})]}),items:{path:"/",sorter:new f("label"),template:new S({title:"{label}"})},dragDropConfig:[new h({sourceAggregation:"items",targetElement:this.getId()+"-selectedList",drop:[this._onMoveToSelected,this]}),new g({sourceAggregation:"items",dragStart:[this._onDragStart,this]})]});this._oAvailableModel=new J([]);this._oAvailableList.setModel(this._oAvailableModel);this._oSelectedList=new L(this.getId()+"-selectedList",{mode:"MultiSelect",growing:true,growingThreshold:50,growingScrollToLoad:true,includeItemInSelection:true,rememberSelections:false,noDataText:r.getText("fieldsui.MOVE_TO_SELECTED"),headerToolbar:new O({content:[new c({text:r.getText("fieldsui.SELECTED_FIELDS")}),new T(),new d({width:"15rem",liveChange:[this._onSelectedListSearch,this]}),new B({icon:"sap-icon://collapse-group",tooltip:r.getText("fieldsui.MOVE_TO_TOP"),press:[this._onMoveTop,this]}),new B({icon:"sap-icon://slim-arrow-up",tooltip:r.getText("fieldsui.MOVE_UP"),press:[this._onMoveUp,this]}),new B({icon:"sap-icon://slim-arrow-down",tooltip:r.getText("fieldsui.MOVE_DOWN"),press:[this._onMoveDown,this]}),new B({icon:"sap-icon://expand-group",tooltip:r.getText("fieldsui.MOVE_TO_BOTTOM"),press:[this._onMoveBottom,this]})]}),items:{path:"/",template:new S({title:"{label}"})},dragDropConfig:[new h({sourceAggregation:"items",targetAggregation:"items",dropPosition:"Between",drop:[this._onRearrange,this]}),new h({sourceAggregation:"items",targetElement:this.getId()+"-availableList",drop:[this._onMoveToAvailable,this]}),new g({sourceAggregation:"items",dragStart:[this._onDragStart,this]})]});this._oSelectedModel=new J([]);this._oSelectedList.setModel(this._oSelectedModel);this.setAggregation("_content",new F({direction:s,renderType:"Bare",items:[this._oAvailableList,new F({direction:(s=="Row")?"Column":"Row",justifyContent:"Center",items:[new B({icon:"sap-icon://slim-arrow-"+(s=="Row"?"right":"down"),tooltip:r.getText("fieldsui.MOVE_TO_SELECTED"),press:[this._onMoveToSelected,this]}).addStyleClass("sapUiTinyMarginBeginEnd"),new B({icon:"sap-icon://slim-arrow-"+(s=="Row"?"left":"up"),tooltip:r.getText("fieldsui.MOVE_TO_AVAILABLE"),press:[this._onMoveToAvailable,this]}).addStyleClass("sapUiTinyMarginBeginEnd")]}),this._oSelectedList]}));},renderer:function(r,o){r.write("<div");r.writeControlData(o);r.addClass("sapUiMDCFieldsUI");r.writeClasses();r.write(">");r.renderControl(o.getAggregation("_content"));r.write("</div>");}});i.prototype.exit=function(){this._oSelectedList=null;this._oAvailableList=null;this._oSelectedModel.destroy();this._oAvailableModel.destroy();this._oSelectedModel=null;this._oAvailableModel=null;};i.prototype.setFetchFields=function(a){this.setProperty("fetchFields",a,true);this.refreshFields();return this;};i.prototype.refreshFields=function(){var s=[];var a=[];var A=this.getFetchFields()()||[];A.forEach(function(m,I){if(m.selected){s.push(m);}else{a.push(m);}});s.sort(function(m,b){return(m.position||0)-(b.position||0);});a.sort(function(m,b){return(m.label||"").localeCompare(b.label||"");});this._oSelectedModel.setData(s);this._oAvailableModel.setData(a);};i.prototype.getSelectedFields=function(){return this._oSelectedModel.getData().slice();};i.prototype.getAvailableFields=function(){return this._oAvailableModel.getData().slice();};i.prototype.getAllFields=function(){return this.getSelectedFields().concat(this.getAvailableFields());};i.prototype._onAvailableListSearch=function(E){this._oAvailableList.getBinding("items").filter(new e("label","Contains",E.getParameter("newValue")));};i.prototype._onSelectedListSearch=function(E){this._oSelectedList.getBinding("items").filter(new e("label","Contains",E.getParameter("newValue")));};i.prototype._moveItem=function(I,n){var a=this._oSelectedList.getItems();var s=this._oSelectedModel.getData();var o=s.indexOf(I.getBindingContext().getObject());n=(n<=0)?0:Math.min(n,a.length-1);n=s.indexOf(a[n].getBindingContext().getObject());if(n==o){return;}s.splice(n,0,s.splice(o,1)[0]);this._oSelectedModel.setData(s);a=this._oSelectedList.getItems();a[o].setSelected(false);a[n].setSelected(true).focus();};i.prototype._moveSelectedItem=function(n){var I=this._oSelectedList.getItems();var s=this._oSelectedList.getSelectedItem();var a=I.indexOf(s);if(a<0){return;}var N=(typeof n=="number")?n:a+(n=="Up"?-1:1);this._moveItem(s,N,true);};i.prototype._onMoveTop=function(E){this._moveSelectedItem(0);};i.prototype._onMoveUp=function(E){this._moveSelectedItem("Up");};i.prototype._onMoveDown=function(E){this._moveSelectedItem("Down");};i.prototype._onMoveBottom=function(E){this._moveSelectedItem(this._oSelectedList.getItems().length-1);};i.prototype._onRearrange=function(E){var o=E.getParameter("draggedControl");var a=E.getParameter("droppedControl");var s=E.getParameter("dropPosition");var b=this._oSelectedList.indexOfItem(o);var j=this._oSelectedList.indexOfItem(a);var A=j+(s=="Before"?0:1)+(b<j?-1:0);this._moveItem(o,A);};i.prototype._swapSelectedAndAvailable=function(s,t){var j=s.getSelectedItems();if(!j.length){return;}var o=s.getModel();var k=t.getModel();var l=o.getData();var m=k.getData();var n=j.map(function(I){return l.indexOf(I.getBindingContext().getObject());}).sort(function(a,b){return b-a;});var p=[];n.forEach(function(I){var a=l.splice(I,1)[0];a.selected=(t===this._oSelectedList);p.push(a);m.push(a);},this);o.setData(l);k.setData(m);t.getItems().forEach(function(I){if(p.indexOf(I.getBindingContext().getObject())>-1){I.setSelected(true);}});};i.prototype._onMoveToSelected=function(E){this._swapSelectedAndAvailable(this._oAvailableList,this._oSelectedList);};i.prototype._onMoveToAvailable=function(E){this._swapSelectedAndAvailable(this._oSelectedList,this._oAvailableList);};i.prototype._onDragStart=function(E){E.getParameter("target").setSelected(true);};return i;},true);
