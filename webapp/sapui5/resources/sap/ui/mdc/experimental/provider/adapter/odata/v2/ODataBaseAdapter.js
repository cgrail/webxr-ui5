/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/experimental/provider/adapter/base/BaseAdapter","sap/ui/mdc/experimental/provider/adapter/odata/Annotations","sap/ui/mdc/experimental/provider/adapter/odata/_ODataAdapterUtils"],function(B,A,U){"use strict";var O=B.extend("sap.ui.mdc.experimental.provider.adapter.odata.v2.ODataBaseAdapter",{_schemaCache:{},aExpand:[],annotations:A,constructor:function(m,M,c){B.prototype.constructor.apply(this,arguments);}});O.annotations=A;O.utils=U;O.prototype.ready=function(){if(this.oMetaModel.loaded){return this.oMetaModel.loaded();}};O.prototype.afterMetaContextSwitch=function(){this.sVersion="2.0";U.buildSchemaCache(this);this.oEntitySet=this.calculateEntitySet(this.sPath);};O.prototype.getQualifiers=function(){return U.getQualifiers(this);};O.prototype.calculateEntitySet=function(p){var a,n,e,q,E,P=p.split("/");if(P[0]!==""){return null;}P.shift();E=this.oMetaModel.getODataEntitySet(U.stripKeyPredicate(P[0]));if(!E){return null;}P.shift();while(P.length){q=E.entityType;e=this.oMetaModel.getODataEntityType(q);n=U.stripKeyPredicate(P[0]);a=this.oMetaModel.getODataAssociationSetEnd(e,n);if(a){E=this.oMetaModel.getODataEntitySet(a.entitySet);}else{break;}P.shift(-1);}return E;};O.prototype.resolveNavi=function(n,T){var p=n.split("/"),N=this.oEntitySet,a,o,m,s;var t=this;function r(){o=t.oMetaModel.getODataAssociationEnd(t.schema,p[0]);if(!o){return;}a=t.oMetaModel.getODataAssociationSetEnd(t.schema,p[0]);N=t.oMetaModel.getODataEntitySet(a.entitySet);if(o.multiplicity!=B.Relation.one||!m){m=o.multiplicity;}}if(p.length==1){if(p[0]!=="."){s="/"+this.oEntitySet.name+"/"+p[0];}else{s="/"+this.oEntitySet.name;}r();}else{var e="";while(p.length>1){e=e+"/"+p[0];r();p.shift(-1);}e=e.substring(1);if(t.aExpand.indexOf(e)==-1){t.aExpand.push(e);}s="/"+N.name+"/"+p[0];}var b=new T(this.oModel,this.sModelName,this.sContextName);b.switchMetaContext(null,s);b.oEntitySet=N;b.navigationPath=this.navigationPath?this.navigationPath+"/"+n:n;b.multiplicity=m||"n";return b;};O.prototype.enabled=function(){return U.enabled(this);};O.prototype.tooltip=function(){return this.getAnnotation(this.annotations.QUICKINFO+"/String");};O.prototype.name=function(){return this.schema.name;};O.prototype.label=function(){return this.getAnnotation(this.annotations.LABEL+"/String");};O.prototype.navigationProperties=function(){var i,n,N=this.getAnnotation("navigationProperty"),a=[];if(N&&N.length){for(i=0;i<N.length;i++){n=N[i];a[n.name]=n;}}return a;};O.prototype.expand=function(){return this.aExpand;};O.prototype["//"]=function(){return this.schema;};O.prototype.getAnnotation=function(a,o){o=o||this.schema;var p=a.split("/");var i=0;while(o&&p[i]){o=o[p[i]];i++;}return o;};O.prototype._isAnnotationBoolean=function(a){var o=this.getAnnotation(a);var i=false;if(o!=null){i=o.Bool?(o.Bool=="true"):true;}return i;};O.prototype._enrichFromEntitySet=function(f,e){var i,F=this._getAnnotation(this.annotations.FILTER_RESTRICTIONS,e);f.filterable=true;f.requiredInFilter=false;if(F){for(i=0;i<F.NonFilterableProperties;i++){if(f.name===F.NonFilterableProperties.PropertyPath){f.filterable=false;}}}};O.prototype.metadataContextOfField=function(f){var i=Object.keys(this.fields).indexOf(f.name);if(i>-1){return this.sMetaPath+"/property/"+i;}else{return"";}};return O;});
