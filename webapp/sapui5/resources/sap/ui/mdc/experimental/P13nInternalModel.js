/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery",'sap/ui/base/ManagedObject','sap/ui/model/json/JSONModel'],function(q,M,J){"use strict";var P=J.extend("sap.ui.mdc.experimental.P13nInternalModel",{constructor:function(i,s){J.apply(this,arguments);this._initialize();}});P.prototype._initialize=function(){var m=this.getProperty("/tableItems").map(function(p){if(typeof p==="string"){p=sap.ui.getCore().byId(p);}return{columnKey:p.getColumnKey(),selected:p.getSelected(),position:p.getPosition(),text:p.getText()};});this._sortBySelectedAndPosition(m);this.setData({items:m});this.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);this.setSizeLimit(1000);};P.prototype.getModelItemByColumnKey=function(c){var m=this.getProperty("/items").filter(function(o){return o.columnKey===c;});return m[0];};P.prototype.getIndexOfModelItem=function(m){return this.getProperty("/items").indexOf(m);};P.prototype.selectModelItem=function(m,i){m.selected=i;var a=this.getProperty("/items");var b=this._getSelectedModelItemsBetween(m,a[0]);if(b.length&&b[0].position>m.position){this.moveModelItemPosition(m,b[0]);}else{b=this._getSelectedModelItemsBetween(m,a[a.length-1]);if(b.length&&b[0].position<m.position){this.moveModelItemPosition(m,b[0]);}}};P.prototype.moveModelItem=function(m,o){if(!m||!o){return;}var a=this.getProperty("/items");var i=a.indexOf(m);var I=a.indexOf(o);if(i<0||I<0||i>a.length-1||I>a.length-1){return;}var b=a.splice(i,1)[0];a.splice(I,0,b);this.setProperty("/items",a);};P.prototype.moveModelItemPosition=function(m,o){var s=this._getSelectedModelItemsBetween(m,o);if(!s.length){return;}var c=this.getProperty("/items");var i=c.indexOf(m);var I=c.indexOf(o);if(i<I){o=s[s.length-1];}else{o=s[s.length-1];}var d=q.extend(true,[],c);d.sort(function(a,b){if(a.position<b.position){return-1;}else if(a.position>b.position){return 1;}else{return 0;}});var e=d.splice(m.position,1)[0];d.forEach(function(a,b){a.position=b;});d.splice(o.position,0,e);d.forEach(function(a,b){a.position=b;});var g=function(k,v,a){var E=null;a.some(function(b){if(b[k]!==undefined&&b[k]===v){E=b;return true;}});return E;};c.forEach(function(a,b){var f=g("columnKey",a.columnKey,d);this.setProperty("/items/"+b+"/position",f.position);},this);};P.prototype._getSelectedModelItemsBetween=function(m,o){var a=this.getProperty("/items");var i=a.indexOf(m);var I=a.indexOf(o);if(i===I){return[];}var b=[];if(i<I){b=a.slice(i+1,I+1);return b.filter(function(c){return!!c.selected;});}b=a.slice(I,i).reverse();return b.filter(function(c){return!!c.selected;});};P.prototype._sortBySelectedAndPosition=function(m){m.sort(function(a,b){if(a.selected===true&&(b.selected===false||b.selected===undefined)){return-1;}else if((a.selected===false||a.selected===undefined)&&b.selected===true){return 1;}else if(a.selected===true&&b.selected===true){if(a.position<b.position){return-1;}else if(a.position>b.position){return 1;}else{return 0;}}else if((a.selected===false||a.selected===undefined)&&(b.selected===false||b.selected===undefined)){if(a.text<b.text){return-1;}else if(a.text>b.text){return 1;}else{return 0;}}});};return P;},true);
