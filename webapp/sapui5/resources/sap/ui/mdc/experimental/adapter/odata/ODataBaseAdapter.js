/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/experimental/adapter/BaseAdapter","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/model/odata/AnnotationHelper"],function(B,V,a){"use strict";var O=B.extend("sap.ui.mdc.experimental.adapter.odata.ODataBaseAdapter",{constructor:function(m,p){B.prototype.constructor.apply(this,[m,p]);},init:function(){this.sVersion="2.0";if(this.oMetaModel.requestObject){this.sVersion="4.0";this.helper=V;}else{this.helper=a;}this.iSeparator=this.path?this.path.indexOf("/##"):-1;if(!this.metaPath){if(this.iSeparator>-1){if(this.sVersion=="2.0"){var d=this.path.substring(0,this.iSeparator);var D=this.oMetaModel.getMetaContext(d);this.oMetaContext=this.oMetaModel.createBindingContext(this.path.substring(this.iSeparator+3),D);}else{this.oMetaContext=this.oModel.createBindingContext(this.path);}}else{this.oMetaContext=this.oMetaModel.getMetaContext(this.path);}this.metaPath=this.oMetaContext.getPath();}else{this.oMetaContext=this.oMetaModel.createBindingContext(this.metaPath);}this.schema=this.oMetaModel.getProperty(this.metaPath);},getAnnotation:function(A,q){if(q){A+="#"+q;}if(this.sVersion=="4.0"){return this.oMetaContext.getObject(A);}else{var o=this.schema;var p=A.split("/"),P;var i=0;while(o&&p[i]){P=p[i];if(P[0]==="@"||P[0]==="$"){P=P.substring(1);}o=o[P];i++;}return o;}},collectAnnotations:function(A){var q={},p;if(this.sVersion=="4.0"){p=this.oMetaContext.getObject("@");}else{p=this.schema;}for(var s in p){var n=s.split("#")[0];var Q=s.split("#")[1]||"";if(jQuery.sap.startsWith(n,A)&&jQuery.sap.endsWith(n,A)){q[Q]={annotation:p[s]};}}return q;},flattenSimpleAnnotation:function(A){if(A&&this.getAttribute(A,"String")){return this.getAttribute(A,"String");}if(A&&this.getAttribute(A,"Bool")){return JSON.parse(this.getAttribute(A,"Bool"));}if(A&&this.getAttribute(A,"Path")){var p=this.getAttribute(A,"Path");return this.convertToSimpleBinding(p);}return A;}});O.prototype._initFieldControl=function(){var f=this.getAnnotation("@com.sap.vocabularies.Common.v1.FieldControl");if(f){var b={};this.schema.$fieldControl=b;var e=this.getAttribute(f,"EnumMember");if(e){switch(e){case"@com.sap.vocabularies.Common.v1.FieldControlType/Hidden":this.schema.$fieldControl.visible=false;this.schema.$fieldControl.hidden=true;this.schema.$fieldControl.editable=false;this.schema.$fieldControl.readonly=true;this.schema.$fieldControl.required=false;break;case"@com.sap.vocabularies.Common.v1.FieldControlType/Mandatory":this.schema.$fieldControl.visible=true;this.schema.$fieldControl.hidden=false;this.schema.$fieldControl.editable=true;this.schema.$fieldControl.readonly=false;this.schema.$fieldControl.required=true;break;case"@com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly":this.schema.$fieldControl.visible=true;this.schema.$fieldControl.hidden=false;this.schema.$fieldControl.editable=false;this.schema.$fieldControl.readonly=true;this.schema.$fieldControl.required=false;break;default:this.schema.$fieldControl.visible=true;this.schema.$fieldControl.hidden=false;this.schema.$fieldControl.editable=true;this.schema.$fieldControl.readonly=true;this.schema.$fieldControl.required=false;break;}}else{var p=this.getAttribute(f,"Path");if(p){this.schema.$fieldControl.path=this.parentPath+"/"+p;}else{delete this.schema.$fieldControl;}}}};O.prototype.getAttribute=function(s,A){if(!s){return null;}return s[A]||s["$"+A];};O.prototype.removeKeys=function(p){var k,P=p.split("/"),b;for(var i=0;i<P.length;i++){b=P[i].indexOf("(");if(b>=0){P[i]=P[i].slice(0,b);}}k=P.join("/");return k;};O.prototype.calculateEntitySet=function(){var e;if(this.sVersion=="4.0"){var s=this.oMetaModel.getObject(this.metaPath);if(s.$kind=="EntitySet"){e=s;}else{var E=this.metaPath.substring(0,this.metaPathlastIndexOf("/"));e=this.oMetaModel.getObject(E);}}else{var A,n,o,q,p=this.removeKeys(this.path).split("/");if(p[0]!==""){return null;}p.shift();e=this.oMetaModel.getODataEntitySet(p[0]);if(!e){return null;}while(p.shift()&&p[0]){q=e.entityType;o=this.oMetaModel.getODataEntityType(q);n=p[0];A=this.oMetaModel.getODataAssociationSetEnd(o,n);if(A){e=this.oMetaModel.getODataEntitySet(A.entitySet);}else{break;}}}return e;};O.prototype.nameInPropertyPathArray=function(A,n){for(var i=0;i<A.length;i++){if(this.getAttribute(A[i],"PropertyPath")==n){return true;}}return false;};return O;});
