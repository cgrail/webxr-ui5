/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/ui/mdc/experimental/adapter/odata/ODataBaseAdapter","sap/ui/base/ManagedObject"],function(q,O,M){"use strict";var a=O.extend("sap.ui.mdc.experimental.adapter.odata.v2.ODataPropertyAdapter",{constructor:function(m){O.prototype.constructor.apply(this,[m,{label:function(){var l;if(this.dataField){l=this.oMetaModel.getObject(this.metaPath+"/Label");}if(!l){l=this.getAnnotation("com.sap.vocabularies.Common.v1.Label");}return this.flattenSimpleAnnotation(l);},tooltip:function(){var t=this.getAnnotation("com.sap.vocabularies.Common.v1.QuickInfo");return this.flattenSimpleAnnotation(t);},visible:function(){var h=this.flattenSimpleAnnotation(this.getAnnotation("com.sap.vocabularies.UI.v1.Hidden"));var v=h?!h:true;if(v&&this.schema.$fieldControl){v=this.schema.$fieldControl.path?"{= $"+this.convertToSimpleBinding(this.schema.$fieldControl.path)+" === 7}":this.schema.$fieldControl.visible;}return v;},name:function(){return this.schema.name;},required:function(){var r=this.getAnnotation("nullable");var R=r!=null?(r==="false"||r===false):false;if(this.schema.$fieldControl){R=this.schema.$fieldControl.path?"{= $"+this.convertToSimpleBinding(this.schema.$fieldControl.path)+" !== 0}":this.schema.$fieldControl.required;}else{R=R&&this.editable;}return R;},value:function(){return new Promise(function(r){Promise.all([this.path,this.modelTypeName]).then(function(R){r(this.convertToSimpleBinding(R[0],R[1]));}.bind(this));}.bind(this));},valueBinding:function(){return new Promise(function(r){this.value.then(function(v){r(M.bindingParser(v));});}.bind(this));},href:function(){if(this.dataField&&this.dataField.Url){return this.flattenSimpleAnnotation(this.dataField.Url);}},textArrangement:function(){var t=this.getAnnotation("com.sap.vocabularies.Common.v1.Text/@com.sap.vocabularies.UI.v1.TextArrangement");if(t){var A=t.EnumMember;if(A.endsWith("TextFirst")){return this.constants.TextArrangement.TextFirst;}if(A.endsWith("TextLast")){return this.constants.TextArrangement.TextLast;}if(A.endsWith("TextOnly")){return this.constants.TextArrangement.TextOnly;}}return this.constants.TextArrangement.TextSeparate;},textProperty:function(){var t=this.getAnnotation("com.sap.vocabularies.Common.v1.Text/Path");t=t?this.parentPath+"/"+t:null;return this.sibling(t);},defaultValue:function(){return this.getAnnotation("defaultValue");},formattedValue:function(){return new Promise(function(r){this.textProperty.then(function(t){Promise.all([this.textArrangement,this.value,t.value]).then(function(R){var f;switch(R[0]){case this.constants.TextArrangement.TextFirst:f=R[2]+" ("+R[1]+")";break;case this.constants.TextArrangement.TextLast:f=R[1]+" ("+R[2]+")";break;case this.constants.TextArrangement.TextOnly:f=R[2];break;default:f=R[1];}r(f);}.bind(this));}.bind(this));}.bind(this));},unitProperty:function(){var u=this.getAnnotation("Org.OData.Measures.V1.Unit/Path");if(!u){u=this.getAnnotation("Org.OData.Measures.V1.ISOCurrency/Path");}u=u?this.parentPath+"/"+u:null;return this.sibling(u);},maxLength:function(){return parseInt(this.getAnnotation("maxLength")||255);},minLength:function(){return parseInt(this.getAnnotation("minLength")||-1);},scale:function(){return this.getAnnotation("scale")||1;},precision:function(){return this.getAnnotation("precision")||1;},editable:function(){var u=this.getAnnotation("Org.OData.Core.V1.Immutable")||this.getAnnotation("Org.OData.Core.V1.Computed");var U=this.flattenSimpleAnnotation(u);var e=U!=null?(U==="false"||U===false):true;if(e&&this.schema.$fieldControl){e=this.schema.$fieldControl.path?"{= $"+this.convertToSimpleBinding(this.schema.$fieldControl.path)+" !== 1}":this.schema.$fieldControl.editable;}return e;},type:function(){var t=this;function b(T){if(T){switch(T){case"sap.ui.model.odata.type.Boolean":return"boolean";case"sap.ui.model.odata.type.Byte":return"byte";case"sap.ui.model.odata.type.Date":return"date";case"sap.ui.model.odata.type.DateTime":case"sap.ui.model.odata.type.DateTimeOffset":return"date-time";case"sap.ui.model.odata.type.Decimal":case"sap.ui.model.odata.type.Double":return"number";case"sap.ui.model.odata.type.Guid":return"string";case"sap.ui.model.odata.type.Int16":case"sap.ui.model.odata.type.Int32":case"sap.ui.model.odata.type.Int64":return"integer";case"sap.ui.model.odata.type.SByte":case"sap.ui.model.odata.type.Single":return"number";case"sap.ui.model.odata.type.String":return"string";case"sap.ui.model.odata.type.TimeOfDay":return"time";default:if(this["//"]["sap:display-format"]=="Date"){return"date";}return"string";}}}return new Promise(function(r,c){t.modelType.then(function(T){if(t.schema.$kind!=="NavigationProperty"){r(b(T.getName()));}else{if(t.schema.$isCollection){r("array");}else{r("object");}}});});},parent:function(){var p={model:this.oModel,path:this.parentPath+"/"};return this.parentPromise("sap/ui/mdc/experimental/adapter/odata/v2/ODataObjectAdapter",p);},reference:function(){var r={model:this.oModel};if(this.schema.$kind=="NavigationProperty"){if(this.schema.$isCollection){r.path=this.parentPath;return this.parentPromise("sap/ui/mdc/experimental/adapter/odata/v2/ODataListAdapter",r);}else{r.path=this.parentPath+"/";return this.parentPromise("sap/ui/mdc/experimental/adapter/odata/v2/ODataObjectAdapter",r);}}return this.parent;},modelTypeName:function(){var t="";if(this.schema.type){switch(this.schema.type){case"Edm.Boolean":t="sap.ui.model.odata.type.Boolean";break;case"Edm.Byte":t="sap.ui.model.odata.type.Byte";break;case"Edm.Date":t="sap.ui.model.odata.type.Date";break;case"Edm.DateTime":t="sap.ui.model.odata.type.DateTime";break;case"Edm.DateTimeOffset":t="sap.ui.model.odata.type.DateTimeOffset";break;case"Edm.Decimal":t="sap.ui.model.odata.type.Decimal";break;case"Edm.Double":t="sap.ui.model.odata.type.Double";break;case"Edm.Guid":t="sap.ui.model.odata.type.Guid";break;case"Edm.Int16":t="sap.ui.model.odata.type.Int16";break;case"Edm.Int32":t="sap.ui.model.odata.type.Int32";break;case"Edm.Int64":t="sap.ui.model.odata.type.Int64";break;case"Edm.SByte":t="sap.ui.model.odata.type.SByte";break;case"Edm.Single":t="sap.ui.model.odata.type.Single";break;case"Edm.String":t="sap.ui.model.odata.type.String";break;case"Edm.TimeOfDay":t="sap.ui.model.odata.type.TimeOfDay";break;default:if(this.schema["sap:display-format"]=="Date"){t="sap.ui.model.odata.type.Date";}else{t="sap.ui.model.odata.type.String";}}}else{t="sap.ui.model.odata.type.Raw";}return t;},modelType:function(){return new Promise(function(r,b){this.modelTypeName.then(function(t){var T=t.split('.').join("/");sap.ui.require([T],function(c){var o=new c();r(o);});});}.bind(this));},filterable:function(){var f=this.schema.$EntitySet["Org.OData.Capabilities.V1.FilterRestrictions"];var s=(f.Filterable!=null)?f.Filterable:true;if(!s){return false;}if(f&&f.NonFilterableProperties){if(this.nameInPropertyPathArray(f.NonFilterableProperties,this.schema.name)){return false;}else{return true;}}return true;},filterProperty:function(){return this;},minConditions:function(){var t=this;return new Promise(function(r,b){t.filterable.then(function(f){if(f){var F=t.schema.$EntitySet["Org.OData.Capabilities.V1.FilterRestrictions"];if(F&&F.RequiredProperties){if(t.nameInPropertyPathArray(F.RequiredProperties,t.schema.name)){return r(1);}else{return r(0);}}}r(0);});});},maxConditions:function(){var t=this;return new Promise(function(r,b){t.filterable.then(function(f){if(f){r(undefined);}else{r(0);}});});},sortable:function(){var s=this.schema.$EntitySet["Org.OData.Capabilities.V1.SortRestrictions"];if(s&&s.NonSortableProperties){if(this.nameInPropertyPathArray(s.NonSortableProperties,this.schema.name)){return false;}else{return true;}}return true;},sortProperty:function(){return this;},status:function(){if(this.dataField&&this.dataField["com.sap.vocabularies.UI.v1.Criticality"]){var c=this.dataField["com.sap.vocabularies.UI.v1.Criticality"];if(c.Path){return this.convertToSimpleBinding(c.Path);}else{var C=c.EnumMember;if(C.endsWith("VeryNegative")){return this.constants.Status.VeryNegative;}if(C.endsWith("Negative")){return this.constants.Status.Negative;}if(C.endsWith("Neutral")){return this.constants.Status.Neutral;}if(C.endsWith("VeryPositive")){return this.constants.Status.VeryPositive;}if(C.endsWith("Positive")){return this.constants.Status.Positive;}}}else{return this.constants.Status.None;}},importance:function(){if(this.dataField&&this.dataField["com.sap.vocabularies.UI.v1.Importance"]){var i=this.dataField["com.sap.vocabularies.UI.v1.Importance"];if(i.Path){return this.convertToSimpleBinding(i.Path);}else{var I=i.EnumMember;if(I.endsWith("Low")){return this.constants.Importance.Low;}if(I.endsWith("Medium")){return this.constants.Importance.Medium;}if(I.endsWith("High")){return this.constants.Importance.High;}}}else{return this.constants.Status.None;}},semanticObject:function(){var Q=this.collectAnnotations("com.sap.vocabularies.Common.v1.SemanticObject");if(q.isEmptyObject(Q)){return undefined;}var A=Object.keys(Q).filter(function(s){return!!s;}).map(function(s){return Q[s].annotation["String"];});return{defaultSemanticObject:(Q[""]?Q[""].annotation["String"]:undefined),additionalSemanticObjects:A};},semanticObjectMapping:function(){var g=function(A){if(this.getAttribute(A,"String")){return Promise.resolve(this.getAttribute(A,"String"));}var p=this.getAttribute(A,"Path");if(p){var P=this.sibling(this.parentPath+"/"+p);return P.value;}q.sap.log.warning("Attribute of annotation '"+A+"' is not supported yet.");}.bind(this);var G=function(b){if(!q.isArray(b)){return{};}var r={};b.forEach(function(p){r[p.LocalProperty.PropertyPath]=g(p.SemanticObjectProperty);});return r;};var s=this.collectAnnotations("com.sap.vocabularies.Common.v1.SemanticObject");if(q.isEmptyObject(s)){return undefined;}var S=this.collectAnnotations("com.sap.vocabularies.Common.v1.SemanticObjectMapping");if(q.isEmptyObject(S)){return undefined;}var o={};for(var Q in s){o[s[Q].annotation["String"]]=G(S[Q].annotation);}return o;}}]);},init:function(){O.prototype.init.apply(this);if(this.iSeparator>-1){var v=this.getAttribute(this.schema,"PropertyPath");if(!v&&this._isDataField()){var t=this.getAttribute(this.schema,"Target");var T=t&&this._getTargetContext();var V=(T||this.oMetaContext).getObject("Value");if(V){v=this.getAttribute(V,"Path");this.dataField=this.schema;}}if(v){this.path=this.path.substring(0,this.iSeparator)+"/"+v;this.oMetaContext=this.oMetaModel.getMetaContext(this.path);this.schema=this.oMetaContext.getObject("");}}var c=this.path.lastIndexOf("/");this.parentPath=this.path.substring(0,c);this._initFieldControl();var p=this.path.split("/"),P=p[p.length-1];if(this.schema.property||this.schema.navigationProperty){this.metaPath=this.oMetaModel.getMetaContext(this.parentPath).getPath();var o=this.oMetaModel.getObject(this.metaPath);var A=this.oMetaModel.getODataAssociationEnd(o,P);if(!A){return;}this._multiplicity=A.multiplicity;var b=this.oMetaModel.getODataAssociationSetEnd(o,P);this._entitySet=b.entitySet;var n=null;this.metaPath+="/navigationProperty/";for(var i=0;i<o.navigationProperty.length;i++){n=o.navigationProperty[i];if(n.name==P){this.schema=n;this.schema["$kind"]="NavigationProperty";if(A.multiplicity!=="1"&&A.multiplicity!=="0..1"){this.schema["$isCollection"]=true;}this.metaPath+=i;return;}}}this.schema.$EntitySet=this.calculateEntitySet();}});a.prototype._getTargetContext=function(){var A=this.getAnnotation("Target/AnnotationPath/");A=A.replace("@","");var d=this.oMetaModel.getMetaContext(this.path.substring(0,this.iSeparator));return this.oMetaModel.createBindingContext(A,d);};a.prototype._isDataField=function(){if(this.dataField){return true;}return this.schema.RecordType?(this.schema.RecordType.indexOf("DataField"))>-1:false;};return a;});
