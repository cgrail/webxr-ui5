/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery",'sap/ui/base/ManagedObject','sap/ui/model/json/JSONModel'],function(q,M,J){"use strict";var P=J.extend("sap.ui.mdc.experimental.P13nSortModel",{constructor:function(i,s){J.apply(this,arguments);this._initialize();}});P.prototype._initialize=function(){var t=this.getProperty("/tableItems");var m=t.map(function(p){if(typeof p==="string"){p=sap.ui.getCore().byId(p);}return{columnKey:p.getColumnKey(),selected:p.getSelected(),position:p.getPosition(),text:p.getText(),sortOrder:p.getSortOrder(),comboboxKey:p.getColumnKey(),availableItems:[]};},this);this._sortBySelectedAndPosition(m);this.setProperty("/items",m);this.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);this.setSizeLimit(1000);this._updateMItemsAvailableItems();};P.prototype.insertModelItemOfIndex=function(i){var m=this.getProperty("/items");m.splice(i+1,0,{columnKey:"(none)",comboboxKey:"(none)",text:"(none)",sortOrder:"Ascending",selected:false,position:undefined,availableItems:[]});this.setProperty("/items",m);this._updateMItemsAvailableItems();this._updateAndSyncMItemsPosition();};P.prototype.removeModelItemOfIndex=function(i){this._updateAndSyncProperties(i,{sortOrder:undefined,selected:false,position:undefined});var m=this.getProperty("/items");m.splice(i,1);if(!m.length){m.splice(0,0,{columnKey:"(none)",comboboxKey:"(none)",text:"(none)",sortOrder:"Ascending",selected:false,position:undefined,availableItems:[]});}this.setProperty("/items",m);this._updateMItemsAvailableItems();this._updateAndSyncMItemsPosition();};P.prototype.replaceModelItemOfIndex=function(i){var m=q.extend(true,{},this.getModelItemByIndex(i));this._updateAndSyncProperties(i,{sortOrder:undefined,selected:false,position:undefined});var I=this.getItemByColumnKey(m.comboboxKey);this.setProperty("/items/"+i+"/columnKey",m.comboboxKey?m.comboboxKey:"(none)");this.setProperty("/items/"+i+"/comboboxKey",m.comboboxKey?m.comboboxKey:"(none)");this.setProperty("/items/"+i+"/text",I?I.getText():"(none)");this._updateAndSyncProperties(i,{sortOrder:m.sortOrder,selected:!!I,position:m.position});this._updateMItemsAvailableItems();};P.prototype._updateItemsPosition=function(){this.getProperty("/availableItems").forEach(function(i){var m=this.getModelItemByColumnKey(i.getColumnKey());if(m){i.setPosition(m.position);}else{i.setPosition(undefined);}},this);};P.prototype.updateProperties=function(i,m){this._updateAndSyncProperties(i,m);};P.prototype._updateAndSyncProperties=function(i,m){var o=this.getModelItemByIndex(i);var I=this.getItemByColumnKey(o.columnKey);if(o){if(m.hasOwnProperty("selected")){this.setProperty("/items/"+i+"/selected",m.selected);if(I){I.setSelected(m.selected);}}if(m.hasOwnProperty("sortOrder")){this.setProperty("/items/"+i+"/sortOrder",m.sortOrder);if(I){I.setSortOrder(m.sortOrder);}}if(m.hasOwnProperty("position")){this.setProperty("/items/"+i+"/position",m.position);if(I){I.setPosition(m.position);}}}};P.prototype._updateAndSyncMItemsPosition=function(){var p=-1;var m=this.getProperty("/items");m.forEach(function(o,i){this._updateAndSyncProperties(i,{position:o.selected===true?++p:undefined});},this);};P.prototype._updateMItemsAvailableItems=function(){if(!this.getProperty("/availableItems")){return;}var a=this.getProperty("/availableItems").filter(function(t){return!this.getModelItemByColumnKey(t.getColumnKey());},this).map(function(t){return{comboboxKey:t.getColumnKey(),text:t.getText()};});this.getProperty("/items").forEach(function(m,i){var c=q.extend(true,[],a);c.splice(0,0,{comboboxKey:m.columnKey,text:m.text});this.setProperty("/items/"+i+"/availableItems",c);},this);};P.prototype.getItemByColumnKey=function(c){var i=this.getProperty("/availableItems").filter(function(I){return I.getColumnKey()===c;});return i[0];};P.prototype.getModelItemByColumnKey=function(c){var m=this.getProperty("/items").filter(function(o){return o.columnKey===c;});return m[0];};P.prototype.getModelItemByIndex=function(i){return this.getProperty("/items/"+i);};P.prototype.getIndexOfModelItem=function(m){return this.getProperty("/items").indexOf(m);};P.prototype.selectModelItem=function(i,I){var m=this.getModelItemByIndex(i);this._updateAndSyncProperties(i,{selected:I});this._updateAndSyncMItemsPosition();var a=this.getProperty("/items");var b=this._getSelectedModelItemsBetween(m,a[0]);if(b.length&&b[0].position>m.position){this.moveModelItemPosition(m,b[0]);}else{b=this._getSelectedModelItemsBetween(m,a[a.length-1]);if(b.length&&b[0].position<m.position){this.moveModelItemPosition(m,b[0]);}}};P.prototype.moveModelItem=function(i,I){var m=this.getModelItemByIndex(i);var o=this.getModelItemByIndex(I);if(!m||!o){return;}var a=this.getProperty("/items");var i=a.indexOf(m);var I=a.indexOf(o);if(i<0||I<0||i>a.length-1||I>a.length-1){return;}var b=a.splice(i,1)[0];a.splice(I,0,b);this.setProperty("/items",a);};P.prototype.moveModelItemPosition=function(i,I){var m=this.getModelItemByIndex(i);var o=this.getModelItemByIndex(I);var s=this._getSelectedModelItemsBetween(m,o);if(!s.length){return;}var c=this.getProperty("/items");var d=c.indexOf(m);var e=c.indexOf(o);var f=q.extend(true,[],c);f.sort(function(a,b){if(a.position<b.position){return-1;}else if(a.position>b.position){return 1;}else{return 0;}});var g=f.splice(d,1)[0];var p=-1;f.forEach(function(a){a.position=a.selected===true?++p:undefined;});f.splice(e,0,g);p=-1;f.forEach(function(a){a.position=a.selected===true?++p:undefined;});var G=function(k,v,a){var E=null;a.some(function(b){if(b[k]!==undefined&&b[k]===v){E=b;return true;}});return E;};c.forEach(function(a,b){var h=G("columnKey",a.columnKey,f);this._updateAndSyncProperties(b,{position:h.position});},this);};P.prototype._getSelectedModelItemsBetween=function(m,o){var a=this.getProperty("/items");var i=a.indexOf(m);var I=a.indexOf(o);if(i===I){return[];}var b=[];if(i<I){b=a.slice(i+1,I+1);return b.filter(function(c){return!!c.selected;});}b=a.slice(I,i).reverse();return b.filter(function(c){return!!c.selected;});};P.prototype._sortBySelectedAndPosition=function(m){if(this.getProperty("/preventInitialSort")){return;}m.sort(function(a,b){if(a.selected===true&&(b.selected===false||b.selected===undefined)){return-1;}else if((a.selected===false||a.selected===undefined)&&b.selected===true){return 1;}else if(a.selected===true&&b.selected===true){if(a.position<b.position){return-1;}else if(a.position>b.position){return 1;}else{return 0;}}else if((a.selected===false||a.selected===undefined)&&(b.selected===false||b.selected===undefined)){if(a.text<b.text){return-1;}else if(a.text>b.text){return 1;}else{return 0;}}});};return P;},true);
