/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery",'sap/m/library','./P13nPanel','./P13nSortModel'],function(q,M,P,a){"use strict";var b=P.extend("sap.ui.mdc.experimental.P13nSortSimplePanel",{metadata:{library:"sap.ui.mdc",properties:{internalModel:{type:"sap.ui.mdc.experimental.P13nSortModel",visibility:"hidden"}}}});b.prototype.init=function(){P.prototype.init.apply(this,arguments);this._proxyOnModelContextChange=q.proxy(this._onModelContextChange,this);this.attachModelContextChange(this._proxyOnModelContextChange);};b.prototype.refreshInitialState=function(){this._bInternalModelToBeUpdated=true;this.invalidate();};b.prototype._onModelContextChange=function(){if(!this.getModel()){return;}this._updateInternalModel();};b.prototype.onBeforeRendering=function(){this._updateInternalModel();};b.prototype.exit=function(){this.detachModelContextChange(this._proxyOnModelContextChange);};b.prototype.onChangeSortOrderBySelection=function(e){var t=this._getTable().getSelectedItems()[0];var i=this._getTable().indexOfItem(t);this._getInternalModel().updateProperties(i,{sortOrder:this._getSelectedSortOrder()});};b.prototype.onChangeSortOrderByItemPress=function(e){var s=e.getParameter('listItem')===this.byId("IDAscendingItem")?"Ascending":"Descending";var t=this._getTable().getSelectedItems()[0];var i=this._getTable().indexOfItem(t);this._getManagedObjectModel().setProperty("/@custom/sortOrder",s);this._getInternalModel().updateProperties(i,{sortOrder:s});};b.prototype.onSelectionChange=function(e){e.getParameter("listItems").forEach(function(t){this._selectTableItem(t);},this);};b.prototype.onItemPress=function(e){var t=e.getParameter('listItem');this._selectTableItem(t);};b.prototype._selectTableItem=function(t){var i=this._getTable().indexOfItem(t);var s=this._getSelectedSortOrder();this._getTable().getItems().forEach(function(t,I){this._getInternalModel().updateProperties(I,{sortOrder:(I===i?s:undefined),selected:(I===i),position:(I===i?0:undefined)});},this);};b.prototype._getTableItemByColumnKey=function(c){var C=this._getTable().getBinding("items").getContexts();var t=this._getTable().getItems().filter(function(T,i){return C[i].getObject().columnKey===c;});return t[0];};b.prototype._getSelectedSortOrder=function(){var t=this.byId("IDSortOrderTable").getSelectedItems()[0];return t===this.byId("IDAscendingItem")?"Ascending":"Descending";};b.prototype._getTable=function(){return sap.ui.getCore().byId(this.getId()+"--IDTable")||null;};b.prototype._updateInternalModel=function(){if(!this._bInternalModelToBeUpdated){return;}this._bInternalModelToBeUpdated=false;var s=this.getItems().filter(function(i){return i.getSelected();});this._setInternalModel(new a({preventInitialSort:true,tableItems:this.getItems().filter(function(i){return i;}),availableItems:this.getItems().filter(function(i){return i;})}));this._getTable().setModel(this._getInternalModel(),"JSONItems");if(s.length>1){var m=this._getInternalModel().getModelItemByColumnKey(s[0].getColumnKey());var t=this._getTableItemByColumnKey(m.columnKey);this._selectTableItem(t);this._getManagedObjectModel().setProperty("/@custom/sortOrder",s[0].getSortOrder());}};b.prototype._setInternalModel=function(i){this.setProperty("internalModel",i);};b.prototype._getInternalModel=function(){return this.getProperty("internalModel");};return b;},true);
