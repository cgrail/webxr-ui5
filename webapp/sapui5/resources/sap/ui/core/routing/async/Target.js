/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/ComponentContainer","sap/ui/core/library"],function(L,C,c){"use strict";return{display:function(d){var s=Promise.resolve();return this._display(d,s).catch(function(v){if(v instanceof Error){return Promise.reject(v);}else{return v;}});},_display:function(d,s,t){if(this._oParent){s=this._oParent._display(d,s,t);}return this._place(d,s,t);},_place:function(d,s,t){if(d instanceof Promise){t=s;s=d;d=undefined;}var o=this._oOptions,a=this,O,n,b,e,p;if(o.name&&o.type){n=this._getEffectiveObjectName(o.name);switch(o.type){case"View":b={name:n,type:o.viewType,id:o.id,async:true};break;case"Component":b=Object.assign({},o.options||{},{name:n,id:o.id});break;default:throw new Error("The given type "+o.type+" isn't support by sap.ui.core.routing.Target");}O=this._oCache._get(b,o.type,this._bUseRawViewId,t);if(!(O instanceof Promise)){if(O.isA("sap.ui.core.mvc.View")){p=O.loaded();}else{p=Promise.resolve(O);}}else{p=O;}s=s.then(function(P){return p.then(function(O){if(O.isA("sap.ui.core.UIComponent")){var r=O.getRouter();if(r&&r.isStopped()){r.initialize();}}return{object:O,parentInfo:P||{}};},function(e){return Promise.reject({name:o._name,error:e});});}).then(function(v){var V=a._isValid(v.parentInfo);O=v.object;if(O.isA("sap.ui.core.mvc.View")){a._bindTitleInTitleProvider(O);a._addTitleProviderAsDependent(O);}if(V!==true){e=V;return a._refuseInvalidTarget(o._name,e);}var f=v.parentInfo.view,g=v.parentInfo.control,h=Promise.resolve(g);if(f&&f.isA("sap.ui.core.UIComponent")){f=f.getRootControl();}if(!f&&o.rootView){f=sap.ui.getCore().byId(o.rootView);if(!f){e="Did not find the root view with the id "+o.rootView;return a._refuseInvalidTarget(o._name,e);}}if(o.controlId){if(f){h=f.loaded().then(function(i){return i.byId(o.controlId);});}h=h.then(function(i){if(!i){i=sap.ui.getCore().byId(o.controlId);}if(!i){e="Control with ID "+o.controlId+" could not be found";return a._refuseInvalidTarget(o._name,e);}else{return i;}}).catch(function(){e="Something went wrong during loading the root view with id "+o.rootView;return a._refuseInvalidTarget(o._name,e);});}return h;}).then(function(f){var g,h,i;if(f.error){return f;}if(O.isA("sap.ui.core.UIComponent")){g=O;h=g.getId()+"-container";O=sap.ui.getCore().byId(h);if(!O){var j=Object.assign({component:g,height:"100%",width:"100%",lifecycle:sap.ui.core.ComponentLifecycle.Application},o.containerOptions);O=new C(h,j);i=g.exit;g.exit=function(){if(i){i.apply(this);}O.destroy();};}}a._beforePlacingViewIntoContainer({container:f,view:O,data:d});var A=f.getMetadata().getJSONKeys()[o.controlAggregation];if(!A){e="Control "+o.controlId+" does not have an aggregation called "+o.controlAggregation;return a._refuseInvalidTarget(o._name,e);}if(o.clearControlAggregation===true){f[A._sRemoveAllMutator]();}L.info("Did place the "+o.type.toLowerCase()+" '"+n+"' with the id '"+O.getId()+"' into the aggregation '"+o.controlAggregation+"' of a control with the id '"+f.getId()+"'",a);f[A._sMutator](O);a.fireDisplay({view:O.isA("sap.ui.core.mvc.View")?O:undefined,object:O,control:f,config:a._oOptions,data:d});return{name:o._name,view:O,control:f};});}else{s=s.then(function(){return{name:o._name};});}return s;},_isValid:function(p){var o=this._oOptions,a=p&&p.control,h=(a||o.controlId),i=true,l="";if(!h){l="The target "+o._name+" has no controlId set and no parent so the target cannot be displayed.";i=false;}if(!o.controlAggregation){l="The target "+o._name+" has a control id or a parent but no 'controlAggregation' was set, so the target could not be displayed.";i=false;}if(l){L.error(l,this);}return i||l;},_refuseInvalidTarget:function(n,m){if(m){L.error(m,this);}return{name:n,error:m};}};});
