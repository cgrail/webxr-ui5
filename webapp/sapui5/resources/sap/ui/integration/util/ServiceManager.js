/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/base/Log"],function(E,L){"use strict";var S=E.extend("sap.ui.integration.util.ServiceManager",{metadata:{library:"sap.ui.integration"},constructor:function(s,o){if(!s){throw new Error("Missing manifest services reference!");}if(!o){throw new Error("Missing context object");}this._mServiceFactoryReferences=s;this._mServices={};this._oServiceContext=o;}});S.prototype.registerService=function(s,i){var n=s.name||s,o;if(!this._mServices[i]){this._mServices[i]={};}o=this._mServices[i][n];if(!o){o={};o.promise=S._getService(this._oServiceContext,n,this._mServiceFactoryReferences).then(function(a){o.instance=a;}).catch(function(e){L.error(e.message);});this._mServices[i][n]=o;return o.promise;}return o.promise;};S.prototype.getService=function(s,a){return new Promise(function(r,R){if(!s||!this._mServices[s]||!Object.keys(this._mServices[s])){return Promise.reject(new Error("Invalid service"));}if(!a){a=Object.keys(this._mServices[s])[0];}this._mServices[s][a].promise.then(function(){r(this._mServices[s][a].instance);}.bind(this)).catch(R);}.bind(this));};S.prototype.destroy=function(){this._mServices=null;};S._getService=function(i,n,s){return new Promise(function(r,R){var o,f;if(i.bIsDestroyed){return Promise.reject(new Error("Service "+n+" could not be loaded as the requestor "+i.getMetadata().getName()+" was destroyed."));}if(!s){return Promise.reject(new Error("No Services declared"));}else{o=s[n];}if(!o||!o.factoryName){return Promise.reject(new Error("No Service '"+n+"' declared or factoryName missing"));}else{f=o.factoryName;}sap.ui.require(["sap/ui/core/service/ServiceFactoryRegistry"],function(a){var b=a.get(f);if(b){b.createInstance({scopeObject:i,scopeType:"component",settings:o.settings||{}}).then(function(c){if(c.getInterface){r(c.getInterface());}else{r(c);}}).catch(R);}else{var e=new Error("ServiceFactory '"+f+"' for Service '"+n+"' not found in ServiceFactoryRegistry");e._optional=o.optional;R(e);}});});};return S;});
