/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Control","../Extension","../ViewportHandler"],function(q,S,a,b){"use strict";var c=a.extend("sap.ui.vtm.extensions.SceneNodeHoverTooltipExtension",{metadata:{interfaces:["sap.ui.vtm.interfaces.ISceneNodeHoverTooltipExtension"],properties:{tooltipCallback:{type:"any",group:"Behavior",defaultValue:null}}},constructor:function(i,s){a.apply(this,arguments);},createTooltip:function(i,t){var d=document.createElement("div");d.className="sapUiVtmSceneNode-Tooltip";d.innerText=t;return d;},initialize:function(){this._panelPanelInitialized=new Map();this.applyPanelHandler(function(p){var v=p.getViewport();var s=this._vtm.getScene();s.attachLoadCompleted(function(e){if(!e.getParameter("succeeded")){return;}if(this._panelPanelInitialized.get(p)){return;}this._panelPanelInitialized.set(p,true);var d=sap.ve.dvl.DVLID_INVALID;var f=v._getVkViewport();var x,y;var t;var g=function(k){return{text:k.getName()};};var h=new sap.ui.vtm.SceneNode({scene:s});var i=function(){if(t){f.getDomRef().removeChild(t);t=undefined;}};var j=function(n,x,y){if(n!==sap.ve.dvl.DVLID_INVALID){h.setSceneNodeId(n);var k=this.getTooltipCallback()||g;var l=k(h);if(l){t=this.createTooltip(n,l.text);t.style.left="calc("+Math.floor(x)+"px + 1em)";t.style.top="calc("+Math.floor(y)+"px + 1.5em)";f.getDomRef().appendChild(t);}}}.bind(this);this.attachEnabledChanged(function(e){if(this.getEnabled()&&d){j(d,x,y);}else{i();}f.renderFrame();}.bind(this));v.addEventDelegate({onmouseout:function(){i();d=sap.ve.dvl.DVLID_INVALID;x=y=null;v.refresh();}},v);v.attachHover(function(e){var n=e.getParameter("nodeId");x=e.getParameter("x");y=e.getParameter("y");if(!this.getEnabled()){d=n;return;}if(n!==d){i();d=n;j(n,x,y);}f.renderFrame();}.bind(this));v.attachBeginGesture(function(e){i();d=sap.ve.dvl.DVLID_INVALID;x=y=null;v.refresh();});}.bind(this));}.bind(this));}});return c;});
