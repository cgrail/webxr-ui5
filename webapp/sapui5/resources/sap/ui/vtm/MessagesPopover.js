/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","sap/m/Popover","sap/m/PopoverRenderer","sap/m/List"],function(q,S,a,b,c){"use strict";var M=sap.m.Popover.extend("sap.ui.vtm.MessagesPopover",{metadata:{properties:{messages:{type:"object[]"},maxHeight:{type:"sap.ui.core.CSSSize",defaultValue:null}}},init:function(){a.prototype.init.apply(this);this._rb=sap.ui.vtm.getResourceBundle();this.setShowHeader(false);this.attachAfterOpen(this._onAfterOpen,this);},renderer:function(r,C){b.render.call(this,r,C);},onAfterRendering:function(){var d=this.getDomRef();var m=parseInt(this.getMaxHeight(),10);if(m>0&&d.clientHeight>m){this.setContentHeight(this.getMaxHeight());}},setMessages:function(m){var d=[];m.forEach(function(g){var h={text:g.getText()};var t=g.getLevel();var i=g.getIcon();switch(t){case sap.ui.core.MessageType.Error:h.iconUrl=i||"sap-icon://error";h.iconColor=sap.ui.core.IconColor.Negative;h.iconTooltip=this._rb.getText("MESSAGESTATUS_ERROR");break;case sap.ui.core.MessageType.Warning:h.iconUrl=i||"sap-icon://alert";h.iconColor=sap.ui.core.IconColor.Critical;h.iconTooltip=this._rb.getText("MESSAGESTATUS_WARNING");break;case sap.ui.core.MessageType.Success:h.iconUrl=i||"sap-icon://sys-enter-2";h.iconColor=sap.ui.core.IconColor.Positive;h.iconTooltip=this._rb.getText("MESSAGESTATUS_SUCCESS");break;case sap.ui.core.MessageType.Information:h.iconUrl=i||"sap-icon://message-information";h.iconColor=sap.ui.core.IconColor.Neutral;h.iconUrl=i||"sap-icon://message-information";h.iconTooltip=this._rb.getText("MESSAGESTATUS_INFORMATION");break;default:g.color=sap.ui.core.IconColor.Default;}d.push(h);}.bind(this));var e=new sap.ui.model.json.JSONModel();var f={messages:d};e.setData(f);var l=new sap.m.List();l.setModel(e,"model");l.bindItems("model>/messages",new sap.m.CustomListItem({content:[new sap.ui.layout.HorizontalLayout({content:[new sap.ui.core.Icon({src:"{model>iconUrl}",color:"{model>iconColor}",tooltip:"{model>iconTooltip}"}).addStyleClass("sapUiVtmTreeStatusItem"),new sap.m.Text({text:"{model>text}",tooltip:"{model>text}",wrapping:true}).addStyleClass("sapUiVtmTreeStatusItem")]})]}));this.addContent(l);return this;},_onModelContextChanged:function(){this.close();},_onAfterOpen:function(e){var C=e.getParameter("openBy");if(C){C.attachModelContextChange(this._onModelContextChanged,this);this.attachAfterClose(this._onAfterClose,this);}this.detachAfterOpen(this._onAfterOpen,this);},_onAfterClose:function(e){var C=e.getParameter("openBy");if(C){C.detachModelContextChange(this._onModelContextChanged,this);this.detachAfterClose(this._onAfterClose,this);}setTimeout(function(){this.destroy();}.bind(this),0);}});return M;});
