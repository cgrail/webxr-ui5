/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","./ColumnType","sap/ui/core/Control","sap/m/TableSelectDialog","./Progress","./InternalColumns"],function(q,S,a,b,c,d,e){"use strict";var f=b.extend("sap.ui.vtm.SelectColumnsDialog",{metadata:{properties:{tree:{type:"object"},selectableColumns:{type:"sap.ui.vtm.Column[]"}}},init:function(){this._oDialog=this._createDialog();},renderer:function(r,C){},_createDialog:function(){var r=sap.ui.vtm.getResourceBundle();var s=new sap.m.TableSelectDialog(this.getId()+'-Dialog',{multiSelect:true,columns:[new sap.m.Column({visible:false}),new sap.m.Column({visible:false}),new sap.m.Column({header:new sap.m.Label({text:r.getText("COLUMNNAME_NAME")})})],noDataText:r.getText("SELECTCOLUMNSDIALOG_NOCOLUMNSAVAILABLE")});var i=new sap.m.ColumnListItem({type:"Active",unread:false,cells:[new sap.m.Label({text:"{mProperties/type}"}),new sap.m.Label({text:"{mProperties/descriptor}"}),new sap.m.Label({text:"{mProperties/label}"})]});s.bindItems({path:"/items",template:i});return s;},open:function(){var t=this.getTree();if(!t){throw"The tree property has not been set";}var s=this.getSelectableColumns();if(!s){throw"The selectableColumns property has not been set";}s=s.slice();var g=this._oDialog;var r=sap.ui.vtm.getResourceBundle();var h=q.sap.debug();if(h){var i=s.filter(function(A){return A.type===sap.ui.vtm.ColumnType.Internal;}).map(function(A){return A.id;});var j=[sap.ui.vtm.InternalColumns.createTreeItemIdColumn(),sap.ui.vtm.InternalColumns.createAbsoluteMatrixColumn(),sap.ui.vtm.InternalColumns.createRelativeMatrixColumn(),sap.ui.vtm.InternalColumns.createSceneNodeIdsColumn(),sap.ui.vtm.InternalColumns.createOpacityColumn(),sap.ui.vtm.InternalColumns.createHighlightColorColumn()];j.forEach(function(A){if(i.indexOf(A.id)==-1){s.push(A);}});}var k=function(A,B){return A.getLabel().localeCompare(B.getLabel());};s.sort(k);var l=function(A,B){return JSON.stringify({type:A,descriptor:B});};var m=new Map();s.forEach(function(A){var B=l(A.getType(),A.getDescriptor());m.set(B,A);});var n=function(A){var B=A.getParameter("value");var C=A.getParameter("itemsBinding");if(B!==undefined&&B.length>0){var D=[new sap.ui.model.Filter("mProperties/label",sap.ui.model.FilterOperator.Contains,B)];C.filter(new sap.ui.model.Filter(D,false),"Application");}else{C.filter([]);}};var o=function(A){var B=t.getDataColumns().map(function(D){return l(D.getType(),D.getDescriptor());});var C=g.getItems();C.forEach(function(D){var E=D.getCells();var F=l(E[0].getText(),E[1].getText());var G=B.indexOf(F)!=-1;D.setSelected(G);});};var p,u;var v=function(t){g.attachConfirm(t,p);g.attachCancel(t,u);g.attachSearch(t,n);g.attachModelContextChange(t,o);};var w=function(){g.detachConfirm(p);g.detachCancel(u);g.detachSearch(n);g.detachModelContextChange(o);};p=function(A){w();var B=A.getParameter("selectedItems");var C=t.getDataColumns().map(function(J){return l(J.getType(),J.getDescriptor());});var D=B.map(function(J){var K=J.getCells();return l(K[0].getText(),K[1].getText());});var E=D.filter(function(J){return C.indexOf(J)===-1;});var F=C.filter(function(J){return D.indexOf(J)!==-1;});var G=F.map(function(J){return m.get(J);});var H=E.map(function(J){return m.get(J);});H.sort(k);var I=G.concat(H);t.setDataColumns(I);};u=function(A){w();};var x=t.getPanel().getTitle();var y=r.getText("SELECTCOLUMNSDIALOG_SELECT_0_COLUMNS",[x]);g.setTitle(y);v(t);var z=new sap.ui.model.json.JSONModel();z.setData({items:s});g.setModel(z);g.open();return this;}});return f;});
