sap.ui.define(["jquery.sap.global","./ListMap","./CameraHandler","./TotaraUtils","./TreeBuilder"],function(q,L,C,T,a){"use strict";var V=function(){};V.buildView=function(v,s,b){var r={};var t=b.viewIdTreeNodesMap.get(v);b.treeNodes=t;if(!b.treeNodes||!b.treeNodes.length){r.error="no tree information in view";return r;}var d=b.treeNodes;var p=a.getPartialTreeNodes(d);var n=[];for(var i=0;i<p.length;i++){var e=p[i].parent;V.processNode(s,b,p[i],n,e);}r.nodeInfos=n;b.treeNodes=[];b.viewIdTreeNodesMap.delete(v);return r;};V.buildViewNode=function(s,b,t,n){if(!t){T.reportError(s,b,"totaraTreeBuilder - buildNode - invalid args");return;}var d=s.sceneBuilder.getNode(t.sid,b.sceneId);var e={target:d};var r=s.sceneBuilder.updateMaterialInNode(t,b.sceneId);if(r.needUpdateMaterial){if(t.opacity){var f=b.materialIdNodeListMapForOpacityUpdate.getOrCreate(t.materialId);f.push(t.sid);}s.materialIdsToRequest.add(t.materialId);}if(r.nodeUpdated){b.updatedNodes.add(s.sceneBuilder.getNode(t.sid,b.sceneId));}if(t.transform){e.transform=T.arrayToColumnMajorMatrixArray16(t.transform);}else{e.transform=[1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0];}if(t.visible===undefined){e.visible=true;}else{e.visible=t.visible;}n.push(e);var g=s.sceneBuilder.getChildNodeIds(t.sid,b.sceneId);var h=c(b.treeNodes,t);var k;var i;for(i=0;i<g.length;i++){k=g[i];for(var j=0;j<h.length;j++){if(k===h[j]){g[i]=undefined;break;}}}for(i=0;i<g.length;i++){var l=g[i];if(l!==undefined){var m=s.sceneBuilder.getNode(l,b.sceneId);var o=false;n.push({target:m,visible:o});}}if(t.children){for(i=0;i<t.children.length;i++){var p=t.children[i];var u=b.treeNodes[p];V.processNode(s,b,u,n,t.sid);}}};V.processNode=function(s,b,t,n,p){var d=s.sceneBuilder.getNode(t.sid,b.sceneId);if(d){V.buildViewNode(s,b,t,n);}else{a.buildNode(s,b,t,p);var e=s.sceneBuilder.getNode(t.sid,b.sceneId);if(e){e.visible=false;n.push({target:e,visible:t.visible===undefined?true:t.visible});}}};function c(t,b){var s=[];var d=0;if(b&&b.children){for(var i=0;i<b.children.length;i++){d=b.children[i];s.push(t[d].sid);}}return s;}return V;});
