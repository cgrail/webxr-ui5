/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/ManagedObject","./Messages"],function(q,M,a){"use strict";var N=M.extend("sap.ui.vk.NodeHierarchy",{metadata:{"abstract":true,events:{changed:{},nodeCreated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeRemoving:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}},nodeReplaced:{parameters:{ReplacedNodeRef:{type:"any"},ReplacementNodeRef:{type:"any"},ReplacedNodeId:{type:"string"},ReplacementNodeId:{type:"string"}}},nodeUpdated:{parameters:{nodeRef:{type:"any"},nodeId:{type:"string"}}}}}});N.prototype.findNodesById=function(b){if(b.fields.some(function(g){return!g.caseSensitive;})){b=q.extend(true,{},b);b.fields.forEach(function(g){if(!g.caseSensitive){g.value=g.value.toLowerCase();}});}var c=function(p,g,v,h){var m;p=p||"equals";h=h||"";var j=g?v:v.toLowerCase();switch(p){case"equals":m=(j===h);break;case"contains":m=(j.indexOf(h)!==-1);break;case"startsWith":m=(j.indexOf(h)===0);break;default:m=false;q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT8.summary),a.VIT8.code,"sap.ui.vk.dvl.NodeHierarchy");}return m;};var i=function(l,g){return!l.some(function(v){return g.name===v.name?c(g.predicate,g.caseSensitive,v.value,g.value):false;});};var f=function(b,v){return b.source===v.source&&b.type===v.type&&!b.fields.some(i.bind(undefined,v.fields));};var d=this.findNodesByName();var e=d.filter(function(n){var g=this.createNodeProxy(n);var v=g.getVeIds();this.destroyNodeProxy(g);return v.some(f.bind(undefined,b));}.bind(this));return e;};N.prototype.findNodesByMetadata=function(b){var c=function(m,j,k,v,h,i){if(m.hasOwnProperty(j)){var l=m[j];if(l.hasOwnProperty(k)){var n=l[k];if(!i){n=n.toLowerCase();}return v.some(h.bind(undefined,n));}}return false;};var d=function(m,j){if(m==null){return false;}return m.hasOwnProperty(j);};var g=function(e,f,j,k,v,h,i){var n=this._baseNodeProxyPool.borrowObject();var r=e.filter(function(l){n.init(this,l);var m=n.getNodeMetadata();var o=f(m,j,k,v,h,i);n.reset();return o;}.bind(this));this._baseNodeProxyPool.returnObject(n);return r;};var e=this.findNodesByName(),r=[];if(b===undefined||b===null||q.isEmptyObject(b)){r=e;}else if(b.category!==null&&b.category!==undefined&&b.category!==""){var f,v,p,h,i=!!(b&&b.caseSensitive);if(b.key===undefined||b.key===null){f=d;}else{v=b.value;p=b.predicate||"equals";if(v===undefined||v===null){v="";p="contains";}if(!Array.isArray(v)){v=[v];}if(!i){v=v.map(function(j){return j.toLowerCase();});}switch(p){case"equals":h=function(m,j){return m===j;};break;case"contains":h=function(m,j){return m.indexOf(j)!==-1;};break;case"startsWith":h=function(m,j){return m.indexOf(j)===0;};break;default:q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT9.summary),a.VIT9.code,"sap.ui.vk.dvl.NodeHierarchy");}f=c;}r=g.bind(this)(e,f,b.category,b.key,v,h,i);}else{q.sap.log.error(sap.ui.vk.getResourceBundle().getText(a.VIT10.summary),a.VIT10.code,"sap.ui.vk.dvl.NodeHierarchy");}return q.sap.unique(r);};N.prototype._appendAncestors=function(n,s){s=s?new Set(s):null;var b=new Set(n);n.forEach(function(d){var e=this.getAncestors(d);e.forEach(function(f){if(s===null||!s.has(f)){b.add(f);}});},this);var c=[];b.forEach(function(d){c.push(d);});return c;};return N;});
