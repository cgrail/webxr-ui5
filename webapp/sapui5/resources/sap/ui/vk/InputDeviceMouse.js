/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/EventProvider"],function(q,E){"use strict";var I=E.extend("sap.ui.vk.InputDeviceMouse",{metadata:{publicMethods:["isSupported","enable","disable"]},constructor:function(L){this._loco=L;this._buttons=0;this._buttonFlagsValue=0;this._zoomOrigin={x:0,y:0};this._mousedownProxy=this._onmousedown.bind(this);this._mouseupProxy=this._onmouseup.bind(this);this._mousemoveProxy=this._onmousemove.bind(this);this._mousewheelProxy=this._onmousewheel.bind(this);this._contextmenuProxy=this._oncontextmenu.bind(this);this._onmouseupWindowListenerProxy=this._onmouseupWindowListener.bind(this);}});I.prototype._buttonFlags=function(b,d){if(d){this._buttonFlagsValue|=(1<<b);}else{this._buttonFlagsValue&=~(1<<b);}return this._buttonFlagsValue;};I.prototype._eventToInput=function(e,b){var a=(e.buttons!=undefined)?e.buttons:this._buttonFlagsValue;if(b){a=b;}var i={x:0,y:0,z:0,d:0,n:0,buttons:a,scroll:e.wheelDelta,points:[],handled:false,jqueryEvent:e};var n=0;switch(a){case 0:case 1:n=1;i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 3:case 4:case 5:n=2;i.points.push({x:e.pageX,y:e.pageY,z:0});i.points.push({x:e.pageX,y:e.pageY,z:0});break;case 2:n=2;i.points.push({x:this._zoomOrigin.x,y:e.pageY,z:0});i.points.push({x:this._zoomOrigin.x,y:e.pageY+(this._zoomOrigin.y-e.pageY)*2,z:0});break;default:n=0;break;}i.n=n;return i;};I.prototype._onmouseup=function(e){this._capturedByControl=true;var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,false);if(e["_sapui_handledByControl"]){return;}var i=this._eventToInput(e,this._buttons);this._loco.endGesture(i,this._control);if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}i=this._eventToInput(e);if(b!=0){i.handled=false;this._loco.beginGesture(i,this._control);}this._buttons=b;};I.prototype._onmouseupWindowListener=function(e){if(!this._capturedByControl){this._onmouseup(e);}this._capturedByControl=false;};I.prototype._onmousemove=function(e){if(e["_sapui_handledByControl"]){return;}if(sap.ui.Device.os.name===sap.ui.Device.os.OS.MACINTOSH&&e.buttons===2){e.buttons=3;}var i=this._eventToInput(e);this._loco.move(i,this._control);};I.prototype._onmousedown=function(e){var b=(e.buttons!=undefined)?e.buttons:this._buttonFlags(e.button,true);if(e["_sapui_handledByControl"]){return;}var i;if(this._buttons!=0){i=this._eventToInput(e,this._buttons);this._loco.endGesture(i,this._control);}if(b==2){this._zoomOrigin.x=e.pageX;this._zoomOrigin.y=e.pageY;}i=this._eventToInput(e);i.handled=false;this._loco.beginGesture(i,this._control);this._prevButtons=b;this._buttons=b;};I.prototype._onmousewheel=function(e){var a=e.originalEvent?e.originalEvent:e;if(a["_sapui_handledByControl"]||this._buttons!=0){return;}this._zoomOrigin.x=a.pageX;this._zoomOrigin.y=a.pageY;var d=a.detail?a.detail*(-40):a.wheelDelta;if(d==null){d=-a.deltaY;}var s={pageX:a.pageX,pageY:a.pageY,buttons:2,wheelDelta:d};var i=this._eventToInput(s);this._loco.beginGesture(i,this._control);s.pageY-=d/5;i=this._eventToInput(s);i.handled=false;this._loco.move(i,this._control);i.handled=false;this._loco.endGesture(i,this._control);if(i.handled){a["_sapui_handledByControl"]=true;a.preventDefault();}};I.prototype._oncontextmenu=function(e){var i=this._eventToInput(e);this._loco.contextMenu(i,this._control);if(i.handled){e["_sapui_handledByControl"]=true;e.preventDefault();}};I.prototype.isSupported=function(){return true;};I.prototype.enable=function(c){this._buttonFlagsValue=0;this._buttons=0;this._control=c;var f=this._control?this._control.attachBrowserEvent.bind(this._control):window.document.addEventListener;f("mousedown",this._mousedownProxy);f("mouseup",this._mouseupProxy);f("mousemove",this._mousemoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.addEventListener("mouseup",this._onmouseupWindowListenerProxy);};I.prototype.disable=function(){var f=this._control?this._control.detachBrowserEvent.bind(this._control):window.document.removeEventListener;f("mousedown",this._mousedownProxy);f("mouseup",this._mouseupProxy);f("mousemove",this._mousemoveProxy);f("mousewheel",this._mousewheelProxy);f("DOMMouseScroll",this._mousewheelProxy);f("contextmenu",this._contextmenuProxy);window.document.removeEventListener("mouseup",this._onmouseupWindowListenerProxy);};return I;},true);
