/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","./Messages","sap/m/ToggleButton","./NotificationsRenderer"],function(q,l,C,M,T,N){"use strict";var a=C.extend("sap.ui.vk.Notifications",{metadata:{library:"sap.ui.vk",publicMethods:["clearAllMessages"],aggregations:{_messagePopover:{type:"sap.m.MessagePopover",multiple:false,visibility:"hidden"},_messagePopoverToggleButton:{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"}},events:{allMessagesCleared:{},messageAdded:{}}}});a.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var m;var b=new T({icon:"sap-icon://message-popup",type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVERBUTTON"),text:"0",press:function(e){if(b.getPressed()){m.openBy(b);}else{m.close();}}});b.addStyleClass("messagePopoverButton");this.setAggregation("_messagePopoverToggleButton",b);m=new sap.m.MessagePopover({headerButton:new sap.m.Button({text:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),type:sap.m.ButtonType.Emphasized,tooltip:sap.ui.vk.getResourceBundle().getText("MESSAGEPOPOVER_CLEARBUTTON"),press:function(e){m.getParent().clearAllMessages();}}),afterClose:b.setPressed.bind(b,false)});m.addStyleClass("sapVizKitNotificationPopover");this.setAggregation("_messagePopover",m);q.sap.log.addLogListener(this);};a.prototype.exit=function(){q.sap.log.removeLogListener(this);if(C.prototype.exit){C.prototype.exit.call(this);}};a.prototype.onLogEntry=function(e){if(/^sap\.ui\.vk/.test(e.component)){var m=e.details,c,r,b;if(M[e.details]){m=sap.ui.vk.getResourceBundle().getText(M[e.details].summary);c=sap.ui.vk.getResourceBundle().getText(M[e.details].cause);r=sap.ui.vk.getResourceBundle().getText(M[e.details].resolution);b=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CODE");}var d=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_COMPONENT");var f=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_DATE");var t=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_TIME");var g=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_LEVEL");var h=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_MESSAGE");var i=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_CAUSE");var j=sap.ui.vk.getResourceBundle().getText("ERROR_DESCRIPTION_RESOLUTION");var k="<div><b>"+d+":</b><br>"+e.component+"</div><br>"+"<div><b>"+f+":</b><br>"+e.date+"</div><br>"+(b?"<div><b>"+b+":</b><br>"+e.details+"</div><br>":"")+"<div><b>"+t+":</b><br>"+e.time.slice(0,e.time.indexOf("."))+"</div><br>"+"<div><b>"+g+":</b><br>"+e.level+"</div><br>"+"<div><b>"+h+":</b><br>"+m+"</div><br>"+(c?"<div><b>"+i+":</b><br>"+c+"</div><br>":"")+(r?"<div><b>"+j+":</b><br>"+r+"</div>":"");var n=new sap.m.MessagePopoverItem({markupDescription:true,title:e.message,description:k});var o=this.getAggregation("_messagePopover");o.addItem(n);this.getAggregation("_messagePopoverToggleButton").setText(o.getItems().length);this.fireMessageAdded();}};a.prototype.clearAllMessages=function(){var m=this.getAggregation("_messagePopover");m.removeAllItems();m.close();this.getAggregation("_messagePopoverToggleButton").setText(m.getItems().length);this.fireAllMessagesCleared();return this;};return a;});
