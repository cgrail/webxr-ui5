/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../NodeHierarchy","sap/ui/base/ObjectPool","./BaseNodeProxy","./NodeProxy","../Messages"],function(q,N,O,B,a,M){"use strict";var s={equals:function(c,d){return c===d;},contains:function(c,d){return c.indexOf(d)!==-1;},startsWith:function(c,d){return c.indexOf(d)===0;}};var b=N.extend("sap.ui.vk.threejs.NodeHierarchy",{metadata:{},_baseNodeProxyPool:new O(B),constructor:function(c){N.call(this);this._scene=c;this._nodeProxies=[];}});b.prototype.destroy=function(){this._nodeProxies.slice().forEach(this.destroyNodeProxy,this);this._scene=null;N.prototype.destroy.call(this);};b.prototype.getScene=function(){return this._scene;};b.prototype.getSceneRef=function(){return this._scene.getSceneRef();};b.prototype.enumerateChildren=function(n,c,d,p){if(typeof n==="function"){p=d;d=c;c=n;n=undefined;}var e=this.getChildren(n,d);if(p){e.forEach(c);}else{var f=this._baseNodeProxyPool.borrowObject();try{e.forEach(function(n){f.init(this,n);c(f);f.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(f);}}return this;};b.prototype.enumerateAncestors=function(n,c,p){var d=this.getAncestors(n);if(p){d.forEach(c);}else{var e=this._baseNodeProxyPool.borrowObject();try{d.forEach(function(n){e.init(this,n);c(e);e.reset();}.bind(this));}finally{this._baseNodeProxyPool.returnObject(e);}}return this;};b.prototype.createNodeProxy=function(n){var c=new a(this,n);this._nodeProxies.push(c);return c;};b.prototype.destroyNodeProxy=function(n){var i=this._nodeProxies.indexOf(n);if(i>=0){this._nodeProxies.splice(i,1)[0].destroy();}return this;};b.prototype.getChildren=function(n,c){if(typeof n==="boolean"){c=n;n=undefined;}if(!n){n=this._scene.getSceneRef();}var d=[];if(c||!n.userData.closed){n.children.forEach(function(e){if(!e.private&&(e.geometry===undefined||e.name||e.children.length>0)){d.push(e);}});}return d;};b.prototype.getAncestors=function(n){var c=[];n.traverseAncestors(function(p){c.unshift(p);});if(c.length>0&&c[0]===this._scene.getSceneRef()){c.shift();}return c;};b.prototype.findNodesByName=function(c){var r=[];if(c===undefined||c===null||q.isEmptyObject(c)){this._scene.getSceneRef().children.forEach(function(f){f.traverse(function(o){if(!o.private&&(o.geometry===undefined||o.name||o.children.length>0)){r.push(o);}});});}else{var d=s[c.predicate||"equals"];if(d===undefined){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT8.summary),M.VIT8.code,"sap.ui.vk.threejs.NodeHierarchy");}else if(!Array.isArray(c.value)&&typeof c.value!=="string"){q.sap.log.error(sap.ui.vk.getResourceBundle().getText(M.VIT6.summary),M.VIT6.code,"sap.ui.vk.threejs.NodeHierarchy");}else{var e=Array.isArray(c.value)?c.value:[c.value];if(!c.caseSensitive){for(var i in e){e[i]=e[i].toLowerCase();}}this._scene.getSceneRef().children.forEach(function(f){f.traverse(function(o){if(!o.private&&(o.geometry===undefined||o.name||o.children.length>0)){var n=o.name||"";if(!c.caseSensitive){n=n.toLowerCase();}for(var i in e){if(d(n,e[i])){r.push(o);break;}}}});});}}return r;};b.prototype.createLayerProxy=function(l){return null;};b.prototype.destroyLayerProxy=function(l){return this;};b.prototype.getLayers=function(){return[];};b.prototype.getHotspotNodeIds=function(){return null;};b.prototype.attachChanged=function(d,f,l){return this.attachEvent("changed",d,f,l);};b.prototype.detachChanged=function(d,f,l){return this.detachEvent("changed",d,f,l);};b.prototype.fireChanged=function(p,c,e){return this.fireEvent("changed",p,c,e);};b.prototype.attachNodeCreated=function(d,f,l){return this.attachEvent("nodeCreated",d,f,l);};b.prototype.detachNodeCreated=function(d,f,l){return this.detachEvent("nodeCreated",d,f,l);};b.prototype.fireNodeCreated=function(p,c,e){return this.fireEvent("nodeCreated",p,c,e);};b.prototype.attachNodeRemoving=function(d,f,l){return this.attachEvent("nodeRemoving",d,f,l);};b.prototype.detachNodeRemoving=function(d,f,l){return this.detachEvent("nodeRemoving",d,f,l);};b.prototype.fireNodeRemoving=function(p,c,e){return this.fireEvent("nodeRemoving",p,c,e);};b.prototype.attachNodeReplaced=function(d,f,l){return this.attachEvent("nodeReplaced",d,f,l);};b.prototype.detachNodeReplaced=function(d,f,l){return this.detachEvent("nodeReplaced",d,f,l);};b.prototype.fireNodeReplaced=function(p,c,e){return this.fireEvent("nodeReplaced",p,c,e);};b.prototype.attachNodeUpdated=function(d,f,l){return this.attachEvent("nodeUpdated",d,f,l);};b.prototype.detachNodeUpdated=function(d,f,l){return this.detachEvent("nodeUpdated",d,f,l);};b.prototype.fireNodeUpdated=function(p,c,e){return this.fireEvent("nodeUpdated",p,c,e);};b.prototype.createNode=function(p,n,i){if(!p){p=this._scene.getSceneRef();}var c=p.children.indexOf(i);var o=new THREE.Group();o.name=n;p.add(o);if(c>=0){p.children.splice(c,0,p.children.pop());}this.fireNodeCreated({nodeRef:o,nodeId:o});this.fireChanged();return o;};b.prototype.createNodeCopy=function(n,p,c,i){if(!p){p=this._scene.getSceneRef();}var d=p.children.indexOf(i);var e=n.clone(true);e.name=c;p.add(e);if(d>=0){p.children.splice(d,0,p.children.pop());}this.fireNodeCreated({nodeRef:e,nodeId:e});this.fireChanged();return e;};b.prototype.removeNode=function(n){var c=[].concat(n);c.forEach(function(n){if(n&&n.parent){this.fireNodeRemoving({nodeRef:n,nodeId:n});n.parent.remove(n);}}.bind(this));this.fireChanged();return this;};return b;});
