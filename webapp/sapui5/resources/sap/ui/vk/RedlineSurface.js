/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","sap/ui/core/Control","./Loco","./RedlineGesturesHandler","./RedlineSurfaceRenderer"],function(q,l,C,L,R){"use strict";var a=C.extend("sap.ui.vk.RedlineSurface",{metadata:{library:"sap.ui.vk",aggregations:{redlineElements:{type:"sap.ui.vk.RedlineElement"}},properties:{virtualLeft:{type:"float"},virtualTop:{type:"float"},virtualSideLength:{type:"float"},panningRatio:{type:"float",defaultValue:1}},events:{pan:{parameters:{deltaX:"float",deltaY:"float"}},zoom:{parameters:{originX:"float",originY:"float",zoomFactor:"float"}}}}});a.prototype.init=function(){};a.prototype.onAfterRendering=function(){};a.prototype.exportJSON=function(){return this.getRedlineElements().map(function(e){return e.exportJSON();});};a.prototype.importJSON=function(j){if(!q.isArray(j)){j=[j];}j.forEach(function(b){var E;switch(b.type){case sap.ui.vk.Redline.ElementType.Rectangle:E=sap.ui.vk.RedlineElementRectangle;break;case sap.ui.vk.Redline.ElementType.Ellipse:E=sap.ui.vk.RedlineElementEllipse;break;case sap.ui.vk.Redline.ElementType.Freehand:E=sap.ui.vk.RedlineElementFreehand;break;case sap.ui.vk.Redline.ElementType.Line:E=sap.ui.vk.RedlineElementLine;break;case sap.ui.vk.Redline.ElementType.Text:E=sap.ui.vk.RedlineElementText;break;default:q.sap.log.warning("Unsupported JSON element type "+b.type);}this.addRedlineElement(new E().importJSON(b));}.bind(this));return this;};a.prototype._toVirtualSpace=function(x,y){if(arguments.length===1){return x/this.getVirtualSideLength();}else{return{x:(x-this.getVirtualLeft())/this.getVirtualSideLength(),y:(y-this.getVirtualTop())/this.getVirtualSideLength()};}};a.prototype._toPixelSpace=function(x,y){if(arguments.length===1){return x*this.getVirtualSideLength();}else{return{x:x*this.getVirtualSideLength()+this.getVirtualLeft(),y:y*this.getVirtualSideLength()+this.getVirtualTop()};}};a.prototype.setPanningRatio=function(p){this.setProperty("panningRatio",p,true);};a.prototype.updatePanningRatio=function(){var v=this.getVirtualLeft(),b=this.getVirtualTop(),r=this.getDomRef(),c=r.getBoundingClientRect(),h=c.height,w=c.width,p;if(v===0&&(h<w&&b<0||(h>w&&b>0))){p=h/w;}else{p=1;}this.setPanningRatio(p);return this;};a.prototype.exportSVG=function(){var s=document.createElementNS(sap.ui.vk.Redline.svgNamespace,"svg");this.getRedlineElements().map(function(e){s.appendChild(e.exportSVG());});return s;};a.prototype.importSVG=function(s){s.childNodes.forEach(function(t){if(t.getAttribute){var E;switch(t.tagName){case"rect":E=sap.ui.vk.RedlineElementRectangle;break;case"ellipse":E=sap.ui.vk.RedlineElementEllipse;break;case"path":E=sap.ui.vk.RedlineElementFreehand;break;case"line":E=sap.ui.vk.RedlineElementLine;break;case"text":E=sap.ui.vk.RedlineElementText;break;default:q.sap.log.warning("Unsupported SVG element type "+E);}if(E){this.addRedlineElement(new E().importSVG(t));}}}.bind(this));return this;};return a;});
