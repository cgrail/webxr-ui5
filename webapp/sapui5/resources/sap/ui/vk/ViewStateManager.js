/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/Element","./ContentConnector","./Scene","./ViewStateManagerBase","./Core"],function(q,E,C,S,V,a){"use strict";var b=V.extend("sap.ui.vk.ViewStateManager",{metadata:{}});var c=b.getMetadata().getParent().getClass().prototype;b.prototype.init=function(){if(c.init){c.init.call(this);}this._implementation=null;};b.prototype.exit=function(){this._destroyImplementation();if(c.exit){c.exit.call(this);}};b.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};b.prototype.getImplementation=function(){return this._implementation;};b.prototype._setContent=function(d){var s=null;if(d&&d instanceof sap.ui.vk.Scene){s=d;}this._setScene(s);};b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};b.prototype._onBeforeClearContentConnector=function(){this._setScene(null);};b.prototype._handleContentReplaced=function(e){this._setContent(e.getParameter("newContent"));};b.prototype._setScene=function(s){if(s&&s instanceof S){var d=s.getMetadata().getName(),i=this._implementation&&this._implementation.getMetadata().getName(),r=d==="sap.ui.vk.dvl.Scene"&&i==="sap.ui.vk.dvl.ViewStateManager"||d==="sap.ui.vk.threejs.Scene"&&i==="sap.ui.vk.threejs.ViewStateManager";if(!r){this._destroyImplementation();var n;if(d==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.ViewStateManager";}else if(d==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.ViewStateManager";}if(n){var t=this;q.sap.require(n);this._implementation=new(q.sap.getObject(n))({shouldTrackVisibilityChanges:this.getShouldTrackVisibilityChanges(),recursiveSelection:this.getRecursiveSelection(),contentConnector:this.getContentConnector(),visibilityChanged:function(e){t.fireVisibilityChanged({visible:e.getParameter("visible"),hidden:e.getParameter("hidden")});},selectionChanged:function(e){t.fireSelectionChanged({selected:e.getParameter("selected"),unselected:e.getParameter("unselected")});},opacityChanged:function(e){t.fireOpacityChanged({changed:e.getParameter("changed"),opacity:e.getParameter("opacity")});},tintColorChanged:function(e){t.fireTintColorChanged({changed:e.getParameter("changed"),tintColor:e.getParameter("tintColor"),tintColorABGR:e.getParameter("tintColorABGR")});},nodeHierarchyReplaced:function(e){t.fireNodeHierarchyReplaced({oldNodeHierarchy:e.getParameter("oldNodeHierarchy"),newNodeHierarchy:e.getParameter("newNodeHierarchy")});}});}}}else{this._destroyImplementation();}return this;};b.prototype.getNodeHierarchy=function(){return this._implementation&&this._implementation.getNodeHierarchy();};b.prototype.getVisibilityChanges=function(){return this._implementation&&this._implementation.getVisibilityChanges();};b.prototype.getVisibilityComplete=function(){return this._implementation&&this._implementation.getVisibilityComplete();};b.prototype.getVisibilityState=function(n){return this._implementation&&this._implementation.getVisibilityState(n);};b.prototype.setVisibilityState=function(n,v,r){if(this._implementation){this._implementation.setVisibilityState(n,v,r);}return this;};b.prototype.resetVisibility=function(){return this._implementation&&this._implementation.resetVisibility();};b.prototype.enumerateSelection=function(d){if(this._implementation){this._implementation.enumerateSelection(d);}return this;};b.prototype.setShowSelectionBoundingBox=function(v){if(this._implementation){this._implementation.setShowSelectionBoundingBox(v);}};b.prototype.getShowSelectionBoundingBox=function(){if(this._implementation){return this._implementation.getShowSelectionBoundingBox();}};b.prototype.getSelectionState=function(n){return this._implementation&&this._implementation.getSelectionState(n);};b.prototype.setSelectionState=function(n,s,r){if(this._implementation){this._implementation.setSelectionState(n,s,r);}return this;};b.prototype.setSelectionStates=function(s,u,r){if(this._implementation){this._implementation.setSelectionStates(s,u,r);}return this;};b.prototype.getOpacity=function(n){return this._implementation&&this._implementation.getOpacity(n);};b.prototype.setOpacity=function(n,o,r){if(this._implementation){this._implementation.setOpacity(n,o,r);}return this;};b.prototype.getTintColor=function(n,i){return this._implementation&&this._implementation.getTintColor(n,i);};b.prototype.setTintColor=function(n,t,r){if(this._implementation){this._implementation.setTintColor(n,t,r);}return this;};b.prototype.setHighlightColor=function(d){if(this._implementation&&this._implementation.setHighlightColor){this._implementation.setHighlightColor(d);}return this;};b.prototype.getHighlightColor=function(i){if(this._implementation&&this._implementation.getHighlightColor){return this._implementation.getHighlightColor(i);}};b.prototype.setRecursiveSelection=function(p){this.setProperty("recursiveSelection",p,true);if(this._implementation){this._implementation.setRecursiveSelection(p);}return this;};var f=b.getMetadata().getName();var m={init:function(){this._viewStateManager=null;sap.ui.vk.getCore().attachEvent(f+"-created",this._handleViewStateManagerCreated,this).attachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this);},exit:function(){this.setViewStateManager(null);sap.ui.vk.getCore().detachEvent(f+"-destroying",this._handleViewStateManagerDestroying,this).detachEvent(f+"-created",this._handleViewStateManagerCreated,this);},setViewStateManager:function(v){this.setAssociation("viewStateManager",v,true);this._updateViewStateManager();return this;},_updateViewStateManager:function(){var n=this.getViewStateManager(),d=n&&sap.ui.getCore().byId(n)||null;if(this._viewStateManager!==d){this._clearViewStateManager();if(d){if(this._handleNodeHierarchyReplaced){d.attachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}if(this._handleVisibilityChanged){d.attachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleSelectionChanged){d.attachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleOpacityChanged){d.attachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleTintColorChanged){d.attachTintColorChanged(this._handleTintColorChanged,this);}this._viewStateManager=d;if(this._onAfterUpdateViewStateManager){this._onAfterUpdateViewStateManager();}}}return this;},_clearViewStateManager:function(){if(this._viewStateManager){if(this._onBeforeClearViewStateManager){this._onBeforeClearViewStateManager();}if(this._handleTintColorChanged){this._viewStateManager.detachTintColorChanged(this._handleTintColorChanged,this);}if(this._handleOpacityChanged){this._viewStateManager.detachOpacityChanged(this._handleOpacityChanged,this);}if(this._handleSelectionChanged){this._viewStateManager.detachSelectionChanged(this._handleSelectionChanged,this);}if(this._handleVisibilityChanged){this._viewStateManager.detachVisibilityChanged(this._handleVisibilityChanged,this);}if(this._handleNodeHierarchyReplaced){this._viewStateManager.detachNodeHierarchyReplaced(this._handleNodeHierarchyReplaced,this);}this._viewStateManager=null;}return this;},_handleViewStateManagerCreated:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._updateViewStateManager();}},_handleViewStateManagerDestroying:function(e){if(this.getViewStateManager()===e.getParameter("object").getId()){this._clearViewStateManager();}}};b.injectMethodsIntoClass=function(d){var p=d.prototype,i=p.init,e=p.exit;p.init=function(){if(i){i.call(this);}m.init.call(this);};p.exit=function(){m.exit.call(this);if(e){e.call(this);}};p.setViewStateManager=m.setViewStateManager;p._updateViewStateManager=m._updateViewStateManager;p._clearViewStateManager=m._clearViewStateManager;p._handleViewStateManagerCreated=m._handleViewStateManagerCreated;p._handleViewStateManagerDestroying=m._handleViewStateManagerDestroying;};sap.ui.vk.getCore().registerClass(b);C.injectMethodsIntoClass(b);return b;});
