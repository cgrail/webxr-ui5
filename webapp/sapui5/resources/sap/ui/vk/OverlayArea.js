/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./library","sap/ui/core/Element"],function(l,E){"use strict";var O=E.extend("sap.ui.vk.OverlayArea",{metadata:{library:"sap.ui.vk",properties:{key:{type:"string",group:"Misc",defaultValue:null},position:{type:"string",group:"Misc",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 0.3)"},colorBorder:{type:"sap.ui.core.CSSColor",group:"Misc",defaultValue:"rgba(200, 50, 50, 1.0)"},colorSelect:{type:"string",group:"Misc",defaultValue:null},colorNonSelect:{type:"string",group:"Misc",defaultValue:null},deltaColorHot:{type:"string",group:"Misc",defaultValue:"RHLSA(0;1.3;1.0;1.0)"},select:{type:"boolean",group:"Misc",defaultValue:false},changeable:{type:"boolean",group:"Misc",defaultValue:false}},events:{click:{clientX:{type:"int"},clientY:{type:"int"}},contextMenu:{parameters:{menu:{type:"sap.ui.unified.Menu"}}},edgeClick:{parameters:{index:{type:"int"}}},edgeContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleMoved:{},handleContextMenu:{parameters:{index:{type:"int"},menu:{type:"sap.ui.unified.Menu"}}},handleClick:{index:{type:"int"}}}}});O.prototype.openContextMenu=function(m){this.getParent().openContextMenu("OverlayArea",this,m);};O.prototype.getDataElement=function(){var e={};var b=this.getParent().AreaBindInfo;e.K=this.getId();if(b.C){e.C=this.getColor();}if(b.CB){e.CB=this.getColorBorder();}if(b.DCH){e.DCH=this.getDeltaColorHot();}if(b.CS){e.CS=this.getColorSelect();}if(b.CNS){e.CNS=this.getColorNonSelect();}if(b.TT){e.TT=this.getTooltip();}e["VB:s"]=this.getSelect();e.P=this.getPosition();if(b.M){e["VB:c"]=this.getChangeable();}return e;};O.prototype.handleChangedData=function(e){if(e.P){this.setPosition(e.P);}};O.prototype.handleEvent=function(e){var a=e.Action.name;var f="fire"+a[0].toUpperCase()+a.slice(1);if(a==="contextMenu"||a==="edgeContextMenu"||a==="handleContextMenu"){var p=this.getParent();this.mClickPos=[e.Action.Params.Param[0]["#"],e.Action.Params.Param[1]["#"]];if(p.mVBIContext.m_Menus){p.mVBIContext.m_Menus.deleteMenu("DynContextMenu");}sap.ui.getCore().loadLibrary("sap.ui.unified");var m=new sap.ui.unified.Menu();m["vbi_data"]={};m["vbi_data"].menuRef="CTM";m["vbi_data"].VBIName="DynContextMenu";if(this.getChangeable()){if(a==="edgeContextMenu"){var s=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:sap.ui.vk.getResourceBundle().getText("OVL_AREA_EDGE_SPLIT"),select:this._handleCtxFunction.bind(this,"SPLIT",s)}));}else if(a==="handleContextMenu"){var h=e.Action.Params.Param[2]["#"];p.mAddMenuItems.push(new sap.ui.unified.MenuItem({text:sap.ui.vk.getResourceBundle().getText("OVL_AREA_HANDLE_REMOVE"),select:this._handleCtxFunction.bind(this,"REMOVE",h)}));}}if(this.hasListeners(a)){if(a==="contextMenu"){this.firecontextMenu({menu:m});}else{this[f]({index:e.Action.Params.Param[2]["#"],menu:m});}}else{p._openContextMenu(e.Action.object,this,m);}}else if(a=="click"){this.mClickPos=e.Action.AddActionProperties.AddActionProperty[0]["#"];this.fireClick({clientX:e.Action.Params.Param[0]["#"],clientY:e.Action.Params.Param[1]["#"]});}else if(a.indexOf("Click")>-1){this[f]({index:e.Action.Params.Param[2]["#"]});}else{this[f]();}};O.prototype.getKey=function(){var k=this.getProperty("key");if(!k){k=this.getId();}return k;};O.prototype._handleCtxFunction=function(f,c){var p=this.getPosition().split(";");var o=c*3;if(f==="REMOVE"){p.splice(o,3);}else if(f==="SPLIT"){var s=[p[o],p[o+1]];var e=(o+3<p.length)?[p[o+3],p[o+4]]:[p[0],p[1]];var m=[parseFloat(s[0])+(e[0]-s[0])/2,parseFloat(s[1])+(e[1]-s[1])/2];p.splice(o+3,0,m[0].toString(),m[1].toString(),"0");}this.setPosition(p.toString().replace(/,/g,";"));};return O;});
