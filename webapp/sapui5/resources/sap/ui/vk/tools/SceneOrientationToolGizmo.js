/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","./Gizmo","sap/ui/unified/Menu","sap/ui/unified/MenuItem","sap/ui/vk/threejs/thirdparty/three","./SceneOrientationToolGizmoRenderer"],function(q,l,G,M,a,t,S){"use strict";sap.ui.require("sap.m.Menu");var b=G.extend("sap.ui.vk.tools.SceneOrientationToolGizmo",{metadata:{library:"sap.ui.vk.tools"}});function c(d,e){var f=64,g=0.5,h=15,i=3,j=29,k=30;d.multiplyScalar(1/80);var n=new THREE.Vector3(d.y,d.z,d.x),o=new THREE.Vector3(d.z,d.x,d.y);var p=new THREE.MeshBasicMaterial({color:e}),r=new THREE.MeshBasicMaterial({color:0xFFFFFF,transparent:true,opacity:0.8}),s=new THREE.MeshBasicMaterial({color:0x000000,transparent:true,opacity:0.8});var u=new THREE.CylinderBufferGeometry(g,g,f-h,4);var m=new THREE.Matrix4().makeBasis(n,d,o).setPosition(d.clone().multiplyScalar((f-h)*0.5));u.applyMatrix(m);var v=new THREE.Mesh(u,p);var w=new THREE.CylinderBufferGeometry(0,i,h,12,1);m.setPosition(d.clone().multiplyScalar(f-h*0.5));w.applyMatrix(m);v.add(new THREE.Mesh(w,p));var x=new THREE.CylinderBufferGeometry(g,g,j,4);m.makeBasis(d,o,n).setPosition(o.clone().multiplyScalar(0.5).add(d).multiplyScalar(j));x.applyMatrix(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(g,g,j,4);m.setPosition(o.clone().multiplyScalar(0.5).add(d).add(n).multiplyScalar(j));x.applyMatrix(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(g,g,j,4);m.makeBasis(o,n,d).setPosition(n.clone().multiplyScalar(0.5).add(d).multiplyScalar(j));x.applyMatrix(m);v.add(new THREE.Mesh(x,r));x=new THREE.CylinderBufferGeometry(g,g,k,4);m.makeBasis(d,o,n).setPosition(o.clone().multiplyScalar(0.5).add(d).multiplyScalar(k));x.applyMatrix(m);v.add(new THREE.Mesh(x,s));x=new THREE.CylinderBufferGeometry(g,g,k,4);m.setPosition(o.clone().multiplyScalar(0.5).add(d).add(n).multiplyScalar(k));x.applyMatrix(m);v.add(new THREE.Mesh(x,s));x=new THREE.CylinderBufferGeometry(g,g,k,4);m.makeBasis(o,n,d).setPosition(n.clone().multiplyScalar(0.5).add(d).multiplyScalar(k));x.applyMatrix(m);v.add(new THREE.Mesh(x,s));return v;}b.prototype.init=function(){if(G.prototype.init){G.prototype.init.apply(this);}this._menu=null;this._viewport=null;this._renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.setSize(1,1);this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0.1,100);this._scene=new THREE.Scene();this._scene.add(c(new THREE.Vector3(1,0,0),0xFF0000));this._scene.add(c(new THREE.Vector3(0,1,0),0x00FF00));this._scene.add(c(new THREE.Vector3(0,0,1),0x0000FF));this._scene.traverse(function(o){o.matrixAutoUpdate=false;});this._axisTitles=this._createAxisTitles(32,16);this._scene.add(this._axisTitles);q(document).click(function(e){if(q(".sapUiVizKitSceneOrientationGizmoButton").length){var d=q(".sapUiVizKitSceneOrientationGizmoButton .sapUiIconMirrorInRTL");if(e.target!==d[0]){this._button.setPressed(false);}}}.bind(this));this._button=new sap.m.ToggleButton({icon:"sap-icon://drop-down-list",tooltip:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),press:function(e){if(!this._menu){this.createMenu();}if(this._button.getPressed()){var d=sap.ui.core.Popup.Dock;var r=sap.ui.getCore().getConfiguration().getRTL();this._menu.open(false,this.getFocusDomRef(),r?d.LeftCenter:d.RightCenter,r?d.LeftBottom:d.RightBottom,this.getDomRef());}else{this._menu.close();}}.bind(this)}).addStyleClass("sapUiVizKitSceneOrientationGizmoButton");this._button.addStyleClass("sapUiSizeCompact");};b.prototype.createMenu=function(){var d=1000;var m=this._menu=new M();if(this.oParent.getEnableInitialView()){m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_INITIAL")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Initial,d);this._button.setPressed(false);}.bind(this)));}m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_FRONT"),startsSection:this.oParent.getEnableInitialView()}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Front,d);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_BACK")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Back,d);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_LEFT")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Left,d);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_RIGHT")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Right,d);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_TOP")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Top,d);this._button.setPressed(false);}.bind(this)));m.addItem(new a({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_BOTTOM")}).attachSelect(function(){this.setView(sap.ui.vk.tools.PredefinedView.Bottom,d);this._button.setPressed(false);}.bind(this)));};b.prototype.setView=function(v,m){var d;switch(v){case sap.ui.vk.tools.PredefinedView.Initial:d=null;break;case sap.ui.vk.tools.PredefinedView.Front:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0);break;case sap.ui.vk.tools.PredefinedView.Back:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);break;case sap.ui.vk.tools.PredefinedView.Left:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2);break;case sap.ui.vk.tools.PredefinedView.Right:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2);break;case sap.ui.vk.tools.PredefinedView.Top:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2);break;case sap.ui.vk.tools.PredefinedView.Bottom:d=new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2);break;default:return this;}this._viewport._viewportGestureHandler.setView(d,m||0);return this;};b.prototype.render=function(v){this._viewport=v;this._camera.quaternion.copy(v.getCamera().getCameraRef().quaternion);this._camera.position.set(0,0,1).applyQuaternion(this._camera.quaternion);var w=this._renderer.getSize().width;this._updateAxisTitles(this._axisTitles,this._scene,this._camera,w*0.45,2/w);this._renderer.render(this._scene,this._camera);};b.prototype.onBeforeRendering=function(){};b.prototype.onAfterRendering=function(){var d=this.getDomRef();this._renderer.setSize(d.clientWidth,d.clientHeight);d.appendChild(this._renderer.domElement);};return b;},true);
