(function(){var f=(function(){'use strict';var C=function(i){var a=i;var e=function(){return a;};var s=function(v){a=v;};var m=function(){return C(e());};return{get:e,set:s,clone:m};};var g=tinymce.util.Tools.resolve('tinymce.PluginManager');var b=tinymce.util.Tools.resolve('tinymce.util.Tools');var c=tinymce.util.Tools.resolve('tinymce.html.DomParser');var d=tinymce.util.Tools.resolve('tinymce.html.Node');var h=tinymce.util.Tools.resolve('tinymce.html.Serializer');var j=function(e){return e.getParam('fullpage_hide_in_source_view');};var k=function(e){return e.getParam('fullpage_default_xml_pi');};var l=function(e){return e.getParam('fullpage_default_encoding');};var n=function(e){return e.getParam('fullpage_default_font_family');};var o=function(e){return e.getParam('fullpage_default_font_size');};var p=function(e){return e.getParam('fullpage_default_text_color');};var q=function(e){return e.getParam('fullpage_default_title');};var r=function(e){return e.getParam('fullpage_default_doctype','<!DOCTYPE html>');};var $={shouldHideInSourceView:j,getDefaultXmlPi:k,getDefaultEncoding:l,getDefaultFontFamily:n,getDefaultFontSize:o,getDefaultTextColor:p,getDefaultTitle:q,getDefaultDocType:r};var t=function(a){return c({validate:false,root_name:'#document'}).parse(a);};var u=function(e,a){var i=t(a);var m={};var s,v;function Q(s,R){var S=s.attr(R);return S||'';}m.fontface=$.getDefaultFontFamily(e);m.fontsize=$.getDefaultFontSize(e);s=i.firstChild;if(s.type===7){m.xml_pi=true;v=/encoding="([^"]+)"/.exec(s.value);if(v){m.docencoding=v[1];}}s=i.getAll('#doctype')[0];if(s){m.doctype='<!DOCTYPE'+s.value+'>';}s=i.getAll('title')[0];if(s&&s.firstChild){m.title=s.firstChild.value;}b.each(i.getAll('meta'),function(R){var S=R.attr('name');var T=R.attr('http-equiv');var v;if(S){m[S.toLowerCase()]=R.attr('content');}else if(T==='Content-Type'){v=/charset\s*=\s*(.*)\s*/gi.exec(R.attr('content'));if(v){m.docencoding=v[1];}}});s=i.getAll('html')[0];if(s){m.langcode=Q(s,'lang')||Q(s,'xml:lang');}m.stylesheets=[];b.each(i.getAll('link'),function(R){if(R.attr('rel')==='stylesheet'){m.stylesheets.push(R.attr('href'));}});s=i.getAll('body')[0];if(s){m.langdir=Q(s,'dir');m.style=Q(s,'style');m.visited_color=Q(s,'vlink');m.link_color=Q(s,'link');m.active_color=Q(s,'alink');}return m;};var w=function(e,a,m){var s,v,Q,R,S;var T=e.dom;function U(R,i,S){R.attr(i,S?S:undefined);}function V(i){if(v.firstChild){v.insert(i,v.firstChild);}else{v.append(i);}}s=t(m);v=s.getAll('head')[0];if(!v){R=s.getAll('html')[0];v=new d('head',1);if(R.firstChild){R.insert(v,R.firstChild,true);}else{R.append(v);}}R=s.firstChild;if(a.xml_pi){S='version="1.0"';if(a.docencoding){S+=' encoding="'+a.docencoding+'"';}if(R.type!==7){R=new d('xml',7);s.insert(R,s.firstChild,true);}R.value=S;}else if(R&&R.type===7){R.remove();}R=s.getAll('#doctype')[0];if(a.doctype){if(!R){R=new d('#doctype',10);if(a.xml_pi){s.insert(R,s.firstChild);}else{V(R);}}R.value=a.doctype.substring(9,a.doctype.length-1);}else if(R){R.remove();}R=null;b.each(s.getAll('meta'),function(i){if(i.attr('http-equiv')==='Content-Type'){R=i;}});if(a.docencoding){if(!R){R=new d('meta',1);R.attr('http-equiv','Content-Type');R.shortEnded=true;V(R);}R.attr('content','text/html; charset='+a.docencoding);}else if(R){R.remove();}R=s.getAll('title')[0];if(a.title){if(!R){R=new d('title',1);V(R);}else{R.empty();}R.append(new d('#text',3)).value=a.title;}else if(R){R.remove();}b.each('keywords,description,author,copyright,robots'.split(','),function(X){var Y=s.getAll('meta');var i,Z;var S=a[X];for(i=0;i<Y.length;i++){Z=Y[i];if(Z.attr('name')===X){if(S){Z.attr('content',S);}else{Z.remove();}return;}}if(S){R=new d('meta',1);R.attr('name',X);R.attr('content',S);R.shortEnded=true;V(R);}});var W={};b.each(s.getAll('link'),function(i){if(i.attr('rel')==='stylesheet'){W[i.attr('href')]=i;}});b.each(a.stylesheets,function(i){if(!W[i]){R=new d('link',1);R.attr({rel:'stylesheet',text:'text/css',href:i});R.shortEnded=true;V(R);}delete W[i];});b.each(W,function(i){i.remove();});R=s.getAll('body')[0];if(R){U(R,'dir',a.langdir);U(R,'style',a.style);U(R,'vlink',a.visited_color);U(R,'link',a.link_color);U(R,'alink',a.active_color);T.setAttribs(e.getBody(),{style:a.style,dir:a.dir,vLink:a.visited_color,link:a.link_color,aLink:a.active_color});}R=s.getAll('html')[0];if(R){U(R,'lang',a.langcode);U(R,'xml:lang',a.langcode);}if(!v.firstChild){v.remove();}Q=h({validate:false,indent:true,apply_source_formatting:true,indent_before:'head,html,body,meta,title,script,link,style',indent_after:'head,html,body,meta,title,script,link,style'}).serialize(s);return Q.substring(0,Q.indexOf('</body>'));};var x={parseHeader:t,htmlToData:u,dataToHtml:w};var y=function(a,i){var m=x.htmlToData(a,i.get());a.windowManager.open({title:'Document properties',data:m,defaults:{type:'textbox',size:40},body:[{name:'title',label:'Title'},{name:'keywords',label:'Keywords'},{name:'description',label:'Description'},{name:'robots',label:'Robots'},{name:'author',label:'Author'},{name:'docencoding',label:'Encoding'}],onSubmit:function(e){var s=x.dataToHtml(a,b.extend(m,e.data),i.get());i.set(s);}});};var z={open:y};var A=function(e,a){e.addCommand('mceFullPageProperties',function(){z.open(e,a);});};var B={register:A};var D=function(a,e){b.each(a,function(i){e=e.replace(i,function(s){return'<!--mce:protected '+escape(s)+'-->';});});return e;};var E=function(e){return e.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(a,m){return unescape(m);});};var F={protectHtml:D,unprotectHtml:E};var G=b.each;var H=function(s){return s.replace(/<\/?[A-Z]+/g,function(a){return a.toLowerCase();});};var I=function(e,a,i,m){var s,v,Q,R,S='';var T=e.dom;var U;if(m.selection){return;}Q=F.protectHtml(e.settings.protect,m.content);if(m.format==='raw'&&a.get()){return;}if(m.source_view&&$.shouldHideInSourceView(e)){return;}if(Q.length===0&&!m.source_view){Q=b.trim(a.get())+'\n'+b.trim(Q)+'\n'+b.trim(i.get());}Q=Q.replace(/<(\/?)BODY/gi,'<$1body');s=Q.indexOf('<body');if(s!==-1){s=Q.indexOf('>',s);a.set(H(Q.substring(0,s+1)));v=Q.indexOf('</body',s);if(v===-1){v=Q.length;}m.content=b.trim(Q.substring(s+1,v));i.set(H(Q.substring(v)));}else{a.set(J(e));i.set('\n</body>\n</html>');}R=x.parseHeader(a.get());G(R.getAll('style'),function(X){if(X.firstChild){S+=X.firstChild.value;}});U=R.getAll('body')[0];if(U){T.setAttribs(e.getBody(),{style:U.attr('style')||'',dir:U.attr('dir')||'',vLink:U.attr('vlink')||'',link:U.attr('link')||'',aLink:U.attr('alink')||''});}T.remove('fullpage_styles');var V=e.getDoc().getElementsByTagName('head')[0];if(S){T.add(V,'style',{id:'fullpage_styles'},S);U=T.get('fullpage_styles');if(U.styleSheet){U.styleSheet.cssText=S;}}var W={};b.each(V.getElementsByTagName('link'),function(X){if(X.rel==='stylesheet'&&X.getAttribute('data-mce-fullpage')){W[X.href]=X;}});b.each(R.getAll('link'),function(X){var Y=X.attr('href');if(!Y){return true;}if(!W[Y]&&X.attr('rel')==='stylesheet'){T.add(V,'link',{'rel':'stylesheet','text':'text/css','href':Y,'data-mce-fullpage':'1'});}delete W[Y];});b.each(W,function(X){X.parentNode.removeChild(X);});};var J=function(e){var a='',v,s='';if($.getDefaultXmlPi(e)){var i=$.getDefaultEncoding(e);a+='<?xml version="1.0" encoding="'+(i?i:'ISO-8859-1')+'" ?>\n';}a+=$.getDefaultDocType(e);a+='\n<html>\n<head>\n';if(v=$.getDefaultTitle(e)){a+='<title>'+v+'</title>\n';}if(v=$.getDefaultEncoding(e)){a+='<meta http-equiv="Content-Type" content="text/html; charset='+v+'" />\n';}if(v=$.getDefaultFontFamily(e)){s+='font-family: '+v+';';}if(v=$.getDefaultFontSize(e)){s+='font-size: '+v+';';}if(v=$.getDefaultTextColor(e)){s+='color: '+v+';';}a+='</head>\n<body'+(s?' style="'+s+'"':'')+'>\n';return a;};var K=function(e,a,i,m){if(!m.selection&&(!m.source_view||!$.shouldHideInSourceView(e))){m.content=F.unprotectHtml(b.trim(a)+'\n'+b.trim(m.content)+'\n'+b.trim(i));}};var L=function(e,a,i){e.on('BeforeSetContent',function(m){I(e,a,i,m);});e.on('GetContent',function(m){K(e,a.get(),i.get(),m);});};var M={setup:L};var N=function(e){e.addButton('fullpage',{title:'Document properties',cmd:'mceFullPageProperties'});e.addMenuItem('fullpage',{text:'Document properties',cmd:'mceFullPageProperties',context:'file'});};var O={register:N};g.add('fullpage',function(e){var a=C(''),i=C('');B.register(e,a);O.register(e);M.setup(e,a,i);});function P(){}return P;}());})();
