(function(){var a=(function(){'use strict';var C=function(e){var f=e;var B=function(){return f;};var K=function(v){f=v;};var L=function(){return C(B());};return{get:B,set:K,clone:L};};var g=tinymce.util.Tools.resolve('tinymce.PluginManager');var b=tinymce.util.Tools.resolve('tinymce.util.LocalStorage');var c=tinymce.util.Tools.resolve('tinymce.util.Tools');var d=function(e){return e.fire('RestoreDraft');};var h=function(e){return e.fire('StoreDraft');};var i=function(e){return e.fire('RemoveDraft');};var $={fireRestoreDraft:d,fireStoreDraft:h,fireRemoveDraft:i};var p=function(e,f){var v={s:1000,m:60000};e=/^(\d+)([ms]?)$/.exec(''+(e||f));return(e[2]?v[e[2]]:1)*parseInt(e,10);};var j={parse:p};var s=function(e){return e.getParam('autosave_ask_before_unload',true);};var k=function(e){var f=e.getParam('autosave_prefix','tinymce-autosave-{path}{query}{hash}-{id}-');f=f.replace(/\{path\}/g,document.location.pathname);f=f.replace(/\{query\}/g,document.location.search);f=f.replace(/\{hash\}/g,document.location.hash);f=f.replace(/\{id\}/g,e.id);return f;};var l=function(e){return e.getParam('autosave_restore_when_empty',false);};var m=function(e){return j.parse(e.settings.autosave_interval,'30s');};var n=function(e){return j.parse(e.settings.autosave_retention,'20m');};var o={shouldAskBeforeUnload:s,getAutoSavePrefix:k,shouldRestoreWhenEmpty:l,getAutoSaveInterval:m,getAutoSaveRetention:n};var q=function(e,f){var v=e.settings.forced_root_block;f=c.trim(typeof f==='undefined'?e.getBody().innerHTML:f);return f===''||new RegExp('^<'+v+'[^>]*>((\xA0|&nbsp;|[ \t]|<br[^>]*>)+?|)</'+v+'>|<br>$','i').test(f);};var r=function(e){var f=parseInt(b.getItem(o.getAutoSavePrefix(e)+'time'),10)||0;if(new Date().getTime()-f>o.getAutoSaveRetention(e)){t(e,false);return false;}return true;};var t=function(e,f){var v=o.getAutoSavePrefix(e);b.removeItem(v+'draft');b.removeItem(v+'time');if(f!==false){$.fireRemoveDraft(e);}};var u=function(e){var f=o.getAutoSavePrefix(e);if(!q(e)&&e.isDirty()){b.setItem(f+'draft',e.getContent({format:'raw',no_events:true}));b.setItem(f+'time',new Date().getTime().toString());$.fireStoreDraft(e);}};var w=function(e){var f=o.getAutoSavePrefix(e);if(r(e)){e.setContent(b.getItem(f+'draft'),{format:'raw'});$.fireRestoreDraft(e);}};var x=function(e,f){var v=o.getAutoSaveInterval(e);if(!f.get()){setInterval(function(){if(!e.removed){u(e);}},v);f.set(true);}};var y=function(e){e.undoManager.transact(function(){w(e);t(e);});e.focus();};var z={isEmpty:q,hasDraft:r,removeDraft:t,storeDraft:u,restoreDraft:w,startStoreDraft:x,restoreLastDraft:y};var A=function(f,e){return function(){var v=Array.prototype.slice.call(arguments);return f.apply(null,[e].concat(v));};};var B=function(e){return{hasDraft:A(z.hasDraft,e),storeDraft:A(z.storeDraft,e),restoreDraft:A(z.restoreDraft,e),removeDraft:A(z.removeDraft,e),isEmpty:A(z.isEmpty,e)};};var D={get:B};var E=tinymce.util.Tools.resolve('tinymce.EditorManager');E._beforeUnloadHandler=function(){var e;c.each(E.get(),function(f){if(f.plugins.autosave){f.plugins.autosave.storeDraft();}if(!e&&f.isDirty()&&o.shouldAskBeforeUnload(f)){e=f.translate('You have unsaved changes are you sure you want to navigate away?');}});return e;};var F=function(e){window.onbeforeunload=E._beforeUnloadHandler;};var G={setup:F};var H=function(f,v){return function(e){var K=e.control;K.disabled(!z.hasDraft(f));f.on('StoreDraft RestoreDraft RemoveDraft',function(){K.disabled(!z.hasDraft(f));});z.startStoreDraft(f,v);};};var I=function(e,f){e.addButton('restoredraft',{title:'Restore last draft',onclick:function(){z.restoreLastDraft(e);},onPostRender:H(e,f)});e.addMenuItem('restoredraft',{text:'Restore last draft',onclick:function(){z.restoreLastDraft(e);},onPostRender:H(e,f),context:'file'});};var J={register:I};g.add('autosave',function(e){var f=C(false);G.setup(e);J.register(e,f);return D.get(e);});function P(){}return P;}());})();
