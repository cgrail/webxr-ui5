(function(){var t=(function(){'use strict';var C=function(i){var a=i;var c=function(){return a;};var b=function(v){a=v;};var e=function(){return C(c());};return{get:c,set:b,clone:e};};var g=tinymce.util.Tools.resolve('tinymce.PluginManager');var c=function(a){var b=function(e){a.set(e);};var f=function(){return a.get();};return{setPatterns:b,getPatterns:f};};var $={get:c};var d=[{start:'*',end:'*',format:'italic'},{start:'**',end:'**',format:'bold'},{start:'***',end:'***',format:['bold','italic']},{start:'#',format:'h1'},{start:'##',format:'h2'},{start:'###',format:'h3'},{start:'####',format:'h4'},{start:'#####',format:'h5'},{start:'######',format:'h6'},{start:'1. ',cmd:'InsertOrderedList'},{start:'* ',cmd:'InsertUnorderedList'},{start:'- ',cmd:'InsertUnorderedList'}];var f=function(e){return e.textpattern_patterns!==undefined?e.textpattern_patterns:d;};var h={getPatterns:f};var j=tinymce.util.Tools.resolve('tinymce.util.Delay');var k=tinymce.util.Tools.resolve('tinymce.util.VK');var l=tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');var m=tinymce.util.Tools.resolve('tinymce.util.Tools');var s=function(e){return e.sort(function(a,b){if(a.start.length>b.start.length){return-1;}if(a.start.length<b.start.length){return 1;}return 0;});};var n=function(a,b){for(var i=0;i<a.length;i++){if(b.indexOf(a[i].start)!==0){continue;}if(a[i].end&&b.lastIndexOf(a[i].end)!==b.length-a[i].end.length){continue;}return a[i];}};var o=function(a,b,e,i){var v=b.substr(e-a.end.length-i,a.end.length);return v===a.end;};var p=function(a,b,e){return a-b-e.end.length-e.start.length>0;};var q=function(a,b,e,v){var M,i;var N=s(a);for(i=0;i<N.length;i++){M=N[i];if(M.end!==undefined&&o(M,b,e,v)&&p(e,v,M)){return M;}}};var r={findPattern:n,findEndPattern:q};var u=function(a,b,e,i,v){a=i>0?a.splitText(i):a;a.splitText(e-i+b.end.length);a.deleteData(0,b.start.length);a.deleteData(a.data.length-b.end.length,b.end.length);return a;};var w=function(a,b,e){if(b.collapsed===false){return;}var i=b.startContainer;var v=i.data;var M=e===true?1:0;if(i.nodeType!==3){return;}var N=r.findEndPattern(a,v,b.startOffset,M);if(N===undefined){return;}var O=v.lastIndexOf(N.end,b.startOffset-M);var Q=v.lastIndexOf(N.start,O-N.end.length);O=v.indexOf(N.end,Q+N.start.length);if(Q===-1){return;}var R=document.createRange();R.setStart(i,Q);R.setEnd(i,O+N.end.length);var S=r.findPattern(a,R.toString());if(N===undefined||S!==N||i.data.length<=N.start.length+N.end.length){return;}return{pattern:N,startOffset:Q,endOffset:O};};var x=function(e,a,b,i){var v=m.isArray(b.pattern.format)?b.pattern.format:[b.pattern.format];var M=m.grep(v,function(N){var O=e.formatter.get(N);return O&&O[0].inline;});if(M.length!==0){e.undoManager.transact(function(){a=u(a,b.pattern,b.endOffset,b.startOffset,i);v.forEach(function(N){e.formatter.apply(N,{},a);});});return a;}};var y=function(e,a,b){var i=e.selection.getRng(true);var v=w(a,i,b);if(v){return x(e,i.startContainer,v,b);}};var z=function(e,a){return y(e,a,true);};var A=function(e,a){return y(e,a,false);};var B=function(e,a){var b,i,v,M,N,O,Q,R,S,T,U;b=e.selection;i=e.dom;if(!b.isCollapsed()){return;}Q=i.getParent(b.getStart(),'p');if(Q){S=new l(Q,Q);while(N=S.next()){if(N.nodeType===3){M=N;break;}}if(M){R=r.findPattern(a,M.data);if(!R){return;}T=b.getRng(true);v=T.startContainer;U=T.startOffset;if(M===v){U=Math.max(0,U-R.start.length);}if(m.trim(M.data).length===R.start.length){return;}if(R.format){O=e.formatter.get(R.format);if(O&&O[0].block){M.deleteData(0,R.start.length);e.formatter.apply(R.format,{},M);T.setStart(v,U);T.collapse(true);b.setRng(T);}}if(R.cmd){e.undoManager.transact(function(){M.deleteData(0,R.start.length);e.execCommand(R.cmd);});}}}};var D={patternFromRng:w,applyInlineFormatSpace:z,applyInlineFormatEnter:A,applyBlockFormat:B};function E(e,a){var b,i;b=D.applyInlineFormatEnter(e,a);if(b){i=e.dom.createRng();i.setStart(b,b.data.length);i.setEnd(b,b.data.length);e.selection.setRng(i);}D.applyBlockFormat(e,a);}function F(e,a){var b,i,v,M,N;b=D.applyInlineFormatSpace(e,a);if(b){N=e.dom;i=b.data.slice(-1);if(/[\u00a0 ]/.test(i)){b.deleteData(b.data.length-1,1);v=N.doc.createTextNode(i);N.insertAfter(v,b.parentNode);M=N.createRng();M.setStart(v,1);M.setEnd(v,1);e.selection.setRng(M);}}}var G=function(a,e,b){for(var i=0;i<a.length;i++){if(b(a[i],e)){return true;}}};var H=function(a,e){return G(a,e,function(b,e){return b===e.keyCode&&k.modifierPressed(e)===false;});};var I=function(a,e){return G(a,e,function(b,e){return b.charCodeAt(0)===e.charCode;});};var J={handleEnter:E,handleInlineKey:F,checkCharCode:I,checkKeyCode:H};var K=function(a,b){var i=[',','.',';',':','!','?'];var v=[32];a.on('keydown',function(e){if(e.keyCode===13&&!k.modifierPressed(e)){J.handleEnter(a,b.get());}},true);a.on('keyup',function(e){if(J.checkKeyCode(v,e)){J.handleInlineKey(a,b.get());}});a.on('keypress',function(e){if(J.checkCharCode(i,e)){j.setEditorTimeout(a,function(){J.handleInlineKey(a,b.get());});}});};var L={setup:K};g.add('textpattern',function(e){var a=C(h.getPatterns(e.settings));L.setup(e,a);return $.get(a);});function P(){}return P;}());})();
