/* Ephox Media Embed
 *
 * Copyright 2010-2017 Ephox Corporation. All rights reserved.
 *
 * Version: 1.1.0-44
 */
!function(){"use strict";var n,t,e,r,o,u,i,a,c=function(n,t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=n.console;o&&t in o&&o[t].apply(o,arguments)}},s={log:c(window,"log"),error:c(window,"error"),warn:c(window,"warm")},f=function(n){return parseInt(n,10)},l=function(n){return function(){return n}},d=function(n,t,e){return{major:l(n),minor:l(t),patch:l(e)}},m=function(n,t){var e=n-t;return 0===e?0:e>0?1:-1},p=function(n){var t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(n);return t?d(f(t[1]),f(t[2]),f(t[3])):d(0,0,0)},h=function(n,t){var e=m(n.major(),t.major());if(0!==e)return e;var r=m(n.minor(),t.minor());if(0!==r)return r;var o=m(n.patch(),t.patch());return 0!==o?o:0},v=function(n){return n?p([(t=n).majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join(".")):null;var t},g=function(n,t){return h(v(n),p(t))<0},b=function(n){return function(){return n}},y={noop:function(){},noarg:function(n){return function(){return n()}},compose:function(n,t){return function(){return n(t.apply(null,arguments))}},constant:b,identity:function(n){return n},tripleEquals:function(n,t){return n===t},curry:function(n){for(var t=new Array(arguments.length-1),e=1;e<arguments.length;e++)t[e-1]=arguments[e];return function(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var o=t.concat(e);return n.apply(null,o)}},not:function(n){return function(){return!n.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:b(!1),always:b(!0)},w=y.never,x=y.always,O=function(){return k},k=(r={fold:function(n,t){return n()},is:w,isSome:w,isNone:x,getOr:e=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:e,orThunk:t,map:O,ap:O,each:function(){},bind:O,flatten:O,exists:w,forall:x,filter:O,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:y.constant("none()")},Object.freeze&&Object.freeze(r),r),S=function(n){var t=function(){return n},e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:x,isNone:w,getOr:t,getOrThunk:t,getOrDie:t,or:e,orThunk:e,map:function(t){return S(t(n))},ap:function(t){return t.fold(O,function(t){return S(t(n))})},each:function(t){t(n)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(n)?o:k},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(w,function(t){return e(n,t)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},j={some:S,none:O,from:function(n){return null===n||void 0===n?k:S(n)}},T=function(n){return function(t){return t?j.from(t[n]):j.none()}},E=function(n,t){return function(e){return n(e)||t(e)}},A=void 0===(o=Array.prototype.indexOf)?function(n,t){return L(n,t)}:function(n,t){return o.call(n,t)},D=function(n,t){return A(n,t)>-1},R=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var u=n[o];r[o]=t(u,o,n)}return r},C=function(n,t){for(var e=0,r=n.length;e<r;e++)t(n[e],e,n)},_=function(n,t){for(var e=n.length-1;e>=0;e--)t(n[e],e,n)},N=function(n,t){for(var e=[],r=0,o=n.length;r<o;r++){var u=n[r];t(u,r,n)&&e.push(u)}return e},M=function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e,n))return j.some(e);return j.none()},L=function(n,t){for(var e=0,r=n.length;e<r;++e)if(n[e]===t)return e;return-1},q=Array.prototype.push,W=function(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!Array.prototype.isPrototypeOf(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);q.apply(t,n[e])}return t},F=function(n,t){for(var e=0,r=n.length;e<r;++e)if(!0!==t(n[e],e,n))return!1;return!0},I=Array.prototype.slice,P={map:R,each:C,eachr:_,partition:function(n,t){for(var e=[],r=[],o=0,u=n.length;o<u;o++){var i=n[o];(t(i,o,n)?e:r).push(i)}return{pass:e,fail:r}},filter:N,groupBy:function(n,t){if(0===n.length)return[];for(var e=t(n[0]),r=[],o=[],u=0,i=n.length;u<i;u++){var a=n[u],c=t(a);c!==e&&(r.push(o),o=[]),e=c,o.push(a)}return 0!==o.length&&r.push(o),r},indexOf:function(n,t){var e=A(n,t);return-1===e?j.none():j.some(e)},foldr:function(n,t,e){return _(n,function(n){e=t(e,n)}),e},foldl:function(n,t,e){return C(n,function(n){e=t(e,n)}),e},find:function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e,n))return j.some(o)}return j.none()},findIndex:M,flatten:W,bind:function(n,t){var e=R(n,t);return W(e)},forall:F,exists:function(n,t){return M(n,t).isSome()},contains:D,equal:function(n,t){return n.length===t.length&&F(n,function(n,e){return n===t[e]})},reverse:function(n){var t=I.call(n,0);return t.reverse(),t},chunk:function(n,t){for(var e=[],r=0;r<n.length;r+=t){var o=n.slice(r,r+t);e.push(o)}return e},difference:function(n,t){return N(n,function(n){return!D(t,n)})},mapToObject:function(n,t){for(var e={},r=0,o=n.length;r<o;r++){var u=n[r];e[String(u)]=t(u,r)}return e},pure:function(n){return[n]},sort:function(n,t){var e=I.call(n,0);return e.sort(t),e},range:function(n,t){for(var e=[],r=0;r<n;r++)e.push(t(r));return e},head:function(n){return 0===n.length?j.none():j.some(n[0])},last:function(n){return 0===n.length?j.none():j.some(n[n.length-1])}},H=function(n,t){for(var e=[],r=0;r<n.length;r++){var o=n[r];if(!o.isSome())return j.none();e.push(o.getOrDie())}return j.some(t.apply(null,e))},B=void 0===(u=Object.keys)?function(n){var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t}:u,V=function(n,t){for(var e=B(n),r=0,o=e.length;r<o;r++){var u=e[r];t(n[u],u,n)}},z=function(n,t){var e={};return V(n,function(r,o){var u=t(r,o,n);e[u.k]=u.v}),e},U=function(n,t){var e=[];return V(n,function(n,r){e.push(t(n,r))}),e},$=function(n){return U(n,function(n){return n})},X={bifilter:function(n,t){var e={},r={};return V(n,function(n,o){(t(n,o)?e:r)[o]=n}),{t:e,f:r}},each:V,map:function(n,t){return z(n,function(n,e,r){return{k:e,v:t(n,e,r)}})},mapToArray:U,tupleMap:z,find:function(n,t){for(var e=B(n),r=0,o=e.length;r<o;r++){var u=e[r],i=n[u];if(t(i,u,n))return j.some(i)}return j.none()},keys:B,values:$,size:function(n){return $(n).length}},J=function(n){return function(t){return function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&Array.prototype.isPrototypeOf(n)?"array":"object"===t&&String.prototype.isPrototypeOf(n)?"string":t}(t)===n}},K={isString:J("string"),isObject:J("object"),isArray:J("array"),isNull:J("null"),isBoolean:J("boolean"),isUndefined:J("undefined"),isFunction:J("function"),isNumber:J("number")},Y=function(n){return n.slice(0).sort()},G={sort:Y,reqMessage:function(n,t){throw new Error("All required keys ("+Y(n).join(", ")+") were not specified. Specified keys were: "+Y(t).join(", ")+".")},unsuppMessage:function(n){throw new Error("Unsupported keys for object: "+Y(n).join(", "))},validateStrArr:function(n,t){if(!K.isArray(t))throw new Error("The "+n+" fields must be an array. Was: "+t+".");P.each(t,function(t){if(!K.isString(t))throw new Error("The value "+t+" in the "+n+" fields was not a string.")})},invalidTypeMessage:function(n,t){throw new Error("All values need to be of type: "+t+". Keys ("+Y(n).join(", ")+") were not.")},checkDupes:function(n){var t=Y(n);P.find(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")})}},Q={immutable:function(){var n=arguments;return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(n.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+t.length+" arguments");var r={};return P.each(n,function(n,e){r[n]=y.constant(t[e])}),r}},immutableBag:function(n,t){var e=n.concat(t);if(0===e.length)throw new Error("You must specify at least one required or optional field.");return G.validateStrArr("required",n),G.validateStrArr("optional",t),G.checkDupes(e),function(r){var o=X.keys(r);P.forall(n,function(n){return P.contains(o,n)})||G.reqMessage(n,o);var u=P.filter(o,function(n){return!P.contains(e,n)});u.length>0&&G.unsuppMessage(u);var i={};return P.each(n,function(n){i[n]=y.constant(r[n])}),P.each(t,function(n){i[n]=y.constant(Object.prototype.hasOwnProperty.call(r,n)?j.some(r[n]):j.none())}),i}}},Z=function(n){if(null===n||void 0===n)throw new Error("Node cannot be null or undefined");return{dom:y.constant(n)}},nn={fromHtml:function(n,t){var e=(t||document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||e.childNodes.length>1)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return Z(e.childNodes[0])},fromTag:function(n,t){var e=(t||document).createElement(n);return Z(e)},fromText:function(n,t){var e=(t||document).createTextNode(n);return Z(e)},fromDom:Z,fromPoint:function(n,t,e){return j.from(n.dom().elementFromPoint(t,e)).map(Z)}},tn=9,en=1,rn=3,on=function(n){return n.dom().nodeName.toLowerCase()},un=function(n){return n.dom().nodeType},an=function(n){return function(t){return un(t)===n}},cn=(an(en),an(rn),an(tn),on),sn=function(n,t){var e=[],r=function(n){return e.push(n),t(n)},o=t(n);do{o=o.bind(r)}while(o.isSome());return e},fn="undefined"!=typeof window?window:Function("return this;")(),ln=function(n,t){for(var e=void 0!==t&&null!==t?t:fn,r=0;r<n.length&&void 0!==e&&null!==e;++r)e=e[n[r]];return e},dn=function(n,t){var e=n.split(".");return ln(e,t)},mn={getOrDie:function(n,t){var e=dn(n,t);if(void 0===e||null===e)throw n+" not available on this browser";return e}},pn=function(n){var t,e=!1;return function(){return e||(e=!0,t=n.apply(null,arguments)),t}},hn=function(){return vn(0,0)},vn=function(n,t){return{major:n,minor:t}},gn={nu:vn,detect:function(n,t){var e=String(t).toLowerCase();return 0===n.length?hn():function(n,t){var e=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.test(t))return r}}(n,t);if(!e)return{major:0,minor:0};var r=function(n){return Number(t.replace(e,"$"+n))};return vn(r(1),r(2))}(n,e)},unknown:hn},bn="Firefox",yn=function(n,t){return function(){return t===n}},wn=function(n){var t=n.current;return{current:t,version:n.version,isEdge:yn("Edge",t),isChrome:yn("Chrome",t),isIE:yn("IE",t),isOpera:yn("Opera",t),isFirefox:yn(bn,t),isSafari:yn("Safari",t)}},xn={unknown:function(){return wn({current:void 0,version:gn.unknown()})},nu:wn,edge:y.constant("Edge"),chrome:y.constant("Chrome"),ie:y.constant("IE"),opera:y.constant("Opera"),firefox:y.constant(bn),safari:y.constant("Safari")},On="Windows",kn="Android",Sn="Solaris",jn="FreeBSD",Tn=function(n,t){return function(){return t===n}},En=function(n){var t=n.current;return{current:t,version:n.version,isWindows:Tn(On,t),isiOS:Tn("iOS",t),isAndroid:Tn(kn,t),isOSX:Tn("OSX",t),isLinux:Tn("Linux",t),isSolaris:Tn(Sn,t),isFreeBSD:Tn(jn,t)}},An={unknown:function(){return En({current:void 0,version:gn.unknown()})},nu:En,windows:y.constant(On),ios:y.constant("iOS"),android:y.constant(kn),linux:y.constant("Linux"),osx:y.constant("OSX"),solaris:y.constant(Sn),freebsd:y.constant(jn)},Dn=function(n,t){var e=String(t).toLowerCase();return P.find(n,function(n){return n.search(e)})},Rn=function(n,t){return Dn(n,t).map(function(n){var e=gn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Cn=function(n,t){return Dn(n,t).map(function(n){var e=gn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},_n=function(n,t){return t+n},Nn=function(n,t){return n+t},Mn=function(n,t){return n.substring(t)},Ln=function(n,t){return n.substring(0,n.length-t)},qn=function(n){return""===n?j.none():j.some(n.substr(0,1))},Wn=function(n){return""===n?j.none():j.some(n.substring(1))},Fn=function(n,t,e){return""===t||!(n.length<t.length)&&n.substr(e,e+t.length)===t},In=function(n,t){return Fn(n,t,0)},Pn=function(n,t){return Fn(n,t,n.length-t.length)},Hn={supplant:function(n,t){return n.replace(/\${([^{}]*)}/g,function(n,e){var r,o=t[e];return"string"==(r=typeof o)||"number"===r?o:n})},startsWith:In,removeLeading:function(n,t){return In(n,t)?Mn(n,t.length):n},removeTrailing:function(n,t){return Pn(n,t)?Ln(n,t.length):n},ensureLeading:function(n,t){return In(n,t)?n:_n(n,t)},ensureTrailing:function(n,t){return Pn(n,t)?n:Nn(n,t)},endsWith:Pn,contains:function(n,t){return-1!==n.indexOf(t)},trim:function(n){return n.replace(/^\s+|\s+$/g,"")},lTrim:function(n){return n.replace(/^\s+/g,"")},rTrim:function(n){return n.replace(/\s+$/g,"")},capitalize:function(n){return qn(n).bind(function(t){return Wn(n).map(function(n){return t.toUpperCase()+n})}).getOr(n)}},Bn=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Vn=function(n){return function(t){return Hn.contains(t,n)}},zn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return Hn.contains(n,"edge/")&&Hn.contains(n,"chrome")&&Hn.contains(n,"safari")&&Hn.contains(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Bn],search:function(n){return Hn.contains(n,"chrome")&&!Hn.contains(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return Hn.contains(n,"msie")||Hn.contains(n,"trident")}},{name:"Opera",versionRegexes:[Bn,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Vn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Vn("firefox")},{name:"Safari",versionRegexes:[Bn,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(Hn.contains(n,"safari")||Hn.contains(n,"mobile/"))&&Hn.contains(n,"applewebkit")}}],Un=[{name:"Windows",search:Vn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return Hn.contains(n,"iphone")||Hn.contains(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Vn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Vn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Vn("linux"),versionRegexes:[]},{name:"Solaris",search:Vn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Vn("freebsd"),versionRegexes:[]}],$n={browsers:y.constant(zn),oses:y.constant(Un)},Xn=function(n){var t,e,r,o,u,i,a,c,s,f,l,d=$n.browsers(),m=$n.oses(),p=Rn(d,n).fold(xn.unknown,xn.nu),h=Cn(m,n).fold(An.unknown,An.nu);return{browser:p,os:h,deviceType:(e=p,r=n,o=(t=h).isiOS()&&!0===/ipad/i.test(r),u=t.isiOS()&&!o,i=t.isAndroid()&&3===t.version.major,a=t.isAndroid()&&4===t.version.major,c=o||i||a&&!0===/mobile/i.test(r),s=t.isiOS()||t.isAndroid(),f=s&&!c,l=e.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:y.constant(o),isiPhone:y.constant(u),isTablet:y.constant(c),isPhone:y.constant(f),isTouch:y.constant(s),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:y.constant(l)})}},Jn=(pn(function(){var n=navigator.userAgent;return Xn(n)})().browser.isIE(),function(n){var t=n.dom();return j.from(t.parentNode).map(nn.fromDom)}),Kn=function(n){var t=n.dom();return j.from(t.previousSibling).map(nn.fromDom)},Yn=function(n){var t=n.dom();return j.from(t.nextSibling).map(nn.fromDom)},Gn=(Q.immutable("element","offset"),Jn),Qn=Kn,Zn=function(n){return P.reverse(sn(n,Kn))},nt=Yn,tt={isBlock:(i=["article","aside","details","div","dt","figcaption","footer","form","fieldset","header","hgroup","html","main","nav","section","summary","body","p","dl","multicol","dd","figure","address","center","blockquote","h1","h2","h3","h4","h5","h6","listing","xmp","pre","plaintext","menu","dir","ul","ol","li","hr","table","tbody","thead","tfoot","th","tr","td","caption"],function(n){return(a=a||P.mapToObject(i,y.constant(!0))).hasOwnProperty(cn(n))})},et=Q.immutable("start","end","caret"),rt=function(n){return"br"===cn(n)},ot=function(n){return H([Gn(n.start()),Gn(n.end())],function(){var t=document.createRange();return t.setStartBefore(n.start().dom()),t.setEndAfter(n.end().dom()),t})},ut=function(n){if(!1===n.collapsed)return j.none();var t,e,r,o=(e=(t=n).startContainer,r=t.startOffset,void 0===e?j.none():3===e.nodeType?0===r?j.some(e).map(nn.fromDom):j.none():j.from(e.childNodes[r]).map(nn.fromDom)),u=o.bind(Qn).filter(rt),i=u.map(Zn).bind(function(n){return P.find(n.reverse(),E(rt,tt.isBlock)).fold(function(){return j.from(n[n.length-1])},nt)});return H([i,u,o],et)},it=ot,at=function(n){return ot(n).fold(y.constant(""),function(n){return n.toString()})},ct=function(n){return K.isString(n.mediaembed_service_url)},st=function(n){return K.isNumber(n.mediaembed_max_width)?n.mediaembed_max_width:650},ft=function(n){var t=n.api_key;return t||n.mediaembed_api_key},lt=function(n,t){return K.isString(n.mediaembed_content_css)?n.mediaembed_content_css:t},dt=function(n){return 1===n.nodeType?n:dt(n.nextSibling)},mt=function(n,t){var e=n.parser.parse(t,{isRootContent:!0,forced_root_block:!1}),r=new tinymce.html.Serializer({validate:!0},n.schema).serialize(e);return n.dom.createFragment(r)},pt=function(n,t){return t&&t.nodeName===n},ht=function(n){return n&&null!==n.parentNode},vt=function(n,t){var e=n.dom.createFragment(t);return dt(e.firstChild)},gt=function(n,t,e){var r=e.cloneNode(!0);return r.style.maxWidth||(r.style.maxWidth=t+"px"),r.setAttribute("data-ephox-embed-iri",n),r.contentEditable=!1,r},bt=function(n,t,e){return pt("DIV",t)?gt(n,e,t):gt(n,e,((pt("VIDEO",u=t)||pt("AUDIO",u))&&(u.style.width="100%"),r=u,(o=document.createElement("div")).appendChild(r.cloneNode(!0)),o));var r,o,u},yt=function(n,t,e){return pt("A",t)?t:bt(n,t,e)},wt=function(n,t,e,r){t.filter(ht).map(function(t){var o,u,i,a,c,s,f=yt(e,vt(n,r),st(n.settings));pt("DIV",f)?(c=t,s=mt(a=n,f.outerHTML).firstChild,a.undoManager.transact(function(){c.parentNode.replaceChild(s,c)})):(u=t,i=mt(o=n,f.outerHTML),o.undoManager.transact(function(){!function(n){for(;n.firstChild;)n.removeChild(n.firstChild)}(u),u.appendChild(i)}))})},xt=function(n,t,e){var r=vt(n,e);return yt(t,r,st(n.settings)).outerHTML},Ot=function(n,t,e,r){t.map(function(t){it(t).each(function(o){var u=yt(e,vt(n,r),st(n.settings)),i=mt(n,u.outerHTML);n.undoManager.transact(function(){var e,r,u;o.deleteContents(),o.insertNode(i),o.collapse(!1),e=n,r=t.caret().dom(),u=e.dom.createRng(),3===r.nodeType?(u.setStart(r,0),u.setEnd(r,0)):(u.setStartBefore(r),u.setEndAfter(r)),e.selection.setRng(u)})})})},kt=function(n){var t,e,r=(t=n.split(" "),e={},P.each(t,function(n){e[n.toLowerCase()]=!0}),e);return function(n){return!!n&&n.nodeName.toLowerCase()in r}},St=kt("h1 h2 h3 h4 h5 h6 p span"),jt=kt("strong em b span a br"),Tt=function(n){return P.find((t=n,t?t.querySelectorAll("*"):[]),y.not(jt)).isNone();var t},Et=function(n){return St(n)&&Tt(n)},At=function(n){return/^https?:\/\/\S+$/i.test(n.trim())},Dt=function(n){return j.from(n).filter(Et).bind(T("textContent")).filter(At)},Rt=function(n,t,e){n.on("newBlock",function(r){var o,u,i,a,c;o=r,u=n,i=t,a=e,(c=T("previousSibling")(o.newBlock)).bind(Dt).map(function(n){i.getAndHandleResponse(n,function(t){var e=t.recommended().html();wt(u,c,n,e)},a.showNotificationError)})}),n.settings.forced_root_block||n.on("keydown",function(r){var o,u,i,a,c;13===r.keyCode&&(u=t,i=e,a=(o=n).selection.getRng(),(c=ut(a)).map(at).filter(At).map(function(n){u.getAndHandleResponse(n,function(t){var e=t.recommended().html();Ot(o,c,n,e)},i.showNotificationError)}))})},Ct=function(n){P.each(n,function(n){var t;(t=new tinymce.html.Node("span",1)).attr("class","mce-shim"),t.attr("data-mce-bogus","1"),n.append(t),n.attr("contenteditable","false")})},_t=function(n){P.each(n,function(n){n.attr("contenteditable",null)})},Nt=function(n){n.on("click keyup",function(){var t=n.selection.getNode();t&&n.dom.getAttrib(t,"data-ephox-embed-iri")&&n.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")}),tinymce.Env.ceFalse&&n.on("PreInit",function(){n.parser.addAttributeFilter("data-ephox-embed-iri",Ct),n.serializer.addAttributeFilter("data-ephox-embed-iri",_t)})},Mt=function(n,t,e){var r,o,u;"media_url_resolver"in n.settings==0&&(n.settings.media_url_resolver=(r=n,o=t,u=e,function(n,t){!1!==At(n.url)?o.getAndHandleResponse(n.url,function(e){var o=e.recommended().html();t({html:xt(r,n.url,o)})},u.showDialogError):t({html:""})}))},Lt=[{code:404,message:"The specified url was not found."},{code:600,message:"The specified service did not respond correctly."},{code:601,message:"The specified service did not respond correctly."}],qt=function(n,t){return"Media embed: "+P.find(Lt,function(n){return n.code===t}).fold(function(){return"Server didn't produce a valid result. ("+t+")"},function(n){return n.message})},Wt=function(n){var t=j.none(),e=[],r=function(n){o()?i(n):e.push(n)},o=function(){return t.isSome()},u=function(n){P.each(n,i)},i=function(n){t.each(function(t){setTimeout(function(){n(t)},0)})};return n(function(n){t=j.some(n),u(e),e=[]}),{get:r,map:function(n){return Wt(function(t){r(function(e){t(n(e))})})},isReady:o}},Ft={nu:Wt,pure:function(n){return Wt(function(t){t(n)})}},It=function(n){return function(){var t=Array.prototype.slice.call(arguments),e=this;setTimeout(function(){n.apply(e,t)},0)}},Pt=function(n){var t=function(t){n(It(t))};return{map:function(n){return Pt(function(e){t(function(t){var r=n(t);e(r)})})},bind:function(n){return Pt(function(e){t(function(t){n(t).get(e)})})},anonBind:function(n){return Pt(function(e){t(function(t){n.get(e)})})},toLazy:function(){return Ft.nu(t)},get:t}},Ht={nu:Pt,pure:function(n){return Pt(function(t){t(n)})}},Bt=function(n){return{is:function(t){return n===t},isValue:y.constant(!0),isError:y.constant(!1),getOr:y.constant(n),getOrThunk:y.constant(n),getOrDie:y.constant(n),or:function(t){return Bt(n)},orThunk:function(t){return Bt(n)},fold:function(t,e){return e(n)},map:function(t){return Bt(t(n))},each:function(t){t(n)},bind:function(t){return t(n)},exists:function(t){return t(n)},forall:function(t){return t(n)},toOption:function(){return j.some(n)}}},Vt=function(n){return{is:y.constant(!1),isValue:y.constant(!1),isError:y.constant(!0),getOr:y.identity,getOrThunk:function(n){return n()},getOrDie:function(){return y.die(n)()},or:function(n){return n},orThunk:function(n){return n()},fold:function(t,e){return t(n)},map:function(t){return Vt(n)},each:y.noop,bind:function(t){return Vt(n)},exists:y.constant(!1),forall:y.constant(!0),toOption:j.none}},zt={value:Bt,error:Vt},Ut={pure:y.compose(Ht.pure,zt.value),failed:y.compose(Ht.pure,zt.error),foldSync:function(n,t,e){return n.map(function(n){return n.fold(t,e)})},bindSync:function(n,t){return n.map(function(n){return n.bind(t)})},bindAsync:function(n,t){return n.bind(function(n){return n.bind(t)})},mapSync:function(n,t){return n.map(function(n){return n.map(t)})},handle:function(n,t,e){return n.get(function(n){return n.fold(t,e)})}},$t={now:function(){return(new Date).getTime()}},Xt=36e5,Jt=function(n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var u=t[o];for(var i in u)u.hasOwnProperty(i)&&(r[i]=n(r[i],u[i]))}return r}},Kt=Jt(function(n,t){return K.isObject(n)&&K.isObject(t)?Kt(n,t):t}),Yt=Jt(function(n,t){return t}),Gt={deepMerge:Kt,merge:Yt},Qt=function(n){if(!K.isArray(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var t=[],e={};return P.each(n,function(r,o){var u=X.keys(r);if(1!==u.length)throw new Error("one and only one name per case");var i=u[0],a=r[i];if(void 0!==e[i])throw new Error("duplicate key detected:"+i);if("cata"===i)throw new Error("cannot have a case named cata (sorry)");if(!K.isArray(a))throw new Error("case arguments must be an array");t.push(i),e[i]=function(){var e=arguments.length;if(e!==a.length)throw new Error("Wrong number of arguments to case "+i+". Expected "+a.length+" ("+a+"), got "+e);for(var r=new Array(e),u=0;u<r.length;u++)r[u]=arguments[u];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[o].apply(null,r)},match:function(n){var e=X.keys(n);if(t.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+e.join(","));if(!P.forall(t,function(n){return P.contains(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+t.join(", "));return n[i].apply(null,r)},log:function(n){console.log(n,{constructors:t,constructor:i,params:r})}}}}),e},Zt=(Qt([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var t=[],e=[];return P.each(n,function(n){n.fold(function(n){t.push(n)},function(n){e.push(n)})}),{errors:t,values:e}}),ne=function(n){return y.compose(zt.error,P.flatten)(n)},te=function(n,t){var e,r,o=Zt(n);return o.errors.length>0?ne(o.errors):(e=o.values,r=t,zt.value(Gt.deepMerge.apply(void 0,[r].concat(e))))},ee=function(n){var t=Zt(n);return t.errors.length>0?ne(t.errors):zt.value(t.values)},re=function(n){return function(t){return t.hasOwnProperty(n)?j.from(t[n]):j.none()}},oe=function(n,t){return re(t)(n)},ue=function(n,t){return n.hasOwnProperty(t)&&void 0!==n[t]&&null!==n[t]},ie=function(n,t){var e={};return e[n]=t,e},ae=function(n,t){return oe(n,t)},ce=function(n,t){return ie(n,t)},se=function(n,t){return ue(n,t)},fe=function(){return mn.getOrDie("JSON")},le={parse:function(n){return fe().parse(n)},stringify:function(n,t,e){return fe().stringify(n,t,e)}},de=function(n){return K.isObject(n)&&X.keys(n).length>100?" removed due to size":le.stringify(n,null,2)},me=function(n){var t=n.length>10?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return P.map(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()})},pe=function(n,t){return zt.error([{path:n,getErrorInfo:t}])},he=function(n,t,e){return pe(n,function(){return'Could not find valid *strict* value for "'+t+'" in '+de(e)})},ve=function(n,t){return pe(n,function(){return'Choice schema did not contain choice key: "'+t+'"'})},ge=function(n,t,e){return pe(n,function(){return'The chosen schema: "'+e+'" did not exist in branches: '+de(t)})},be=function(n,t){return pe(n,function(){return"There are unsupported fields: ["+t.join(", ")+"] specified"})},ye=function(n,t){return pe(n,function(){return t})},we=Qt([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),xe={strict:we.strict,asOption:we.asOption,defaulted:function(n){return we.defaultedThunk(y.constant(n))},defaultedThunk:we.defaultedThunk,asDefaultedOption:function(n){return we.asDefaultedOptionThunk(y.constant(n))},asDefaultedOptionThunk:we.asDefaultedOptionThunk,mergeWith:function(n){return we.mergeWithThunk(y.constant(n))},mergeWithThunk:we.mergeWithThunk},Oe={typeAdt:Qt([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]}]),fieldAdt:Qt([{field:["name","presence","type"]},{state:["name"]}])},ke=Qt([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Se=function(n,t,e){var r=oe(n,t).fold(function(){return e(n)},y.identity);return zt.value(r)},je=function(n,t,e,r){return e.fold(function(e,o,u,i){var a=function(t){return i.extract(n.concat([e]),r,t).map(function(n){return ie(o,r(n))})},c=function(t){return t.fold(function(){var n=ie(o,r(j.none()));return zt.value(n)},function(t){return i.extract(n.concat([e]),r,t).map(function(n){return ie(o,r(j.some(n)))})})};return u.fold(function(){return(r=n,o=t,u=e,oe(o,u).fold(function(){return he(r,u,o)},zt.value)).bind(a);var r,o,u},function(n){return Se(t,e,n).bind(a)},function(){return(n=t,r=e,zt.value(oe(n,r))).bind(c);var n,r},function(n){return(r=t,o=e,u=n,i=oe(r,o).map(function(n){return!0===n?u(r):n}),zt.value(i)).bind(c);var r,o,u,i},function(n){var r=n(t);return Se(t,e,y.constant({})).map(function(n){return Gt.deepMerge(r,n)}).bind(a)})},function(n,e){var o=e(t);return zt.value(ie(n,r(o)))})},Te=function(n){return{extract:function(t,e,r){return n(r).fold(function(n){return ye(t,n)},zt.value)},toString:function(){return"val"},toDsl:function(){return Oe.typeAdt.itemOf(n)}}},Ee=function(n){return{extract:function(t,e,r){return o=t,u=r,i=n,a=e,c=P.map(i,function(n){return je(o,u,n,a)}),te(c,{});var o,u,i,a,c},toString:function(){return"obj{\n"+P.map(n,function(n){return n.fold(function(n,t,e,r){return n+" -> "+r.toString()},function(n,t){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return Oe.typeAdt.objOf(P.map(n,function(n){return n.fold(function(n,t,e,r){return Oe.fieldAdt.field(n,e,r)},function(n,t){return Oe.fieldAdt.state(n)})}))}}},Ae=function(n){return{extract:function(t,e,r){var o=P.map(r,function(r,o){return n.extract(t.concat(["["+o+"]"]),e,r)});return ee(o)},toString:function(){return"array("+n.toString()+")"},toDsl:function(){return Oe.typeAdt.arrOf(n)}}},De=Te(zt.value),Re=y.compose(Ae,Ee),Ce={anyValue:y.constant(De),value:Te,obj:Ee,objOnly:function(n){var t=Ee(n),e=P.foldr(n,function(n,t){return t.fold(function(t){return Gt.deepMerge(n,ce(t,!0))},y.constant(n))},{});return{extract:function(n,r,o){var u,i,a=K.isBoolean(o)?[]:(u=o,i=X.keys(u),P.filter(i,function(n){return se(u,n)})),c=P.filter(a,function(n){return!se(e,n)});return 0===c.length?t.extract(n,r,o):be(n,c)},toString:t.toString,toDsl:t.toDsl}},arr:Ae,setOf:function(n,t){return{extract:function(e,r,o){var u,i,a=X.keys(o);return(u=e,i=a,Ae(Te(n)).extract(u,y.identity,i)).bind(function(n){var u=P.map(n,function(n){return ke.field(n,n,xe.strict(),t)});return Ee(u).extract(e,r,o)})},toString:function(){return"setOf("+t.toString()+")"},toDsl:function(){return Oe.typeAdt.setOf(n,t)}}},arrOfObj:Re,state:ke.state,field:ke.field,output:function(n,t){return ke.state(n,y.constant(t))},snapshot:function(n){return ke.state(n,y.identity)}},_e=function(n,t){return{extract:function(e,r,o){return ae(o,n).fold(function(){return ve(e,n)},function(n){return u=e,i=r,a=o,ae(c=t,s=n).fold(function(){return ge(u,c,s)},function(n){return Ce.obj(n).extract(u.concat(["branch: "+s]),i,a)});var u,i,a,c,s})},toString:function(){return"chooseOn("+n+"). Possible values: "+X.keys(t)},toDsl:function(){return Oe.typeAdt.choiceOf(n,t)}}},Ne=Ce.value(zt.value),Me=Ce.arr,Le=Ce.obj,qe=Ce.objOnly,We=Ce.setOf,Fe=function(n,t,e,r){return t.extract([n],e,r).fold(function(n){return zt.error({input:r,errors:n})},zt.value)},Ie=function(n,t,e){return Fe(n,t,y.constant,e)},Pe=function(n,t,e){return Fe(n,t,y.identity,e)},He=function(n){return n.fold(function(n){throw new Error(Be(n))},y.identity)},Be=function(n){return"Errors: \n"+me(n.errors)+"\n\nInput object: "+de(n.input)},Ve={anyValue:y.constant(Ne),arrOfObj:function(n){return Ce.arrOfObj(n)},arrOf:Me,arrOfVal:function(){return Ce.arr(Ne)},valueOf:function(n){return Ce.value(n)},setOf:We,objOf:Le,objOfOnly:qe,asStruct:Ie,asRaw:Pe,asStructOrDie:function(n,t,e){return He(Ie(n,t,e))},asRawOrDie:function(n,t,e){return He(Pe(n,t,e))},getOrDie:He,formatError:Be,choose:function(n,t){return _e(n,t)}},ze=Qt([{get:[]},{post:[]},{put:[]},{del:[]}]),Ue={get:ze.get,post:ze.post,put:ze.put,del:ze.del},$e=function(n,t,e,r){var o=n.bind(function(n){return n.match({file:function(){return j.none()},form:function(){return j.some("application/x-www-form-urlencoded; charset=UTF-8")},json:function(){return j.some("application/json")},plain:function(){return j.some("text/plain")},html:function(){return j.some("text/html")}})}),u=e.match({none:j.none,xhr:y.constant(j.some(!0))}),i=t.match({json:j.none,blob:y.constant(j.some("blob")),xml:y.constant(j.some("document")),html:y.constant(j.some("document")),text:y.constant(j.some("text"))}),a=t.match({json:y.constant("application/json, text/javascript"),blob:y.constant("application/octet-stream"),text:y.constant("text/plain"),html:y.constant("text/html"),xml:y.constant("application/xml, text/xml")})+", */*; q=0.01",c=r;return{contentType:y.constant(o),credentials:y.constant(u),responseType:y.constant(i),accept:y.constant(a),headers:y.constant(c)}},Xe=function(n,t){t.contentType().each(function(t){n.setRequestHeader("Content-Type",t)});var e=t.accept();n.setRequestHeader("Accept",e),t.credentials().each(function(t){n.withCredentials=t}),t.responseType().each(function(t){n.responseType=t});var r=t.headers();X.each(r,function(t,e){K.isString(e)||K.isString(t)?n.setRequestHeader(e,t):console.error("Request header data was not a string: ",e," -> ",t)})};function Je(n){return Ht.nu(function(t){var e=new(mn.getOrDie("FileReader"));e.onload=function(n){var e=n.target;t(e.result)},e.readAsText(n)})}var Ke=function(n){try{var t=le.parse(n);return zt.value(t)}catch(n){return zt.error("Response was not JSON")}},Ye=Q.immutableBag(["message","status","responseText"],[]),Ge={handle:function(n,t,e){var r=function(){return Ht.pure(e.response)};return t.match({json:function(){return Ke(e.response).fold(r,Ht.pure)},blob:function(){return n=e,j.from(n.response).map(Je).getOr(Ht.pure("no response content"));var n},text:r,html:r,xml:r}).map(function(t){var r=0===e.status?"Unknown HTTP error (possible cross-domain request)":'Could not load url "'+n+'": '+e.statusText;return Ye({message:r,status:e.status,responseText:t})})},nu:Ye},Qe=function(n){return Ze(function(t){t(n)})},Ze=function(n){var t=Ht.nu(n);return{bindFuture:function(n){return t.bind(function(e){return e.fold(function(){return t},function(t){return n(t)})})},bindResult:function(n){return t.map(function(t){return t.bind(n)})},mapResult:function(n){return t.map(function(t){return t.map(n)})},toLazy:t.toLazy,get:t.get}},nr={pure:function(n){return Qe(zt.value(n))},error:function(n){return Qe(zt.error(n))},fromResult:Qe,fromFuture:function(n){return n.map(zt.value)},nu:Ze},tr=function(n,t){var e,r,o=function(){return nr.pure(t.response)};return n.match({json:function(){return Ke(t.response).fold(function(n){return nr.error(Ge.nu({message:n,status:t.status,responseText:t.responseText}))},nr.pure)},blob:o,text:o,html:o,xml:(e="Invalid XML document",r=o,function(){return r().bindResult(function(n){return null===n?zt.error(e):zt.value(n)})})})},er=function(n,t,e,r,o,u){var i=void 0!==u?u:{};return nr.nu(function(u){var a=t.match({get:y.constant("get"),put:y.constant("put"),post:y.constant("post"),del:y.constant("delete")}),c=new(mn.getOrDie("XMLHttpRequest"));c.open(a,n,!0);var s=$e(e,r,o,i);Xe(c,s);var f=function(){Ge.handle(n,r,c).get(function(n){u(zt.error(n))})};c.onload=function(){0!==c.status||Hn.startsWith(n,"file:")?c.status<100||c.status>=400?f():tr(r,c).get(u):f()},c.onerror=f,e.fold(function(){c.send()},function(n){var t=n.match({file:y.identity,form:y.identity,json:le.stringify,plain:y.identity,html:y.identity});c.send(t)})}).toLazy()},rr=function(n,t,e,r){var o=Ue.get();return er(n,o,j.none(),t,e,r)},or=function(n,t,e,r,o){var u=Ue.post();return er(n,u,j.some(t),e,r,o)},ur=Qt([{file:["data"]},{form:["data"]},{json:["data"]},{plain:["data"]},{html:["data"]}]),ir={file:ur.file,form:ur.form,json:ur.json,plain:ur.plain,html:ur.html},ar=Qt([{none:[]},{xhr:[]}]),cr={none:ar.none,xhr:ar.xhr},sr=Qt([{json:[]},{blob:[]},{text:[]},{html:[]},{xml:[]}]),fr={json:sr.json,blob:sr.blob,text:sr.text,html:sr.html,xml:sr.xml,cata:function(n,t,e,r,o,u){return n.match({json:t,blob:e,text:r,html:o,xml:u})}},lr=function(n,t){var e=-1===n.indexOf("?")?"?":"&";return t?n+e+"apiKey="+encodeURIComponent(t):n},dr=function(n){return n.hasOwnProperty("tiny-api-key")?n["tiny-api-key"]:n.hasOwnProperty("tinymce-api-key")?n["tinymce-api-key"]:n["textbox-api-key"]},mr=function(n){return n.fold(function(n){var t=n.responseText(),e=K.isObject(t)?t:n.message();return zt.error(e)},zt.value)},pr={get:function(n,t,e,r){var o=dr(r);return{execute:function(u){var i=Ve.asRawOrDie(n+".ajax.service.get",t,u),a=X.map(i,function(n){return K.isBoolean(n)?String(n):n}),c=lr(Hn.supplant(e,a),o);return rr(c,fr.json(),cr.xhr(),r).map(mr)}}},post:function(n,t,e,r){var o=dr(r);return{execute:function(u){var i=Ve.asRawOrDie(n+".ajax.service.post",t,u);return or(lr(e,o),ir.json(i),fr.json(),cr.xhr(),r).map(mr)}}}},hr=function(n,t,e,r,o){return!0===o?{known:{},unknown:e}:P.foldl(e,function(e,o){var u=r(o);return n(t,u).fold(function(){return{known:e.known,unknown:e.unknown.concat([o])}},function(n){var t=ce(u,n);return{known:Gt.merge(e.known,t),unknown:e.unknown}})},{known:{},unknown:[]})},vr={single:function(n,t,e,r,o){return(!0===o?j.none():t.get(r,e)).fold(function(){return n(e,o).map(function(n){return n.map(function(n){return t.set(e,n,r),n})})},function(n){return Ut.pure(n)})},multiple:function(n,t,e,r,o,u,i){var a,c,s,f,l,d,m,p=hr(t.get,u,e,o,i);return 0===p.unknown.length?Ut.pure(p.known):(a=n,c=t,s=p.known,f=p.unknown,l=r,d=u,m=a(f,i),Ut.mapSync(m,function(n){var t=l(n);return X.each(t,function(n,t){c.set(t,n,d)}),Gt.deepMerge(s,t)}))}},gr=function(n){return Ce.field(n,n,xe.strict(),Ce.anyValue())},br=function(n,t){return Ce.field(n,n,xe.strict(),Ce.obj(t))},yr=function(n,t){return Ce.field(n,n,xe.defaulted(t),Ce.anyValue())},wr=function(n,t,e,r){return Ce.field(n,t,e,r)},xr="iframely",Or="oembed",kr="fallback",Sr="wikipedia",jr=function(n){return"["+n.join(", ")+"]"},Tr=[xr,Or,kr],Er=function(n,t,e){return P.exists(t,function(t){return P.contains(n,t)})?zt.error("Embed response source: "+jr(n)+" contains more than one of "+jr(Tr)):zt.value(e)},Ar=(y.constant(xr),y.constant(Or),y.constant(kr),function(n){return P.contains(n,xr)?Er(n,[Or,kr,Sr],xr):P.contains(n,Or)?Er(n,[xr,kr,Sr],Or):P.contains(n,kr)?Er(n,[xr,Or,Sr],kr):P.contains(n,Sr)?Er(n,[xr,Or,kr],Sr):zt.error("Embed response source: "+jr(n)+" did not contain any of: "+jr(Tr))}),Dr=Ve.objOf([gr("url"),gr("maxWidth"),yr("fresh",!1)]),Rr=Ve.objOf([gr("status_code"),gr("sub_code"),gr("msg")]),Cr=Ve.objOf([gr("html"),br("rels",[wr("source","source",xe.strict(),Ve.valueOf(function(n){return K.isArray(n)?Ar(n):zt.error("Sources was not an array: "+n)}))])]),_r={requestOne:y.constant(Dr),responseFailed:y.constant(Rr),responseSucceeded:y.constant(Cr)},Nr={failed:function(n){return Ve.asStruct("EmbedResponse.failure",_r.responseFailed(),n).fold(function(n){return zt.error({code:y.constant(600),subcode:y.constant(0),msg:y.constant(Ve.formatError(n))})},function(n){return zt.error({code:n.status_code,subcode:n.sub_code,msg:n.msg})})},success:function(n){return Ve.asStruct("EmbedResponse.success",_r.responseSucceeded(),n).fold(function(n){return zt.error({code:y.constant(601),subcode:y.constant(0),msg:y.constant(Ve.formatError(n))})},function(n){return zt.value({recommended:y.constant({html:n.html,source:n.rels().source})})})}};function Mr(n,t,e){var r,o,u,i,a,c,s,f,l=(r=e,a=void 0!==o?o:Xt,c=Q.immutable("result","timestamp"),s={},f=function(n,t,e){s[n]=c(t,e)},K.isObject(r)&&(u=r,i=$t.now(),X.map(u,function(n,t){i-n.timestamp<a&&f(t,n.result,n.timestamp)})),{set:f,get:function(n,t){return j.from(s[t]).filter(function(t){return n-t.timestamp()<a}).map(function(n){return n.result()})},dump:function(){return X.map(s,function(n){return{result:n.result(),timestamp:n.timestamp()}})}}),d=pr.get("ephox.media.service.one",_r.requestOne(),n+"/1/embed?url=${url}&maxWidth=${maxWidth}",t);return{checkOne:function(n,t,e){var r=$t.now(),o=vr.single(function(e,r){return d.execute({url:encodeURIComponent(n),maxWidth:t,fresh:r})},l,t+"&"+n,r,void 0!==e&&e);return Ut.foldSync(o,Nr.failed,Nr.success)},dumpCache:l.dump}}var Lr=function(n){var t,e,r=(t=n.mediaembed_service_url,e=ft(n),Mr(t,e?{"tinymce-api-key":e}:{})),o=function(n,t,e){return r.checkOne(n,t,e)},u={};return{getOne:o,dumpCache:function(){r.dumpCache()},getAndHandleResponse:function(t,e,r){void 0!==u[t]?u[t]=u[t].concat(e):(u[t]=[e],Ut.handle(o(t.trim(),st(n)),function(n){r(n),delete u[t]},function(n){P.each(u[t],function(t){t(n)}),delete u[t]}))}}},qr=function(n,t){var e,r,o,u=(e=n,{formatMessage:qt,showNotificationError:function(n){o(qt(n.msg(),n.code()))},showDialogError:function(n){var t=n.msg(),o=n.code();t!==r&&e.windowManager.alert(qt(t,o),function(){r=""}),r=t},showNotificationMsg:o=function(n){e.notificationManager.open({text:n,type:"error"})}}),i=Lr(n.settings);return Nt(n),n.on("Init",function(){var e,r,o;r=t+"/content.min.css",o=lt((e=n).settings,r),e.dom.loadCSS(o)}),n.on("SkinLoaded",function(){ct(n.settings)?(Rt(n,i,u),Mt(n,i,u)):u.showNotificationMsg("You need to specify the mediaembed_service_url setting")}),{}};tinymce.PluginManager.add("mediaembed",function(n,t){return tinymce.Env.ceFalse?g(tinymce,"4.5.2")?(s.error("The mediaembed plugin requires at least 4.5.2 version of TinyMCE."),{}):qr(n,t):{}})}();
