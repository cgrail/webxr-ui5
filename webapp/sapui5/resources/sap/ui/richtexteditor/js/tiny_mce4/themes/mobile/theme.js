(function(){var q=(function(){'use strict';var z=function(){var x=[];for(var _=0;_<arguments.length;_++){x[_]=arguments[_];}};var A=function(f){return function(){var x=[];for(var _=0;_<arguments.length;_++){x[_]=arguments[_];}return f();};};var B=function(f,a){return function(){var x=[];for(var _=0;_<arguments.length;_++){x[_]=arguments[_];}return f(a.apply(null,arguments));};};var C=function(f4){return function(){return f4;};};var D=function(x){return x;};var E=function(a,b){return a===b;};var F=function(f){var x=[];for(var _=1;_<arguments.length;_++){x[_-1]=arguments[_];}var a=new Array(arguments.length-1);for(var i=1;i<arguments.length;i++)a[i-1]=arguments[i];return function(){var x=[];for(var _=0;_<arguments.length;_++){x[_]=arguments[_];}var n=new Array(arguments.length);for(var j=0;j<n.length;j++)n[j]=arguments[j];var V4=a.concat(n);return f.apply(null,V4);};};var G=function(f){return function(){var x=[];for(var _=0;_<arguments.length;_++){x[_]=arguments[_];}return!f.apply(null,arguments);};};var H=function(m){return function(){throw new Error(m);};};var I=function(f){return f();};var J=function(f){f();};var K=C(false);var L=C(true);var $={noop:z,noarg:A,compose:B,constant:C,identity:D,tripleEquals:E,curry:F,not:G,die:H,apply:I,call:J,never:K,always:L};var M=function(x){if(x===null)return'null';var t=typeof x;if(t==='object'&&Array.prototype.isPrototypeOf(x))return'array';if(t==='object'&&String.prototype.isPrototypeOf(x))return'string';return t;};var N=function(e4){return function(f4){return M(f4)===e4;};};var O={isString:N('string'),isObject:N('object'),isArray:N('array'),isNull:N('null'),isBoolean:N('boolean'),isUndefined:N('undefined'),isFunction:N('function'),isNumber:N('number')};var P=function(o,n){return n;};var Q=function(o,n){var b=O.isObject(o)&&O.isObject(n);return b?S(o,n):n;};var R=function(m){return function(){var o=new Array(arguments.length);for(var i=0;i<o.length;i++)o[i]=arguments[i];if(o.length===0)throw new Error('Can\'t merge zero objects');var r={};for(var j=0;j<o.length;j++){var c=o[j];for(var k in c)if(c.hasOwnProperty(k)){r[k]=m(r[k],c[k]);}}return r;};};var S=R(Q);var T=R(P);var U={deepMerge:S,merge:T};var V=$.never;var W=$.always;var X=function(){return Y;};var Y=function(){var e=function(o){return o.isNone();};var J=function(t){return t();};var i=function(n){return n;};var z=function(){};var m={fold:function(n,s){return n();},is:V,isSome:V,isNone:W,getOr:i,getOrThunk:J,getOrDie:function(a){throw new Error(a||'error: getOrDie called on none.');},or:i,orThunk:J,map:X,ap:X,each:z,bind:X,flatten:X,exists:V,forall:W,filter:X,equals:e,equals_:e,toArray:function(){return[];},toString:$.constant('none()')};if(Object.freeze)Object.freeze(m);return m;}();var Z=function(a){var c=function(){return a;};var d=function(){return m;};var s2=function(f){return Z(f(a));};var F2=function(f){return f(a);};var m={fold:function(n,s){return s(a);},is:function(v){return a===v;},isSome:W,isNone:V,getOr:c,getOrThunk:c,getOrDie:c,or:d,orThunk:d,map:s2,ap:function(o){return o.fold(X,function(f){return Z(f(a));});},each:function(f){f(a);},bind:F2,flatten:c,exists:F2,forall:F2,filter:function(f){return f(a)?m:Y;},equals:function(o){return o.is(a);},equals_:function(o,e){return o.fold(V,function(b){return e(a,b);});},toArray:function(){return[a];},toString:function(){return'some('+a+')';}};return m;};var b1=function(f4){return f4===null||f4===undefined?Y:Z(f4);};var c1={some:Z,none:X,from:b1};var f1=function(){var f=Object.keys;var s=function(o){var r=[];for(var i in o){if(o.hasOwnProperty(i)){r.push(i);}}return r;};return f===undefined?s:f;}();var g1=function(o,f){var p=f1(o);for(var k=0,l=p.length;k<l;k++){var i=p[k];var x=o[i];f(x,i,o);}};var h1=function(o,f){return i1(o,function(x,i,o){return{k:i,v:f(x,i,o)};});};var i1=function(o,f){var r={};g1(o,function(x,i){var t=f(x,i,o);r[t.k]=t.v;});return r;};var j1=function(o,p){var t={};var f={};g1(o,function(x,i){var b=p(x,i)?t:f;b[i]=x;});return{t:t,f:f};};var k1=function(o,f){var r=[];g1(o,function(f4,d4){r.push(f(f4,d4));});return r;};var l1=function(o,p){var a=f1(o);for(var k=0,l=a.length;k<l;k++){var i=a[k];var x=o[i];if(p(x,i,o)){return c1.some(x);}}return c1.none();};var m1=function(o){return k1(o,function(v){return v;});};var n1=function(o){return m1(o).length;};var o1={bifilter:j1,each:g1,map:h1,mapToArray:k1,tupleMap:i1,find:l1,keys:f1,values:m1,size:n1};var p1=$.constant('contextmenu');var q1=$.constant('touchstart');var r1=$.constant('touchmove');var s1=$.constant('touchend');var t1=$.constant('gesturestart');var u1=$.constant('mousedown');var v1=$.constant('mousemove');var w1=$.constant('mouseout');var x1=$.constant('mouseup');var y1=$.constant('mouseover');var z1=$.constant('focusin');var A1=$.constant('keydown');var B1=$.constant('input');var C1=$.constant('change');var D1=$.constant('focus');var E1=$.constant('click');var F1=$.constant('transitionend');var G1=$.constant('selectstart');var H1=function(f){var c=false;var r;return function(){if(!c){c=true;r=f.apply(null,arguments);}return r;};};var I1={cached:H1};var J1=function(r,s){for(var i=0;i<r.length;i++){var x=r[i];if(x.test(s))return x;}return undefined;};var K1=function(a,b){var r=J1(a,b);if(!r)return{major:0,minor:0};var ig=function(i){return Number(b.replace(r,'$'+i));};return nu(ig(1),ig(2));};var L1=function(v,a){var c=String(a).toLowerCase();if(v.length===0)return M1();return K1(v,c);};var M1=function(){return nu(0,0);};var nu=function(m,a){return{major:m,minor:a};};var O1={nu:nu,detect:L1,unknown:M1};var P1='Edge';var Q1='Chrome';var ie='IE';var S1='Opera';var T1='Firefox';var U1='Safari';var V1=function(d4,c){return function(){return c===d4;};};var W1=function(){return X1({current:undefined,version:O1.unknown()});};var X1=function(i){var c=i.current;var v=i.version;return{current:c,version:v,isEdge:V1(P1,c),isChrome:V1(Q1,c),isIE:V1(ie,c),isOpera:V1(S1,c),isFirefox:V1(T1,c),isSafari:V1(U1,c)};};var Y1={unknown:W1,nu:X1,edge:$.constant(P1),chrome:$.constant(Q1),ie:$.constant(ie),opera:$.constant(S1),firefox:$.constant(T1),safari:$.constant(U1)};var Z1='Windows';var $1='iOS';var _1='Android';var b2='Linux';var c2='OSX';var f2='Solaris';var g2='FreeBSD';var h2=function(d4,c){return function(){return c===d4;};};var i2=function(){return j2({current:undefined,version:O1.unknown()});};var j2=function(i){var c=i.current;var v=i.version;return{current:c,version:v,isWindows:h2(Z1,c),isiOS:h2($1,c),isAndroid:h2(_1,c),isOSX:h2(c2,c),isLinux:h2(b2,c),isSolaris:h2(f2,c),isFreeBSD:h2(g2,c)};};var k2={unknown:i2,nu:j2,windows:$.constant(Z1),ios:$.constant($1),android:$.constant(_1),linux:$.constant(b2),osx:$.constant(c2),solaris:$.constant(f2),freebsd:$.constant(g2)};function l2(o,b5,u){var i=o.isiOS()&&/ipad/i.test(u)===true;var a=o.isiOS()&&!i;var b=o.isAndroid()&&o.version.major===3;var c=o.isAndroid()&&o.version.major===4;var d=i||b||c&&/mobile/i.test(u)===true;var uh=o.isiOS()||o.isAndroid();var e=uh&&!d;var f=b5.isSafari()&&o.isiOS()&&/safari/i.test(u)===false;return{isiPad:$.constant(i),isiPhone:$.constant(a),isTablet:$.constant(d),isPhone:$.constant(e),isTouch:$.constant(uh),isAndroid:o.isAndroid,isiOS:o.isiOS,isWebView:$.constant(f)};}var m2=function(){var p=Array.prototype.indexOf;var f=function(a,x){return p.call(a,x);};var s=function(a,x){return C2(a,x);};return p===undefined?s:f;}();var n2=function(a,x){var r=m2(a,x);return r===-1?c1.none():c1.some(r);};var o2=function(a,x){return m2(a,x)>-1;};var p2=function(x,p){return B2(x,p).isSome();};var q2=function(n,f){var r=[];for(var i=0;i<n;i++){r.push(f(i));}return r;};var r2=function(a,n1){var r=[];for(var i=0;i<a.length;i+=n1){var s=a.slice(i,i+n1);r.push(s);}return r;};var s2=function(a,f){var l=a.length;var r=new Array(l);for(var i=0;i<l;i++){var x=a[i];r[i]=f(x,i,a);}return r;};var t2=function(a,f){for(var i=0,l=a.length;i<l;i++){var x=a[i];f(x,i,a);}};var u2=function(a,f){for(var i=a.length-1;i>=0;i--){var x=a[i];f(x,i,a);}};var v2=function(a,p){var b=[];var f=[];for(var i=0,l=a.length;i<l;i++){var x=a[i];var c=p(x,i,a)?b:f;c.push(x);}return{pass:b,fail:f};};var w2=function(a,p){var r=[];for(var i=0,l=a.length;i<l;i++){var x=a[i];if(p(x,i,a)){r.push(x);}}return r;};var x2=function(a,f){if(a.length===0){return[];}else{var w=f(a[0]);var r=[];var ig=[];for(var i=0,l=a.length;i<l;i++){var x=a[i];var e4=f(x);if(e4!==w){r.push(ig);ig=[];}w=e4;ig.push(x);}if(ig.length!==0){r.push(ig);}return r;}};var y2=function(a,f,b){u2(a,function(x){b=f(b,x);});return b;};var z2=function(a,f,b){t2(a,function(x){b=f(b,x);});return b;};var A2=function(a,p){for(var i=0,l=a.length;i<l;i++){var x=a[i];if(p(x,i,a)){return c1.some(x);}}return c1.none();};var B2=function(a,p){for(var i=0,l=a.length;i<l;i++){var x=a[i];if(p(x,i,a)){return c1.some(i);}}return c1.none();};var C2=function(a,x){for(var i=0,l=a.length;i<l;++i){if(a[i]===x){return i;}}return-1;};var D2=Array.prototype.push;var E2=function(x){var r=[];for(var i=0,l=x.length;i<l;++i){if(!Array.prototype.isPrototypeOf(x[i]))throw new Error('Arr.flatten item '+i+' was not an array, input: '+x);D2.apply(r,x[i]);}return r;};var F2=function(x,f){var o=s2(x,f);return E2(o);};var G2=function(a,p){for(var i=0,l=a.length;i<l;++i){var x=a[i];if(p(x,i,a)!==true){return false;}}return true;};var H2=function(a,b){return a.length===b.length&&G2(a,function(x,i){return x===b[i];});};var I2=Array.prototype.slice;var J2=function(x){var r=I2.call(x,0);r.reverse();return r;};var K2=function(a,b){return w2(a,function(x){return!o2(b,x);});};var L2=function(a,f){var r={};for(var i=0,l=a.length;i<l;i++){var x=a[i];r[String(x)]=f(x,i);}return r;};var M2=function(x){return[x];};var N2=function(x,c){var ua=I2.call(x,0);ua.sort(c);return ua;};var O2=function(x){return x.length===0?c1.none():c1.some(x[0]);};var P2=function(x){return x.length===0?c1.none():c1.some(x[x.length-1]);};var Q2=O.isFunction(Array.from)?Array.from:function(x){return I2.call(x);};var R2={map:s2,each:t2,eachr:u2,partition:v2,filter:w2,groupBy:x2,indexOf:n2,foldr:y2,foldl:z2,find:A2,findIndex:B2,flatten:E2,bind:F2,forall:G2,exists:p2,contains:o2,equal:H2,reverse:J2,chunk:r2,difference:K2,mapToObject:L2,pure:M2,sort:N2,range:q2,head:O2,last:P2,from:Q2};var S2=function(Li,u){var a=String(u).toLowerCase();return R2.find(Li,function(c){return c.search(a);});};var T2=function(u3,u){return S2(u3,u).map(function(b5){var v=O1.detect(b5.versionRegexes,u);return{current:b5.name,version:v};});};var U2=function(v3,u){return S2(v3,u).map(function(o){var v=O1.detect(o.versionRegexes,u);return{current:o.name,version:v};});};var V2={detectBrowser:T2,detectOs:U2};var W2=function(s,Bb){return Bb+s;};var X2=function(s,a){return s+a;};var Y2=function(s,n){return s.substring(n);};var Z2=function(s,n){return s.substring(0,s.length-n);};var $2={addToStart:W2,addToEnd:X2,removeFromStart:Y2,removeFromEnd:Z2};var _2=function(s,c){return s.substr(0,c);};var a3=function(s,c){return s.substr(s.length-c,s.length);};var b3=function(s){return s===''?c1.none():c1.some(s.substr(0,1));};var c3=function(s){return s===''?c1.none():c1.some(s.substring(1));};var d3={first:_2,last:a3,head:b3,tail:c3};var e3=function(s,a,b){if(a==='')return true;if(s.length<a.length)return false;var x=s.substr(b,b+a.length);return x===a;};var f3=function(s,o){var i=function(a){var t=typeof a;return t==='string'||t==='number';};return s.replace(/\${([^{}]*)}/g,function(a,b){var f4=o[b];return i(f4)?f4:a;});};var g3=function(s,Bb){return m3(s,Bb)?$2.removeFromStart(s,Bb.length):s;};var h3=function(s,Bb){return n3(s,Bb)?$2.removeFromEnd(s,Bb.length):s;};var i3=function(s,Bb){return m3(s,Bb)?s:$2.addToStart(s,Bb);};var j3=function(s,Bb){return n3(s,Bb)?s:$2.addToEnd(s,Bb);};var k3=function(s,a){return s.indexOf(a)!==-1;};var l3=function(s){return d3.head(s).bind(function(O2){return d3.tail(s).map(function(c3){return O2.toUpperCase()+c3;});}).getOr(s);};var m3=function(s,Bb){return e3(s,Bb,0);};var n3=function(s,a){return e3(s,a,s.length-a.length);};var o3=function(s){return s.replace(/^\s+|\s+$/g,'');};var p3=function(s){return s.replace(/^\s+/g,'');};var q3=function(s){return s.replace(/\s+$/g,'');};var r3={supplant:f3,startsWith:m3,removeLeading:g3,removeTrailing:h3,ensureLeading:i3,ensureTrailing:j3,endsWith:n3,contains:k3,trim:o3,lTrim:p3,rTrim:q3,capitalize:l3};var s3=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/;var t3=function(t){return function(u){return r3.contains(u,t);};};var u3=[{name:'Edge',versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(u){var m=r3.contains(u,'edge/')&&r3.contains(u,'chrome')&&r3.contains(u,'safari')&&r3.contains(u,'applewebkit');return m;}},{name:'Chrome',versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,s3],search:function(u){return r3.contains(u,'chrome')&&!r3.contains(u,'chromeframe');}},{name:'IE',versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(u){return r3.contains(u,'msie')||r3.contains(u,'trident');}},{name:'Opera',versionRegexes:[s3,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:t3('opera')},{name:'Firefox',versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:t3('firefox')},{name:'Safari',versionRegexes:[s3,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(u){return(r3.contains(u,'safari')||r3.contains(u,'mobile/'))&&r3.contains(u,'applewebkit');}}];var v3=[{name:'Windows',search:t3('win'),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:'iOS',search:function(u){return r3.contains(u,'iphone')||r3.contains(u,'ipad');},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:'Android',search:t3('android'),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:'OSX',search:t3('os x'),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:'Linux',search:t3('linux'),versionRegexes:[]},{name:'Solaris',search:t3('sunos'),versionRegexes:[]},{name:'FreeBSD',search:t3('freebsd'),versionRegexes:[]}];var w3={browsers:$.constant(u3),oses:$.constant(v3)};var x3=function(u){var u3=w3.browsers();var v3=w3.oses();var b5=V2.detectBrowser(u3,u).fold(Y1.unknown,Y1.nu);var o=V2.detectOs(v3,u).fold(k2.unknown,k2.nu);var d=l2(o,b5,u);return{browser:b5,os:o,deviceType:d};};var y3={detect:x3};var z3=I1.cached(function(){var u=navigator.userAgent;return y3.detect(u);});var A3={detect:z3};var B3={tap:$.constant('alloy.tap')};var C3=$.constant('alloy.focus');var D3=$.constant('alloy.blur.post');var E3=$.constant('alloy.receive');var F3=$.constant('alloy.execute');var G3=$.constant('alloy.focus.item');var H3=B3.tap;var I3=A3.detect().deviceType.isTouch()?B3.tap:E1;var J3=$.constant('alloy.longpress');var K3=$.constant('alloy.sandbox.close');var L3=$.constant('alloy.system.init');var M3=$.constant('alloy.system.scroll');var N3=$.constant('alloy.system.attached');var O3=$.constant('alloy.system.detached');var P3=$.constant('alloy.change.tab');var Q3=$.constant('alloy.dismiss.tab');var R3=function(c,e){V3(c,c.element(),e,{});};var S3=function(c,e,p){V3(c,c.element(),e,p);};var T3=function(c){R3(c,F3());};var U3=function(c,t,e){V3(c,t,e,{});};var V3=function(c,t,e,p){var cr=U.deepMerge({target:t},p);c.getSystem().triggerEvent(e,t,o1.map(cr,$.constant));};var W3=function(c,t,e,s){c.getSystem().triggerEvent(e,t,s.event());};var X3=function(c,t){c.getSystem().triggerFocus(t,c.element());};var Y3=function(h,s){var d=s||document;var a=d.createElement('div');a.innerHTML=h;if(!a.hasChildNodes()||a.childNodes.length>1){console.error('HTML does not have a single root node',h);throw'HTML must have a single root node';}return _3(a.childNodes[0]);};var Z3=function(Gr,s){var d=s||document;var M4=d.createElement(Gr);return _3(M4);};var $3=function(um,s){var d=s||document;var M4=d.createTextNode(um);return _3(M4);};var _3=function(M4){if(M4===null||M4===undefined)throw new Error('Node cannot be null or undefined');return{dom:$.constant(M4)};};var a4=function(d,x,y){return c1.from(d.dom().elementFromPoint(x,y)).map(_3);};var b4={fromHtml:Y3,fromTag:Z3,fromText:$3,fromDom:_3,fromPoint:a4};var c4={ATTRIBUTE:2,CDATA_SECTION:4,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,ELEMENT:1,TEXT:3,PROCESSING_INSTRUCTION:7,ENTITY_REFERENCE:5,ENTITY:6,NOTATION:12};var d4=function(ya){var r=ya.dom().nodeName;return r.toLowerCase();};var e4=function(ya){return ya.dom().nodeType;};var f4=function(ya){return ya.dom().nodeValue;};var g4=function(t){return function(ya){return e4(ya)===t;};};var h4=function(ya){return e4(ya)===c4.COMMENT||d4(ya)==='#comment';};var i4=g4(c4.ELEMENT);var j4=g4(c4.TEXT);var k4=g4(c4.DOCUMENT);var l4={name:d4,type:e4,value:f4,isElement:i4,isText:j4,isDocument:k4,isComment:h4};var m4=function(ya){var md=l4.isText(ya)?ya.dom().parentNode:ya.dom();return md!==undefined&&md!==null&&md.ownerDocument.body.contains(md);};var n4=I1.cached(function(){return o4(b4.fromDom(document));});var o4=function(d){var n4=d.dom().body;if(n4===null||n4===undefined)throw'Body is not available yet';return b4.fromDom(n4);};var p4={body:n4,getBody:o4,inBody:m4};function q4(){var o8=[];for(var _=0;_<arguments.length;_++){o8[_]=arguments[_];}return function(){var m1=[];for(var _=0;_<arguments.length;_++){m1[_]=arguments[_];}if(o8.length!==m1.length){throw new Error('Wrong number of arguments to struct. Expected "['+o8.length+']", got '+m1.length+' arguments');}var s={};R2.each(o8,function(d4,i){s[d4]=$.constant(m1[i]);});return s;};}var r4=function(a){return a.slice(0).sort();};var s4=function(fg,f1){throw new Error('All required keys ('+r4(fg).join(', ')+') were not specified. Specified keys were: '+r4(f1).join(', ')+'.');};var t4=function(u){throw new Error('Unsupported keys for object: '+r4(u).join(', '));};var u4=function(l,b){if(!O.isArray(b))throw new Error('The '+l+' fields must be an array. Was: '+b+'.');R2.each(b,function(a){if(!O.isString(a))throw new Error('The value '+a+' in the '+l+' fields was not a string.');});};var v4=function(i,e4){throw new Error('All values need to be of type: '+e4+'. Keys ('+r4(i).join(', ')+') were not.');};var w4=function(e){var a=r4(e);var b=R2.find(a,function(s,i){return i<a.length-1&&s===a[i+1];});b.each(function(d){throw new Error('The field: '+d+' occurs more than once in the combined fields: ['+a.join(', ')+'].');});};var x4={sort:r4,reqMessage:s4,unsuppMessage:t4,validateStrArr:u4,invalidTypeMessage:v4,checkDupes:w4};function y4(fg,hg){var e=fg.concat(hg);if(e.length===0)throw new Error('You must specify at least one required or optional field.');x4.validateStrArr('required',fg);x4.validateStrArr('optional',hg);x4.checkDupes(e);return function(o){var f1=o1.keys(o);var a=R2.forall(fg,function(b){return R2.contains(f1,b);});if(!a)x4.reqMessage(fg,f1);var u=R2.filter(f1,function(k){return!R2.contains(e,k);});if(u.length>0)x4.unsuppMessage(u);var r={};R2.each(fg,function(b){r[b]=$.constant(o[b]);});R2.each(hg,function(b){r[b]=$.constant(Object.prototype.hasOwnProperty.call(o,b)?c1.some(o[b]):c1.none());});return r;};}var z4={immutable:q4,immutableBag:y4};var A4=function(t,f){var r=[];var a=function(e){r.push(e);return f(e);};var c=f(t);do{c=c.bind(a);}while(c.isSome());return r;};var B4={toArray:A4};var C4=typeof window!=='undefined'?window:Function('return this;')();var D4=function(Jm,s){var o=s!==undefined&&s!==null?s:C4;for(var i=0;i<Jm.length&&o!==undefined&&o!==null;++i)o=o[Jm[i]];return o;};var E4=function(p,s){var Jm=p.split('.');return D4(Jm,s);};var F4=function(o,p){if(o[p]===undefined||o[p]===null)o[p]={};return o[p];};var G4=function(Jm,t){var o=t!==undefined?t:C4;for(var i=0;i<Jm.length;++i)o=F4(o,Jm[i]);return o;};var H4=function(d4,t){var Jm=d4.split('.');return G4(Jm,t);};var I4={path:D4,resolve:E4,forge:G4,namespace:H4};var J4=function(d4,s){return I4.resolve(d4,s);};var K4=function(d4,s){var a=J4(d4,s);if(a===undefined||a===null)throw d4+' not available on this browser';return a;};var L4={getOrDie:K4};var M4=function(){var f=L4.getOrDie('Node');return f;};var N4=function(a,b,m){return(a.compareDocumentPosition(b)&m)!==0;};var O4=function(a,b){return N4(a,b,M4().DOCUMENT_POSITION_PRECEDING);};var P4=function(a,b){return N4(a,b,M4().DOCUMENT_POSITION_CONTAINED_BY);};var Q4={documentPositionPreceding:O4,documentPositionContainedBy:P4};var R4=c4.ELEMENT;var S4=c4.DOCUMENT;var is=function(ya,s){var e=ya.dom();if(e.nodeType!==R4)return false;else if(e.matches!==undefined)return e.matches(s);else if(e.msMatchesSelector!==undefined)return e.msMatchesSelector(s);else if(e.webkitMatchesSelector!==undefined)return e.webkitMatchesSelector(s);else if(e.mozMatchesSelector!==undefined)return e.mozMatchesSelector(s);else throw new Error('Browser lacks native selectors');};var U4=function(md){return md.nodeType!==R4&&md.nodeType!==S4||md.childElementCount===0;};var V4=function(s,a){var z8=a===undefined?document:a.dom();return U4(z8)?[]:R2.map(z8.querySelectorAll(s),b4.fromDom);};var W4=function(s,a){var z8=a===undefined?document:a.dom();return U4(z8)?c1.none():c1.from(z8.querySelector(s)).map(b4.fromDom);};var X4={all:V4,is:is,one:W4};var eq=function(e,a){return e.dom()===a.dom();};var Z4=function(e,a){return e.dom().isEqualNode(a.dom());};var $4=function(ya,e){return R2.exists(e,$.curry(eq,ya));};var _4=function(e,a){var d=e.dom(),b=a.dom();return d===b?false:d.contains(b);};var a5=function(e,a){return Q4.documentPositionContainedBy(e.dom(),a.dom());};var b5=A3.detect().browser;var c5=b5.isIE()?a5:_4;var d5={eq:eq,isEqualNode:Z4,member:$4,contains:c5,is:X4.is};var e5=function(ya){return b4.fromDom(ya.dom().ownerDocument);};var f5=function(ya){var d=e5(ya);return b4.fromDom(d.dom().documentElement);};var g5=function(ya){var e=ya.dom();var g5=e.ownerDocument.defaultView;return b4.fromDom(g5);};var h5=function(ya){var md=ya.dom();return c1.from(md.parentNode).map(b4.fromDom);};var i5=function(ya){return h5(ya).bind(function(p){var k=q5(p);return R2.findIndex(k,function(e){return d5.eq(ya,e);});});};var j5=function(ya,i){var s=O.isFunction(i)?i:$.constant(false);var md=ya.dom();var r=[];while(md.parentNode!==null&&md.parentNode!==undefined){var a=md.parentNode;var h5=b4.fromDom(a);r.push(h5);if(s(h5)===true)break;else md=a;}return r;};var k5=function(ya){var f=function(e){return R2.filter(e,function(x){return!d5.eq(ya,x);});};return h5(ya).map(q5).map(f).getOr([]);};var l5=function(ya){var md=ya.dom();return c1.from(md.offsetParent).map(b4.fromDom);};var m5=function(ya){var md=ya.dom();return c1.from(md.previousSibling).map(b4.fromDom);};var n5=function(ya){var md=ya.dom();return c1.from(md.nextSibling).map(b4.fromDom);};var o5=function(ya){return R2.reverse(B4.toArray(ya,m5));};var p5=function(ya){return B4.toArray(ya,n5);};var q5=function(ya){var md=ya.dom();return R2.map(md.childNodes,b4.fromDom);};var r5=function(ya,i){var q5=ya.dom().childNodes;return c1.from(q5[i]).map(b4.fromDom);};var s5=function(ya){return r5(ya,0);};var t5=function(ya){return r5(ya,ya.dom().childNodes.length-1);};var u5=function(ya){return ya.dom().childNodes.length;};var v5=function(ya){return ya.dom().hasChildNodes();};var w5=z4.immutable('element','offset');var x5=function(ya,o){var c=q5(ya);return c.length>0&&o<c.length?w5(c[o],0):w5(ya,o);};var y5={owner:e5,defaultView:g5,documentElement:f5,parent:h5,findIndex:i5,parents:j5,siblings:k5,prevSibling:m5,offsetParent:l5,prevSiblings:o5,nextSibling:n5,nextSiblings:p5,children:q5,child:r5,firstChild:s5,lastChild:t5,childNodesCount:u5,hasChildNodes:v5,leaf:x5};var z5=function(m,ya){var h5=y5.parent(m);h5.each(function(v){v.dom().insertBefore(ya.dom(),m.dom());});};var A5=function(m,ya){var G9=y5.nextSibling(m);G9.fold(function(){var h5=y5.parent(m);h5.each(function(v){C5(v,ya);});},function(v){z5(v,ya);});};var B5=function(h5,ya){var s5=y5.firstChild(h5);s5.fold(function(){C5(h5,ya);},function(v){h5.dom().insertBefore(ya.dom(),v.dom());});};var C5=function(h5,ya){h5.dom().appendChild(ya.dom());};var D5=function(h5,ya,i){y5.child(h5,i).fold(function(){C5(h5,ya);},function(v){z5(v,ya);});};var E5=function(ya,w){z5(ya,w);C5(w,ya);};var F5={before:z5,after:A5,prepend:B5,append:C5,appendAt:D5,wrap:E5};var G5=function(m,e){R2.each(e,function(x){F5.before(m,x);});};var H5=function(m,a){R2.each(a,function(x,i){var e=i===0?m:a[i-1];F5.after(e,x);});};var I5=function(h5,e){R2.each(e.slice().reverse(),function(x){F5.prepend(h5,x);});};var J5=function(h5,e){R2.each(e,function(x){F5.append(h5,x);});};var K5={before:G5,after:H5,prepend:I5,append:J5};var L5=function(ya){ya.dom().textContent='';R2.each(y5.children(ya),function(r){M5(r);});};var M5=function(ya){var md=ya.dom();if(md.parentNode!==null)md.parentNode.removeChild(md);};var N5=function(w){var q5=y5.children(w);if(q5.length>0)K5.before(w,q5);M5(w);};var O5={empty:L5,remove:M5,unwrap:N5};var P5=function(c){R3(c,O3());var q5=c.components();R2.each(q5,P5);};var Q5=function(c){var q5=c.components();R2.each(q5,Q5);R3(c,N3());};var R5=function(h5,r5){S5(h5,r5,F5.append);};var S5=function(h5,r5,i){h5.getSystem().addToWorld(r5);i(h5.element(),r5.element());if(p4.inBody(h5.element())){Q5(r5);}h5.syncComponents();};var T5=function(c){P5(c);O5.remove(c.element());c.getSystem().removeFromWorld(c);};var U5=function(c){var h5=y5.parent(c.element()).bind(function(p){return c.getSystem().getByDom(p).fold(c1.none,c1.some);});T5(c);h5.each(function(p){p.syncComponents();});};var V5=function(c){var lg=c.components();R2.each(lg,T5);O5.empty(c.element());c.syncComponents();};var W5=function(ya,g){F5.append(ya,g.element());var q5=y5.children(g.element());R2.each(q5,function(r5){g.getByDom(r5).each(Q5);});};var X5=function(o){var i=function(v){return o===v;};var a=function(d){return X5(o);};var b=function(f){return X5(o);};var s2=function(f){return X5(f(o));};var g1=function(f){f(o);};var F2=function(f){return f(o);};var c=function(_,d){return d(o);};var p2=function(f){return f(o);};var G2=function(f){return f(o);};var t=function(){return c1.some(o);};return{is:i,isValue:$.always,isError:$.never,getOr:$.constant(o),getOrThunk:$.constant(o),getOrDie:$.constant(o),or:a,orThunk:b,fold:c,map:s2,each:g1,bind:F2,exists:p2,forall:G2,toOption:t};};var Y5=function(m){var g=function(f){return f();};var K4=function(){return $.die(String(m))();};var o=function(c){return c;};var a=function(f){return f();};var s2=function(f){return Y5(m);};var F2=function(f){return Y5(m);};var b=function(c,_){return c(m);};return{is:$.never,isValue:$.never,isError:$.always,getOr:$.identity,getOrThunk:g,getOrDie:K4,or:o,orThunk:a,fold:b,map:s2,each:$.noop,bind:F2,exists:$.never,forall:$.always,toOption:c1.none};};var Z5={value:X5,error:Y5};var $5=function(c){if(!O.isArray(c)){throw new Error('cases must be an array');}if(c.length===0){throw new Error('there must be at least one case');}var a=[];var a6={};R2.each(c,function(b,d){var f1=o1.keys(b);if(f1.length!==1){throw new Error('one and only one name per case');}var k=f1[0];var f4=b[k];if(a6[k]!==undefined){throw new Error('duplicate key detected:'+k);}else if(k==='cata'){throw new Error('cannot have a case named cata (sorry)');}else if(!O.isArray(f4)){throw new Error('case arguments must be an array');}a.push(k);a6[k]=function(){var e=arguments.length;if(e!==f4.length){throw new Error('Wrong number of arguments to case '+k+'. Expected '+f4.length+' ('+f4+'), got '+e);}var f=new Array(e);for(var i=0;i<f.length;i++)f[i]=arguments[i];var m=function(g){var h=o1.keys(g);if(a.length!==h.length){throw new Error('Wrong number of arguments to match. Expected: '+a.join(',')+'\nActual: '+h.join(','));}var j=R2.forall(a,function(r){return R2.contains(h,r);});if(!j)throw new Error('Not all branches were specified when using match. Specified: '+h.join(', ')+'\nRequired: '+a.join(', '));return g[k].apply(null,f);};return{fold:function(){if(arguments.length!==c.length){throw new Error('Wrong number of arguments to fold. Expected '+c.length+', got '+arguments.length);}var t=arguments[d];return t.apply(null,f);},match:m,log:function(l){console.log(l,{constructors:a,constructor:k,params:f});}};};});return a6;};var _5={generate:$5};var a6=_5.generate([{strict:[]},{defaultedThunk:['fallbackThunk']},{asOption:[]},{asDefaultedOptionThunk:['fallbackThunk']},{mergeWithThunk:['baseThunk']}]);var b6=function(f){return a6.defaultedThunk($.constant(f));};var c6=function(z8){return a6.mergeWithThunk($.constant(z8));};var d6=a6.strict;var e6=a6.asOption;var f6=a6.defaultedThunk;var g6=a6.asDefaultedOptionThunk;var h6=a6.mergeWithThunk;var i6=_5.generate([{bothErrors:['error1','error2']},{firstError:['error1','value2']},{secondError:['value1','error2']},{bothValues:['value1','value2']}]);var j6=function(r){var e=[];var m1=[];R2.each(r,function(a){a.fold(function(b){e.push(b);},function(f4){m1.push(f4);});});return{errors:e,values:m1};};var k6=function(r,a){return r.fold(function(e){return a.fold(function(b){return i6.bothErrors(e,b);},function(v){return i6.firstError(e,v);});},function(v){return a.fold(function(e){return i6.secondError(v,e);},function(b){return i6.bothValues(v,b);});});};var l6={partition:j6,compare:k6};var m6=function(m1,z8){return Z5.value(U.deepMerge.apply(undefined,[z8].concat(m1)));};var n6=function(e){return $.compose(Z5.error,R2.flatten)(e);};var o6=function(o,z8){var p=l6.partition(o);return p.errors.length>0?n6(p.errors):m6(p.values,z8);};var p6=function(o){var p=l6.partition(o);return p.errors.length>0?n6(p.errors):Z5.value(p.values);};var q6={consolidateObj:o6,consolidateArr:p6};var r6=function(o,o8){var r={};R2.each(o8,function(k7){if(o[k7]!==undefined&&o.hasOwnProperty(k7)){r[k7]=o[k7];}});return r;};var s6=function(o,o8){var r={};o1.each(o,function(v,k){if(!R2.contains(o8,k)){r[k]=v;}});return r;};var t6=function(k){return function(o){return o.hasOwnProperty(k)?c1.from(o[k]):c1.none();};};var u6=function(k,f){return function(o){return t6(k)(o).getOr(f);};};var v6=function(o,k){return t6(k)(o);};var w6=function(o,k){return o.hasOwnProperty(k)&&o[k]!==undefined&&o[k]!==null;};var x6=function(k,f4){var r={};r[k]=f4;return r;};var y6=function(k){var r={};R2.each(k,function(a){r[a.key]=a.value;});return r;};var z6=function(o,o8){return r6(o,o8);};var A6=function(o,o8){return s6(o,o8);};var B6=function(k){return t6(k);};var C6=function(k,f){return u6(k,f);};var D6=function(o,k){return v6(o,k);};var E6=function(k,f4){return x6(k,f4);};var F6=function(k){return y6(k);};var G6=function(o,z8){return q6.consolidateObj(o,z8);};var H6=function(o,k){return w6(o,k);};var I6=_5.generate([{setOf:['validator','valueType']},{arrOf:['valueType']},{objOf:['fields']},{itemOf:['validator']},{choiceOf:['key','branches']},{thunk:['description']},{func:['args','outputSchema']}]);var J6=_5.generate([{field:['name','presence','type']},{state:['name']}]);var K6=function(){return L4.getOrDie('JSON');};var L6=function(o){return K6().parse(o);};var M6=function(o,r,s){return K6().stringify(o,r,s);};var N6={parse:L6,stringify:M6};var O6=function(B1){return O.isObject(B1)&&o1.keys(B1).length>100?' removed due to size':N6.stringify(B1,null,2);};var P6=function(a){var b=a.length>10?a.slice(0,10).concat([{path:[],getErrorInfo:function(){return'... (only showing first ten failures)';}}]):a;return R2.map(b,function(e){return'Failed path: ('+e.path.join(' > ')+')\n'+e.getErrorInfo();});};var Q6=function(D4,g){return Z5.error([{path:D4,getErrorInfo:g}]);};var R6=function(D4,k,o){return Q6(D4,function(){return'Could not find valid *strict* value for "'+k+'" in '+O6(o);});};var S6=function(D4,k){return Q6(D4,function(){return'Choice schema did not contain choice key: "'+k+'"';});};var T6=function(D4,b,a){return Q6(D4,function(){return'The chosen schema: "'+a+'" did not exist in branches: '+O6(b);});};var U6=function(D4,u){return Q6(D4,function(){return'There are unsupported fields: ['+u.join(', ')+'] specified';});};var V6=function(D4,e){return Q6(D4,function(){return e;});};var W6=_5.generate([{field:['key','okey','presence','prop']},{state:['okey','instantiator']}]);var X6=function(D4,o,k){return v6(o,k).fold(function(){return R6(D4,k,o);},Z5.value);};var Y6=function(o,k,f){var v=v6(o,k).fold(function(){return f(o);},$.identity);return Z5.value(v);};var Z6=function(o,k){return Z5.value(v6(o,k));};var $6=function(o,k,f){var a=v6(o,k).map(function(v){return v===true?f(o):v;});return Z5.value(a);};var _6=function(D4,o,k7,s){return k7.fold(function(k,a,p,b){var c=function(e){return b.extract(D4.concat([k]),s,e).map(function(r){return x6(a,s(r));});};var d=function(e){return e.fold(function(){var Je=x6(a,s(c1.none()));return Z5.value(Je);},function(f){return b.extract(D4.concat([k]),s,f).map(function(r){return x6(a,s(c1.some(r)));});});};return function(){return p.fold(function(){return X6(D4,o,k).bind(c);},function(f){return Y6(o,k,f).bind(c);},function(){return Z6(o,k).bind(d);},function(f){return $6(o,k,f).bind(d);},function(e){var z8=e(o);return Y6(o,k,$.constant({})).map(function(v){return U.deepMerge(z8,v);}).bind(c);});}();},function(a,i){var j7=i(o);return Z5.value(x6(a,s(j7)));});};var a7=function(D4,o,o8,s){var r=R2.map(o8,function(k7){return _6(D4,o,k7,s);});return q6.consolidateObj(r,{});};var b7=function(v){var p7=function(D4,s,b){return v(b,s).fold(function(e){return V6(D4,e);},Z5.value);};var t=function(){return'val';};var a=function(){return I6.itemOf(v);};return{extract:p7,toString:t,toDsl:a};};var c7=function(o){var f1=o1.keys(o);return R2.filter(f1,function(k){return H6(o,k);});};var d7=function(o8){var d=e7(o8);var a=R2.foldr(o8,function(b,f){return f.fold(function(k){return U.deepMerge(b,E6(k,true));},$.constant(b));},{});var p7=function(D4,s,o){var f1=O.isBoolean(o)?[]:c7(o);var e=R2.filter(f1,function(k){return!H6(a,k);});return e.length===0?d.extract(D4,s,o):U6(D4,e);};return{extract:p7,toString:d.toString,toDsl:d.toDsl};};var e7=function(o8){var p7=function(D4,s,o){return a7(D4,o,o8,s);};var t=function(){var f=R2.map(o8,function(k7){return k7.fold(function(k,o,p,b){return k+' -> '+b.toString();},function(o,i){return'state('+o+')';});});return'obj{\n'+f.join('\n')+'}';};var a=function(){return I6.objOf(R2.map(o8,function(f){return f.fold(function(k,o,p,b){return J6.field(k,p,b);},function(o,i){return J6.state(o);});}));};return{extract:p7,toString:t,toDsl:a};};var f7=function(p){var p7=function(D4,s,c){var r=R2.map(c,function(a,i){return p.extract(D4.concat(['['+i+']']),s,a);});return q6.consolidateArr(r);};var t=function(){return'array('+p.toString()+')';};var b=function(){return I6.arrOf(p);};return{extract:p7,toString:t,toDsl:b};};var g7=function(v,p){var a=function(D4,f1){return f7(b7(v)).extract(D4,$.identity,f1);};var p7=function(D4,s,o){var f1=o1.keys(o);return a(D4,f1).bind(function(c){var Ra=R2.map(c,function(d){return W6.field(d,d,d6(),p);});return e7(Ra).extract(D4,s,o);});};var t=function(){return'setOf('+p.toString()+')';};var b=function(){return I6.setOf(v,p);};return{extract:p7,toString:t,toDsl:b};};var h7=$.constant(b7(Z5.value));var i7=$.compose(f7,e7);var j7=W6.state;var k7=W6.field;var l7=function(D4,s,B1,b,c){var o8=D6(b,c);return o8.fold(function(){return T6(D4,b,c);},function(f){return e7(f).extract(D4.concat(['branch: '+c]),s,B1);});};var m7=function(k,b){var p7=function(D4,s,B1){var c=D6(B1,k);return c.fold(function(){return S6(D4,k);},function(d){return l7(D4,s,B1,b,d);});};var t=function(){return'chooseOn('+k+'). Possible values: '+o1.keys(b);};var a=function(){return I6.choiceOf(k,b);};return{extract:p7,toString:t,toDsl:a};};var n7=b7(Z5.value);var o7=function(a){return b7(function(v){return a(v);});};var p7=function(l,p,s,o){return p.extract([l],s,o).fold(function(e){return Z5.error({input:o,errors:e});},Z5.value);};var q7=function(l,p,o){return p7(l,p,$.constant,o);};var r7=function(l,p,o){return p7(l,p,$.identity,o);};var s7=function(e){return e.fold(function(a){throw new Error(v7(a));},$.identity);};var t7=function(l,p,o){return s7(r7(l,p,o));};var u7=function(l,p,o){return s7(q7(l,p,o));};var v7=function(e){return'Errors: \n'+P6(e.errors)+'\n\nInput object: '+O6(e.input);};var w7=function(k,b){return m7(k,b);};var x7=$.constant(n7);var y7=function(v,e){return b7(function(a){var b=typeof a;return v(a)?Z5.value(a):Z5.error('Expected type: '+e+' but got: '+b);});};var z7=y7(O.isFunction,'function');var A7=function(k){return k7(k,k,d6(),h7());};var B7=function(k,Ra){return k7(k,k,d6(),Ra);};var C7=function(k){return B7(k,z7);};var D7=function(k,m){return k7(k,k,e6(),b7(function(v){return Z5.error('The field: '+k+' is forbidden. '+m);}));};var E7=function(k,o){return k7(k,k,d6(),e7(o));};var F7=function(k){return k7(k,k,e6(),h7());};var G7=function(k,Ra){return k7(k,k,e6(),Ra);};var H7=function(k,o){return k7(k,k,e6(),e7(o));};var I7=function(k,o){return k7(k,k,e6(),d7(o));};var J7=function(k,f){return k7(k,k,b6(f),h7());};var K7=function(k,f,Ra){return k7(k,k,b6(f),Ra);};var L7=function(k,f,o){return k7(k,k,b6(f),e7(o));};var M7=function(o,i){return j7(o,i);};var N7=function(c,s){return d5.eq(c.element(),s.event().target());};var O7=function(Jm){if(!H6(Jm,'can')&&!H6(Jm,'abort')&&!H6(Jm,'run')){throw new Error('EventHandler defined by: '+N6.stringify(Jm,null,2)+' does not have can, abort, or run!');}return t7('Extracting event.handler',d7([J7('can',$.constant(true)),J7('abort',$.constant(false)),J7('run',$.noop)]),Jm);};var P7=function(h,f){return function(){var a=Array.prototype.slice.call(arguments,0);return R2.foldl(h,function(b,c){return b&&f(c).apply(undefined,a);},true);};};var Q7=function(h,f){return function(){var a=Array.prototype.slice.call(arguments,0);return R2.foldl(h,function(b,c){return b||f(c).apply(undefined,a);},false);};};var R7=function(h){return O.isFunction(h)?{can:$.constant(true),abort:$.constant(false),run:h}:h;};var S7=function(h){var V7=P7(h,function(a){return a.can;});var U7=Q7(h,function(a){return a.abort;});var W7=function(){var a=Array.prototype.slice.call(arguments,0);R2.each(h,function(b){b.run.apply(undefined,a);});};return O7({can:V7,abort:U7,run:W7});};var T7=F6;var U7=function(d4,p){return{key:d4,value:O7({abort:p})};};var V7=function(d4,p){return{key:d4,value:O7({can:p})};};var W7=function(d4,h){return{key:d4,value:O7({run:h})};};var X7=function(d4,a,e){return{key:d4,value:O7({run:function(c){a.apply(undefined,[c].concat(e));}})};};var Y7=function(d4){return function(h){return W7(d4,h);};};var Z7=function(d4){return function(h){return{key:d4,value:O7({run:function(c,s){if(N7(c,s)){h(c,s);}}})};};};var $7=function(d4,u){return W7(d4,function(c,s){c.getSystem().getByUid(u).each(function(r){W3(r,r.element(),d4,s);});});};var _7=function(d4,d,p){var u=d.partUids()[p];return $7(d4,u);};var a8=function(d4,f){return W7(d4,function(c,s){c.getSystem().getByDom(s.event().target()).each(function(t){f(c,t,s);});});};var b8=function(d4){return W7(d4,function(c,s){s.cut();});};var c8=function(d4){return W7(d4,function(c,s){s.stop();});};var d8=Z7(N3());var e8=Z7(O3());var f8=Z7(L3());var g8=Y7(F3());var h8=function(f,a,b){var d=b.toString();var e=d.indexOf(')')+1;var o=d.indexOf('(');var p=d.substring(o+1,e-1).split(/,\s*/);f.toFunctionAnnotation=function(){return{name:a,parameters:i8(p.slice(0,1).concat(p.slice(3)))};};return f;};var i8=function(a){return R2.map(a,function(p){return r3.endsWith(p,'/*')?p.substring(0,p.length-'/*'.length):p;});};var j8=function(f,e){var d=f.toString();var a=d.indexOf(')')+1;var o=d.indexOf('(');var p=d.substring(o+1,a-1).split(/,\s*/);f.toFunctionAnnotation=function(){return{name:e,parameters:i8(p)};};return f;};var k8=function(f,a){var d=a.toString();var e=d.indexOf(')')+1;var o=d.indexOf('(');var p=d.substring(o+1,e-1).split(/,\s*/);f.toFunctionAnnotation=function(){return{name:'OVERRIDE',parameters:i8(p.slice(1))};};return f;};var l8=z4.immutableBag(['tag'],['classes','attributes','styles','value','innerHtml','domChildren','defChildren']);var m8=function(d){var r=n8(d);return N6.stringify(r,null,2);};var n8=function(d){return{tag:d.tag(),classes:d.classes().getOr([]),attributes:d.attributes().getOr({}),styles:d.styles().getOr({}),value:d.value().getOr('<none>'),innerHtml:d.innerHtml().getOr('<none>'),defChildren:d.defChildren().getOr('<none>'),domChildren:d.domChildren().fold(function(){return'<none>';},function(q5){return q5.length===0?'0 children, but still specified':String(q5.length);})};};var o8=['classes','attributes','styles','value','innerHtml','defChildren','domChildren'];var p8=z4.immutableBag([],o8);var q8=function(k,a,o){return a.fold(function(){return o.fold(function(){return{};},function(b){return E6(k,b);});},function(b){return o.fold(function(){return E6(k,b);},function(c){return E6(k,c);});});};var r8=function(d,m){var r=U.deepMerge({tag:d.tag(),classes:m.classes().getOr([]).concat(d.classes().getOr([])),attributes:U.merge(d.attributes().getOr({}),m.attributes().getOr({})),styles:U.merge(d.styles().getOr({}),m.styles().getOr({}))},m.innerHtml().or(d.innerHtml()).map(function(i){return E6('innerHtml',i);}).getOr({}),q8('domChildren',m.domChildren(),d.domChildren()),q8('defChildren',m.defChildren(),d.defChildren()),m.value().or(d.value()).map(function(f4){return E6('value',f4);}).getOr({}));return l8(r);};var s8=function(c,s,e){return g8(function(a){e(a,c,s);});};var t8=function(c,s,f){return f8(function(a,b){f(a,c,s);});};var u8=function(Ra,d4,U9,a,e,j7){var c=d7(Ra);var s=H7(d4,[I7('config',Ra)]);return y8(c,s,d4,U9,a,e,j7);};var v8=function(m,d4,U9,a,e,j7){var c=m;var s=H7(d4,[G7('config',m)]);return y8(c,s,d4,U9,a,e,j7);};var w8=function(n,a,b){var f=function(c){var d=arguments;return c.config({name:$.constant(n)}).fold(function(){throw new Error('We could not find any behaviour configuration for: '+n+'. Using API: '+b);},function(i){var r=Array.prototype.slice.call(d,1);return a.apply(undefined,[c,i.config,i.state].concat(r));});};return h8(f,b,a);};var x8=function(d4){return{key:d4,value:undefined};};var y8=function(c,s,d4,U9,a,e,j7){var g=function(i){return H6(i,d4)?i[d4]():c1.none();};var w=o1.map(a,function(d,f){return w8(d4,d,f);});var b=o1.map(e,function(d,f){return j8(d,f);});var m=U.deepMerge(b,w,{revoke:$.curry(x8,d4),config:function(gh){var p=u7(d4+'-config',c,gh);return{key:d4,value:{config:p,me:m,configAsRaw:I1.cached(function(){return t7(d4+'-config',c,gh);}),initialConfig:gh,state:j7}};},schema:function(){return s;},exhibit:function(i,z8){return g(i).bind(function(d){return D6(U9,'exhibit').map(function(f){return f(z8,d.config,d.state);});}).getOr(p8({}));},name:function(){return d4;},handlers:function(i){return g(i).bind(function(d){return D6(U9,'events').map(function(Aa){return Aa(d.config,d.state);});}).getOr({});}});return m;};var z8=function(h,fg){return A8(h,fg,{validate:O.isFunction,label:'function'});};var A8=function(h,fg,p){if(fg.length===0)throw new Error('You must specify at least one required field.');x4.validateStrArr('required',fg);x4.checkDupes(fg);return function(o){var f1=o1.keys(o);var a=R2.forall(fg,function(r){return R2.contains(f1,r);});if(!a)x4.reqMessage(fg,f1);h(fg,f1);var i=R2.filter(fg,function(k){return!p.validate(o[k],k);});if(i.length>0)x4.invalidTypeMessage(i,p.label);return o;};};var B8=function(fg,f1){var u=R2.filter(f1,function(k){return!R2.contains(fg,k);});if(u.length>0)x4.unsuppMessage(u);};var C8=$.noop;var D8={exactly:$.curry(z8,B8),ensure:$.curry(z8,C8),ensureWith:$.curry(A8,C8)};var E8=D8.ensure(['readState']);var F8=function(){return E8({readState:function(){return'No State required';}});};var G8=Object.freeze({init:F8});var H8=function(c){return F6(c);};var I8=d7([A7('fields'),A7('name'),J7('active',{}),J7('apis',{}),J7('extra',{}),J7('state',G8)]);var J8=function(cr){var f4=t7('Creating behaviour: '+cr.name,I8,cr);return u8(f4.fields,f4.name,f4.active,f4.apis,f4.extra,f4.state);};var K8=d7([A7('branchKey'),A7('branches'),A7('name'),J7('active',{}),J7('apis',{}),J7('extra',{}),J7('state',G8)]);var L8=function(cr){var f4=t7('Creating behaviour: '+cr.name,K8,cr);return v8(w7(f4.branchKey,f4.branches),f4.name,f4.active,f4.apis,f4.extra,f4.state);};var M8=$.constant(undefined);var N8=$.constant({});var O8=$.constant({});var P8=$.constant({});var Q8=$.constant(G8);function R8(t,a,i){var U9=i||false;var o=function(){a();U9=true;};var kb=function(){t();U9=false;};var j9=function(){var f=U9?kb:o;f();};var lb=function(){return U9;};return{on:o,off:kb,toggle:j9,isOn:lb};}var S8=function(md,k,f4){if(O.isString(f4)||O.isBoolean(f4)||O.isNumber(f4)){md.setAttribute(k,f4+'');}else{console.error('Invalid call to Attr.set. Key ',k,':: Value ',f4,':: Element ',md);throw new Error('Attribute value was not simple');}};var T8=function(ya,k,f4){S8(ya.dom(),k,f4);};var U8=function(ya,a){var md=ya.dom();o1.each(a,function(v,k){S8(md,k,v);});};var V8=function(ya,k){var v=ya.dom().getAttribute(k);return v===null?undefined:v;};var W8=function(ya,k){var md=ya.dom();return md&&md.hasAttribute?md.hasAttribute(k):false;};var X8=function(ya,k){ya.dom().removeAttribute(k);};var Y8=function(ya){var a=ya.dom().attributes;return a===undefined||a===null||a.length===0;};var Z8=function(ya){return R2.foldl(ya.dom().attributes,function(a,wr){a[wr.name]=wr.value;return a;},{});};var $8=function(s,d,wr){if(W8(s,wr)&&!W8(d,wr))T8(d,wr,V8(s,wr));};var _8=function(s,d,a){if(!l4.isElement(s)||!l4.isElement(d))return;R2.each(a,function(wr){$8(s,d,wr);});};var a9={clone:Z8,set:T8,setAll:U8,get:V8,has:W8,remove:X8,hasNone:Y8,transfer:_8};var b9=function(ya,wr){var f4=a9.get(ya,wr);return f4===undefined||f4===''?[]:f4.split(' ');};var c9=function(ya,wr,i){var o=b9(ya,wr);var n=o.concat([i]);a9.set(ya,wr,n.join(' '));};var d9=function(ya,wr,i){var n=R2.filter(b9(ya,wr),function(v){return v!==i;});if(n.length>0)a9.set(ya,wr,n.join(' '));else a9.remove(ya,wr);};var e9={read:b9,add:c9,remove:d9};var f9=function(ya){return ya.dom().classList!==undefined;};var g9=function(ya){return e9.read(ya,'class');};var h9=function(ya,c){return e9.add(ya,'class',c);};var i9=function(ya,c){return e9.remove(ya,'class',c);};var j9=function(ya,c){if(R2.contains(g9(ya),c)){i9(ya,c);}else{h9(ya,c);}};var k9={get:g9,add:h9,remove:i9,toggle:j9,supports:f9};var l9=function(ya,c){if(k9.supports(ya))ya.dom().classList.add(c);else k9.add(ya,c);};var m9=function(ya){var c=k9.supports(ya)?ya.dom().classList:k9.get(ya);if(c.length===0){a9.remove(ya,'class');}};var n9=function(ya,c){if(k9.supports(ya)){var a=ya.dom().classList;a.remove(c);}else k9.remove(ya,c);m9(ya);};var o9=function(ya,c){return k9.supports(ya)?ya.dom().classList.toggle(c):k9.toggle(ya,c);};var p9=function(ya,c){var h=k9.supports(ya);var a=ya.dom().classList;var kb=function(){if(h)a.remove(c);else k9.remove(ya,c);};var o=function(){if(h)a.add(c);else k9.add(ya,c);};return R8(kb,o,q9(ya,c));};var q9=function(ya,c){return k9.supports(ya)&&ya.dom().classList.contains(c);};var r9={add:l9,remove:n9,toggle:o9,toggler:p9,has:q9};var s9=function(ya,a,r){r9.remove(ya,r);r9.add(ya,a);};var t9=function(c,s,a){s9(c.element(),s.alpha(),s.omega());};var u9=function(c,s,a){s9(c.element(),s.omega(),s.alpha());};var v9=function(c,s,a){r9.remove(c.element(),s.alpha());r9.remove(c.element(),s.omega());};var w9=function(c,s,a){return r9.has(c.element(),s.alpha());};var x9=function(c,s,a){return r9.has(c.element(),s.omega());};var y9=Object.freeze({toAlpha:t9,toOmega:u9,isAlpha:w9,isOmega:x9,clear:v9});var z9=[A7('alpha'),A7('omega')];var A9=J8({fields:z9,name:'swapping',apis:y9});var B9=function(i){var f4=i;var V8=function(){return f4;};var T8=function(v){f4=v;};var Z8=function(){return B9(V8());};return{get:V8,set:T8,clone:Z8};};function C9(i,E9,s,a,b){return i(s,a)?c1.some(s):O.isFunction(b)&&b(s)?c1.none():E9(s,a,b);}var D9=function(p){return I9(p4.body(),p);};var E9=function(s,p,i){var ya=s.dom();var a=O.isFunction(i)?i:$.constant(false);while(ya.parentNode){ya=ya.parentNode;var e=b4.fromDom(ya);if(p(e))return c1.some(e);else if(a(e))break;}return c1.none();};var F9=function(s,p,i){var a=function(s){return p(s);};return C9(a,E9,s,p,i);};var G9=function(s,p){var ya=s.dom();if(!ya.parentNode)return c1.none();return H9(b4.fromDom(ya.parentNode),function(x){return!d5.eq(s,x)&&p(x);});};var H9=function(s,p){var r=R2.find(s.dom().childNodes,$.compose(p,b4.fromDom));return r.map(b4.fromDom);};var I9=function(s,p){var d=function(ya){for(var i=0;i<ya.childNodes.length;i++){if(p(b4.fromDom(ya.childNodes[i])))return c1.some(b4.fromDom(ya.childNodes[i]));var r=d(ya.childNodes[i]);if(r.isSome())return r;}return c1.none();};return d(s.dom());};var J9={first:D9,ancestor:E9,closest:F9,sibling:G9,child:H9,descendant:I9};var K9=function(p){return J9.first(p).isSome();};var L9=function(s,p,i){return J9.ancestor(s,p,i).isSome();};var M9=function(s,p,i){return J9.closest(s,p,i).isSome();};var N9=function(s,p){return J9.sibling(s,p).isSome();};var O9=function(s,p){return J9.child(s,p).isSome();};var P9=function(s,p){return J9.descendant(s,p).isSome();};var Q9={any:K9,ancestor:L9,closest:M9,sibling:N9,child:O9,descendant:P9};var R9=function(ya){ya.dom().focus();};var S9=function(ya){ya.dom().blur();};var T9=function(ya){var d=y5.owner(ya).dom();return ya.dom()===d.activeElement;};var U9=function(_){var d=_!==undefined?_.dom():document;return c1.from(d.activeElement).map(b4.fromDom);};var V9=function(ya){var d=y5.owner(ya);var sd=U9(d).filter(function(a){return Q9.closest(a,$.curry(d5.eq,ya));});sd.fold(function(){R9(ya);},$.noop);};var W9=function(ya){return U9(y5.owner(ya)).filter(function(e){return ya.dom().contains(e.dom());});};var X9={hasFocus:T9,focus:R9,blur:S9,active:U9,search:W9,focusInside:V9};var Y9=tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');var Z9=tinymce.util.Tools.resolve('tinymce.ThemeManager');var $9=function(t){var l=document.createElement('a');l.target='_blank';l.href=t.href;l.rel='noreferrer noopener';var n=document.createEvent('MouseEvents');n.initMouseEvent('click',true,true,window,0,0,0,0,0,false,false,false,false,0,null);document.body.appendChild(l);l.dispatchEvent(n);document.body.removeChild(l);};var _9={openLink:$9};var aa=function(e){return e.settings.skin===false;};var ba=function(e){return false;};var ca='formatChanged';var da='orientationChanged';var ea='dropupDismissed';var ga={formatChanged:$.constant(ca),orientationChanged:$.constant(da),dropupDismissed:$.constant(ea)};var ha=function(h,s){var d=s||document;var a=d.createElement('div');a.innerHTML=h;return y5.children(b4.fromDom(a));};var ia=function(t,s){return R2.map(t,function(x){return b4.fromTag(x,s);});};var ja=function(t,s){return R2.map(t,function(x){return b4.fromText(x,s);});};var ka=function(n){return R2.map(n,b4.fromDom);};var la={fromHtml:ha,fromTags:ia,fromText:ja,fromDom:ka};var ma=function(ya){return ya.dom().innerHTML;};var na=function(ya,c){var e5=y5.owner(ya);var d=e5.dom();var f=b4.fromDom(d.createDocumentFragment());var a=la.fromHtml(c,d);K5.append(f,a);O5.empty(ya);F5.append(ya,f);};var oa=function(ya){var c=b4.fromTag('div');var Z8=b4.fromDom(ya.dom().cloneNode(true));F5.append(c,Z8);return ma(c);};var pa={get:ma,set:na,getOuter:oa};var qa=function(jg,Q){return b4.fromDom(jg.dom().cloneNode(Q));};var ra=function(jg){return qa(jg,false);};var sa=function(jg){return qa(jg,true);};var ta=function(jg,Gr){var n=b4.fromTag(Gr);var a=a9.clone(jg);a9.setAll(n,a);return n;};var ua=function(jg,Gr){var n=ta(jg,Gr);var c=y5.children(sa(jg));K5.append(n,c);return n;};var va=function(jg,Gr){var n=ta(jg,Gr);F5.before(jg,n);var q5=y5.children(jg);K5.append(n,q5);O5.remove(jg);return n;};var wa={shallow:ra,shallowAs:ta,deep:sa,copy:ua,mutate:va};var xa=function(ya){var Z8=wa.shallow(ya);return pa.getOuter(Z8);};var ya=function(e){return xa(e);};var za=function(c,m){return m.universal()?c:R2.filter(c,function(a){return R2.contains(m.channels(),a);});};var Aa=function(r){return T7([W7(E3(),function(c,m){var a=r.channels();var b=o1.keys(a);var t=za(b,m);R2.each(t,function(d){var e=a[d]();var f=e.schema();var cr=u7('channel['+d+'] data\nReceiver: '+ya(c.element()),f,m.data());e.onReceive()(c,cr);});})]);};var Ba=Object.freeze({events:Aa});var Ca=function(a){var r=[];var D2=function(x){r.push(x);};for(var i=0;i<a.length;i++){a[i].each(D2);}return r;};var Da=function(a,f){for(var i=0;i<a.length;i++){var r=f(a[i],i);if(r.isSome()){return r;}}return c1.none();};var Ea=function(a,f){var r=[];for(var i=0;i<a.length;i++){var x=a[i];if(x.isSome()){r.push(x.getOrDie());}else{return c1.none();}}return c1.some(f.apply(null,r));};var Fa={cat:Ca,findMap:Da,liftN:Ea};var Ga='unknown';var Ha=true;var Ia=[];var Ja=['alloy/data/Fields','alloy/debugging/Debugging'];var Ka=function(){if(Ha===false){return Ga;}var e=new Error();if(e.stack!==undefined){var l=e.stack.split('\n');return R2.find(l,function(a){return a.indexOf('alloy')>0&&!R2.exists(Ja,function(p){return a.indexOf(p)>-1;});}).getOr(Ga);}else{return Ga;}};var La={logEventCut:$.noop,logEventStopped:$.noop,logNoParent:$.noop,logEventNoHandlers:$.noop,logEventResponse:$.noop,write:$.noop};var Ma=function(e,i,f){var l=Ha&&(Ia==='*'||R2.contains(Ia,e))?function(){var a=[];return{logEventCut:function(d4,t,p){a.push({outcome:'cut',target:t,purpose:p});},logEventStopped:function(d4,t,p){a.push({outcome:'stopped',target:t,purpose:p});},logNoParent:function(d4,t,p){a.push({outcome:'no-parent',target:t,purpose:p});},logEventNoHandlers:function(d4,t){a.push({outcome:'no-handlers-left',target:t});},logEventResponse:function(d4,t,p){a.push({outcome:'response',purpose:p,target:t});},write:function(){if(R2.contains(['mousemove','mouseover','mouseout',L3()],e)){return;}console.log(e,{event:e,target:i.dom(),sequence:R2.map(a,function(s){if(!R2.contains(['cut','stopped','response'],s.outcome)){return s.outcome;}else{return'{'+s.purpose+'} '+s.outcome+' at ('+ya(s.target)+')';}})});}};}():La;var o=f(l);l.write();return o;};var Na=$.constant(La);var Oa=$.constant(Ha);var Pa=$.constant([A7('menu'),A7('selectedMenu')]);var Qa=$.constant([A7('item'),A7('selectedItem')]);var Ra=$.constant(d7(Qa().concat(Pa())));var Sa=$.constant(d7(Qa()));var Ta=E7('initSize',[A7('numColumns'),A7('numRows')]);var Ua=function(){return B7('markers',Sa());};var Va=function(){return E7('markers',[A7('backgroundMenu')].concat(Pa()).concat(Qa()));};var Wa=function(fg){return E7('markers',R2.map(fg,A7));};var Xa=function(l,a,p){var dn=Ka();return k7(a,a,p,o7(function(f){return Z5.value(function(){return f.apply(undefined,arguments);});}));};var Ya=function(f){return Xa('onHandler',f,b6($.noop));};var Za=function(f){return Xa('onKeyboardHandler',f,b6(c1.none));};var $a=function(f){return Xa('onHandler',f,d6());};var _a=function(f){return Xa('onKeyboardHandler',f,d6());};var ab=function(d4,f4){return M7(d4,$.constant(f4));};var bb=function(d4){return M7(d4,$.identity);};var db=$.constant(Ta);var eb=[B7('channels',g7(Z5.value,d7([$a('onReceive'),J7('schema',x7())])))];var gb=J8({fields:eb,name:'receiving',active:Ba});var hb=function(c,t){var p=lb(c,t);var a=t.aria();a.update()(c,a,p);};var ib=function(c,t,a){r9.toggle(c.element(),t.toggleClass());hb(c,t);};var on=function(c,t,a){r9.add(c.element(),t.toggleClass());hb(c,t);};var kb=function(c,t,a){r9.remove(c.element(),t.toggleClass());hb(c,t);};var lb=function(c,t){return r9.has(c.element(),t.toggleClass());};var mb=function(c,t,a){var gc=t.selected()?on:kb;gc(c,t,a);};var nb=Object.freeze({onLoad:mb,toggle:ib,isOn:lb,on:on,off:kb});var ob=function(z8,t,a){return p8({});};var pb=function(t,a){var F3=s8(t,a,ib);var l=t8(t,a,mb);return T7(R2.flatten([t.toggleOnExecute()?[F3]:[],[l]]));};var qb=Object.freeze({exhibit:ob,events:pb});var rb=function(c,a,s){a9.set(c.element(),'aria-pressed',s);if(a.syncWithExpanded()){ub(c,a,s);}};var sb=function(c,a,s){a9.set(c.element(),'aria-selected',s);};var tb=function(c,a,s){a9.set(c.element(),'aria-checked',s);};var ub=function(c,a,s){a9.set(c.element(),'aria-expanded',s);};var vb=[J7('selected',false),A7('toggleClass'),J7('toggleOnExecute',true),K7('aria',{mode:'none'},w7('mode',{pressed:[J7('syncWithExpanded',false),ab('update',rb)],checked:[ab('update',tb)],expanded:[ab('update',ub)],selected:[ab('update',sb)],none:[ab('update',$.noop)]}))];var wb=J8({fields:vb,name:'toggling',active:qb,apis:nb});var xb=function(c,u){return gb.config({channels:E6(ga.formatChanged(),{onReceive:function(zi,cr){if(cr.command===c){u(zi,cr.state);}}})});};var yb=function(o){return gb.config({channels:E6(ga.orientationChanged(),{onReceive:o})});};var zb=function(c,o){return{key:c,value:{onReceive:o}};};var Ab={format:xb,orientation:yb,receive:zb};var Bb='tinymce-mobile';var Cb=function(p){return Bb+'-'+p;};var Db={resolve:Cb,prefix:$.constant(Bb)};var Eb=function(o){var e=function(c){return W7(F3(),function(d,s){c(d);s.stop();});};var a=function(c,s){s.stop();T3(c);};var b=function(c,s){s.cut();};var p=A3.detect().deviceType.isTouch()?[W7(H3(),a)]:[W7(E1(),a),W7(u1(),b)];return T7(R2.flatten([o.map(e).toArray(),p]));};var Fb=function(c,f){if(!f.ignore()){X9.focus(c.element());f.onFocus()(c);}};var Gb=function(c,f){if(!f.ignore()){X9.blur(c.element());}};var Hb=function(c){return X9.hasFocus(c.element());};var Ib=Object.freeze({focus:Fb,blur:Gb,isFocused:Hb});var Jb=function(z8,f){if(f.ignore()){return p8({});}else{return p8({attributes:{tabindex:'-1'}});}};var Kb=function(f){return T7([W7(C3(),function(c,s){Fb(c,f);s.stop();})]);};var Lb=Object.freeze({exhibit:Jb,events:Kb});var Mb=[Ya('onFocus'),J7('ignore',false)];var Nb=J8({fields:Mb,name:'focusing',active:Lb,apis:Ib});var Ob=function(md){return md.style!==undefined;};var Pb={isSupported:Ob};var Qb=function(md,p,f4){if(!O.isString(f4)){console.error('Invalid call to CSS.set. Property ',p,':: Value ',f4,':: Element ',md);throw new Error('CSS value must be a string: '+f4);}if(Pb.isSupported(md))md.style.setProperty(p,f4);};var Rb=function(md,p){if(Pb.isSupported(md))md.style.removeProperty(p);};var Sb=function(ya,p,f4){var md=ya.dom();Qb(md,p,f4);};var Tb=function(ya,c){var md=ya.dom();o1.each(c,function(v,k){Qb(md,k,v);});};var Ub=function(ya,c){var md=ya.dom();o1.each(c,function(v,k){v.fold(function(){Rb(md,k);},function(f4){Qb(md,k,f4);});});};var Vb=function(ya,p){var md=ya.dom();var s=window.getComputedStyle(md);var r=s.getPropertyValue(p);var v=r===''&&!p4.inBody(ya)?Wb(md,p):r;return v===null?undefined:v;};var Wb=function(md,p){return Pb.isSupported(md)?md.style.getPropertyValue(p):'';};var Xb=function(ya,p){var md=ya.dom();var a=Wb(md,p);return c1.from(a).filter(function(r){return r.length>0;});};var Yb=function(ya){var c={};var md=ya.dom();if(Pb.isSupported(md)){for(var i=0;i<md.style.length;i++){var r=md.style.item(i);c[r]=md.style[r];}}return c;};var Zb=function(Gr,p,f4){var ya=b4.fromTag(Gr);Sb(ya,p,f4);var s=Xb(ya,p);return s.isSome();};var $b=function(ya,p){var md=ya.dom();Rb(md,p);if(a9.has(ya,'style')&&r3.trim(a9.get(ya,'style'))===''){a9.remove(ya,'style');}};var _b=function(ya,f){var o=a9.get(ya,'style');var r=f(ya);var a=o===undefined?a9.remove:a9.set;a(ya,'style',o);return r;};var ac=function(s,t){var a=s.dom();var b=t.dom();if(Pb.isSupported(a)&&Pb.isSupported(b)){b.style.cssText=a.style.cssText;}};var bc=function(e){return e.dom().offsetWidth;};var cc=function(s,d,a){Xb(s,a).each(function(f4){if(Xb(d,a).isNone())Sb(d,a,f4);});};var dc=function(s,d,a){if(!l4.isElement(s)||!l4.isElement(d))return;R2.each(a,function(b){cc(s,d,b);});};var ec={copy:ac,set:Sb,preserve:_b,setAll:Tb,setOptions:Ub,remove:$b,get:Vb,getRaw:Xb,getAllRaw:Yb,isValidValue:Zb,reflow:bc,transfer:dc};function fc(d4,g){var T8=function(ya,h){if(!O.isNumber(h)&&!h.match(/^[0-9]+$/))throw d4+'.set accepts only positive integer values. Value was '+h;var md=ya.dom();if(Pb.isSupported(md))md.style[d4]=h+'px';};var V8=function(ya){var r=g(ya);if(r<=0||r===null){var c=ec.get(ya,d4);return parseFloat(c)||0;}return r;};var oa=V8;var a=function(ya,p){return R2.foldl(p,function(b,c){var v=ec.get(ya,c);var f4=v===undefined?0:parseInt(v,10);return isNaN(f4)?b:b+f4;},0);};var m=function(ya,f4,p){var c=a(ya,p);var b=f4>c?f4-c:0;return b;};return{set:T8,get:V8,getOuter:oa,aggregate:a,max:m};}var gc=fc('height',function(ya){return p4.inBody(ya)?ya.dom().getBoundingClientRect().height:ya.dom().offsetHeight;});var hc=function(ya,h){gc.set(ya,h);};var ic=function(ya){return gc.get(ya);};var jc=function(ya){return gc.getOuter(ya);};var kc=function(ya,f4){var i=['margin-top','border-top-width','padding-top','padding-bottom','border-bottom-width','margin-bottom'];var a=gc.max(ya,f4,i);ec.set(ya,'max-height',a+'px');};var lc={set:hc,get:ic,getOuter:jc,setMax:kc};var mc=function(p){return rc(p4.body(),p);};var nc=function(s,p,i){return R2.filter(y5.parents(s,i),p);};var oc=function(s,p){return R2.filter(y5.siblings(s),p);};var qc=function(s,p){return R2.filter(y5.children(s),p);};var rc=function(s,p){var r=[];R2.each(y5.children(s),function(x){if(p(x)){r=r.concat([x]);}r=r.concat(rc(x,p));});return r;};var sc={all:mc,ancestors:nc,siblings:oc,children:qc,descendants:rc};var tc=function(s){return X4.all(s);};var uc=function(s,a,i){return sc.ancestors(s,function(e){return X4.is(e,a);},i);};var vc=function(s,a){return sc.siblings(s,function(e){return X4.is(e,a);});};var wc=function(s,a){return sc.children(s,function(e){return X4.is(e,a);});};var xc=function(s,a){return X4.all(a,s);};var yc={all:tc,ancestors:uc,siblings:vc,children:wc,descendants:xc};var zc=function(s){return X4.one(s);};var Ac=function(s,a,i){return J9.ancestor(s,function(e){return X4.is(e,a);},i);};var Bc=function(s,a){return J9.sibling(s,function(e){return X4.is(e,a);});};var Cc=function(s,a){return J9.child(s,function(e){return X4.is(e,a);});};var Dc=function(s,a){return X4.one(a,s);};var Ec=function(s,a,i){return C9(X4.is,Ac,s,a,i);};var Fc={first:zc,ancestor:Ac,sibling:Bc,child:Cc,descendant:Dc,closest:Ec};var Gc={BACKSPACE:$.constant([8]),TAB:$.constant([9]),ENTER:$.constant([13]),SHIFT:$.constant([16]),CTRL:$.constant([17]),ALT:$.constant([18]),CAPSLOCK:$.constant([20]),ESCAPE:$.constant([27]),SPACE:$.constant([32]),PAGEUP:$.constant([33]),PAGEDOWN:$.constant([34]),END:$.constant([35]),HOME:$.constant([36]),LEFT:$.constant([37]),UP:$.constant([38]),RIGHT:$.constant([39]),DOWN:$.constant([40]),INSERT:$.constant([45]),DEL:$.constant([46]),META:$.constant([91,93,224]),F10:$.constant([121])};var Hc=function(m1,i,p){var z5=R2.reverse(m1.slice(0,i));var A5=R2.reverse(m1.slice(i+1));return R2.find(z5.concat(A5),p);};var Ic=function(m1,i,p){var z5=R2.reverse(m1.slice(0,i));return R2.find(z5,p);};var Jc=function(m1,i,p){var z5=m1.slice(0,i);var A5=m1.slice(i+1);return R2.find(A5.concat(z5),p);};var Kc=function(m1,i,p){var A5=m1.slice(i+1);return R2.find(A5,p);};var Lc=function(f1){return function(e){return R2.contains(f1,e.raw().which);};};var Mc=function(p){return function(e){return R2.forall(p,function(a){return a(e);});};};var Nc=function(e){return e.raw().shiftKey===true;};var Oc=function(e){return e.raw().ctrlKey===true;};var Pc=$.not(Oc);var Qc=$.not(Nc);var Rc=function(m,a){return{matches:m,classification:a};};var Sc=function(a,e){var b=R2.find(a,function(t){return t.matches(e);});return b.map(function(t){return t.classification;});};var Tc=function(f4,d,m,a){var r=f4+d;if(r>a){return m;}else{return r<m?a:r;}};var Uc=function(f4,m,a){if(f4<=m){return m;}else{return f4>=a?a:f4;}};var Vc=function(c,a,b){var d=yc.descendants(c.element(),'.'+a.highlightClass());R2.each(d,function(h){r9.remove(h,a.highlightClass());c.getSystem().getByDom(h).each(function(t){a.onDehighlight()(c,t);});});};var Wc=function(c,h,a,t){var w=ad(c,h,a,t);r9.remove(t.element(),h.highlightClass());if(w){h.onDehighlight()(c,t);}};var Xc=function(c,h,a,t){var w=ad(c,h,a,t);Vc(c,h,a);r9.add(t.element(),h.highlightClass());if(!w){h.onHighlight()(c,t);}};var Yc=function(c,h,a){dd(c,h,a).each(function(f){Xc(c,h,a,f);});};var Zc=function(c,h,a){ed(c,h,a).each(function(l){Xc(c,h,a,l);});};var $c=function(c,h,a,i){cd(c,h,a,i).fold(function(e){throw new Error(e);},function(f){Xc(c,h,a,f);});};var _c=function(a,h,b,p){var d=yc.descendants(a.element(),'.'+h.itemClass());var e=Fa.cat(R2.map(d,function(i){return a.getSystem().getByDom(i).toOption();}));var t=R2.find(e,p);t.each(function(c){Xc(a,h,b,c);});};var ad=function(c,h,a,b){return r9.has(b.element(),h.highlightClass());};var bd=function(c,h,a){return Fc.descendant(c.element(),'.'+h.highlightClass()).bind(c.getSystem().getByDom);};var cd=function(c,h,a,i){var b=yc.descendants(c.element(),'.'+h.itemClass());return c1.from(b[i]).fold(function(){return Z5.error('No element found with index '+i);},c.getSystem().getByDom);};var dd=function(c,h,a){return Fc.descendant(c.element(),'.'+h.itemClass()).bind(c.getSystem().getByDom);};var ed=function(c,h,a){var i=yc.descendants(c.element(),'.'+h.itemClass());var P2=i.length>0?c1.some(i[i.length-1]):c1.none();return P2.bind(c.getSystem().getByDom);};var fd=function(c,h,a,d){var i=yc.descendants(c.element(),'.'+h.itemClass());var b=R2.findIndex(i,function(e){return r9.has(e,h.highlightClass());});return b.bind(function(s){var e=Tc(s,d,0,i.length-1);return c.getSystem().getByDom(i[e]);});};var gd=function(c,h,a){return fd(c,h,a,-1);};var hd=function(c,h,a){return fd(c,h,a,+1);};var jd=Object.freeze({dehighlightAll:Vc,dehighlight:Wc,highlight:Xc,highlightFirst:Yc,highlightLast:Zc,highlightAt:$c,highlightBy:_c,isHighlighted:ad,getHighlighted:bd,getFirst:dd,getLast:ed,getPrevious:gd,getNext:hd});var kd=[A7('highlightClass'),A7('itemClass'),Ya('onHighlight'),Ya('onDehighlight')];var ld=J8({fields:kd,name:'highlighting',apis:jd});var md=function(){var V8=function(c){return X9.search(c.element());};var T8=function(c,f){c.getSystem().triggerFocus(f,c.element());};return{get:V8,set:T8};};var nd=function(){var V8=function(c){return ld.getHighlighted(c).map(function(i){return i.element();});};var T8=function(c,ya){c.getSystem().getByDom(ya).fold($.noop,function(i){ld.highlight(c,i);});};return{get:V8,set:T8};};var od=function(i,s,xd,yd,zd,o){var Ra=function(){return i.concat([J7('focusManager',md()),ab('handler',m),ab('state',s)]);};var p=function(c,a,k,b){var r=xd(c,a,k,b);return Sc(r,a.event()).bind(function(d){return d(c,a,k,b);});};var bm=function(k,a){var b=yd(k,a);var c=T7(o.map(function(ge){return W7(C3(),function(d,e){ge(d,k,a,e);e.stop();});}).toArray().concat([W7(A1(),function(d,e){p(d,e,k,a).each(function(_){e.stop();});})]));return U.deepMerge(b,c);};var m={schema:Ra,processKey:p,toEvents:bm,toApis:zd};return m;};var pd=function(c){var Ra=[F7('onEscape'),F7('onEnter'),J7('selector','[data-alloy-tabstop="true"]'),J7('firstTabstop',0),J7('useTabstopAt',$.constant(true)),F7('visibilitySelector')].concat([c]);var Td=function(t,ya){var f=t.visibilitySelector().bind(function(s){return Fc.closest(ya,s);}).getOr(ya);return lc.get(f)>0;};var a=function(f,t){var j=yc.descendants(f.element(),t.selector());var v=R2.filter(j,function(k){return Td(t,k);});return c1.from(v[t.firstTabstop()]);};var he=function(f,t){return t.focusManager().get(f).bind(function(j){return Fc.closest(j,t.selector());});};var i=function(t,ya){return Td(t,ya)&&t.useTabstopAt()(ya);};var ge=function(f,t,j){a(f,t).each(function(k){t.focusManager().set(f,k);});};var g=function(f,t,s,j,k){return k(t,s,function(l){return i(j,l);}).fold(function(){return j.cyclic()?c1.some(true):c1.none();},function(l){j.focusManager().set(f,l);return c1.some(true);});};var b=function(f,s,t,j){var k=yc.descendants(f.element(),t.selector());return he(f,t).bind(function(l){var o=R2.findIndex(k,$.curry(d5.eq,l));return o.bind(function(m){return g(f,k,m,t,j);});});};var d=function(f,s,t,j){var n=t.cyclic()?Hc:Ic;return b(f,s,t,n);};var e=function(f,s,t,j){var n=t.cyclic()?Jc:Kc;return b(f,s,t,n);};var F3=function(j,s,t,k){return t.onEnter().bind(function(f){return f(j,s);});};var h=function(j,s,t,k){return t.onEscape().bind(function(f){return f(j,s);});};var xd=$.constant([Rc(Mc([Nc,Lc(Gc.TAB())]),d),Rc(Lc(Gc.TAB()),e),Rc(Lc(Gc.ESCAPE()),h),Rc(Mc([Qc,Lc(Gc.ENTER())]),F3)]);var yd=$.constant({});var zd=$.constant({});return od(Ra,F8,xd,yd,zd,c1.some(ge));};var qd=pd(M7('cyclic',$.constant(false)));var rd=pd(M7('cyclic',$.constant(true)));var sd=function(t){return l4.name(t)==='input'&&a9.get(t,'type')!=='radio'||l4.name(t)==='textarea';};var td=function(c,s,f){U3(c,f,F3());return c1.some(true);};var ud=function(c,s,f){return sd(f)&&Lc(Gc.SPACE())(s.event())?c1.none():td(c,s,f);};var vd=[J7('execute',ud),J7('useSpace',false),J7('useEnter',true),J7('useControlEnter',false),J7('useDown',false)];var wd=function(c,s,e,a){return e.execute()(c,s,c.element());};var xd=function(c,s,e,a){var b=e.useSpace()&&!sd(c.element())?Gc.SPACE():[];var d=e.useEnter()?Gc.ENTER():[];var f=e.useDown()?Gc.DOWN():[];var g=b.concat(d).concat(f);return[Rc(Lc(g),wd)].concat(e.useControlEnter()?[Rc(Mc([Oc,Lc(Gc.ENTER())]),wd)]:[]);};var yd=$.constant({});var zd=$.constant({});var Ad=od(vd,F8,xd,yd,zd,c1.none());var Bd=function(gh){var a=B9(c1.none());var s=function(n,c){a.set(c1.some({numRows:$.constant(n),numColumns:$.constant(c)}));};var g=function(){return a.get().map(function(d){return d.numRows();});};var b=function(){return a.get().map(function(d){return d.numColumns();});};return E8({readState:$.constant({}),setGridSize:s,getNumRows:g,getNumColumns:b});};var Cd=function(gh){return gh.state()(gh);};var Dd=Object.freeze({flatgrid:Bd,init:Cd});var Ed=function(i,a){return function(ya){return Fd(ya)==='rtl'?a:i;};};var Fd=function(ya){return ec.get(ya,'direction')==='rtl'?'rtl':'ltr';};var Gd={onDirection:Ed,getDirection:Fd};var Hd=function(m){return function(c,s,hk,j7){var Od=m(c.element());return Ld(Od,c,s,hk,j7);};};var Id=function(oe,pe){var m=Gd.onDirection(oe,pe);return Hd(m);};var Jd=function(oe,pe){var m=Gd.onDirection(pe,oe);return Hd(m);};var Kd=function(Od){return function(c,s,hk,j7){return Ld(Od,c,s,hk,j7);};};var Ld=function(Od,c,s,hk,j7){var Je=hk.focusManager().get(c).bind(function(f){return Od(c.element(),f,hk,j7);});return Je.map(function(n){hk.focusManager().set(c,n);return true;});};var Md=Kd;var Nd=Kd;var Od=Kd;var Pd=function(ya,p,h,v){var i=ec.get(ya,p);if(i===undefined)i='';var f4=i===h?v:h;var kb=$.curry(ec.set,ya,p,i);var o=$.curry(ec.set,ya,p,f4);return R8(kb,o,false);};var Qd=function(ya){return Pd(ya,'visibility','hidden','visible');};var Rd=function(ya,f4){return Pd(ya,'display','none',f4);};var Sd=function(md){return md.offsetWidth<=0&&md.offsetHeight<=0;};var Td=function(ya){var md=ya.dom();return!Sd(md);};var Ud={toggler:Qd,displayToggler:Rd,isVisible:Td};var Vd=z4.immutableBag(['index','candidates'],[]);var Wd=function(Li,p){return R2.findIndex(Li,p).map(function(i){return Vd({index:i,candidates:Li});});};var Xd=function(c,a,s){var w2=Ud.isVisible;return Yd(c,a,s,w2);};var Yd=function(c,a,s,w2){var p=$.curry(d5.eq,a);var Li=yc.descendants(c,s);var v=R2.filter(Li,Ud.isVisible);return Wd(v,p);};var Zd=function(e,t){return R2.findIndex(e,function(a){return d5.eq(t,a);});};var $d=function(m1,i,n,f){var o=Math.floor(i/n);var a=i%n;return f(o,a).bind(function(b){var c=b.row()*n+b.column();return c>=0&&c<m1.length?c1.some(m1[c]):c1.none();});};var _d=function(m1,i,n,a,d){return $d(m1,i,a,function(o,b){var c=o===n-1;var e=c?m1.length-o*a:a;var f=Tc(b,d,0,e-1);return c1.some({row:$.constant(o),column:$.constant(f)});});};var ae=function(m1,i,n,a,d){return $d(m1,i,a,function(o,b){var c=Tc(o,d,0,n-1);var e=c===n-1;var f=e?m1.length-c*a:a;var g=Uc(b,0,f-1);return c1.some({row:$.constant(c),column:$.constant(g)});});};var be=function(m1,i,n,a){return _d(m1,i,n,a,+1);};var ce=function(m1,i,n,a){return _d(m1,i,n,a,-1);};var de=function(m1,i,n,a){return ae(m1,i,n,a,-1);};var ee=function(m1,i,n,a){return ae(m1,i,n,a,+1);};var fe=[A7('selector'),J7('execute',ud),Za('onEscape'),J7('captureTab',false),db()];var ge=function(c,g,a){Fc.descendant(c.element(),g.selector()).each(function(_2){g.focusManager().set(c,_2);});};var he=function(c,g){return g.focusManager().get(c).bind(function(e){return Fc.closest(e,g.selector());});};var je=function(c,s,g,a){return he(c,g).bind(function(f){return g.execute()(c,s,f);});};var ke=function(c){return function(ya,f,g,a){return Xd(ya,f,g.selector()).bind(function(i){return c(i.candidates(),i.index(),a.getNumRows().getOr(g.initSize().numRows()),a.getNumColumns().getOr(g.initSize().numColumns()));});};};var le=function(c,s,g,a){return g.captureTab()?c1.some(true):c1.none();};var ne=function(c,s,g,a){return g.onEscape()(c,s);};var oe=ke(ce);var pe=ke(be);var qe=ke(de);var re=ke(ee);var te=$.constant([Rc(Lc(Gc.LEFT()),Id(oe,pe)),Rc(Lc(Gc.RIGHT()),Jd(oe,pe)),Rc(Lc(Gc.UP()),Md(qe)),Rc(Lc(Gc.DOWN()),Nd(re)),Rc(Mc([Nc,Lc(Gc.TAB())]),le),Rc(Mc([Qc,Lc(Gc.TAB())]),le),Rc(Lc(Gc.ESCAPE()),ne),Rc(Lc(Gc.SPACE().concat(Gc.ENTER())),je)]);var ue=$.constant({});var ve={};var we=od(fe,Bd,te,ue,ve,c1.some(ge));var xe=function(c,s,a,d){return Xd(c,a,s).bind(function(i){var b=i.index();var Li=i.candidates();var n=Tc(b,d,0,Li.length-1);return c1.from(Li[n]);});};var ye=[A7('selector'),J7('getInitial',c1.none),J7('execute',ud),J7('executeOnMove',false)];var ze=function(c,f){return f.focusManager().get(c).bind(function(e){return Fc.closest(e,f.selector());});};var Ae=function(c,s,f){return ze(c,f).bind(function(a){return f.execute()(c,s,a);});};var Be=function(c,f){f.getInitial()(c).or(Fc.descendant(c.element(),f.selector())).each(function(_2){f.focusManager().set(c,_2);});};var Ce=function(ya,f,i){return xe(ya,i.selector(),f,-1);};var De=function(ya,f,i){return xe(ya,i.selector(),f,+1);};var Ee=function(m){return function(c,s,f){return m(c,s,f).bind(function(){return f.executeOnMove()?Ae(c,s,f):c1.some(true);});};};var Fe=function(_){return[Rc(Lc(Gc.LEFT().concat(Gc.UP())),Ee(Id(Ce,De))),Rc(Lc(Gc.RIGHT().concat(Gc.DOWN())),Ee(Jd(Ce,De))),Rc(Lc(Gc.ENTER()),Ae),Rc(Lc(Gc.SPACE()),Ae)];};var Ge=$.constant({});var He=$.constant({});var Ie=od(ye,F8,Fe,Ge,He,c1.some(Be));var Je=z4.immutableBag(['rowIndex','columnIndex','cell'],[]);var Ke=function(m,r,c){return c1.from(m[r]).bind(function(a){return c1.from(a[c]).map(function(b){return Je({rowIndex:r,columnIndex:c,cell:b});});});};var Le=function(m,r,s,d){var a=m[r];var c=a.length;var n=Tc(s,d,0,c-1);return Ke(m,r,n);};var Me=function(m,c,s,d){var n=Tc(s,d,0,m.length-1);var a=m[n].length;var b=Uc(c,0,a-1);return Ke(m,n,b);};var Ne=function(m,r,s,d){var a=m[r];var c=a.length;var n=Uc(s+d,0,c-1);return Ke(m,r,n);};var Oe=function(m,c,s,d){var n=Uc(s+d,0,m.length-1);var a=m[n].length;var b=Uc(c,0,a-1);return Ke(m,n,b);};var Pe=function(m,s,a){return Le(m,s,a,+1);};var Qe=function(m,s,a){return Le(m,s,a,-1);};var Re=function(m,s,a){return Me(m,a,s,-1);};var Se=function(m,s,a){return Me(m,a,s,+1);};var Te=function(m,s,a){return Ne(m,s,a,-1);};var Ue=function(m,s,a){return Ne(m,s,a,+1);};var Ve=function(m,s,a){return Oe(m,a,s,-1);};var We=function(m,s,a){return Oe(m,a,s,+1);};var Xe=[E7('selectors',[A7('row'),A7('cell')]),J7('cycles',true),J7('previousSelector',c1.none),J7('execute',ud)];var Ye=function(c,m){var f=m.previousSelector()(c).orThunk(function(){var s=m.selectors();return Fc.descendant(c.element(),s.cell());});f.each(function(a){m.focusManager().set(c,a);});};var Ze=function(c,s,m){return X9.search(c.element()).bind(function(f){return m.execute()(c,s,f);});};var $e=function(r,m){return R2.map(r,function(a){return yc.descendants(a,m.selectors().cell());});};var _e=function(i,a){return function(ya,f,m){var b=m.cycles()?i:a;return Fc.closest(f,m.selectors().row()).bind(function(c){var d=yc.descendants(c,m.selectors().cell());return Zd(d,f).bind(function(e){var g=yc.descendants(ya,m.selectors().row());return Zd(g,c).bind(function(r){var h=$e(g,m);return b(h,r,e).map(function(n){return n.cell();});});});});};};var af=_e(Qe,Te);var bf=_e(Pe,Ue);var cf=_e(Re,Ve);var df=_e(Se,We);var ef=$.constant([Rc(Lc(Gc.LEFT()),Id(af,bf)),Rc(Lc(Gc.RIGHT()),Jd(af,bf)),Rc(Lc(Gc.UP()),Md(cf)),Rc(Lc(Gc.DOWN()),Nd(df)),Rc(Lc(Gc.SPACE().concat(Gc.ENTER())),Ze)]);var ff=$.constant({});var gf=$.constant({});var hf=od(Xe,F8,ef,ff,gf,c1.some(Ye));var jf=[A7('selector'),J7('execute',ud),J7('moveOnTab',false)];var kf=function(c,s,m){return m.focusManager().get(c).bind(function(f){return m.execute()(c,s,f);});};var lf=function(c,m,s){Fc.descendant(c.element(),m.selector()).each(function(_2){m.focusManager().set(c,_2);});};var mf=function(ya,f,i){return xe(ya,i.selector(),f,-1);};var nf=function(ya,f,i){return xe(ya,i.selector(),f,+1);};var of=function(c,s,m){return m.moveOnTab()?Od(mf)(c,s,m):c1.none();};var pf=function(c,s,m){return m.moveOnTab()?Od(nf)(c,s,m):c1.none();};var qf=$.constant([Rc(Lc(Gc.UP()),Od(mf)),Rc(Lc(Gc.DOWN()),Od(nf)),Rc(Mc([Nc,Lc(Gc.TAB())]),of),Rc(Mc([Qc,Lc(Gc.TAB())]),pf),Rc(Lc(Gc.ENTER()),kf),Rc(Lc(Gc.SPACE()),kf)]);var rf=$.constant({});var sf=$.constant({});var tf=od(jf,F8,qf,rf,sf,c1.some(lf));var uf=[Za('onSpace'),Za('onEnter'),Za('onShiftEnter'),Za('onLeft'),Za('onRight'),Za('onTab'),Za('onShiftTab'),Za('onUp'),Za('onDown'),Za('onEscape'),F7('focusIn')];var vf=function(c,s,e){return[Rc(Lc(Gc.SPACE()),e.onSpace()),Rc(Mc([Qc,Lc(Gc.ENTER())]),e.onEnter()),Rc(Mc([Nc,Lc(Gc.ENTER())]),e.onShiftEnter()),Rc(Mc([Nc,Lc(Gc.TAB())]),e.onShiftTab()),Rc(Mc([Qc,Lc(Gc.TAB())]),e.onTab()),Rc(Lc(Gc.UP()),e.onUp()),Rc(Lc(Gc.DOWN()),e.onDown()),Rc(Lc(Gc.LEFT()),e.onLeft()),Rc(Lc(Gc.RIGHT()),e.onRight()),Rc(Lc(Gc.SPACE()),e.onSpace()),Rc(Lc(Gc.ESCAPE()),e.onEscape())];};var wf=function(c,e){return e.focusIn().bind(function(f){return f(c,e);});};var xf=$.constant({});var yf=$.constant({});var zf=od(uf,F8,vf,xf,yf,c1.some(wf));var Af={acyclic:qd.schema(),cyclic:rd.schema(),flow:Ie.schema(),flatgrid:we.schema(),matrix:hf.schema(),execution:Ad.schema(),menu:tf.schema(),special:zf.schema()};var Bf=L8({branchKey:'mode',branches:Af,name:'keying',active:{events:function(k,a){var h=k.handler();return h.toEvents(k,a);}},apis:{focusIn:function(c){c.getSystem().triggerFocus(c.element(),c.element());},setGridSize:function(c,k,a,n,b){if(!H6(a,'setGridSize')){console.error('Layout does not support setGridSize');}else{a.setGridSize(n,b);}}},state:Dd});var Cf=function(d4,a){return L7(d4,{},R2.map(a,function(f){return D7(f.name(),'Cannot configure '+f.name()+' for '+d4);}).concat([M7('dump',$.identity)]));};var Df=function(cr){return cr.dump();};var Ef='placeholder';var Ff=_5.generate([{single:['required','valueThunk']},{multiple:['required','valueThunks']}]);var Gf=function(e5,d,c,p){if(e5.exists(function(o){return o!==c.owner;})){return Ff.single(true,$.constant(c));}return D6(p,c.name).fold(function(){throw new Error('Unknown placeholder component: '+c.name+'\nKnown: ['+o1.keys(p)+']\nNamespace: '+e5.getOr('none')+'\nSpec: '+N6.stringify(c,null,2));},function(n){return n.replace();});};var Hf=function(e5,d,c,p){if(c.uiType===Ef){return Gf(e5,d,c,p);}else{return Ff.single(false,$.constant(c));}};var If=function(e5,d,a,p){var z8=Hf(e5,d,a,p);return z8.fold(function(r,v){var f4=v(d,a.config,a.validated);var b=D6(f4,'components').getOr([]);var s=R2.bind(b,function(c){return If(e5,d,c,p);});return[U.deepMerge(f4,{components:s})];},function(r,v){var m1=v(d,a.config,a.validated);return m1;});};var Jf=function(e5,d,sg,p){return R2.bind(sg,function(c){return If(e5,d,c,p);});};var Kf=function(l,r){var c=false;var u=function(){return c;};var Pq=function(){if(c===true){throw new Error('Trying to use the same placeholder more than once: '+l);}c=true;return r;};var fg=function(){return r.fold(function(a,_){return a;},function(a,_){return a;});};return{name:$.constant(l),required:fg,used:u,replace:Pq};};var Lf=function(e5,d,sg,a){var b=o1.map(a,function(p,d4){return Kf(d4,p);});var Je=Jf(e5,d,sg,b);o1.each(b,function(p){if(p.used()===false&&p.required()){throw new Error('Placeholder: '+p.name()+' was not found in components list\nNamespace: '+e5.getOr('none')+'\nComponents: '+N6.stringify(d.components(),null,2));}});return Je;};var Mf=Ff.single;var Nf=Ff.multiple;var Of=$.constant(Ef);var Pf=0;var Qf=function(Bb){var d=new Date();var t=d.getTime();var r=Math.floor(Math.random()*1000000000);Pf++;return Bb+'_'+r+Pf+String(t);};var Rf={generate:Qf};var Sf=_5.generate([{required:['data']},{external:['data']},{optional:['data']},{group:['data']}]);var Tf=J7('factory',{sketch:$.identity});var Uf=J7('schema',[]);var Vf=A7('name');var Wf=k7('pname','pname',f6(function(t){return'<alloy.'+Rf.generate(t.name)+'>';}),x7());var Xf=J7('defaults',$.constant({}));var Yf=J7('overrides',$.constant({}));var Zf=e7([Tf,Uf,Vf,Wf,Xf,Yf]);var $f=e7([Tf,Uf,Vf,Xf,Yf]);var ag=e7([Tf,Uf,Vf,Wf,Xf,Yf]);var bg=e7([Tf,Uf,Vf,A7('unit'),Wf,Xf,Yf]);var cg=function(p){return p.fold(c1.some,c1.none,c1.some,c1.some);};var dg=function(p){var V8=function(cr){return cr.name();};return p.fold(V8,V8,V8,V8);};var eg=function(a,p){return function(gh){var cr=u7('Converting part type',p,gh);return a(cr);};};var fg=eg(Sf.required,Zf);var gg=eg(Sf.external,$f);var hg=eg(Sf.optional,ag);var ig=eg(Sf.group,bg);var jg=$.constant('entirety');var kg=function(d,cr,p,a){var gh=p;return U.deepMerge(cr.defaults()(d,p,a),p,{uid:d.partUids()[cr.name()]},cr.overrides()(d,p,a),{'debug.sketcher':E6('part-'+cr.name(),gh)});};var lg=function(e5,d,Jm){var i={};var e={};R2.each(Jm,function(p){p.fold(function(cr){i[cr.pname()]=Mf(true,function(d,a,b){return cr.factory().sketch(kg(d,cr,a,b));});},function(cr){var a=d.parts()[cr.name()]();e[cr.name()]=$.constant(kg(d,cr,a[jg()]()));},function(cr){i[cr.pname()]=Mf(false,function(d,a,b){return cr.factory().sketch(kg(d,cr,a,b));});},function(cr){i[cr.pname()]=Nf(true,function(d,_,a){var b=d[cr.name()]();return R2.map(b,function(u){return cr.factory().sketch(U.deepMerge(cr.defaults()(d,u),u,cr.overrides()(d,u)));});});});});return{internals:$.constant(i),externals:$.constant(e)};};var mg=function(e5,Jm){var r={};R2.each(Jm,function(p){cg(p).each(function(n){var g=ng(e5,n.pname());r[n.name()]=function(hk){var v=t7('Part: '+n.name()+' in '+e5,e7(n.schema()),hk);return U.deepMerge(g,{config:hk,validated:v});};});});return r;};var ng=function(e5,p){return{uiType:Of(),owner:e5,name:p};};var og=function(e5,p,hk){return{uiType:Of(),owner:e5,name:p,config:hk,validated:{}};};var pg=function(Jm){return R2.bind(Jm,function(p){return p.fold(c1.none,c1.some,c1.none,c1.none).map(function(cr){return E7(cr.name(),cr.schema().concat([bb(jg())]));}).toArray();});};var qg=function(Jm){return R2.map(Jm,dg);};var rg=function(e5,d,Jm){return lg(e5,d,Jm);};var sg=function(e5,d,i){return Lf(c1.some(e5),d,d.components(),i);};var tg=function(c,d,p){var u=d.partUids()[p];return c.getSystem().getByUid(u).toOption();};var ug=function(c,d,p){return tg(c,d,p).getOrDie('Could not find part: '+p);};var vg=function(c,d){var s=c.getSystem();return o1.map(d.partUids(),function(p,k){return $.constant(s.getByUid(p));});};var wg=function(b,p){var a=qg(p);return F6(R2.map(a,function(c){return{key:c,value:b+'-'+c};}));};var xg=function(p){return k7('partUids','partUids',h6(function(gh){return wg(gh.uid,p);}),x7());};var yg=Rf.generate('alloy-premade');var zg=Rf.generate('api');var Ag=function(c){return E6(yg,c);};var Bg=function(gh){return D6(gh,yg);};var Cg=function(f){return k8(function(c){var a=Array.prototype.slice.call(arguments,0);var s=c.config(zg);return f.apply(undefined,[s].concat(a));},f);};var Dg=$.constant(zg);var Eg=$.constant('alloy-id-');var Fg=$.constant('data-alloy-id');var Gg=Eg();var Hg=Fg();var Ig=function(l,e){var i=Rf.generate(Gg+l);a9.set(e,Hg,i);return i;};var Jg=function(e,u){a9.set(e,Hg,u);};var Kg=function(e){var i=l4.isElement(e)?a9.get(e,Hg):null;return c1.from(i);};var Lg=function(Bb){return Rf.generate(Bb);};var Mg=$.constant(Hg);var Ng=function(l,p,a,gh){var b=p.length>0?[E7('parts',p)]:[];return b.concat([A7('uid'),J7('dom',{}),J7('components',[]),bb('originalSpec'),J7('debug.sketcher',{})]).concat(a);};var Og=function(l,Ra,gh,p,a){var b=Ng(l,p,a,gh);return u7(l+' [SpecSchema]',d7(b.concat(Ra)),gh);};var Pg=function(e5,Ra,Xg,gh){var s=Rg(gh);var d=Og(e5,Ra,s,[],[]);return U.deepMerge(Xg(d,s),{'debug.sketcher':E6(e5,gh)});};var Qg=function(e5,Ra,p,Xg,gh){var s=Rg(gh);var a=pg(p);var b=xg(p);var d=Og(e5,Ra,s,a,[b]);var lg=rg(e5,d,p);var c=sg(e5,d,lg.internals());return U.deepMerge(Xg(d,c,s,lg.externals()),{'debug.sketcher':E6(e5,gh)});};var Rg=function(gh){return U.deepMerge({uid:Lg('uid')},gh);};function Sg(gh){return gh.uid!==undefined;}var Tg=d7([A7('name'),A7('factory'),A7('configFields'),J7('apis',{}),J7('extraApis',{})]);var Ug=d7([A7('name'),A7('factory'),A7('configFields'),A7('partFields'),J7('apis',{}),J7('extraApis',{})]);var Vg=function(r){var hk=t7('Sketcher for '+r.name,Tg,r);var s=function(gh){return Pg(hk.name,hk.configFields,hk.factory,gh);};var a=o1.map(hk.apis,Cg);var e=o1.map(hk.extraApis,function(f,k){return j8(f,k);});return U.deepMerge({name:$.constant(hk.name),partFields:$.constant([]),configFields:$.constant(hk.configFields),sketch:s},a,e);};var Wg=function(r){var hk=t7('Sketcher for '+r.name,Ug,r);var s=function(gh){return Qg(hk.name,hk.configFields,hk.partFields,hk.factory,gh);};var Jm=mg(hk.name,hk.partFields);var a=o1.map(hk.apis,Cg);var e=o1.map(hk.extraApis,function(f,k){return j8(f,k);});return U.deepMerge({name:$.constant(hk.name),partFields:$.constant(hk.partFields),configFields:$.constant(hk.configFields),sketch:s,parts:$.constant(Jm)},a,e);};var Xg=function(d,gh){var Aa=Eb(d.action());var o=D6(d.dom(),'attributes').bind(B6('type'));var a=D6(d.dom(),'tag');return{uid:d.uid(),dom:d.dom(),components:d.components(),events:Aa,behaviours:U.deepMerge(H8([Nb.config({}),Bf.config({mode:'execution',useSpace:true,useEnter:true})]),Df(d.buttonBehaviours())),domModification:{attributes:U.deepMerge(o.fold(function(){return a.is('button')?{type:'button'}:{};},function(t){return{};}),{role:d.role().getOr('button')})},eventOrder:d.eventOrder()};};var Yg=Vg({name:'Button',factory:Xg,configFields:[J7('uid',undefined),A7('dom'),J7('components',[]),Cf('buttonBehaviours',[Nb,Bf]),F7('action'),F7('role'),J7('eventOrder',{})]});var Zg=function(z8,u){return p8({styles:{'-webkit-user-select':'none','user-select':'none','-ms-user-select':'none','-moz-user-select':'-moz-none'},attributes:{unselectable:'on'}});};var $g=function(u){return T7([U7(G1(),$.constant(true))]);};var _g=Object.freeze({events:$g,exhibit:Zg});var ah=J8({fields:[],name:'unselecting',active:_g});var bh=function(e){var a=e.dom().attributes!==undefined?e.dom().attributes:[];return R2.foldl(a,function(b,wr){if(wr.name==='class'){return b;}else{return U.deepMerge(b,E6(wr.name,wr.value));}},{});};var dh=function(e){return Array.prototype.slice.call(e.dom().classList,0);};var eh=function(h){var e=b4.fromHtml(h);var q5=y5.children(e);var a=bh(e);var c=dh(e);var _m=q5.length===0?{}:{innerHtml:pa.get(e)};return U.deepMerge({tag:l4.name(e),classes:c,attributes:a},_m);};var fh=function(r){var h=r3.supplant(r,{prefix:Db.prefix()});return eh(h);};var gh=function(r){var d=fh(r);return{dom:d};};var hh=function(e,c){return lh(c,function(){e.execCommand(c);},{});};var ih=function(c){return H8([wb.config({toggleClass:Db.resolve('toolbar-button-selected'),toggleOnExecute:false,aria:{mode:'pressed'}}),Ab.format(c,function(zi,s){var j9=s?wb.on:wb.off;j9(zi);})]);};var jh=function(e,c){var a=ih(c);return lh(c,function(){e.execCommand(c);},a);};var kh=function(e,c,a,b){var d=ih(a);return lh(c,b,d);};var lh=function(c,a,e){return Yg.sketch({dom:fh('<span class="${prefix}-toolbar-button ${prefix}-icon-'+c+' ${prefix}-icon"></span>'),action:a,buttonBehaviours:U.deepMerge(H8([ah.config({})]),e)});};var mh={forToolbar:lh,forToolbarCommand:hh,forToolbarStateAction:kh,forToolbarStateCommand:jh};var nh=function(f4,m,a,F4){if(f4<m){return f4;}else if(f4>a){return a;}else if(f4===m){return m-1;}else{return Math.max(m,f4-F4);}};var oh=function(f4,m,a,F4){if(f4>a){return f4;}else if(f4<m){return m;}else if(f4===a){return a+1;}else{return Math.min(a,f4+F4);}};var qh=function(f4,m,a){return Math.max(m,Math.min(a,f4));};var rh=function(b,f4,m,a,F4,s){return s.fold(function(){var i=f4-m;var e=Math.round(i/F4)*F4;return qh(m+e,m-1,a+1);},function(c){var d=(f4-c)%F4;var e=Math.round(d/F4);var f=Math.floor((f4-c)/F4);var g=Math.floor((a-c)/F4);var n=Math.min(g,f+e);var r=c+n*F4;return Math.max(c,r);});};var sh=function(b,m,a,x,F4,s,c){var q2=a-m;if(x<b.left){return m-1;}else if(x>b.right){return a+1;}else{var d=Math.min(b.right,Math.max(x,b.left))-b.left;var n=qh(d/b.width*q2+m,m-1,a+1);var r=Math.round(n);return s&&n>=m&&n<=a?rh(b,n,m,a,F4,c):r;}};var th='slider.change.value';var uh=A3.detect().deviceType.isTouch();var vh=function(s){var e=s.event().raw();if(uh&&e.touches!==undefined&&e.touches.length===1){return c1.some(e.touches[0]);}else if(uh&&e.touches!==undefined){return c1.none();}else if(!uh&&e.clientX!==undefined){return c1.some(e);}else{return c1.none();}};var wh=function(a){var w5=vh(a);return w5.map(function(s){return s.clientX;});};var xh=function(c,f4){S3(c,th,{value:f4});};var yh=function(r,d){xh(r,d.max()+1);};var zh=function(l,d){xh(l,d.min()-1);};var Ah=function(s,a,d,x){var f4=sh(a,d.min(),d.max(),x,d.stepSize(),d.snapToGrid(),d.snapStart());xh(s,f4);};var Bh=function(s,d,a,b){return wh(b).map(function(x){Ah(s,a,d,x);return x;});};var Ch=function(s,d){var n=nh(d.value().get(),d.min(),d.max(),d.stepSize());xh(s,n);};var Dh=function(s,d){var n=oh(d.value().get(),d.min(),d.max(),d.stepSize());xh(s,n);};var Eh=$.constant(th);var Fh=A3.detect();var Gh=Fh.deviceType.isTouch();var Hh=function(d4,a){return hg({name:''+d4+'-edge',overrides:function(d){var t=T7([X7(q1(),a,[d])]);var m=T7([X7(u1(),a,[d]),X7(v1(),function(l,b){if(b.mouseIsDown().get()){a(l,b);}},[d])]);return{events:Gh?t:m};}});};var Ih=Hh('left',zh);var Jh=Hh('right',yh);var Kh=fg({name:'thumb',defaults:$.constant({dom:{styles:{position:'absolute'}}}),overrides:function(d){return{events:T7([_7(q1(),d,'spectrum'),_7(r1(),d,'spectrum'),_7(s1(),d,'spectrum')])};}});var Lh=fg({schema:[M7('mouseIsDown',function(){return B9(false);})],name:'spectrum',overrides:function(d){var m=function(s,b){var c=s.element().dom().getBoundingClientRect();Bh(s,d,c,b);};var t=T7([W7(q1(),m),W7(r1(),m)]);var a=T7([W7(u1(),m),W7(v1(),function(s,b){if(d.mouseIsDown().get()){m(s,b);}})]);return{behaviours:H8(Gh?[]:[Bf.config({mode:'special',onLeft:function(s){Ch(s,d);return c1.some(true);},onRight:function(s){Dh(s,d);return c1.some(true);}}),Nb.config({})]),events:Gh?t:a};}});var Mh=[Ih,Jh,Kh,Lh];var Nh=function(c,r,a){r.store().manager().onLoad(c,r,a);};var Oh=function(c,r,a){r.store().manager().onUnload(c,r,a);};var Ph=function(c,r,a,cr){r.store().manager().setValue(c,r,a,cr);};var Qh=function(c,r,a){return r.store().manager().getValue(c,r,a);};var Rh=Object.freeze({onLoad:Nh,onUnload:Oh,setValue:Ph,getValue:Qh});var Sh=function(r,a){var e=r.resetOnDom()?[d8(function(c,s){Nh(c,r,a);}),e8(function(c,s){Oh(c,r,a);})]:[t8(r,a,Nh)];return T7(e);};var Th=Object.freeze({events:Sh});var Uh=function(){var cr=B9(null);var r=function(){return{mode:'memory',value:cr.get()};};var i=function(){return cr.get()===null;};var v9=function(){cr.set(null);};return E8({set:cr.set,get:cr.get,isNotSet:i,clear:v9,readState:r});};var Vh=function(){var r=function(){};return E8({readState:r});};var Wh=function(){var cr=B9({});var r=function(){return{mode:'dataset',dataset:cr.get()};};return E8({readState:r,set:cr.set,get:cr.get});};var Xh=function(gh){return gh.store().manager().state(gh);};var Yh=Object.freeze({memory:Uh,dataset:Wh,manual:Vh,init:Xh});var Zh=function(c,r,a,cr){var d=r.store().getDataKey();a.set({});r.store().setData()(c,cr);r.onSetValue()(c,cr);};var $h=function(c,r,a){var k=r.store().getDataKey()(c);var d=a.get();return D6(d,k).fold(function(){return r.store().getFallbackEntry()(k);},function(cr){return cr;});};var _h=function(c,r,a){r.store().initialValue().each(function(cr){Zh(c,r,a,cr);});};var ai=function(c,r,a){a.set({});};var bi=[F7('initialValue'),A7('getFallbackEntry'),A7('getDataKey'),A7('setData'),ab('manager',{setValue:Zh,getValue:$h,onLoad:_h,onUnload:ai,state:Wh})];var ci=function(c,r,a){return r.store().getValue()(c);};var di=function(c,r,a,cr){r.store().setValue()(c,cr);r.onSetValue()(c,cr);};var ei=function(c,r,a){r.store().initialValue().each(function(cr){r.store().setValue()(c,cr);});};var fi=[A7('getValue'),J7('setValue',$.noop),F7('initialValue'),ab('manager',{setValue:di,getValue:ci,onLoad:ei,onUnload:$.noop,state:F8})];var gi=function(c,r,a,cr){a.set(cr);r.onSetValue()(c,cr);};var hi=function(c,r,a){return a.get();};var ii=function(c,r,a){r.store().initialValue().each(function(i){if(a.isNotSet()){a.set(i);}});};var ji=function(c,r,a){a.clear();};var ki=[F7('initialValue'),ab('manager',{setValue:gi,getValue:hi,onLoad:ii,onUnload:ji,state:Uh})];var li=[K7('store',{mode:'memory'},w7('mode',{memory:ki,manual:fi,dataset:bi})),Ya('onSetValue'),J7('resetOnDom',false)];var mi=J8({fields:li,name:'representing',active:Th,apis:Rh,extra:{setValueFrom:function(c,s){var f4=mi.getValue(s);mi.setValue(c,f4);}},state:Yh});var ni=A3.detect().deviceType.isTouch();var oi=[A7('min'),A7('max'),J7('stepSize',1),J7('onChange',$.noop),J7('onInit',$.noop),J7('onDragStart',$.noop),J7('onDragEnd',$.noop),J7('snapToGrid',false),F7('snapStart'),A7('getInitialValue'),Cf('sliderBehaviours',[Bf,mi]),M7('value',function(gh){return B9(gh.min);})].concat(!ni?[M7('mouseIsDown',function(){return B9(false);})]:[]);var pi=fc('width',function(ya){return ya.dom().offsetWidth;});var qi=function(ya,h){pi.set(ya,h);};var ri=function(ya){return pi.get(ya);};var si=function(ya){return pi.getOuter(ya);};var ti=function(ya,f4){var i=['margin-left','border-left-width','padding-left','padding-right','border-right-width','margin-right'];var a=pi.max(ya,f4,i);ec.set(ya,'max-width',a+'px');};var vi={set:qi,get:ri,getOuter:si,setMax:ti};var wi=A3.detect().deviceType.isTouch();var xi=function(d,c,gh,e){var q2=d.max()-d.min();var g=function(j){var k=j.element().dom().getBoundingClientRect();return(k.left+k.right)/2;};var a=function(j){return ug(j,d,'thumb');};var b=function(s,j,d){var v=d.value().get();if(v<d.min()){return tg(s,d,'left-edge').fold(function(){return 0;},function(l){return g(l)-j.left;});}else if(v>d.max()){return tg(s,d,'right-edge').fold(function(){return j.width;},function(k){return g(k)-j.left;});}else{return(d.value().get()-d.min())/q2*j.width;}};var f=function(s){var j=ug(s,d,'spectrum');var k=j.element().dom().getBoundingClientRect();var l=s.element().dom().getBoundingClientRect();var x=b(s,k,d);return k.left-l.left+x;};var Dt=function(j){var p=f(j);var t=a(j);var k=vi.get(t.element())/2;ec.set(t.element(),'left',p-k+'px');};var h=function(j,n){var o=d.value().get();var t=a(j);if(o!==n||ec.getRaw(t.element(),'left').isNone()){d.value().set(n);Dt(j);d.onChange()(j,t,n);return c1.some(true);}else{return c1.none();}};var r=function(s){h(s,d.min());};var i=function(s){h(s,d.max());};var u=wi?[W7(q1(),function(s,j){d.onDragStart()(s,a(s));}),W7(s1(),function(s,j){d.onDragEnd()(s,a(s));})]:[W7(u1(),function(s,j){j.stop();d.onDragStart()(s,a(s));d.mouseIsDown().set(true);}),W7(x1(),function(s,j){d.onDragEnd()(s,a(s));d.mouseIsDown().set(false);})];return{uid:d.uid(),dom:d.dom(),components:c,behaviours:U.deepMerge(H8(R2.flatten([!wi?[Bf.config({mode:'special',focusIn:function(s){return tg(s,d,'spectrum').map(Bf.focusIn).map($.constant(true));}})]:[],[mi.config({store:{mode:'manual',getValue:function(_){return d.value().get();}}})]])),Df(d.sliderBehaviours())),events:T7([W7(Eh(),function(s,j){h(s,j.event().value());}),d8(function(s,j){d.value().set(d.getInitialValue()());var t=a(s);Dt(s);d.onInit()(s,t,d.value().get());})].concat(u)),apis:{resetToMin:r,resetToMax:i,refresh:Dt},domModification:{styles:{position:'relative'}}};};var yi=Wg({name:'Slider',configFields:oi,partFields:Mh,factory:xi,apis:{resetToMin:function(a,s){a.resetToMin(s);},resetToMax:function(a,s){a.resetToMax(s);},refresh:function(a,s){a.refresh(s);}}});var zi=function(r,c,Ci){return mh.forToolbar(c,function(){var i=Ci();r.setContextToolbar([{label:c+' group',items:i}]);},{});};var Ai=-1;var Bi=function(s){var g=function(h){if(h<0){return'black';}else if(h>360){return'white';}else{return'hsl('+h+', 100%, 50%)';}};var o=function(a,t,f4){var c=g(f4);ec.set(t.element(),'background-color',c);};var xo=function(a,t,f4){var c=g(f4);ec.set(t.element(),'background-color',c);s.onChange(a,t,c);};return yi.sketch({dom:fh('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[yi.parts()['left-edge'](gh('<div class="${prefix}-hue-slider-black"></div>')),yi.parts().spectrum({dom:fh('<div class="${prefix}-slider-gradient-container"></div>'),components:[gh('<div class="${prefix}-slider-gradient"></div>')],behaviours:H8([wb.config({toggleClass:Db.resolve('thumb-active')})])}),yi.parts()['right-edge'](gh('<div class="${prefix}-hue-slider-white"></div>')),yi.parts().thumb({dom:fh('<div class="${prefix}-slider-thumb"></div>'),behaviours:H8([wb.config({toggleClass:Db.resolve('thumb-active')})])})],onChange:xo,onDragStart:function(a,t){wb.on(t);},onDragEnd:function(a,t){wb.off(t);},onInit:o,stepSize:10,min:0,max:360,getInitialValue:s.getInitialValue,sliderBehaviours:H8([Ab.orientation(yi.refresh)])});};var Ci=function(s){return[Bi(s)];};var Di=function(r,e){var s={onChange:function(a,t,c){e.undoManager.transact(function(){e.formatter.apply('forecolor',{value:c});e.nodeChanged();});},getInitialValue:function(){return Ai;}};return zi(r,'color',function(){return Ci(s);});};var Ei={makeItems:Ci,sketch:Di};var Fi=d7([A7('getInitialValue'),A7('onChange'),A7('category'),A7('sizes')]);var Gi=function(r){var s=t7('SizeSlider',Fi,r);var Zb=function(v){return v>=0&&v<s.sizes.length;};var xo=function(a,t,v){if(Zb(v)){s.onChange(v);}};return yi.sketch({dom:{tag:'div',classes:[Db.resolve('slider-'+s.category+'-size-container'),Db.resolve('slider'),Db.resolve('slider-size-container')]},onChange:xo,onDragStart:function(a,t){wb.on(t);},onDragEnd:function(a,t){wb.off(t);},min:0,max:s.sizes.length-1,stepSize:1,getInitialValue:s.getInitialValue,snapToGrid:true,sliderBehaviours:H8([Ab.orientation(yi.refresh)]),components:[yi.parts().spectrum({dom:fh('<div class="${prefix}-slider-size-container"></div>'),components:[gh('<div class="${prefix}-slider-size-line"></div>')]}),yi.parts().thumb({dom:fh('<div class="${prefix}-slider-thumb"></div>'),behaviours:H8([wb.config({toggleClass:Db.resolve('thumb-active')})])})]});};var Hi={sketch:Gi};var Ii=function(s,t,i){var ya=s.dom();var a=O.isFunction(i)?i:$.constant(false);while(ya.parentNode){ya=ya.parentNode;var e=b4.fromDom(ya);var b=t(e);if(b.isSome())return b;else if(a(e))break;}return c1.none();};var Ji=function(s,t,i){var c=t(s);return c.orThunk(function(){return i(s)?c1.none():Ii(s,t,i);});};var Ki={ancestor:Ii,closest:Ji};var Li=['9px','10px','11px','12px','14px','16px','18px','20px','24px','32px','36px'];var Mi='medium';var Ni=2;var Oi=function(i){return c1.from(Li[i]);};var Pi=function(n1){return R2.findIndex(Li,function(v){return v===n1;});};var Qi=function(i,r){var o=l4.isElement(r)?c1.some(r):y5.parent(r);return o.map(function(s){var a=Ki.closest(s,function(e){return ec.getRaw(e,'font-size');},i);return a.getOrThunk(function(){return ec.get(s,'font-size');});}).getOr('');};var Ri=function(a){var M4=a.selection.getStart();var b=b4.fromDom(M4);var r=b4.fromDom(a.getBody());var i=function(e){return d5.eq(r,e);};var c=Qi(i,b);return R2.find(Li,function(n1){return c===n1;}).getOr(Mi);};var Si=function(e,f4){var c=Ri(e);if(c!==f4){e.execCommand('fontSize',false,f4);}};var Ti=function(e){var n1=Ri(e);return Pi(n1).getOr(Ni);};var Ui=function(e,i){Oi(i).each(function(n1){Si(e,n1);});};var Vi={candidates:$.constant(Li),get:Ti,apply:Ui};var Wi=Vi.candidates();var Xi=function(s){return Hi.sketch({onChange:s.onChange,sizes:Wi,category:'font',getInitialValue:s.getInitialValue});};var Yi=function(s){return[gh('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),Xi(s),gh('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];};var Zi=function(r,e){var s={onChange:function(f4){Vi.apply(e,f4);},getInitialValue:function(){return Vi.get(e);}};return zi(r,'font-size',function(){return Yi(s);});};var $i=function(gh){var u=Sg(gh)&&H6(gh,'uid')?gh.uid:Lg('memento');var V8=function(Q7){return Q7.getSystem().getByUid(u).getOrDie();};var g=function(Q7){return Q7.getSystem().getByUid(u).fold(c1.none,c1.some);};var a=function(){return U.deepMerge(gh,{uid:u});};return{get:V8,getOpt:g,asSpec:a};};function aj(w,h){return ej(document.createElement('canvas'),w,h);}function bj(c){var t,a;t=aj(c.width,c.height);a=cj(t);a.drawImage(c,0,0);return t;}function cj(c){return c.getContext('2d');}function dj(c){var g=null;try{g=c.getContext('webgl')||c.getContext('experimental-webgl');}catch(e){}if(!g){g=null;}return g;}function ej(c,w,h){c.width=w;c.height=h;return c;}var fj={create:aj,clone:bj,resize:ej,get2dContext:cj,get3dContext:dj};function gj(i){return i.naturalWidth||i.width;}function hj(i){return i.naturalHeight||i.height;}var ij={getWidth:gj,getHeight:hj};var jj=function(){var kj=function(e){if(typeof this!=='object')throw new TypeError('Promises must be constructed via new');if(typeof e!=='function')throw new TypeError('not a function');this._state=null;this._value=null;this._deferreds=[];d(e,F2(E4,this),F2(r,this));};var a=kj.immediateFn||typeof setImmediate==='function'&&setImmediate||function(e){setTimeout(e,1);};function F2(e,t){return function(){e.apply(t,arguments);};}var b=Array.isArray||function(f4){return Object.prototype.toString.call(f4)==='[object Array]';};function io(g){var m=this;if(this._state===null){this._deferreds.push(g);return;}a(function(){var h=m._state?g.onFulfilled:g.onRejected;if(h===null){(m._state?g.resolve:g.reject)(m._value);return;}var i;try{i=h(m._value);}catch(e){g.reject(e);return;}g.resolve(i);});}function E4(n){try{if(n===this)throw new TypeError('A promise cannot be resolved with itself.');if(n&&(typeof n==='object'||typeof n==='function')){var t=n.then;if(typeof t==='function'){d(F2(t,n),F2(E4,this),F2(r,this));return;}}this._state=true;this._value=n;f.call(this);}catch(e){r.call(this,e);}}function r(n){this._state=false;this._value=n;f.call(this);}function f(){for(var i=0,l=this._deferreds.length;i<l;i++){io.call(this,this._deferreds[i]);}this._deferreds=null;}function c(o,e,E4,r){this.onFulfilled=typeof o==='function'?o:null;this.onRejected=typeof e==='function'?e:null;this.resolve=E4;this.reject=r;}function d(e,o,g){var h=false;try{e(function(f4){if(h)return;h=true;o(f4);},function(j){if(h)return;h=true;g(j);});}catch(i){if(h)return;h=true;g(i);}}kj.prototype['catch']=function(o){return this.then(null,o);};kj.prototype.then=function(o,e){var m=this;return new kj(function(E4,r){io.call(m,new c(o,e,E4,r));});};kj.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&b(arguments[0])?arguments[0]:arguments);return new kj(function(E4,r){if(e.length===0)return E4([]);var g=e.length;function h(i,v){try{if(v&&(typeof v==='object'||typeof v==='function')){var t=v.then;if(typeof t==='function'){t.call(v,function(v){h(i,v);},r);return;}}e[i]=v;if(--g===0){E4(e);}}catch(j){r(j);}}for(var i=0;i<e.length;i++){h(i,e[i]);}});};kj.resolve=function(f4){if(f4&&typeof f4==='object'&&f4.constructor===kj){return f4;}return new kj(function(E4){E4(f4);});};kj.reject=function(f4){return new kj(function(E4,r){r(f4);});};kj.race=function(m1){return new kj(function(E4,r){for(var i=0,l=m1.length;i<l;i++){m1[i].then(E4,r);}});};return kj;};var kj=window.Promise?window.Promise:jj();function lj(Jm,p){var f=L4.getOrDie('Blob');return new f(Jm,p);}function mj(){var f=L4.getOrDie('FileReader');return new f();}function nj(a){var f=L4.getOrDie('Uint8Array');return new f(a);}var oj=function(c){var f=L4.getOrDie('requestAnimationFrame');f(c);};var pj=function(b){var f=L4.getOrDie('atob');return f(b);};var qj={atob:pj,requestAnimationFrame:oj};function rj(i){var s=i.src;if(s.indexOf('data:')===0){return vj(s);}return tj(s);}function sj(b){return new kj(function(E4,r){var a=URL.createObjectURL(b);var i=new Image();var c=function(){i.removeEventListener('load',l);i.removeEventListener('error',Y5);};function l(){c();E4(i);}function Y5(){c();r('Unable to load data of type '+b.type+': '+a);}i.addEventListener('load',l);i.addEventListener('error',Y5);i.src=a;if(i.complete){l();}});}function tj(u){return new kj(function(E4,r){var x=new XMLHttpRequest();x.open('GET',u,true);x.responseType='blob';x.onload=function(){if(this.status==200){E4(this.response);}};x.onerror=function(){var _=this;var c=function(){var o=new Error('No access to download image');o.code=18;o.name='SecurityError';return o;};var g=function(){return new Error('Error '+_.status+' downloading image');};r(this.status===0?c():g());};x.send();});}function uj(u){var cr=u.split(',');var m=/data:([^;]+)/.exec(cr[0]);if(!m)return c1.none();var a=m[1];var b=cr[1];var s=1024;var c=qj.atob(b);var d=c.length;var e=Math.ceil(d/s);var f=new Array(e);for(var g=0;g<e;++g){var h=g*s;var j=Math.min(h+s,d);var k=new Array(j-h);for(var o=h,i=0;o<j;++i,++o){k[i]=c[o].charCodeAt(0);}f[g]=nj(k);}return c1.some(lj(f,{type:a}));}function vj(u){return new kj(function(E4,r){uj(u).fold(function(){r('uri is not base64: '+u);},E4);});}function wj(u){if(u.indexOf('blob:')===0){return tj(u);}if(u.indexOf('data:')===0){return vj(u);}return null;}function xj(c,e4,a){e4=e4||'image/png';if(HTMLCanvasElement.prototype.toBlob){return new kj(function(E4){c.toBlob(function(b){E4(b);},e4,a);});}else{return vj(c.toDataURL(e4,a));}}function yj(g,e4,a){e4=e4||'image/png';return g.then(function(c){return c.toDataURL(e4,a);});}function zj(b){return sj(b).then(function(i){Dj(i);var c,a;a=fj.create(ij.getWidth(i),ij.getHeight(i));c=fj.get2dContext(a);c.drawImage(i,0,0);return a;});}function Aj(b){return new kj(function(E4){var r=new mj();r.onloadend=function(){E4(r.result);};r.readAsDataURL(b);});}function Bj(b){return new kj(function(E4){var r=new mj();r.onloadend=function(){E4(r.result);};r.readAsArrayBuffer(b);});}function Cj(b){return Aj(b).then(function(d){return d.split(',')[1];});}function Dj(i){URL.revokeObjectURL(i.src);}var Ej={blobToImage:sj,imageToBlob:rj,blobToArrayBuffer:Bj,blobToDataUri:Aj,blobToBase64:Cj,dataUriToBlobSync:uj,canvasToBlob:xj,canvasToDataURL:yj,blobToCanvas:zj,uriToBlob:wj};var Fj=function(i){return Ej.blobToImage(i);};var Gj=function(b){return Ej.imageToBlob(b);};var Hj=function(b){return Ej.blobToDataUri(b);};var Ij=function(b){return Ej.blobToBase64(b);};var Jj=function(u){return Ej.dataUriToBlobSync(u);};var Kj=function(u){return c1.from(Ej.uriToBlob(u));};var Lj={blobToImage:Fj,imageToBlob:Gj,blobToDataUri:Hj,blobToBase64:Ij,dataUriToBlobSync:Jj,uriToBlob:Kj};var Mj=function(e,b){Lj.blobToBase64(b).then(function(a){e.undoManager.transact(function(){var c=e.editorUpload.blobCache;var i=c.create(Rf.generate('mceu'),b,a);c.add(i);var d=e.dom.createHTML('img',{src:i.blobUri()});e.insertContent(d);});});};var Nj=function(s){var e=s.event();var f=e.raw().target.files||e.raw().dataTransfer.files;return c1.from(f[0]);};var Oj=function(e){var p={tag:'input',attributes:{accept:'image/*',type:'file',title:''},styles:{visibility:'hidden',position:'absolute'}};var m=$i({dom:p,events:T7([b8(E1()),W7(C1(),function(a,s){Nj(s).each(function(b){Mj(e,b);});})])});return Yg.sketch({dom:fh('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[m.asSpec()],action:function(zi){var a=m.get(zi);a.element().dom().click();}});};var Pj=function(ya){return ya.dom().textContent;};var Qj=function(ya,f4){ya.dom().textContent=f4;};var Rj={get:Pj,set:Qj};var Sj=function(v){return v.length>0;};var Tj=function(s){return s===undefined||s===null?'':s;};var Uj=function(e){var um=e.selection.getContent({format:'text'});return{url:'',text:um,title:'',target:'',link:c1.none()};};var Vj=function(l){var um=Rj.get(l);var u=a9.get(l,'href');var t=a9.get(l,'title');var a=a9.get(l,'target');return{url:Tj(u),text:um!==u?Tj(um):'',title:Tj(t),target:Tj(a),link:c1.some(l)};};var Wj=function(e){return ak(e).fold(function(){return Uj(e);},function(l){return Vj(l);});};var Xj=function(l){var p=a9.get(l,'href');var a=Rj.get(l);return p===a;};var Yj=function(l,u,i){return i.text.filter(Sj).fold(function(){return Xj(l)?c1.some(u):c1.none();},c1.some);};var Zj=function(e,i){var a=i.link.bind($.identity);a.each(function(l){e.execCommand('unlink');});};var $j=function(u,i){var a={};a.href=u;i.title.filter(Sj).each(function(t){a.title=t;});i.target.filter(Sj).each(function(t){a.target=t;});return a;};var _j=function(e,i){i.url.filter(Sj).fold(function(){Zj(e,i);},function(u){var a=$j(u,i);var b=i.link.bind($.identity);b.fold(function(){var um=i.text.filter(Sj).getOr(u);e.insertContent(e.dom.createHTML('a',a,e.dom.encode(um)));},function(l){var um=Yj(l,u,i);a9.setAll(l,a);um.each(function(n){Rj.set(l,n);});});});};var ak=function(e){var s=b4.fromDom(e.selection.getStart());return Fc.closest(s,'a');};var bk={getInfo:Wj,applyInfo:_j,query:ak};var ck=A3.detect();var dk=function(f,e){var r=e.selection.getRng();f();e.selection.setRng(r);};var ek=function(e,f){var w=ck.os.isAndroid()?dk:$.apply;w(f,e);};var fk={forAndroid:ek};var gk=function(d4,e){var Aa=T7(e);return J8({fields:[A7('enabled')],name:d4,active:{events:$.constant(Aa)}});};var hk=function(d4,e){var m=gk(d4,e);return{key:d4,value:{config:{},me:m,configAsRaw:$.constant({}),initialConfig:{},state:Q8()}};};var ik=function(c,a,b){return a.find()(c);};var jk=Object.freeze({getCurrent:ik});var kk=[A7('find')];var lk=J8({fields:kk,name:'composing',apis:jk});var mk=function(d,gh){return{uid:d.uid(),dom:U.deepMerge({tag:'div',attributes:{role:'presentation'}},d.dom()),components:d.components(),behaviours:Df(d.containerBehaviours()),events:d.events(),domModification:d.domModification(),eventOrder:d.eventOrder()};};var nk=Vg({name:'Container',factory:mk,configFields:[J7('components',[]),Cf('containerBehaviours',[]),J7('events',{}),J7('domModification',{}),J7('eventOrder',{})]});var ok=function(d,gh){return{uid:d.uid(),dom:d.dom(),behaviours:U.deepMerge(H8([mi.config({store:{mode:'memory',initialValue:d.getInitialValue()()}}),lk.config({find:c1.some})]),Df(d.dataBehaviours())),events:T7([d8(function(c,s){mi.setValue(c,d.getInitialValue()());})])};};var pk=Vg({name:'DataField',factory:ok,configFields:[A7('uid'),A7('dom'),A7('getInitialValue'),Cf('dataBehaviours',[mi,lk])]});var qk=function(ya){return ya.dom().value;};var rk=function(ya,f4){if(f4===undefined)throw new Error('Value.set was undefined');ya.dom().value=f4;};var sk={set:rk,get:qk};var tk=$.constant([F7('data'),J7('inputAttributes',{}),J7('inputStyles',{}),J7('type','input'),J7('tag','input'),J7('inputClasses',[]),Ya('onSetValue'),J7('styles',{}),F7('placeholder'),J7('eventOrder',{}),Cf('inputBehaviours',[mi,Nb]),J7('selectOnFocus',true)]);var uk=function(d){return U.deepMerge(H8([mi.config({store:{mode:'manual',initialValue:d.data().getOr(undefined),getValue:function(B1){return sk.get(B1.element());},setValue:function(B1,cr){var c=sk.get(B1.element());if(c!==cr){sk.set(B1.element(),cr);}}},onSetValue:d.onSetValue()}),Nb.config({onFocus:d.selectOnFocus()===false?$.noop:function(c){var B1=c.element();var f4=sk.get(B1);B1.dom().setSelectionRange(0,f4.length);}})]),Df(d.inputBehaviours()));};var wk=function(d){return{tag:d.tag(),attributes:U.deepMerge(F6([{key:'type',value:d.type()}].concat(d.placeholder().map(function(p){return{key:'placeholder',value:p};}).toArray())),d.inputAttributes()),styles:d.inputStyles(),classes:d.inputClasses()};};var xk=function(d,gh){return{uid:d.uid(),dom:wk(d),components:[],behaviours:uk(d),eventOrder:d.eventOrder()};};var yk=Vg({name:'Input',configFields:tk(),factory:xk});var zk=function(z8,t){return p8({attributes:F6([{key:t.tabAttr(),value:'true'}])});};var Ak=Object.freeze({exhibit:zk});var Bk=[J7('tabAttr','data-alloy-tabstop')];var Ck=J8({fields:Bk,name:'tabstopping',active:Ak});var Dk='input-clearing';var Ek=function(d4,Of){var i=$i(yk.sketch({placeholder:Of,onSetValue:function(a,cr){R3(a,B1());},inputBehaviours:H8([lk.config({find:c1.some}),Ck.config({}),Bf.config({mode:'execution'})]),selectOnFocus:false}));var b=$i(Yg.sketch({dom:fh('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(zi){var a=i.get(zi);mi.setValue(a,'');}}));return{name:d4,spec:nk.sketch({dom:fh('<div class="${prefix}-input-container"></div>'),components:[i.asSpec(),b.asSpec()],containerBehaviours:H8([wb.config({toggleClass:Db.resolve('input-container-empty')}),lk.config({find:function(c){return c1.some(i.get(c));}}),hk(Dk,[W7(B1(),function(c){var a=i.get(c);var v=mi.getValue(a);var f=v.length>0?wb.off:wb.on;f(c);})])])})};};var Fk=function(d4){return{name:d4,spec:pk.sketch({dom:{tag:'span',styles:{display:'none'}},getInitialValue:function(){return c1.none();}})};};var Gk=['input','button','textarea'];var Hk=function(c,d,a){if(d.disabled()){Pk(c,d,a);}};var Ik=function(c){return R2.contains(Gk,l4.name(c.element()));};var Jk=function(c){return a9.has(c.element(),'disabled');};var Kk=function(c){a9.set(c.element(),'disabled','disabled');};var Lk=function(c){a9.remove(c.element(),'disabled');};var Mk=function(c){return a9.get(c.element(),'aria-disabled')==='true';};var Nk=function(c){a9.set(c.element(),'aria-disabled','true');};var Ok=function(c){a9.set(c.element(),'aria-disabled','false');};var Pk=function(c,d,a){d.disableClass().each(function(b){r9.add(c.element(),b);});var f=Ik(c)?Kk:Nk;f(c);};var Qk=function(c,d,a){d.disableClass().each(function(b){r9.remove(c.element(),b);});var f=Ik(c)?Lk:Ok;f(c);};var Rk=function(c){return Ik(c)?Jk(c):Mk(c);};var Sk=Object.freeze({enable:Qk,disable:Pk,isDisabled:Rk,onLoad:Hk});var Tk=function(z8,d,a){return p8({classes:d.disabled()?d.disableClass().map(R2.pure).getOr([]):[]});};var Uk=function(d,a){return T7([U7(F3(),function(c,s){return Rk(c);}),t8(d,a,Hk)]);};var Vk=Object.freeze({exhibit:Tk,events:Uk});var Wk=[J7('disabled',false),F7('disableClass')];var Xk=J8({fields:Wk,name:'disabling',active:Vk,apis:Sk});var Yk='form';var Zk=[Cf('formBehaviours',[mi])];var $k=function(d4){return'<alloy.field.'+d4+'>';};var _k=function(s){var Jm=function(){var $i=[];var k7=function(d4,hk){$i.push(d4);return og(Yk,$k(d4),hk);};return{field:k7,record:function(){return $i;}};}();var gh=s(Jm);var p=Jm.record();var f=R2.map(p,function(n){return fg({name:n,pname:$k(n)});});return Qg(Yk,Zk,f,al,gh);};var al=function(d,c,gh){return U.deepMerge({'debug.sketcher':{Form:gh},'uid':d.uid(),'dom':d.dom(),'components':c,'behaviours':U.deepMerge(H8([mi.config({store:{mode:'manual',getValue:function(f){var o=vg(f,d);return o1.map(o,function(a,p){return a().bind(lk.getCurrent).map(mi.getValue);});},setValue:function(f,m1){o1.each(m1,function(n,k){tg(f,d,k).each(function(w){lk.getCurrent(w).each(function(k7){mi.setValue(k7,n);});});});}}})]),Df(d.formBehaviours())),'apis':{getField:function(f,k){return tg(f,d,k).bind(lk.getCurrent);}}});};var bl={getField:Cg(function(a,c,k){return a.getField(c,k);}),sketch:_k};var cl=function(d){var a=B9(c1.none());var M8=function(){a.get().each(d);};var v9=function(){M8();a.set(c1.none());};var T8=function(s){M8();a.set(c1.some(s));};var i=function(){return a.get().isSome();};return{clear:v9,isSet:i,set:T8};};var dl=function(){return cl(function(s){s.destroy();});};var fl=function(){return cl(function(s){s.unbind();});};var hl=function(){var a=B9(c1.none());var M8=function(){a.get().each(function(s){s.destroy();});};var v9=function(){M8();a.set(c1.none());};var T8=function(s){M8();a.set(c1.some(s));};var W7=function(f){a.get().each(f);};var i=function(){return a.get().isSome();};return{clear:v9,isSet:i,set:T8,run:W7};};var il=function(){var a=B9(c1.none());var v9=function(){a.set(c1.none());};var T8=function(s){a.set(c1.some(s));};var o=function(f){a.get().each(f);};var i=function(){return a.get().isSome();};return{clear:v9,set:T8,isSet:i,on:o};};var jl={destroyable:dl,unbindable:fl,api:hl,value:il};var kl=1;var ll=-1;var ml=0;var nl=function(x){return{xValue:x,points:[]};};var ol=function(m,x){if(x===m.xValue){return m;}var c=x-m.xValue>0?kl:ll;var n={direction:c,xValue:x};var p=function(){if(m.points.length===0){return[];}else{var a=m.points[m.points.length-1];return a.direction===c?m.points.slice(0,m.points.length-1):m.points;}}();return{xValue:x,points:p.concat([n])};};var pl=function(m){if(m.points.length===0){return ml;}else{var f=m.points[0].direction;var l=m.points[m.points.length-1].direction;return f===ll&&l===ll?ll:f===kl&&l===kl?kl:ml;}};var ql={init:nl,move:ol,complete:pl};var rl=function(r){var n='navigateEvent';var a='serializer-wrapper-events';var f='form-events';var Ra=e7([A7('fields'),J7('maxFieldIndex',r.fields.length-1),A7('onExecute'),A7('getInitialValue'),M7('state',function(){return{dialogSwipeState:jl.value(),currentScreen:B9(0)};})]);var s=t7('SerialisedDialog',Ra,r);var b=function(i,j,k){return Yg.sketch({dom:fh('<span class="${prefix}-icon-'+j+' ${prefix}-icon"></span>'),action:function(zi){S3(zi,n,{direction:i});},buttonBehaviours:H8([Xk.config({disableClass:Db.resolve('toolbar-navigation-disabled'),disabled:!k})])});};var c=function(i,j){Fc.descendant(i.element(),'.'+Db.resolve('serialised-dialog-chain')).each(function(h5){ec.set(h5,'left',-s.state.currentScreen.get()*j.width+'px');});};var d=function(i,j){var k=yc.descendants(i.element(),'.'+Db.resolve('serialised-dialog-screen'));Fc.descendant(i.element(),'.'+Db.resolve('serialised-dialog-chain')).each(function(h5){if(s.state.currentScreen.get()+j>=0&&s.state.currentScreen.get()+j<k.length){ec.getRaw(h5,'left').each(function(l){var o=parseInt(l,10);var w=vi.get(k[0]);ec.set(h5,'left',o-j*w+'px');});s.state.currentScreen.set(s.state.currentScreen.get()+j);}});};var e=function(i){var j=yc.descendants(i.element(),'input');var o=c1.from(j[s.state.currentScreen.get()]);o.each(function(l){i.getSystem().getByDom(l).each(function(p){X3(i,p.element());});});var k=h.get(i);ld.highlightAt(k,s.state.currentScreen.get());};var g=function(){s.state.currentScreen.set(0);s.state.dialogSwipeState.clear();};var m=$i(bl.sketch(function(Jm){return{dom:fh('<div class="${prefix}-serialised-dialog"></div>'),components:[nk.sketch({dom:fh('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:R2.map(s.fields,function(j,i){return i<=s.maxFieldIndex?nk.sketch({dom:fh('<div class="${prefix}-serialised-dialog-screen"></div>'),components:R2.flatten([[b(-1,'previous',i>0)],[Jm.field(j.name,j.spec)],[b(+1,'next',i<s.maxFieldIndex)]])}):Jm.field(j.name,j.spec);})})],formBehaviours:H8([Ab.orientation(function(i,j){c(i,j);}),Bf.config({mode:'special',focusIn:function(i){e(i);},onTab:function(i){d(i,+1);return c1.some(true);},onShiftTab:function(i){d(i,-1);return c1.some(true);}}),hk(f,[d8(function(i,j){g();var k=h.get(i);ld.highlightFirst(k);s.getInitialValue(i).each(function(v){mi.setValue(i,v);});}),g8(s.onExecute),W7(F1(),function(i,j){if(j.event().raw().propertyName==='left'){e(i);}}),W7(n,function(i,j){var k=j.event().direction();d(i,k);})])])};}));var h=$i({dom:fh('<div class="${prefix}-dot-container"></div>'),behaviours:H8([ld.config({highlightClass:Db.resolve('dot-active'),itemClass:Db.resolve('dot-item')})]),components:R2.bind(s.fields,function(_,i){return i<=s.maxFieldIndex?[gh('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[];})});return{dom:fh('<div class="${prefix}-serializer-wrapper"></div>'),components:[m.asSpec(),h.asSpec()],behaviours:H8([Bf.config({mode:'special',focusIn:function(w){var i=m.get(w);Bf.focusIn(i);}}),hk(a,[W7(q1(),function(w,i){s.state.dialogSwipeState.set(ql.init(i.event().raw().touches[0].clientX));}),W7(r1(),function(w,i){s.state.dialogSwipeState.on(function(j7){i.event().prevent();s.state.dialogSwipeState.set(ql.move(j7,i.event().raw().touches[0].clientX));});}),W7(s1(),function(w){s.state.dialogSwipeState.on(function(j7){var i=m.get(w);var j=-1*ql.complete(j7);d(i,j);});})])])};};var sl=I1.cached(function(r,e){return[{label:'the link group',items:[rl({fields:[Ek('url','Type or paste URL'),Ek('text','Link text'),Ek('title','Link title'),Ek('target','Link target'),Fk('link')],maxFieldIndex:['url','text','title','target'].length-1,getInitialValue:function(){return c1.some(bk.getInfo(e));},onExecute:function(d){var i=mi.getValue(d);bk.applyInfo(e,i);r.restoreToolbar();e.focus();}})]}];});var tl=function(r,e){return mh.forToolbarStateAction(e,'link','link',function(){var g=sl(r,e);r.setContextToolbar(g);fk.forAndroid(e,function(){r.focusToolbar();});bk.query(e).each(function(l){e.selection.select(l.dom());});});};var ul=[{title:'Headings',items:[{title:'Heading 1',format:'h1'},{title:'Heading 2',format:'h2'},{title:'Heading 3',format:'h3'},{title:'Heading 4',format:'h4'},{title:'Heading 5',format:'h5'},{title:'Heading 6',format:'h6'}]},{title:'Inline',items:[{title:'Bold',icon:'bold',format:'bold'},{title:'Italic',icon:'italic',format:'italic'},{title:'Underline',icon:'underline',format:'underline'},{title:'Strikethrough',icon:'strikethrough',format:'strikethrough'},{title:'Superscript',icon:'superscript',format:'superscript'},{title:'Subscript',icon:'subscript',format:'subscript'},{title:'Code',icon:'code',format:'code'}]},{title:'Blocks',items:[{title:'Paragraph',format:'p'},{title:'Blockquote',format:'blockquote'},{title:'Div',format:'div'},{title:'Pre',format:'pre'}]},{title:'Alignment',items:[{title:'Left',icon:'alignleft',format:'alignleft'},{title:'Center',icon:'aligncenter',format:'aligncenter'},{title:'Right',icon:'alignright',format:'alignright'},{title:'Justify',icon:'alignjustify',format:'alignjustify'}]}];var vl=function(c,o,t){return d5.eq(o,c.element())&&!d5.eq(o,t);};var wl={events:T7([V7(C3(),function(c,s){var o=s.event().originator();var t=s.event().target();if(vl(c,o,t)){console.warn(C3()+' did not get interpreted by the desired target. '+'\nOriginator: '+ya(o)+'\nTarget: '+ya(t)+'\nCheck the '+C3()+' event handlers');return false;}else{return true;}})])};var xl=$.identity;var yl=D8.exactly(['debugInfo','triggerFocus','triggerEvent','triggerEscape','addToWorld','removeFromWorld','addToGui','removeFromGui','build','getByUid','getByDom','broadcast','broadcastOn','isConnected']);var zl=function(g){var f=function(e){return function(){throw new Error('The component must be in a context to send: '+e+'\n'+ya(g().element())+' is not in context.');};};return yl({debugInfo:$.constant('fake'),triggerEvent:f('triggerEvent'),triggerFocus:f('triggerFocus'),triggerEscape:f('triggerEscape'),build:f('build'),addToWorld:f('addToWorld'),removeFromWorld:f('removeFromWorld'),addToGui:f('addToGui'),removeFromGui:f('removeFromGui'),getByUid:f('getByUid'),getByDom:f('getByDom'),broadcast:f('broadcast'),broadcastOn:f('broadcastOn'),isConnected:$.constant(false)});};var Al=function(gh,V4){var Ra=R2.map(V4,function(a){return k7(a.name(),a.name(),e6(),e7([A7('config'),J7('state',G8)]));});var v=q7('component.behaviours',e7(Ra),gh.behaviours).fold(function(e){throw new Error(v7(e)+'\nComplete spec:\n'+N6.stringify(gh,null,2));},$.identity);return{list:V4,data:o1.map(v,function(b){var a=b();return $.constant(a.map(function(c){return{config:c.config(),state:c.state().init(c.config())};}));})};};var Bl=function(d){return d.list;};var Cl=function(d){return d.data;};var Dl={generateFrom:Al,getBehaviours:Bl,getData:Cl};var El=function(cr,t){var r={};o1.each(cr,function(d,k){o1.each(d,function(f4,i){var c=C6(i,[])(r);r[i]=c.concat([t(k,f4)]);});});return r;};var Fl=function(d4,m){return{name:$.constant(d4),modification:m};};var Gl=function(a,b){var m1=R2.bind(a,function(c){return c.modification().getOr([]);});return Z5.value(E6(b,m1));};var Hl=function(c,a,o){if(c.length>1){return Z5.error('Multiple behaviours have tried to change DOM "'+a+'". The guilty behaviours are: '+N6.stringify(R2.map(c,function(b){return b.name();}))+'. At this stage, this '+'is not supported. Future releases might provide strategies for resolving this.');}else if(c.length===0){return Z5.value({});}else{return Z5.value(c[0].modification().fold(function(){return{};},function(m){return E6(a,m);}));}};var Il=function(a,k,o,uk){return Z5.error('Mulitple behaviours have tried to change the _'+k+'_ "'+a+'"'+'. The guilty behaviours are: '+N6.stringify(R2.bind(uk,function(b){return b.modification().getOr({})[k]!==undefined?[b.name()]:[];}),null,2)+'. This is not currently supported.');};var Jl=function(a,b){var y=R2.foldl(a,function(d,c){var o=c.modification().getOr({});return d.bind(function(e){var Jm=o1.mapToArray(o,function(v,k){return e[k]!==undefined?Il(b,k,o,a):Z5.value(E6(k,v));});return G6(Jm,e);});},Z5.value({}));return y.map(function(c){return E6(b,c);});};var Kl={classes:Gl,attributes:Jl,styles:Jl,domChildren:Hl,defChildren:Hl,innerHtml:Hl,value:Hl};var Ll=function(i,b,uk,z8){var a=U.deepMerge({},b);R2.each(uk,function(e){a[e.name()]=e.exhibit(i,z8);});var c=El(a,Fl);var u=o1.map(c,function(m1,e){return R2.bind(m1,function(f4){return f4.modification().fold(function(){return[];},function(v){return[f4];});});});var m=o1.mapToArray(u,function(m1,e){return D6(Kl,e).fold(function(){return Z5.error('Unknown field type: '+e);},function(f){return f(m1,e);});});var d=G6(m,{});return d.map(p8);};var Ml=function(l,k,c,o){var s=c.slice(0);try{var d=s.sort(function(a,b){var f=a[k]();var g=b[k]();var i=o.indexOf(f);var h=o.indexOf(g);if(i===-1){throw new Error('The ordering for '+l+' does not have an entry for '+f+'.\nOrder specified: '+N6.stringify(o,null,2));}if(h===-1){throw new Error('The ordering for '+l+' does not have an entry for '+g+'.\nOrder specified: '+N6.stringify(o,null,2));}if(i<h){return-1;}else if(h<i){return 1;}else{return 0;}});return Z5.value(d);}catch(e){return Z5.error([e]);}};var Nl={sortKeys:Ml};var Ol=function(h,p){return{handler:h,purpose:$.constant(p)};};var Pl=function(d,e){return{handler:$.curry.apply(undefined,[d.handler].concat(e)),purpose:d.purpose};};var Ql=function(d){return d.handler;};var Rl=function(d4,h){return{name:$.constant(d4),handler:$.constant(h)};};var Sl=function(uk,i){var r={};R2.each(uk,function(b){r[b.name()]=b.handlers(i);});return r;};var Tl=function(i,uk,z8){var b=U.deepMerge(z8,Sl(uk,i));return El(b,Rl);};var Ul=function(i,e,uk,z8){var b=Tl(i,uk,z8);return Yl(b,e);};var Vl=function(r){var h=R7(r);return function(c,s){var a=Array.prototype.slice.call(arguments,0);if(h.abort.apply(undefined,a)){s.stop();}else if(h.can.apply(undefined,a)){h.run.apply(undefined,a);}};};var Wl=function(e,t){return Z5.error(['The event ('+e+') has more than one behaviour that listens to it.\nWhen this occurs, you must '+'specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that '+'can trigger it are: '+N6.stringify(R2.map(t,function(c){return c.name();}),null,2)]);};var Xl=function(t,e,a){var o=e[a];if(!o){return Wl(a,t);}else{return Nl.sortKeys('Event: '+a,'name',t,o).map(function(s){var h=R2.map(s,function(b){return b.handler();});return S7(h);});}};var Yl=function(b,e){var r=o1.mapToArray(b,function(a,c){var d=a.length===1?Z5.value(a[0].handler()):Xl(a,e,c);return d.map(function(h){var f=Vl(h);var p=a.length>1?R2.filter(e,function(o){return R2.contains(a,function(t){return t.name()===o;});}).join(' > '):a[0].name();return E6(c,Ol(f,p));});});return G6(r,{});};var Zl=function(gh){return q7('custom.definition',d7([k7('dom','dom',d6(),d7([A7('tag'),J7('styles',{}),J7('classes',[]),J7('attributes',{}),F7('value'),F7('innerHtml')])),A7('components'),A7('uid'),J7('events',{}),J7('apis',$.constant({})),k7('eventOrder','eventOrder',c6({'alloy.execute':['disabling','alloy.base.behaviour','toggling'],'alloy.focus':['alloy.base.behaviour','focusing','keying'],'alloy.system.init':['alloy.base.behaviour','disabling','toggling','representing'],'input':['alloy.base.behaviour','representing','streaming','invalidating'],'alloy.system.detached':['alloy.base.behaviour','representing']}),x7()),F7('domModification'),bb('originalSpec'),J7('debug.sketcher','unknown')]),gh);};var $l=function(i){return E6(Fg(),i.uid());};var _l=function(i){var z8={tag:i.dom().tag(),classes:i.dom().classes(),attributes:U.deepMerge($l(i),i.dom().attributes()),styles:i.dom().styles(),domChildren:R2.map(i.components(),function(c){return c.element();})};return l8(U.deepMerge(z8,i.dom().innerHtml().map(function(h){return E6('innerHtml',h);}).getOr({}),i.dom().value().map(function(h){return E6('value',h);}).getOr({})));};var am=function(i){return i.domModification().fold(function(){return p8({});},p8);};var bm=function(i){return i.events();};var cm=function(ya,c){R2.each(c,function(x){r9.add(ya,x);});};var dm=function(ya,c){R2.each(c,function(x){r9.remove(ya,x);});};var em=function(ya,c){R2.each(c,function(x){r9.toggle(ya,x);});};var fm=function(ya,c){return R2.forall(c,function(a){return r9.has(ya,a);});};var gm=function(ya,c){return R2.exists(c,function(a){return r9.has(ya,a);});};var hm=function(ya){var c=ya.dom().classList;var r=new Array(c.length);for(var i=0;i<c.length;i++){r[i]=c.item(i);}return r;};var im=function(ya){return k9.supports(ya)?hm(ya):k9.get(ya);};var jm={add:cm,remove:dm,toggle:em,hasAll:fm,hasAny:gm,get:im};var km=function(d){if(d.domChildren().isSome()&&d.defChildren().isSome()){throw new Error('Cannot specify children and child specs! Must be one or the other.\nDef: '+m8(d));}else{return d.domChildren().fold(function(){var a=d.defChildren().getOr([]);return R2.map(a,mm);},function(a){return a;});}};var lm=function(d){var s=b4.fromTag(d.tag());a9.setAll(s,d.attributes().getOr({}));jm.add(s,d.classes().getOr([]));ec.setAll(s,d.styles().getOr({}));pa.set(s,d.innerHtml().getOr(''));var q5=km(d);K5.append(s,q5);d.value().each(function(f4){sk.set(s,f4);});return s;};var mm=function(gh){var d=l8(gh);return lm(d);};var nm=function(gh){var uk=D6(gh,'behaviours').getOr({});var f1=R2.filter(o1.keys(uk),function(k){return uk[k]!==undefined;});return R2.map(f1,function(k){return gh.behaviours[k].me;});};var om=function(gh,V4){return Dl.generateFrom(gh,V4);};var pm=function(gh){var V4=nm(gh);return om(gh,V4);};var qm=D8.exactly(['getSystem','config','hasConfigured','spec','connect','disconnect','element','syncComponents','readState','components','events']);var rm=function(gh){var g=function(){return w;};var s=B9(zl(g));var i=s7(Zl(U.deepMerge(gh,{behaviours:undefined})));var a=pm(gh);var l=Dl.getBehaviours(a);var d=Dl.getData(a);var e=_l(i);var h={'alloy.base.modification':am(i)};var m=Ll(d,h,l,e).getOrDie();var j=r8(e,m);var k=lm(j);var n={'alloy.base.behaviour':bm(i)};var Aa=Ul(d,i.eventOrder(),l,n).getOrDie();var o=B9(i.components());var p=function(b){s.set(b);};var r=function(){s.set(zl(g));};var t=function(){var q5=y5.children(k);var lg=R2.bind(q5,function(r5){return s.get().getByDom(r5).fold(function(){return[];},function(c){return[c];});});o.set(lg);};var hk=function(c){if(c===Dg()){return i.apis();}var b=d;var f=O.isFunction(b[c.name()])?b[c.name()]:function(){throw new Error('Could not find '+c.name()+' in '+N6.stringify(gh,null,2));};return f();};var u=function(b){return O.isFunction(d[b.name()]);};var v=function(c){return d[c]().map(function(b){return b.state.readState();}).getOr('not enabled');};var w=qm({getSystem:s.get,config:hk,hasConfigured:u,spec:$.constant(gh),readState:v,connect:p,disconnect:r,element:$.constant(k),syncComponents:t,components:o.get,events:$.constant(Aa)});return w;};var sm=function(gh){var sg=C6('components',[])(gh);return R2.map(sg,wm);};var tm=function(u){var gh=xl(u);var sg=sm(gh);var c=U.deepMerge(wl,gh,E6('components',sg));return Z5.value(rm(c));};var um=function(t){var ya=b4.fromText(t);return vm({element:ya});};var vm=function(gh){var e=u7('external.component',d7([A7('element'),F7('uid')]),gh);var s=B9(zl());var c=function(n){s.set(n);};var d=function(){s.set(zl(function(){return m;}));};e.uid().each(function(u){Jg(e.element(),u);});var m=qm({getSystem:s.get,config:c1.none,hasConfigured:$.constant(false),connect:c,disconnect:d,element:$.constant(e.element()),spec:$.constant(gh),readState:$.constant('No state'),syncComponents:$.noop,components:$.constant([]),events:$.constant({})});return Ag(m);};var wm=function(r){return Bg(r).fold(function(){var u=U.deepMerge({uid:Lg('')},r);return tm(u).getOrDie();},function(p){return p;});};var xm=Ag;var ym='alloy.item-hover';var zm='alloy.item-focus';var Am=function(i){if(X9.search(i.element()).isNone()||Nb.isFocused(i)){if(!Nb.isFocused(i)){Nb.focus(i);}S3(i,ym,{item:i});}};var Bm=function(i){S3(i,zm,{item:i});};var Cm=$.constant(ym);var Dm=$.constant(zm);var Em=function(i){return{dom:U.deepMerge(i.dom(),{attributes:{role:i.toggling().isSome()?'menuitemcheckbox':'menuitem'}}),behaviours:U.deepMerge(H8([i.toggling().fold(wb.revoke,function(t){return wb.config(U.deepMerge({aria:{mode:'checked'}},t));}),Nb.config({ignore:i.ignoreFocus(),onFocus:function(c){Bm(c);}}),Bf.config({mode:'execution'}),mi.config({store:{mode:'memory',initialValue:i.data()}})]),i.itemBehaviours()),events:T7([a8(I3(),T3),b8(u1()),W7(y1(),Am),W7(G3(),Nb.focus)]),components:i.components(),domModification:i.domModification(),eventOrder:i.eventOrder()};};var Fm=[A7('data'),A7('components'),A7('dom'),F7('toggling'),J7('itemBehaviours',{}),J7('ignoreFocus',false),J7('domModification',{}),ab('builder',Em),J7('eventOrder',{})];var Gm=function(d){return{dom:d.dom(),components:d.components(),events:T7([c8(G3())])};};var Hm=[A7('dom'),A7('components'),ab('builder',Gm)];var Im=$.constant('item-widget');var Jm=$.constant([fg({name:'widget',overrides:function(d){return{behaviours:H8([mi.config({store:{mode:'manual',getValue:function(c){return d.data();},setValue:function(){}}})])};}})]);var Km=function(i){var lg=rg(Im(),i,Jm());var c=sg(Im(),i,lg.internals());var f=function(a){return tg(a,i,'widget').map(function(w){Bf.focusIn(w);return w;});};var o=function(a,s){return sd(s.event().target())?c1.none():function(){if(i.autofocus()){s.setSource(a.element());return c1.none();}else{return c1.none();}}();};return U.deepMerge({dom:i.dom(),components:c,domModification:i.domModification(),events:T7([g8(function(a,s){f(a).each(function(w){s.stop();});}),W7(y1(),Am),W7(G3(),function(a,s){if(i.autofocus()){f(a);}else{Nb.focus(a);}})]),behaviours:H8([mi.config({store:{mode:'memory',initialValue:i.data()}}),Nb.config({onFocus:function(a){Bm(a);}}),Bf.config({mode:'special',focusIn:i.autofocus()?function(a){f(a);}:M8(),onLeft:o,onRight:o,onEscape:function(a,s){if(!Nb.isFocused(a)&&!i.autofocus()){Nb.focus(a);return c1.some(true);}else if(i.autofocus()){s.setSource(a.element());return c1.none();}else{return c1.none();}}})])});};var Lm=[A7('uid'),A7('data'),A7('components'),A7('dom'),J7('autofocus',false),J7('domModification',{}),xg(Jm()),ab('builder',Km)];var Mm=w7('type',{widget:Lm,item:Fm,separator:Hm});var Nm=function(d,m){return{mode:'flatgrid',selector:'.'+d.markers().item(),initSize:{numColumns:m.initSize().numColumns(),numRows:m.initSize().numRows()},focusManager:d.focusManager()};};var Om=function(d,m){return{mode:'menu',selector:'.'+d.markers().item(),moveOnTab:m.moveOnTab(),focusManager:d.focusManager()};};var Pm=$.constant([ig({factory:{sketch:function(gh){var i=u7('menu.spec item',Mm,gh);return i.builder()(i);}},name:'items',unit:'item',defaults:function(d,u){var f=Lg('');return U.deepMerge({uid:f},u);},overrides:function(d,u){return{type:u.type,ignoreFocus:d.fakeFocus(),domModification:{classes:[d.markers().item()]}};}})]);var Qm=$.constant([A7('value'),A7('items'),A7('dom'),A7('components'),J7('eventOrder',{}),Cf('menuBehaviours',[ld,mi,lk,Bf]),K7('movement',{mode:'menu',moveOnTab:true},w7('mode',{grid:[db(),ab('config',Nm)],menu:[J7('moveOnTab',true),ab('config',Om)]})),Ua(),J7('fakeFocus',false),J7('focusManager',md()),Ya('onHighlight')]);var Rm=$.constant('menu');var Sm=$.constant('alloy.menu-focus');var Tm=function(d,sg,gh,e){return U.deepMerge({dom:U.deepMerge(d.dom(),{attributes:{role:'menu'}}),uid:d.uid(),behaviours:U.deepMerge(H8([ld.config({highlightClass:d.markers().selectedItem(),itemClass:d.markers().item(),onHighlight:d.onHighlight()}),mi.config({store:{mode:'memory',initialValue:d.value()}}),lk.config({find:$.identity}),Bf.config(d.movement().config()(d,d.movement()))]),Df(d.menuBehaviours())),events:T7([W7(Dm(),function(m,s){var a=s.event();m.getSystem().getByDom(a.target()).each(function(i){ld.highlight(m,i);s.stop();S3(m,Sm(),{menu:m,item:i});});}),W7(Cm(),function(m,s){var i=s.event().item();ld.highlight(m,i);})]),components:sg,eventOrder:d.eventOrder()});};var Um=Wg({name:'Menu',configFields:Qm(),partFields:Pm(),factory:Tm});var Vm=function(f,c){var o=y5.owner(c);var r=X9.active(o).bind(function(b){var T9=function(e){return d5.eq(b,e);};return T9(c)?c1.some(c):J9.descendant(c,T9);});var a=f(c);r.each(function(b){X9.active(o).filter(function(n){return d5.eq(n,b);}).orThunk(function(){X9.focus(b);});});return a;};var Wm=function(c,r,a,cr){V5(c);Vm(function(){var q5=R2.map(cr,c.getSystem().build);R2.each(q5,function(l){R5(c,l);});},c.element());};var Xm=function(c,r,i,a){var r5=c.getSystem().build(a);S5(c,r5,i);};var Ym=function(c,r,a,b){Xm(c,r,F5.append,b);};var Zm=function(c,r,a,p){Xm(c,r,F5.prepend,p);};var $m=function(c,r,a,b){var q5=_m(c,r);var f=R2.find(q5,function(r5){return d5.eq(b.element(),r5.element());});f.each(U5);};var _m=function(c,r){return c.components();};var an=Object.freeze({append:Ym,prepend:Zm,remove:$m,set:Wm,contents:_m});var bn=J8({fields:[],name:'replacing',apis:an});var cn=function(o){return o1.tupleMap(o,function(v,k){return{k:v,v:k};});};var dn=function(i,b,a,f){return D6(a,f).bind(function(t){return D6(i,t).bind(function(c){var r=dn(i,b,a,c);return c1.some([c].concat(r));});}).getOr([]);};var en=function(m,e){var i={};o1.each(m,function(d,f){R2.each(d,function(g){i[g]=f;});});var b=e;var a=cn(e);var c=o1.map(a,function(t,s){return[s].concat(dn(i,b,a,s));});return o1.map(i,function(D4){return D6(c,D4).getOr([D4]);});};function gn(){var e=B9({});var m=B9({});var p=B9({});var a=B9(c1.none());var t=B9($.constant([]));var v9=function(){e.set({});m.set({});p.set({});a.set(c1.none());};var i=function(){return a.get().isNone();};var s=function(d,f,h,j){a.set(c1.some(d));e.set(h);m.set(f);t.set(j);var k=j(f);var n=en(k,h);p.set(n);};var Un=function(d){return D6(e.get(),d).map(function(f){var h=D6(p.get(),d).getOr([]);return[f].concat(h);});};var c=function(d){return D6(p.get(),d).bind(function(D4){return D4.length>1?c1.some(D4.slice(1)):c1.none();});};var Dt=function(d){return D6(p.get(),d);};var l=function(d){return D6(m.get(),d);};var o=function(D4){var d=t.get()(m.get());return R2.difference(o1.keys(d),D4);};var g=function(){return a.get().bind(l);};var b=function(){return m.get();};return{setContents:s,expand:Un,refresh:Dt,collapse:c,lookupMenu:l,otherMenus:o,getPrimary:g,getMenus:b,clear:v9,isClear:i};}var hn=function(d,a){var b=function(f,o){return o1.map(o,function(gh,d4){var cr=Um.sketch(U.deepMerge(gh,{value:d4,items:gh.items,markers:z6(a.markers,['item','selectedItem']),fakeFocus:d.fakeFocus(),onHighlight:d.onHighlight(),focusManager:d.fakeFocus()?nd():md()}));return f.getSystem().build(cr);});};var j7=gn();var co=function(f){var o=b(f,d.data().menus());j7.setContents(d.data().primary(),o,d.data().expansions(),function(p){return t(f,p);});return j7.getPrimary();};var g=function(f){return mi.getValue(f).value;};var t=function(f,o){return o1.map(d.data().menus(),function(cr,p){return R2.bind(cr.items,function(r){return r.type==='separator'?[]:[r.data.value];});});};var s=function(f,o){ld.highlight(f,o);ld.getHighlighted(o).orThunk(function(){return ld.getFirst(o);}).each(function(p){U3(f,p.element(),G3());});};var c=function(j7,f){return Fa.cat(R2.map(f,j7.lookupMenu));};var u=function(f,j7,D4){return c1.from(D4[0]).bind(j7.lookupMenu).map(function(p){var v=c(j7,D4.slice(1));R2.each(v,function(r){r9.add(r.element(),d.markers().backgroundMenu());});if(!p4.inBody(p.element())){bn.append(f,xm(p));}jm.remove(p.element(),[d.markers().backgroundMenu()]);s(f,p);var w=c(j7,j7.otherMenus(D4));R2.each(w,function(o){jm.remove(o.element(),[d.markers().backgroundMenu()]);if(!d.stayInDom()){bn.remove(f,o);}});return p;});};var e=function(f,o){var f4=g(o);return j7.expand(f4).bind(function(D4){c1.from(D4[0]).bind(j7.lookupMenu).each(function(p){if(!p4.inBody(p.element())){bn.append(f,xm(p));}d.onOpenSubmenu()(f,o,p);ld.highlightFirst(p);});return u(f,j7,D4);});};var h=function(f,o){var f4=g(o);return j7.collapse(f4).bind(function(D4){return u(f,j7,D4).map(function(p){d.onCollapseMenu()(f,o,p);return p;});});};var i=function(f,o){var f4=g(o);return j7.refresh(f4).bind(function(D4){return u(f,j7,D4);});};var j=function(f,o){return sd(o.element())?c1.none():e(f,o);};var k=function(f,o){return sd(o.element())?c1.none():h(f,o);};var l=function(f,o){return h(f,o).orThunk(function(){return d.onEscape()(f,o);});};var m=function(f){return function(o,p){return Fc.closest(p.getSource(),'.'+d.markers().item()).bind(function(r){return o.getSystem().getByDom(r).bind(function(v){return f(o,v);});});};};var Aa=T7([W7(Sm(),function(f,o){var p=o.event().menu();ld.highlight(f,p);}),g8(function(f,o){var p=o.event().target();return f.getSystem().getByDom(p).bind(function(r){var v=g(r);if(v.indexOf('collapse-item')===0){return h(f,r);}return e(f,r).orThunk(function(){return d.onExecute()(f,r);});});}),d8(function(f,o){co(f).each(function(p){bn.append(f,xm(p));if(d.openImmediately()){s(f,p);d.onOpenMenu()(f,p);}});})].concat(d.navigateOnHover()?[W7(Cm(),function(f,o){var p=o.event().item();i(f,p);e(f,p);d.onHover()(f,p);})]:[]));var n=function(f){ld.getHighlighted(f).each(function(o){ld.getHighlighted(o).each(function(p){h(f,p);});});};return{uid:d.uid(),dom:d.dom(),behaviours:U.deepMerge(H8([Bf.config({mode:'special',onRight:m(j),onLeft:m(k),onEscape:m(l),focusIn:function(f,o){j7.getPrimary().each(function(p){U3(f,p.element(),G3());});}}),ld.config({highlightClass:d.markers().selectedMenu(),itemClass:d.markers().menu()}),lk.config({find:function(f){return ld.getHighlighted(f);}}),bn.config({})]),Df(d.tmenuBehaviours())),eventOrder:d.eventOrder(),apis:{collapseMenu:n},events:Aa};};var jn=$.constant('collapse-item');var kn=function(p,m,e){return{primary:p,menus:m,expansions:e};};var ln=function(d4,m){return{primary:d4,menus:E6(d4,m),expansions:{}};};var mn=function(um){return{value:Rf.generate(jn()),text:um};};var nn=Vg({name:'TieredMenu',configFields:[_a('onExecute'),_a('onEscape'),$a('onOpenMenu'),$a('onOpenSubmenu'),Ya('onCollapseMenu'),J7('openImmediately',true),E7('data',[A7('primary'),A7('menus'),A7('expansions')]),J7('fakeFocus',false),Ya('onHighlight'),Ya('onHover'),Va(),A7('dom'),J7('navigateOnHover',true),J7('stayInDom',false),Cf('tmenuBehaviours',[Bf,ld,lk,bn]),J7('eventOrder',{})],apis:{collapseMenu:function(a,t){a.collapseMenu(t);}},factory:hn,extraApis:{tieredData:kn,singleData:ln,collapseItem:mn}});var qn=function(c,t,a,r){return D6(t.routes(),r.start()).map($.apply).bind(function(s){return D6(s,r.destination()).map($.apply);});};var rn=function(c,t,a){var b=vn(c,t,a);return b.bind(function(r){return sn(c,t,a,r);});};var sn=function(c,a,b,d){return qn(c,a,b,d).bind(function(r){return r.transition().map(function(t){return{transition:$.constant(t),route:$.constant(r)};});});};var tn=function(c,a,b){rn(c,a,b).each(function(r){var t=r.transition();r9.remove(c.element(),t.transitionClass());a9.remove(c.element(),a.destinationAttr());});};var un=function(c,t,a,d){return{start:$.constant(a9.get(c.element(),t.stateAttr())),destination:$.constant(d)};};var vn=function(c,t,a){var e=c.element();return a9.has(e,t.destinationAttr())?c1.some({start:$.constant(a9.get(c.element(),t.stateAttr())),destination:$.constant(a9.get(c.element(),t.destinationAttr()))}):c1.none();};var wn=function(c,t,a,d){tn(c,t,a);if(a9.has(c.element(),t.stateAttr())&&a9.get(c.element(),t.stateAttr())!==d){t.onFinish()(c,d);}a9.set(c.element(),t.stateAttr(),d);};var xn=function(c,t,a,d){if(a9.has(c.element(),t.destinationAttr())){a9.set(c.element(),t.stateAttr(),a9.get(c.element(),t.destinationAttr()));a9.remove(c.element(),t.destinationAttr());}};var yn=function(c,a,b,d){xn(c,a,b,d);var r=un(c,a,b,d);sn(c,a,b,r).fold(function(){wn(c,a,b,d);},function(e){tn(c,a,b);var t=e.transition();r9.add(c.element(),t.transitionClass());a9.set(c.element(),a.destinationAttr(),d);});};var zn=function(c,t,a){var e=c.element();return a9.has(e,t.stateAttr())?c1.some(a9.get(e,t.stateAttr())):c1.none();};var An=Object.freeze({findRoute:qn,disableTransition:tn,getCurrentRoute:vn,jumpTo:wn,progressTo:yn,getState:zn});var Bn=function(t,a){return T7([W7(F1(),function(c,s){var r=s.event().raw();vn(c,t,a).each(function(b){qn(c,t,a,b).each(function(d){d.transition().each(function(e){if(r.propertyName===e.property()){wn(c,t,a,b.destination());t.onTransition()(c,b);}});});});}),d8(function(c,s){wn(c,t,a,t.initialState());})]);};var Cn=Object.freeze({events:Bn});var Dn=[J7('destinationAttr','data-transitioning-destination'),J7('stateAttr','data-transitioning-state'),A7('initialState'),Ya('onTransition'),Ya('onFinish'),B7('routes',g7(Z5.value,g7(Z5.value,d7([I7('transition',[A7('property'),A7('transitionClass')])]))))];var En=function(a){var r={};o1.each(a,function(v,k){var w=k.split('<->');r[w[0]]=E6(w[1],v);r[w[1]]=E6(w[0],v);});return r;};var Fn=function(_2,s,t){return F6([{key:_2,value:E6(s,t)},{key:s,value:E6(_2,t)}]);};var Gn=function(_2,s,t,a){return F6([{key:_2,value:F6([{key:s,value:a},{key:t,value:a}])},{key:s,value:F6([{key:_2,value:a},{key:t,value:a}])},{key:t,value:F6([{key:_2,value:a},{key:s,value:a}])}]);};var Hn=J8({fields:Dn,name:'transitioning',active:Cn,apis:An,extra:{createRoutes:En,createBistate:Fn,createTristate:Gn}});var In=Db.resolve('scrollable');var Jn=function(ya){r9.add(ya,In);};var Kn=function(ya){r9.remove(ya,In);};var Ln={register:Jn,deregister:Kn,scrollable:$.constant(In)};var Mn=function(i){return D6(i,'format').getOr(i.title);};var Nn=function(f,m){var a=Pn('Styles',[].concat(R2.map(f.items,function(k){return On(Mn(k),k.title,k.isSelected(),k.getPreview(),H6(f.expansions,Mn(k)));})),m,false);var s=o1.map(f.menus,function(c,d){var i=R2.map(c,function(e){return On(Mn(e),e.title,e.isSelected!==undefined?e.isSelected():false,e.getPreview!==undefined?e.getPreview():'',H6(f.expansions,Mn(e)));});return Pn(d,i,m,true);});var b=U.deepMerge(s,E6('styles',a));var t=nn.tieredData('styles',b,f.expansions);return{tmenu:t};};var On=function(f4,t,s,p,i){return{data:{value:f4,text:t},type:'item',dom:{tag:'div',classes:i?[Db.resolve('styles-item-is-menu')]:[]},toggling:{toggleOnExecute:false,toggleClass:Db.resolve('format-matches'),selected:s},itemBehaviours:H8(i?[]:[Ab.format(f4,function(c,a){var j9=a?wb.on:wb.off;j9(c);})]),components:[{dom:{tag:'div',attributes:{style:p},innerHtml:t}}]};};var Pn=function(f4,i,m,c){return{value:f4,dom:{tag:'div'},components:[Yg.sketch({dom:{tag:'div',classes:[Db.resolve('styles-collapser')]},components:c?[{dom:{tag:'span',classes:[Db.resolve('styles-collapse-icon')]}},um(f4)]:[um(f4)],action:function(a){if(c){var b=m().get(a);nn.collapseMenu(b);}}}),{dom:{tag:'div',classes:[Db.resolve('styles-menu-items-container')]},components:[Um.parts().items({})],behaviours:H8([hk('adhoc-scrollable-menu',[d8(function(a,s){ec.set(a.element(),'overflow-y','auto');ec.set(a.element(),'-webkit-overflow-scrolling','touch');Ln.register(a.element());}),e8(function(a){ec.remove(a.element(),'overflow-y');ec.remove(a.element(),'-webkit-overflow-scrolling');Ln.deregister(a.element());})])])}],items:i,menuBehaviours:H8([Hn.config({initialState:'after',routes:Hn.createTristate('before','current','after',{transition:{property:'transform',transitionClass:'transitioning'}})})])};};var Qn=function(s){var Wh=Nn(s.formats,function(){return m;});var m=$i(nn.sketch({dom:{tag:'div',classes:[Db.resolve('styles-menu')]},components:[],fakeFocus:true,stayInDom:true,onExecute:function(t,i){var v=mi.getValue(i);s.handle(i,v.value);},onEscape:function(){},onOpenMenu:function(c,a){var w=vi.get(c.element());vi.set(a.element(),w);Hn.jumpTo(a,'current');},onOpenSubmenu:function(c,i,a){var w=vi.get(c.element());var b=Fc.ancestor(i.element(),'[role="menu"]').getOrDie('hacky');var d=c.getSystem().getByDom(b).getOrDie();vi.set(a.element(),w);Hn.progressTo(d,'before');Hn.jumpTo(a,'after');Hn.progressTo(a,'current');},onCollapseMenu:function(c,i,a){var b=Fc.ancestor(i.element(),'[role="menu"]').getOrDie('hacky');var d=c.getSystem().getByDom(b).getOrDie();Hn.progressTo(d,'after');Hn.progressTo(a,'current');},navigateOnHover:false,openImmediately:true,data:Wh.tmenu,markers:{backgroundMenu:Db.resolve('styles-background-menu'),menu:Db.resolve('styles-menu'),selectedMenu:Db.resolve('styles-selected-menu'),item:Db.resolve('styles-item'),selectedItem:Db.resolve('styles-selected-item')}}));return m.asSpec();};var Rn={sketch:Qn};var Sn=function(i){var n=U.deepMerge(A6(i,['items']),{menu:true});var r=Un(i.items);var a=U.deepMerge(r.menus,E6(i.title,r.items));var b=U.deepMerge(r.expansions,E6(i.title,i.title));return{item:n,menus:a,expansions:b};};var Tn=function(i){return H6(i,'items')?Sn(i):{item:i,menus:{},expansions:{}};};var Un=function(i){return R2.foldr(i,function(a,b){var n=Tn(b);return{menus:U.deepMerge(a.menus,n.menus),items:[n.item].concat(a.items),expansions:U.deepMerge(a.expansions,n.expansions)};},{menus:{},expansions:{},items:[]});};var Vn={expand:Un};var Wn=function(e,s){var i=function(xb){return function(){return e.formatter.match(xb);};};var g=function(xb){return function(){var h=e.formatter.getCssText(xb);return h;};};var a=function(h){return U.deepMerge(h,{isSelected:i(h.format),getPreview:g(h.format)});};var b=function(h){return U.deepMerge(h,{isSelected:$.constant(false),getPreview:$.constant('')});};var c=function(h){var j=Rf.generate(h.title);var n=U.deepMerge(h,{format:j,isSelected:i(j),getPreview:g(j)});e.formatter.register(j,n);return n;};var f=D6(s,'style_formats').getOr(ul);var d=function(h){return R2.map(h,function(j){if(H6(j,'items')){var n=d(j.items);return U.deepMerge(b(j),{items:n});}else if(H6(j,'format')){return a(j);}else{return c(j);}});};return d(f);};var Xn=function(e,f){var d=function(i){return R2.bind(i,function(a){if(a.items!==undefined){var n=d(a.items);return n.length>0?[a]:[];}else{var k=H6(a,'format')?e.formatter.canApply(a.format):true;return k?[a]:[];}});};var p=d(f);return Vn.expand(p);};var ui=function(e,f,o){var p=Xn(e,f);return Rn.sketch({formats:p,handle:function(i,f4){e.undoManager.transact(function(){if(wb.isOn(i)){e.formatter.remove(f4);}else{e.formatter.apply(f4);}});o();}});};var Zn={register:Wn,ui:ui};var $n=['undo','bold','italic','link','image','bullist','styleselect'];var _n=function(r){var t=r.replace(/\|/g,' ').trim();return t.length>0?t.split(/\s+/):[];};var ao=function(t){return R2.bind(t,function(i){return O.isArray(i)?ao(i):_n(i);});};var bo=function(s){var t=s.toolbar!==undefined?s.toolbar:$n;return O.isArray(t)?ao(t):_n(t);};var co=function(r,e){var c=function(d4){return function(){return mh.forToolbarCommand(e,d4);};};var s=function(d4){return function(){return mh.forToolbarStateCommand(e,d4);};};var a=function(d4,ak,p){return function(){return mh.forToolbarStateAction(e,d4,ak,p);};};var u=c('undo');var b=c('redo');var d=s('bold');var i=s('italic');var f=s('underline');var g=c('removeformat');var l=function(){return tl(r,e);};var h=a('unlink','link',function(){e.execCommand('unlink',null,false);});var j=function(){return Oj(e);};var k=a('unordered-list','ul',function(){e.execCommand('InsertUnorderedList',null,false);});var n=a('ordered-list','ol',function(){e.execCommand('InsertOrderedList',null,false);});var m=function(){return Zi(r,e);};var o=function(){return Ei.sketch(r,e);};var t=Zn.register(e,e.settings);var v=function(){return Zn.ui(e,t,function(){e.fire('scrollIntoView');});};var w=function(){return mh.forToolbar('style-formats',function(zi){e.fire('toReading');r.dropup().appear(v,wb.on,zi);},H8([wb.config({toggleClass:Db.resolve('toolbar-button-selected'),toggleOnExecute:false,aria:{mode:'pressed'}}),gb.config({channels:F6([Ab.receive(ga.orientationChanged(),wb.off),Ab.receive(ga.dropupDismissed(),wb.off)])})]));};var x=function(y,_){return{isSupported:function(){return y.forall(function(p){return H6(e.buttons,p);});},sketch:_};};return{undo:x(c1.none(),u),redo:x(c1.none(),b),bold:x(c1.none(),d),italic:x(c1.none(),i),underline:x(c1.none(),f),removeformat:x(c1.none(),g),link:x(c1.none(),l),unlink:x(c1.none(),h),image:x(c1.none(),j),bullist:x(c1.some('bullist'),k),numlist:x(c1.some('numlist'),n),fontsizeselect:x(c1.none(),m),forecolor:x(c1.none(),o),styleselect:x(c1.none(),w)};};var eo=function(s,f){var i=bo(s);var p={};return R2.bind(i,function(n){var r=!H6(p,n)&&H6(f,n)&&f[n].isSupported()?[f[n].sketch()]:[];p[n]=true;return r;});};var fo={identify:bo,setup:co,detect:eo};var ho=function(t,x,y,s,p,k,r){return{'target':$.constant(t),'x':$.constant(x),'y':$.constant(y),'stop':s,'prevent':p,'kill':k,'raw':$.constant(r)};};var io=function(w2,h){return function(r){if(!w2(r))return;var t=b4.fromDom(r.target);var s=function(){r.stopPropagation();};var p=function(){r.preventDefault();};var k=$.compose(p,s);var e=ho(t,r.clientX,r.clientY,s,p,k,r);h(e);};};var jo=function(ya,e,w2,h,u){var w=io(w2,h);ya.dom().addEventListener(e,w,u);return{unbind:$.curry(mo,ya,e,w,u)};};var ko=function(ya,e,w2,h){return jo(ya,e,w2,h,false);};var lo=function(ya,e,w2,h){return jo(ya,e,w2,h,true);};var mo=function(ya,e,h,u){ya.dom().removeEventListener(e,h,u);};var no={bind:ko,capture:lo};var oo=$.constant(true);var po=function(ya,e,h){return no.bind(ya,e,oo,h);};var qo=function(ya,e,h){return no.capture(ya,e,oo,h);};var so={bind:po,capture:qo};var to=50;var uo=1000/to;var vo=function(o){var i=o.matchMedia('(orientation: portrait)').matches;return{isPortrait:$.constant(i)};};var wo=function(o){var i=A3.detect().os.isiOS();var a=vo(o).isPortrait();return i&&!a?o.screen.height:o.screen.width;};var xo=function(o,l){var w=b4.fromDom(o);var p=null;var C1=function(){clearInterval(p);var yb=vo(o);l.onChange(yb);b(function(){l.onReady(yb);});};var a=so.bind(w,'orientationchange',C1);var b=function(f){clearInterval(p);var c=o.innerHeight;var i=0;p=setInterval(function(){if(c!==o.innerHeight){clearInterval(p);f(c1.some(o.innerHeight));}else if(i>uo){clearInterval(p);f(c1.none());}i++;},to);};var d=function(){a.unbind();};return{onAdjustment:b,destroy:d};};var yo={get:vo,onChange:xo,getActualWidth:wo};function zo(f,d){var r=null;var s=function(){var Q7=[];for(var _=0;_<arguments.length;_++){Q7[_]=arguments[_];}var a=arguments;r=setTimeout(function(){f.apply(null,a);r=null;},d);};var c=function(){if(r!==null){clearTimeout(r);r=null;}};return{cancel:c,schedule:s};}var Ao=5;var Bo=400;var Co=function(e){if(e.raw().touches===undefined||e.raw().touches.length!==1){return c1.none();}return c1.some(e.raw().touches[0]);};var Do=function(t,cr){var d=Math.abs(t.clientX-cr.x());var a=Math.abs(t.clientY-cr.y());return d>Ao||a>Ao;};var Eo=function(s){var a=B9(c1.none());var l=zo(function(e){a.set(c1.none());s.triggerEvent(J3(),e);},Bo);var h=function(e){Co(e).each(function(t){l.cancel();var cr={x:$.constant(t.clientX),y:$.constant(t.clientY),target:e.target};l.schedule(e);a.set(c1.some(cr));});return c1.none();};var b=function(e){l.cancel();Co(e).each(function(t){a.get().each(function(cr){if(Do(t,cr)){a.set(c1.none());}});});return c1.none();};var c=function(e){l.cancel();var i=function(cr){return d5.eq(cr.target(),e.target());};return a.get().filter(i).map(function(cr){return s.triggerEvent(H3(),e);});};var d=F6([{key:q1(),value:h},{key:r1(),value:b},{key:s1(),value:c}]);var f=function(e,e4){return D6(d,e4).bind(function(g){return g(e);});};return{fireIfReady:f};};var Fo=function(e){var t=Eo({triggerEvent:function(e4,b){e.onTapContent(b);}});var o=function(){return so.bind(e.body(),'touchend',function(b){t.fireIfReady(b,'touchend');});};var a=function(){return so.bind(e.body(),'touchmove',function(b){t.fireIfReady(b,'touchmove');});};var f=function(b){t.fireIfReady(b,'touchstart');};return{fireTouchstart:f,onTouchend:o,onTouchmove:a};};var Go={monitor:Fo};var Ho=A3.detect().os.version.major>=6;var Io=function(e,t,B3){var a=Go.monitor(e);var o=y5.owner(t);var i=function(s){return!d5.eq(s.start(),s.finish())||s.soffset()!==s.foffset();};var h=function(){return X9.active(o).filter(function(B1){return l4.name(B1)==='input';}).exists(function(B1){return B1.dom().selectionStart!==B1.dom().selectionEnd;});};var u=function(){var r=e.doc().dom().hasFocus()&&e.getSelection().exists(i);B3.getByDom(t).each((r||h())===true?wb.on:wb.off);};var b=[so.bind(e.body(),'touchstart',function(c){e.onTouchContent();a.fireTouchstart(c);}),a.onTouchmove(),a.onTouchend(),so.bind(t,'touchstart',function(c){e.onTouchToolstrip();}),e.onToReading(function(){X9.blur(e.body());}),e.onToEditing($.noop),e.onScrollToCursor(function(c){c.preventDefault();e.getCursorBox().each(function(f){var g=e.win();var j=f.top()>g.innerHeight||f.bottom()>g.innerHeight;var k=j?f.bottom()-g.innerHeight+50:0;if(k!==0){g.scrollTo(g.pageXOffset,g.pageYOffset+k);}});})].concat(Ho===true?[]:[so.bind(b4.fromDom(e.win()),'blur',function(){B3.getByDom(t).each(wb.off);}),so.bind(o,'select',u),so.bind(e.doc(),'selectionchange',u)]);var d=function(){R2.each(b,function(l){l.unbind();});};return{destroy:d};};var Jo={initEvents:Io};var Ko=function(ya,Mg){var p=parseInt(a9.get(ya,Mg),10);return isNaN(p)?0:p;};var Lo={safeParse:Ko};function Mo(i,d4){var V8=function(ya){if(!i(ya))throw new Error('Can only get '+d4+' value of a '+d4+' node');return Po(ya).getOr('');};var g=function(ya){try{return a(ya);}catch(e){return c1.none();}};var a=function(ya){return i(ya)?c1.from(ya.dom().nodeValue):c1.none();};var b5=A3.detect().browser;var Po=b5.isIE()&&b5.version.major===10?g:a;var T8=function(ya,f4){if(!i(ya))throw new Error('Can only set raw '+d4+' value of a '+d4+' node');ya.dom().nodeValue=f4;};return{get:V8,getOption:Po,set:T8};}var No=Mo(l4.isText,'text');var Oo=function(ya){return No.get(ya);};var Po=function(ya){return No.getOption(ya);};var Qo=function(ya,f4){No.set(ya,f4);};var Ro={get:Oo,getOption:Po,set:Qo};var So=function(ya){return l4.name(ya)==='img'?1:Ro.getOption(ya).fold(function(){return y5.children(ya).length;},function(v){return v.length;});};var To=function(ya,o){return So(ya)===o;};var Uo=function(ya,o){return o===0;};var Vo='\xA0';var Wo=function(e){return Ro.getOption(e).filter(function(um){return um.trim().length!==0||um.indexOf(Vo)>-1;}).isSome();};var Xo=['img','br'];var Yo=function(e){var h=Wo(e);return h||R2.contains(Xo,l4.name(e));};var Zo={getEnd:So,isEnd:To,isStart:Uo,isCursorPosition:Yo};var $o=_5.generate([{'before':['element']},{'on':['element','offset']},{after:['element']}]);var _o=function(s,o,a,b){return s.fold(o,a,b);};var ap=function(s){return s.fold($.identity,$.identity,$.identity);};var bp={before:$o.before,on:$o.on,after:$o.after,cata:_o,getStart:ap};var cp=_5.generate([{domRange:['rng']},{relative:['startSitu','finishSitu']},{exact:['start','soffset','finish','foffset']}]);var dp=z4.immutable('start','soffset','finish','foffset');var ep=function(s){return cp.exact(s.start(),s.soffset(),s.finish(),s.foffset());};var fp=function(s){return s.match({domRange:function(r){return b4.fromDom(r.startContainer);},relative:function(a,f){return bp.getStart(a);},exact:function(a,b,f,c){return a;}});};var gp=function(s){var a=fp(s);return y5.defaultView(a);};var hp={domRange:cp.domRange,relative:cp.relative,exact:cp.exact,exactFromRange:ep,range:dp,getWin:gp};var ip=function(s,a,f,b){var d=y5.owner(s);var r=d.dom().createRange();r.setStart(s.dom(),a);r.setEnd(f.dom(),b);return r;};var jp=function(s,a,f,b){var r=ip(s,a,f,b);return b4.fromDom(r.commonAncestorContainer);};var kp=function(s,a,f,b){var r=ip(s,a,f,b);var c=d5.eq(s,f)&&a===b;return r.collapsed&&!c;};var lp={after:kp,commonAncestorContainer:jp};var mp=function(e,s){var d=s||document;var f=d.createDocumentFragment();R2.each(e,function(ya){f.appendChild(ya.dom());});return b4.fromDom(f);};var op={fromElements:mp};var pp=function(w,ya){var r=w.document.createRange();qp(r,ya);return r;};var qp=function(r,ya){r.selectNodeContents(ya.dom());};var rp=function(o,i){return i.compareBoundaryPoints(o.END_TO_START,o)<1&&i.compareBoundaryPoints(o.START_TO_END,o)>-1;};var sp=function(w){return w.document.createRange();};var tp=function(r,s){s.fold(function(e){r.setStartBefore(e.dom());},function(e,o){r.setStart(e.dom(),o);},function(e){r.setStartAfter(e.dom());});};var up=function(r,s){s.fold(function(e){r.setEndBefore(e.dom());},function(e,o){r.setEnd(e.dom(),o);},function(e){r.setEndAfter(e.dom());});};var vp=function(r,f){yp(r);r.insertNode(f.dom());};var wp=function(w,s,f){var q2=w.document.createRange();tp(q2,s);up(q2,f);return q2;};var xp=function(w,s,a,f,b){var r=w.document.createRange();r.setStart(s.dom(),a);r.setEnd(f.dom(),b);return r;};var yp=function(r){r.deleteContents();};var zp=function(r){var f=r.cloneContents();return b4.fromDom(f);};var Ap=function(r){return{left:$.constant(r.left),top:$.constant(r.top),right:$.constant(r.right),bottom:$.constant(r.bottom),width:$.constant(r.width),height:$.constant(r.height)};};var Bp=function(r){var a=r.getClientRects();var b=a.length>0?a[0]:r.getBoundingClientRect();return b.width>0||b.height>0?c1.some(b).map(Ap):c1.none();};var Cp=function(r){var a=r.getBoundingClientRect();return a.width>0||a.height>0?c1.some(a).map(Ap):c1.none();};var Dp=function(r){return r.toString();};var Ep={create:sp,replaceWith:vp,selectNodeContents:pp,selectNodeContentsUsing:qp,relativeToNative:wp,exactToNative:xp,deleteContents:yp,cloneFragment:zp,getFirstRect:Bp,getBounds:Cp,isWithin:rp,toString:Dp};var Fp=_5.generate([{ltr:['start','soffset','finish','foffset']},{rtl:['start','soffset','finish','foffset']}]);var Gp=function(w,e4,q2){return e4(b4.fromDom(q2.startContainer),q2.startOffset,b4.fromDom(q2.endContainer),q2.endOffset);};var Hp=function(w,s){return s.match({domRange:function(r){return{ltr:$.constant(r),rtl:c1.none};},relative:function(a,f){return{ltr:I1.cached(function(){return Ep.relativeToNative(w,a,f);}),rtl:I1.cached(function(){return c1.some(Ep.relativeToNative(w,f,a));})};},exact:function(a,b,f,c){return{ltr:I1.cached(function(){return Ep.exactToNative(w,a,b,f,c);}),rtl:I1.cached(function(){return c1.some(Ep.exactToNative(w,f,c,a,b));})};}});};var Ip=function(w,r){var a=r.ltr();if(a.collapsed){var b=r.rtl().filter(function(c){return c.collapsed===false;});return b.map(function(c){return Fp.rtl(b4.fromDom(c.endContainer),c.endOffset,b4.fromDom(c.startContainer),c.startOffset);}).getOrThunk(function(){return Gp(w,Fp.ltr,a);});}else{return Gp(w,Fp.ltr,a);}};var Jp=function(w,s){var r=Hp(w,s);return Ip(w,r);};var Kp=function(w,s){var d=Jp(w,s);return d.match({ltr:function(a,b,f,c){var r=w.document.createRange();r.setStart(a.dom(),b);r.setEnd(f.dom(),c);return r;},rtl:function(a,b,f,c){var r=w.document.createRange();r.setStart(f.dom(),c);r.setEnd(a.dom(),b);return r;}});};var Lp={ltr:Fp.ltr,rtl:Fp.rtl,diagnose:Jp,asLtrRange:Kp};var Mp=function(r,x,y,m,l){if(l===0)return 0;else if(x===m)return l-1;var a=m;for(var i=1;i<l;i++){var b=r(i);var c=Math.abs(x-b.left);if(y>b.bottom){}else if(y<b.top||c>a){return i-1;}else{a=c;}}return 0;};var Np=function(r,x,y){return x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom;};var Op={inRect:Np,searchForPoint:Mp};var Pp=function(d,t,x,y,a){var b=function(o){var r=d.dom().createRange();r.setStart(t.dom(),o);r.collapse(true);return r;};var c=function(o){var r=b(o);return r.getBoundingClientRect();};var l=Ro.get(t).length;var o=Op.searchForPoint(c,x,y,a.right,l);return b(o);};var Qp=function(d,M4,x,y){var r=d.dom().createRange();r.selectNode(M4.dom());var a=r.getClientRects();var f=Fa.findMap(a,function(b){return Op.inRect(b,x,y)?c1.some(b):c1.none();});return f.map(function(b){return Pp(d,M4,x,y,b);});};var Rp={locate:Qp};var Sp=function(d,M4,x,y){var r=d.dom().createRange();var a=y5.children(M4);return Fa.findMap(a,function(n){r.selectNode(n.dom());return Op.inRect(r.getBoundingClientRect(),x,y)?Tp(d,n,x,y):c1.none();});};var Tp=function(d,M4,x,y){var l=l4.isText(M4)?Rp.locate:Sp;return l(d,M4,x,y);};var Up=function(d,M4,x,y){var r=d.dom().createRange();r.selectNode(M4.dom());var a=r.getBoundingClientRect();var b=Math.max(a.left,Math.min(a.right,x));var c=Math.max(a.top,Math.min(a.bottom,y));return Tp(d,M4,b,c);};var Vp={locate:Up};var Wp=function(ya){return J9.descendant(ya,Zo.isCursorPosition);};var Xp=function(ya){return Yp(ya,Zo.isCursorPosition);};var Yp=function(s,p){var d=function(ya){var q5=y5.children(ya);for(var i=q5.length-1;i>=0;i--){var r5=q5[i];if(p(r5))return c1.some(r5);var r=d(r5);if(r.isSome())return r;}return c1.none();};return d(s);};var Zp={first:Wp,last:Xp};var $p=true;var _p=false;var aq=function(r,x){return x-r.left<r.right-x?$p:_p;};var bq=function(d,t,c){var r=d.dom().createRange();r.selectNode(t.dom());r.collapse(c);return r;};var cq=function(d,M4,x){var c=d.dom().createRange();c.selectNode(M4.dom());var r=c.getBoundingClientRect();var a=aq(r,x);var f=a===$p?Zp.first:Zp.last;return f(M4).map(function(t){return bq(d,t,a);});};var dq=function(d,M4,x){var r=M4.dom().getBoundingClientRect();var c=aq(r,x);return c1.some(bq(d,M4,c));};var fq=function(d,M4,x){var f=y5.children(M4).length===0?dq:cq;return f(d,M4,x);};var gq={search:fq};var hq=function(d,x,y){return c1.from(d.dom().caretPositionFromPoint(x,y)).bind(function(p){if(p.offsetNode===null)return c1.none();var r=d.dom().createRange();r.setStart(p.offsetNode,p.offset);r.collapse();return c1.some(r);});};var iq=function(d,x,y){return c1.from(d.dom().caretRangeFromPoint(x,y));};var jq=function(d,M4,x,y){var r=d.dom().createRange();r.selectNode(M4.dom());var a=r.getBoundingClientRect();var b=Math.max(a.left,Math.min(a.right,x));var c=Math.max(a.top,Math.min(a.bottom,y));return Vp.locate(d,M4,b,c);};var kq=function(d,x,y){return b4.fromPoint(d,x,y).bind(function(e){var f=function(){return gq.search(d,e,x);};return y5.children(e).length===0?f():jq(d,e,x,y).orThunk(f);});};var lq=document.caretPositionFromPoint?hq:document.caretRangeFromPoint?iq:kq;var mq=function(w,x,y){var d=b4.fromDom(w.document);return lq(d,x,y).map(function(r){return hp.range(b4.fromDom(r.startContainer),r.startOffset,b4.fromDom(r.endContainer),r.endOffset);});};var nq={fromPoint:mq};var oq=function(w,E9,o,s){var i=Ep.create(w);var a=X4.is(E9,s)?[E9]:[];var e=a.concat(yc.descendants(E9,s));return R2.filter(e,function(b){Ep.selectNodeContentsUsing(i,b);return Ep.isWithin(o,i);});};var pq=function(w,s,a){var o=Lp.asLtrRange(w,s);var E9=b4.fromDom(o.commonAncestorContainer);return l4.isElement(E9)?oq(w,E9,o,a):[];};var qq={find:pq};var rq=function(ya,o){var d4=l4.name(ya);if('input'===d4)return bp.after(ya);else if(!R2.contains(['br','img'],d4))return bp.on(ya,o);else return o===0?bp.before(ya):bp.after(ya);};var sq=function(s,f){var a=s.fold(bp.before,rq,bp.after);var b=f.fold(bp.before,rq,bp.after);return hp.relative(a,b);};var tq=function(s,a,f,b){var c=rq(s,a);var d=rq(f,b);return hp.relative(c,d);};var uq=function(s){return s.match({domRange:function(r){var a=b4.fromDom(r.startContainer);var f=b4.fromDom(r.endContainer);return tq(a,r.startOffset,f,r.endOffset);},relative:sq,exact:tq});};var vq={beforeSpecial:rq,preprocess:uq,preprocessRelative:sq,preprocessExact:tq};var wq=function(w,r){c1.from(w.getSelection()).each(function(s){s.removeAllRanges();s.addRange(r);});};var xq=function(w,s,a,f,b){var r=Ep.exactToNative(w,s,a,f,b);wq(w,r);};var yq=function(w,s,a){return qq.find(w,s,a);};var zq=function(w,r){return Lp.diagnose(w,r).match({ltr:function(s,a,f,b){xq(w,s,a,f,b);},rtl:function(s,a,f,b){var c=w.getSelection();if(c.setBaseAndExtent){c.setBaseAndExtent(s.dom(),a,f.dom(),b);}else if(c.extend){c.collapse(s.dom(),a);c.extend(f.dom(),b);}else{xq(w,f,b,s,a);}}});};var Aq=function(w,s,a,f,b){var r=vq.preprocessExact(s,a,f,b);zq(w,r);};var Bq=function(w,s,f){var r=vq.preprocessRelative(s,f);zq(w,r);};var Cq=function(s){var w=hp.getWin(s).dom();var g=function(a,b,c,d){return Ep.exactToNative(w,a,b,c,d);};var f=vq.preprocess(s);return Lp.diagnose(w,f).match({ltr:g,rtl:g});};var Dq=function(s){if(s.rangeCount>0){var f=s.getRangeAt(0);var l=s.getRangeAt(s.rangeCount-1);return c1.some(hp.range(b4.fromDom(f.startContainer),f.startOffset,b4.fromDom(l.endContainer),l.endOffset));}else{return c1.none();}};var Eq=function(s){var a=b4.fromDom(s.anchorNode);var f=b4.fromDom(s.focusNode);return lp.after(a,s.anchorOffset,f,s.focusOffset)?c1.some(hp.range(b4.fromDom(s.anchorNode),s.anchorOffset,b4.fromDom(s.focusNode),s.focusOffset)):Dq(s);};var Fq=function(w,ya){var r=Ep.selectNodeContents(w,ya);wq(w,r);};var Gq=function(w,ya){var r=Ep.selectNodeContents(w,ya);return hp.range(b4.fromDom(r.startContainer),r.startOffset,b4.fromDom(r.endContainer),r.endOffset);};var Hq=function(w){return c1.from(w.getSelection()).filter(function(s){return s.rangeCount>0;}).bind(Eq);};var Iq=function(w){return Hq(w).map(function(q2){return hp.exact(q2.start(),q2.soffset(),q2.finish(),q2.foffset());});};var Jq=function(w,s){var r=Lp.asLtrRange(w,s);return Ep.getFirstRect(r);};var Kq=function(w,s){var r=Lp.asLtrRange(w,s);return Ep.getBounds(r);};var Lq=function(w,x,y){return nq.fromPoint(w,x,y);};var Mq=function(w,s){var r=Lp.asLtrRange(w,s);return Ep.toString(r);};var Nq=function(w){var s=w.getSelection();s.removeAllRanges();};var Oq=function(w,s){var r=Lp.asLtrRange(w,s);return Ep.cloneFragment(r);};var Pq=function(w,s,e){var r=Lp.asLtrRange(w,s);var f=op.fromElements(e,w.document);Ep.replaceWith(r,f);};var Qq=function(w,s){var r=Lp.asLtrRange(w,s);Ep.deleteContents(r);};var Rq=function(s,a,f,b){return d5.eq(s,f)&&a===b;};var Sq={setExact:Aq,getExact:Hq,get:Iq,setRelative:Bq,toNative:Cq,setToElement:Fq,clear:Nq,clone:Oq,replace:Pq,deleteAt:Qq,forElement:Gq,getFirstRect:Jq,getBounds:Kq,getAtPoint:Lq,findWithin:yq,getAsString:Mq,isCollapsed:Rq};var Tq=2;var Uq=function(r){return{left:r.left,top:r.top,right:r.right,bottom:r.bottom,width:$.constant(Tq),height:r.height};};var Vq=function(r){return{left:$.constant(r.left),top:$.constant(r.top),right:$.constant(r.right),bottom:$.constant(r.bottom),width:$.constant(r.width),height:$.constant(r.height)};};var Wq=function(q2){if(!q2.collapsed){return R2.map(q2.getClientRects(),Vq);}else{var s=b4.fromDom(q2.startContainer);return y5.parent(s).bind(function(h5){var a=hp.exact(s,q2.startOffset,h5,Zo.getEnd(h5));var o=Sq.getFirstRect(q2.startContainer.ownerDocument.defaultView,a);return o.map(Uq).map(R2.pure);}).getOr([]);}};var Xq=function(c){var s=c.getSelection();return s!==undefined&&s.rangeCount>0?Wq(s.getRangeAt(0)):[];};var Yq={getRectangles:Xq};var Zq=function(){return function(f){setTimeout(function(){f();},0);};};var $q=function(c){c.focus();var b=b4.fromDom(c.document.body);var i=X9.active().exists(function(e){return R2.contains(['input','textarea'],l4.name(e));});var t=i?Zq():$.apply;t(function(){X9.active().each(X9.blur);X9.focus(b);});};var _q={resume:$q};var ar=50;var cr='data-'+Db.resolve('last-outer-height');var dr=function(c,f4){a9.set(c,cr,f4);};var er=function(c){return Lo.safeParse(c,cr);};var fr=function(r){return{top:$.constant(r.top()),bottom:$.constant(r.top()+r.height())};};var gr=function(c){var r=Yq.getRectangles(c);return r.length>0?c1.some(r[0]).map(fr):c1.none();};var hr=function(o,c){var P2=er(c);var a=o.innerHeight;return P2>a?c1.some(P2-a):c1.none();};var ir=function(c,b,d){var i=b.top()>c.innerHeight||b.bottom()>c.innerHeight;return i?Math.min(d,b.bottom()-c.innerHeight+ar):0;};var jr=function(o,c){var a=b4.fromDom(c.document.body);var t=function(){_q.resume(c);};var b=so.bind(b4.fromDom(o),'resize',function(){hr(o,a).each(function(e){gr(c).each(function(f){var g=ir(c,f,e);if(g!==0){c.scrollTo(c.pageXOffset,c.pageYOffset+g);}});});dr(a,o.innerHeight);});dr(a,o.innerHeight);var d=function(){b.unbind();};return{toEditing:t,destroy:d};};var kr={setup:jr};var lr=function(f){return c1.some(b4.fromDom(f.dom().contentWindow.document.body));};var mr=function(f){return c1.some(b4.fromDom(f.dom().contentWindow.document));};var nr=function(f){return c1.from(f.dom().contentWindow);};var pr=function(f){var o=nr(f);return o.bind(Sq.getExact);};var qr=function(e){return e.getFrame();};var rr=function(d4,f){return function(e){var g=e[d4].getOrThunk(function(){var a=qr(e);return function(){return f(a);};});return g();};};var sr=function(e,d,d4,e4){return e[d4].getOrThunk(function(){return function(h){return so.bind(d,e4,h);};});};var tr=function(r){return{left:$.constant(r.left),top:$.constant(r.top),right:$.constant(r.right),bottom:$.constant(r.bottom),width:$.constant(r.width),height:$.constant(r.height)};};var ur=function(e){var f=qr(e);var t=function(w){var Rq=function(s){return d5.eq(s.start(),s.finish())&&s.soffset()===s.foffset();};var a=function(s){var r=s.start().dom().getBoundingClientRect();return r.width>0||r.height>0?c1.some(r).map(tr):c1.none();};return Sq.getExact(w).filter(Rq).bind(a);};return lr(f).bind(function(n4){return mr(f).bind(function(d){return nr(f).map(function(w){var h=b4.fromDom(d.dom().documentElement);var g=e.getCursorBox.getOrThunk(function(){return function(){return Sq.get(w).bind(function(a){return Sq.getFirstRect(w,a).orThunk(function(){return t(w);});});};});var s=e.setSelection.getOrThunk(function(){return function(a,b,i,j){Sq.setExact(w,a,b,i,j);};});var c=e.clearSelection.getOrThunk(function(){return function(){Sq.clear(w);};});return{body:$.constant(n4),doc:$.constant(d),win:$.constant(w),html:$.constant(h),getSelection:$.curry(pr,f),setSelection:s,clearSelection:c,frame:$.constant(f),onKeyup:sr(e,d,'onKeyup','keyup'),onNodeChanged:sr(e,d,'onNodeChanged','selectionchange'),onDomChanged:e.onDomChanged,onScrollToCursor:e.onScrollToCursor,onScrollToElement:e.onScrollToElement,onToReading:e.onToReading,onToEditing:e.onToEditing,onToolbarScrollStart:e.onToolbarScrollStart,onTouchContent:e.onTouchContent,onTapContent:e.onTapContent,onTouchToolstrip:e.onTouchToolstrip,getCursorBox:g};});});});};var vr={getBody:rr('getBody',lr),getDoc:rr('getDoc',mr),getWin:rr('getWin',nr),getSelection:rr('getSelection',pr),getFrame:qr,getActiveApi:ur};var wr='data-ephox-mobile-fullscreen-style';var xr='display:none!important;';var yr='position:absolute!important;';var zr='top:0!important;left:0!important;margin:0'+'!important;padding:0!important;width:100%!important;';var Ar='background-color:rgb(255,255,255)!important;';var Br=A3.detect().os.isAndroid();var Cr=function(e){var c=ec.get(e,'background-color');return c!==undefined&&c!==''?'background-color:'+c+'!important':Ar;};var Dr=function(c,e){var g=function(ya){var k5=yc.siblings(ya,'*');return k5;};var a=function(f){return function(ya){var s=a9.get(ya,'style');var h=s===undefined?'no-styles':s.trim();if(h===f){return;}else{a9.set(ya,wr,h);a9.set(ya,'style',f);}};};var nc=yc.ancestors(c,'*');var k5=R2.bind(nc,g);var b=Cr(e);R2.each(k5,a(xr));R2.each(nc,a(yr+zr+b));var d=Br===true?'':yr;a(d+zr+b)(c);};var Er=function(){var c=yc.all('['+wr+']');R2.each(c,function(ya){var r=a9.get(ya,wr);if(r!=='no-styles'){a9.set(ya,'style',r);}else{a9.remove(ya,'style');}a9.remove(ya,wr);});};var Fr={clobberStyles:Dr,restoreStyles:Er};var Gr=function(){var O2=Fc.first('head').getOrDie();var n=function(){var a=b4.fromTag('meta');a9.set(a,'name','viewport');F5.append(O2,a);return a;};var ya=Fc.first('meta[name="viewport"]').getOrThunk(n);var b=a9.get(ya,'content');var m=function(){a9.set(ya,'content','width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0');};var r=function(){if(b!==undefined&&b!==null&&b.length>0){a9.set(ya,'content',b);}else{a9.set(ya,'content','user-scalable=yes');}};return{maximize:m,restore:r};};var Hr={tag:Gr};var Ir=function(Fh,m){var a=Hr.tag();var b=jl.api();var c=jl.api();var e=function(){m.hide();r9.add(Fh.container,Db.resolve('fullscreen-maximized'));r9.add(Fh.container,Db.resolve('android-maximized'));a.maximize();r9.add(Fh.body,Db.resolve('android-scroll-reload'));b.set(kr.setup(Fh.win,vr.getWin(Fh.editor).getOrDie('no')));vr.getActiveApi(Fh.editor).each(function(f){Fr.clobberStyles(Fh.container,f.body());c.set(Jo.initEvents(f,Fh.toolstrip,Fh.alloy));});};var d=function(){a.restore();m.show();r9.remove(Fh.container,Db.resolve('fullscreen-maximized'));r9.remove(Fh.container,Db.resolve('android-maximized'));Fr.restoreStyles();r9.remove(Fh.body,Db.resolve('android-scroll-reload'));c.clear();b.clear();};return{enter:e,exit:d};};var Jr={create:Ir};var Kr=function(f,r){var t=null;var a=null;var c=function(){if(t!==null){clearTimeout(t);t=null;a=null;}};var b=function(){a=arguments;if(t===null){t=setTimeout(function(){f.apply(null,a);t=null;a=null;},r);}};return{cancel:c,throttle:b};};var Lr=function(f,r){var t=null;var c=function(){if(t!==null){clearTimeout(t);t=null;}};var a=function(){var b=arguments;if(t===null){t=setTimeout(function(){f.apply(null,b);t=null;b=null;},r);}};return{cancel:c,throttle:a};};var Mr=function(f,r){var t=null;var c=function(){if(t!==null){clearTimeout(t);t=null;}};var a=function(){var b=arguments;if(t!==null)clearTimeout(t);t=setTimeout(function(){f.apply(null,b);t=null;b=null;},r);};return{cancel:c,throttle:a};};var Nr={adaptable:Kr,first:Lr,last:Mr};var Or=function(o,t){var m=$i(nk.sketch({dom:fh('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:H8([wb.config({toggleClass:Db.resolve('mask-tap-icon-selected'),toggleOnExecute:false})])}));var a=Nr.first(o,200);return nk.sketch({dom:fh('<div class="${prefix}-disabled-mask"></div>'),components:[nk.sketch({dom:fh('<div class="${prefix}-content-container"></div>'),components:[Yg.sketch({dom:fh('<div class="${prefix}-content-tap-section"></div>'),components:[m.asSpec()],action:function(zi){a.throttle();},buttonBehaviours:H8([wb.config({toggleClass:Db.resolve('mask-tap-icon-selected')})])})]})]});};var Pr={sketch:Or};var Qr=e7([E7('editor',[A7('getFrame'),F7('getBody'),F7('getDoc'),F7('getWin'),F7('getSelection'),F7('setSelection'),F7('clearSelection'),F7('cursorSaver'),F7('onKeyup'),F7('onNodeChanged'),F7('getCursorBox'),A7('onDomChanged'),J7('onTouchContent',$.noop),J7('onTapContent',$.noop),J7('onTouchToolstrip',$.noop),J7('onScrollToCursor',$.constant({unbind:$.noop})),J7('onScrollToElement',$.constant({unbind:$.noop})),J7('onToEditing',$.constant({unbind:$.noop})),J7('onToReading',$.constant({unbind:$.noop})),J7('onToolbarScrollStart',$.identity)]),A7('socket'),A7('toolstrip'),A7('dropup'),A7('toolbar'),A7('container'),A7('alloy'),M7('win',function(gh){return y5.owner(gh.socket).dom().defaultView;}),M7('body',function(gh){return b4.fromDom(gh.socket.dom().ownerDocument.body);}),J7('translate',$.identity),J7('setReadOnly',$.noop),J7('readOnlyOnInit',$.constant(true))]);var Rr=function(r){var q=t7('Getting AndroidWebapp schema',Qr,r);ec.set(q.toolstrip,'width','100%');var o=function(){q.setReadOnly(q.readOnlyOnInit());b.enter();};var m=wm(Pr.sketch(o,q.translate));q.alloy.add(m);var a={show:function(){q.alloy.add(m);},hide:function(){q.alloy.remove(m);}};F5.append(q.container,m.element());var b=Jr.create(q,a);return{setReadOnly:q.setReadOnly,refreshStructure:$.noop,enter:b.enter,exit:b.exit,destroy:$.noop};};var Sr={produce:Rr};var Tr=$.constant([J7('shell',true),Cf('toolbarBehaviours',[bn])]);var Ur=function(d){return{behaviours:H8([bn.config({})])};};var Vr=$.constant([hg({name:'groups',overrides:Ur})]);var Wr=$.constant('Toolbar');var Xr=function(d,c,gh,_){var s=function(t,a){g(t).fold(function(){console.error('Toolbar was defined to not be a shell, but no groups container was specified in components');throw new Error('Toolbar was defined to not be a shell, but no groups container was specified in components');},function(b){bn.set(b,a);});};var g=function(a){return d.shell()?c1.some(a):tg(a,d,'groups');};var e=d.shell()?{behaviours:[bn.config({})],components:[]}:{behaviours:[],components:c};return{uid:d.uid(),dom:d.dom(),components:e.components,behaviours:U.deepMerge(H8(e.behaviours),Df(d.toolbarBehaviours())),apis:{setGroups:s},domModification:{attributes:{role:'group'}}};};var Yr=Wg({name:'Toolbar',configFields:Tr(),partFields:Vr(),factory:Xr,apis:{setGroups:function(a,t,g){a.setGroups(t,g);}}});var Zr=$.constant([A7('items'),Wa(['itemClass']),Cf('tgroupBehaviours',[Bf])]);var $r=$.constant([ig({name:'items',unit:'item',overrides:function(d){return{domModification:{classes:[d.markers().itemClass()]}};}})]);var _r=$.constant('ToolbarGroup');var as=function(d,sg,gh,_){return U.deepMerge({dom:{attributes:{role:'toolbar'}}},{'uid':d.uid(),'dom':d.dom(),'components':sg,'behaviours':U.deepMerge(H8([Bf.config({mode:'flow',selector:'.'+d.markers().itemClass()})]),Df(d.tgroupBehaviours())),'debug.sketcher':gh['debug.sketcher']});};var bs=Wg({name:'ToolbarGroup',configFields:Zr(),partFields:$r(),factory:as});var ds='data-'+Db.resolve('horizontal-scroll');var hs=function(c){c.dom().scrollTop=1;var r=c.dom().scrollTop!==0;c.dom().scrollTop=0;return r;};var js=function(c){c.dom().scrollLeft=1;var r=c.dom().scrollLeft!==0;c.dom().scrollLeft=0;return r;};var ks=function(c){return c.dom().scrollTop>0||hs(c);};var ls=function(c){return c.dom().scrollLeft>0||js(c);};var ms=function(c){a9.set(c,ds,'true');};var ns=function(c){return a9.get(c,ds)==='true'?ls:ks;};var qs=function(s,a){return so.bind(s,'touchmove',function(e){Fc.closest(e.target(),a).filter(ns).fold(function(){e.raw().preventDefault();},$.noop);});};var rs={exclusive:qs,markAsHorizontal:ms};function ss(){var m=function(g){var d=g.scrollable===true?'${prefix}-toolbar-scrollable-group':'';return{dom:fh('<div aria-label="'+g.label+'" class="${prefix}-toolbar-group '+d+'"></div>'),tgroupBehaviours:H8([hk('adhoc-scrollable-toolbar',g.scrollable===true?[f8(function(e,f){ec.set(e.element(),'overflow-x','auto');rs.markAsHorizontal(e.element());Ln.register(e.element());})]:[])]),components:[nk.sketch({components:[bs.parts().items({})]})],markers:{itemClass:Db.resolve('toolbar-group-item')},items:g.items};};var t=wm(Yr.sketch({dom:fh('<div class="${prefix}-toolbar"></div>'),components:[Yr.parts().groups({})],toolbarBehaviours:H8([wb.config({toggleClass:Db.resolve('context-toolbar'),toggleOnExecute:false,aria:{mode:'none'}}),Bf.config({mode:'cyclic'})]),shell:true}));var w=wm(nk.sketch({dom:{classes:[Db.resolve('toolstrip')]},components:[xm(t)],containerBehaviours:H8([wb.config({toggleClass:Db.resolve('android-selection-context-toolbar'),toggleOnExecute:false})])}));var r=function(){Yr.setGroups(t,i.get());wb.off(t);};var i=B9([]);var s=function(g){i.set(g);r();};var c=function(g){return R2.map(g,$.compose(bs.sketch,m));};var Dt=function(){};var a=function(g){wb.on(t);Yr.setGroups(t,g);};var b=function(){if(wb.isOn(t)){r();}};var D1=function(){Bf.focusIn(t);};return{wrapper:$.constant(w),toolbar:$.constant(t),createGroups:c,setGroups:s,setContextToolbar:a,restoreToolbar:b,refresh:Dt,focus:D1};}var ts=function(a){return wm(Yg.sketch({dom:fh('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){a.run(function(w){w.setReadOnly(false);});}}));};var us=function(){return wm(nk.sketch({dom:fh('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:H8([bn.config({})])}));};var vs=function(s,a){bn.append(s,xm(a));};var ws=function(s,a){bn.remove(s,a);};var ys=function(s,a,r,b){var s9=r===true?A9.toAlpha:A9.toOmega;s9(b);var f=r?vs:ws;f(s,a);};var zs={makeEditSwitch:ts,makeSocket:us,updateMode:ys};var As=function(c,s){return s.getAnimationRoot().fold(function(){return c.element();},function(V8){return V8(c);});};var Bs=function(s){return s.dimension().property();};var Cs=function(s,e){return s.dimension().getDimension()(e);};var Ds=function(c,s){var r=As(c,s);jm.remove(r,[s.shrinkingClass(),s.growingClass()]);};var Es=function(c,s){r9.remove(c.element(),s.openClass());r9.add(c.element(),s.closedClass());ec.set(c.element(),Bs(s),'0px');ec.reflow(c.element());};var Fs=function(c,s){Gs(c,s);var e=Cs(s,c.element());Es(c,s);return e;};var Gs=function(c,s){r9.remove(c.element(),s.closedClass());r9.add(c.element(),s.openClass());ec.remove(c.element(),Bs(s));};var Hs=function(c,s,a){a.setCollapsed();ec.set(c.element(),Bs(s),Cs(s,c.element()));ec.reflow(c.element());Ds(c,s);Es(c,s);s.onStartShrink()(c);s.onShrunk()(c);};var Is=function(c,s,a){a.setCollapsed();ec.set(c.element(),Bs(s),Cs(s,c.element()));ec.reflow(c.element());var r=As(c,s);r9.add(r,s.shrinkingClass());Es(c,s);s.onStartShrink()(c);};var Js=function(c,s,a){var f=Fs(c,s);var r=As(c,s);r9.add(r,s.growingClass());Gs(c,s);ec.set(c.element(),Bs(s),f);a.setExpanded();s.onStartGrow()(c);};var Ks=function(c,s,a){if(!a.isExpanded()){Js(c,s,a);}};var Ls=function(c,s,a){if(a.isExpanded()){Is(c,s,a);}};var Ms=function(c,s,a){if(a.isExpanded()){Hs(c,s,a);}};var Ns=function(c,s,a){return a.isExpanded();};var Os=function(c,s,a){return a.isCollapsed();};var Ps=function(c,s,a){var r=As(c,s);return r9.has(r,s.growingClass())===true;};var Qs=function(c,s,a){var r=As(c,s);return r9.has(r,s.shrinkingClass())===true;};var Rs=function(c,s,a){return Ps(c,s,a)===true||Qs(c,s,a)===true;};var Ss=function(c,s,a){var f=a.isExpanded()?Is:Js;f(c,s,a);};var Ts=Object.freeze({grow:Ks,shrink:Ls,immediateShrink:Ms,hasGrown:Ns,hasShrunk:Os,isGrowing:Ps,isShrinking:Qs,isTransitioning:Rs,toggleGrow:Ss,disableTransitions:Ds});var Us=function(z8,s){var e=s.expanded();return e?p8({classes:[s.openClass()],styles:{}}):p8({classes:[s.closedClass()],styles:E6(s.dimension().property(),'0px')});};var Vs=function(s,a){return T7([W7(F1(),function(c,b){var r=b.event().raw();if(r.propertyName===s.dimension().property()){Ds(c,s);if(a.isExpanded()){ec.remove(c.element(),s.dimension().property());}var n=a.isExpanded()?s.onGrown():s.onShrunk();n(c,b);}})]);};var Ws=Object.freeze({exhibit:Us,events:Vs});var Xs=[A7('closedClass'),A7('openClass'),A7('shrinkingClass'),A7('growingClass'),F7('getAnimationRoot'),Ya('onShrunk'),Ya('onStartShrink'),Ya('onGrown'),Ya('onStartGrow'),J7('expanded',false),B7('dimension',w7('property',{width:[ab('property','width'),ab('getDimension',function(e){return vi.get(e)+'px';})],height:[ab('property','height'),ab('getDimension',function(e){return lc.get(e)+'px';})]}))];var Ys=function(gh){var j7=B9(gh.expanded());var r=function(){return'expanded: '+j7.get();};return E8({isExpanded:function(){return j7.get()===true;},isCollapsed:function(){return j7.get()===false;},setCollapsed:$.curry(j7.set,false),setExpanded:$.curry(j7.set,true),readState:r});};var Zs=Object.freeze({init:Ys});var $s=J8({fields:Xs,name:'sliding',active:Ws,apis:Ts,state:Zs});var _s=function(Dt,Ku){var d=wm(nk.sketch({dom:{tag:'div',classes:Db.resolve('dropup')},components:[],containerBehaviours:H8([bn.config({}),$s.config({closedClass:Db.resolve('dropup-closed'),openClass:Db.resolve('dropup-open'),shrinkingClass:Db.resolve('dropup-shrinking'),growingClass:Db.resolve('dropup-growing'),dimension:{property:'height'},onShrunk:function(c){Dt();Ku();bn.set(c,[]);},onGrown:function(c){Dt();Ku();}}),Ab.orientation(function(c,cr){b($.noop);})])}));var a=function(m,u,c){if($s.hasShrunk(d)===true&&$s.isTransitioning(d)===false){window.requestAnimationFrame(function(){u(c);bn.set(d,[m()]);$s.grow(d);});}};var b=function(o){window.requestAnimationFrame(function(){o();$s.shrink(d);});};return{appear:a,disappear:b,component:$.constant(d),element:d.element};};var at=function(e){return e.raw().which===Gc.BACKSPACE()[0]&&!R2.contains(['input','textarea'],l4.name(e.target()));};var bt=A3.detect().browser.isFirefox();var ct=d7([C7('triggerEvent'),C7('broadcastEvent'),J7('stopBackspace',true)]);var dt=function(c,h){if(bt){return so.capture(c,'focus',h);}else{return so.bind(c,'focusin',h);}};var et=function(c,h){if(bt){return so.capture(c,'blur',h);}else{return so.bind(c,'focusout',h);}};var ft=function(c,r){var s=t7('Getting GUI events settings',ct,r);var p=A3.detect().deviceType.isTouch()?['touchstart','touchmove','touchend','gesturestart']:['mousedown','mouseup','mouseover','mousemove','mouseout','click'];var t=Eo(s);var a=R2.map(p.concat(['selectstart','input','contextmenu','change','transitionend','dragstart','dragover','drop']),function(e4){return so.bind(c,e4,function(e){t.fireIfReady(e,e4).each(function(h){if(h){e.kill();}});var g=s.triggerEvent(e4,e);if(g){e.kill();}});});var o=so.bind(c,'keydown',function(e){var g=s.triggerEvent('keydown',e);if(g){e.kill();}else if(s.stopBackspace===true&&at(e)){e.prevent();}});var b=dt(c,function(e){var g=s.triggerEvent('focusin',e);if(g){e.kill();}});var d=et(c,function(e){var g=s.triggerEvent('focusout',e);if(g){e.kill();}setTimeout(function(){s.triggerEvent(D3(),e);},0);});var g5=y5.defaultView(c);var f=so.bind(g5,'scroll',function(e){var g=s.broadcastEvent(M3(),e);if(g){e.kill();}});var mo=function(){R2.each(a,function(e){e.unbind();});o.unbind();b.unbind();d.unbind();f.unbind();};return{unbind:mo};};var gt=function(r,a){var s=D6(r,'target').map(function(g){return g();}).getOr(a);return B9(s);};var ht=function(e,s){var c8=B9(false);var b8=B9(false);var a=function(){c8.set(true);};var c=function(){b8.set(true);};return{stop:a,cut:c,isStopped:c8.get,isCut:b8.get,event:$.constant(e),setSource:s.set,getSource:s.get};};var it=function(e){var c8=B9(false);var s=function(){c8.set(true);};return{stop:s,cut:$.noop,isStopped:c8.get,isCut:$.constant(false),event:$.constant(e),setTarget:$.die('Cannot set target of a broadcasted event'),getTarget:$.die('Cannot get target of a broadcasted event')};};var jt=_5.generate([{stopped:[]},{resume:['element']},{complete:[]}]);var kt=function(l,e,r,t,s,a){var h=l(e,t);var b=ht(r,s);return h.fold(function(){a.logEventNoHandlers(e,t);return jt.complete();},function(c){var d=c.descHandler();var rt=Ql(d);rt(b);if(b.isStopped()){a.logEventStopped(e,c.element(),d.purpose());return jt.stopped();}else if(b.isCut()){a.logEventCut(e,c.element(),d.purpose());return jt.complete();}else{return y5.parent(c.element()).fold(function(){a.logNoParent(e,c.element(),d.purpose());return jt.complete();},function(h5){a.logEventResponse(e,c.element(),d.purpose());return jt.resume(h5);});}});};var lt=function(l,e,r,a,s,b){return kt(l,e,r,a,s,b).fold(function(){return true;},function(h5){return lt(l,e,r,h5,s,b);},function(){return false;});};var mt=function(l,e,r,t,a){var s=gt(r,t);return kt(l,e,r,t,s,a);};var nt=function(l,r,a){var s=it(r);R2.each(l,function(b){var d=b.descHandler();var h=Ql(d);h(s);});return s.isStopped();};var ot=function(l,e,r,a){var b=r.target();return pt(l,e,r,b,a);};var pt=function(l,e,r,a,b){var s=gt(r,a);return lt(l,e,r,a,s,b);};var qt=function(t,a,i){var d=J9.closest(t,function(e){return a(e).isSome();},i);return d.bind(a);};var rt=z4.immutable('element','descHandler');var st=function(i,h){return{id:$.constant(i),descHandler:$.constant(h)};};function tt(){var r={};var a=function(e,i,Aa){o1.each(Aa,function(v,k){var h=r[k]!==undefined?r[k]:{};h[i]=Pl(v,e);r[k]=h;});};var b=function(h,e){return Kg(e).fold(function(){return c1.none();},function(i){var d=B6(i);return h.bind(d).map(function(f){return rt(e,f);});});};var c=function(e4){return D6(r,e4).map(function(h){return o1.mapToArray(h,function(f,i){return st(i,f);});}).getOr([]);};var l1=function(i,e4,t){var d=B6(e4);var h=d(r);return qt(t,function(e){return b(h,e);},i);};var u=function(i){o1.each(r,function(h,e){if(h.hasOwnProperty(i)){delete h[i];}});};return{registerId:a,unregisterId:u,filterByType:c,find:l1};}function ut(){var Aa=tt();var sg={};var r=function(c){var e=c.element();return Kg(e).fold(function(){return Ig('uid-',c.element());},function(a){return a;});};var f=function(c,t){var a=sg[t];if(a===c){u(c);}else{throw new Error('The tagId "'+t+'" is already used by: '+ya(a.element())+'\nCannot use it for: '+ya(c.element())+'\n'+'The conflicting element is'+(p4.inBody(a.element())?' ':' not ')+'already in the DOM');}};var Jn=function(c){var t=r(c);if(H6(sg,t)){f(c,t);}var e=[c];Aa.registerId(e,t,c.events());sg[t]=c;};var u=function(c){Kg(c.element()).each(function(t){sg[t]=undefined;Aa.unregisterId(t);});};var w2=function(e4){return Aa.filterByType(e4);};var l1=function(i,e4,t){return Aa.find(i,e4,t);};var g=function(i){return B6(i)(sg);};return{find:l1,filter:w2,register:Jn,unregister:u,getById:g};}var vt=function(r){var i=function(c){return y5.parent(r.element()).fold(function(){return true;},function(h5){return d5.eq(c,h5);});};var a=ut();var l=function(c,t){return a.find(i,c,t);};var d=ft(r.element(),{triggerEvent:function(c,n){return Ma(c,n.target(),function(o){return ot(l,c,n,o);});},broadcastEvent:function(c,n){var o=a.filter(c);return nt(o,n);}});var s=yl({debugInfo:$.constant('real'),triggerEvent:function(c,t,cr){Ma(c,t,function(n){pt(l,c,cr,t,n);});},triggerFocus:function(t,o){Kg(t).fold(function(){X9.focus(t);},function(_){Ma(C3(),t,function(c){mt(l,C3(),{originator:$.constant(o),target:$.constant(t)},t,c);});});},triggerEscape:function(c,n){s.triggerEvent('keydown',c.element(),n.event());},getByUid:function(u){return k(u);},getByDom:function(c){return m(c);},build:wm,addToGui:function(c){c9(c);},removeFromGui:function(c){M5(c);},addToWorld:function(c){b(c);},removeFromWorld:function(c){e(c);},broadcast:function(c){h(c);},broadcastOn:function(c,n){j(c,n);},isConnected:$.constant(true)});var b=function(c){c.connect(s);if(!l4.isText(c.element())){a.register(c);R2.each(c.components(),b);s.triggerEvent(L3(),c.element(),{target:$.constant(c.element())});}};var e=function(c){if(!l4.isText(c.element())){R2.each(c.components(),e);a.unregister(c);}c.disconnect();};var c9=function(c){R5(r,c);};var M5=function(c){U5(c);};var f=function(){d.unbind();O5.remove(r.element());};var g=function(cr){var c=a.filter(E3());R2.each(c,function(n){var o=n.descHandler();var p=Ql(o);p(cr);});};var h=function(c){g({universal:$.constant(true),data:$.constant(c)});};var j=function(c,n){g({universal:$.constant(false),channels:$.constant(c),data:$.constant(n)});};var k=function(u){return a.getById(u).fold(function(){return Z5.error(new Error('Could not find component with uid: "'+u+'" in system.'));},Z5.value);};var m=function(c){var u=Kg(c).getOr('not found');return k(u);};b(r);return{root:$.constant(r),element:r.element,destroy:f,add:c9,remove:M5,getByUid:k,getByDom:m,addToWorld:b,removeFromWorld:e,broadcast:h,broadcastOn:j};};var wt=$.constant(Db.resolve('readonly-mode'));var xt=$.constant(Db.resolve('edit-mode'));function yt(gh){var r=wm(nk.sketch({dom:{classes:[Db.resolve('outer-container')].concat(gh.classes)},containerBehaviours:H8([A9.config({alpha:wt(),omega:xt()})])}));return vt(r);}function zt(Ku){var B3=yt({classes:[Db.resolve('android-container')]});var t=ss();var a=jl.api();var s=zs.makeEditSwitch(a);var b=zs.makeSocket();var d=_s($.noop,Ku);B3.add(t.wrapper());B3.add(b);B3.add(d.component());var c=function(h){var i=t.createGroups(h);t.setGroups(i);};var e=function(h){var i=t.createGroups(h);t.setContextToolbar(i);};var f=function(){t.focus();};var r=function(){t.restoreToolbar();};var F8=function(gh){a.set(Sr.produce(gh));};var g=function(){a.run(function(w){w.exit();bn.remove(b,s);});};var ys=function(h){zs.updateMode(b,s,h,B3.root());};return{system:$.constant(B3),element:B3.element,init:F8,exit:g,setToolbarGroups:c,setContextToolbar:e,focusToolbar:f,restoreToolbar:r,updateMode:ys,socket:$.constant(b),dropup:$.constant(d)};}var At=function(h5,o){var B1=b4.fromTag('input');ec.setAll(B1,{opacity:'0',position:'absolute',top:'-1000px',left:'-1000px'});F5.append(h5,B1);X9.focus(B1);o(B1);O5.remove(B1);};var Bt={input:At};var Ct=function(B1){var s=B1.dom().selectionStart;var e=B1.dom().selectionEnd;var d=B1.dom().selectionDirection;setTimeout(function(){B1.dom().setSelectionRange(s,e,d);X9.focus(B1);},50);};var Dt=function(w){var s=w.getSelection();if(s.rangeCount>0){var b=s.getRangeAt(0);var r=w.document.createRange();r.setStart(b.startContainer,b.startOffset);r.setEnd(b.endContainer,b.endOffset);s.removeAllRanges();s.addRange(r);}};var Et={refreshInput:Ct,refresh:Dt};var Ft=function(c,f){X9.active().each(function(U9){if(!d5.eq(U9,f)){X9.blur(U9);}});c.focus();X9.focus(b4.fromDom(c.document.body));Et.refresh(c);};var Gt={resume:Ft};var Ht=function(o,c,p,f){var t=function(){Gt.resume(c,f);};var a=function(){Bt.input(o,X9.blur);};var b=so.bind(p,'keydown',function(g){if(!R2.contains(['input','textarea'],l4.name(g.target()))){t();}});var d=function(){};var e=function(){b.unbind();};return{toReading:a,toEditing:t,onToolbarTouch:d,destroy:e};};var It=function(o,c,p,f){var d=function(){X9.blur(f);};var a=function(){d();};var t=function(){d();};var b=function(){Gt.resume(c,f);};return{toReading:t,toEditing:b,onToolbarTouch:a,destroy:$.noop};};var Jt={stubborn:Ht,timid:It};var Kt=function(e,i,t,s,d){var a=function(){i.run(function(gc){gc.highlightSelection();});};var r=function(){i.run(function(gc){gc.refreshSelection();});};var b=function(l,x){var y=l-s.dom().scrollTop;i.run(function(gc){gc.scrollIntoView(y,y+x);});};var c=function(l){b(i,s);};var f=function(){e.getCursorBox().each(function(l){b(l.top(),l.height());});};var g=function(){i.run(function(gc){gc.clearSelection();});};var h=function(){g();u.throttle();};var j=function(){f();i.run(function(gc){gc.syncHeight();});};var k=function(){var l=lc.get(t);i.run(function(gc){gc.setViewportOffset(l);});r();j();};var m=function(){i.run(function(gc){gc.toEditing();});};var n=function(){i.run(function(gc){gc.toReading();});};var o=function(l){i.run(function(gc){gc.onToolbarTouch(l);});};var p=Go.monitor(e);var u=Nr.last(j,300);var v=[e.onKeyup(h),e.onNodeChanged(r),e.onDomChanged(u.throttle),e.onDomChanged(r),e.onScrollToCursor(function(l){l.preventDefault();u.throttle();}),e.onScrollToElement(function(l){c(l.element());}),e.onToEditing(m),e.onToReading(n),so.bind(e.doc(),'touchend',function(l){if(d5.eq(e.html(),l.target())||d5.eq(e.body(),l.target())){}}),so.bind(t,'transitionend',function(l){if(l.raw().propertyName==='height'){k();}}),so.capture(t,'touchstart',function(l){a();o(l);e.onTouchToolstrip();}),so.bind(e.body(),'touchstart',function(l){g();e.onTouchContent();p.fireTouchstart(l);}),p.onTouchmove(),p.onTouchend(),so.bind(e.body(),'click',function(l){l.kill();}),so.bind(t,'touchmove',function(){e.onToolbarScrollStart();})];var w=function(){R2.each(v,function(l){l.unbind();});};return{destroy:w};};var Lt={initEvents:Kt};function Mt(w,f){var d=w.document;var c=b4.fromTag('div');r9.add(c,Db.resolve('unfocused-selections'));F5.append(b4.fromDom(d.documentElement),c);var o=so.bind(c,'touchstart',function(e){e.prevent();Gt.resume(w,f);v9();});var al=function(r){var s=b4.fromTag('span');jm.add(s,[Db.resolve('layer-editor'),Db.resolve('unfocused-selection')]);ec.setAll(s,{left:r.left()+'px',top:r.top()+'px',width:r.width()+'px',height:r.height()+'px'});return s;};var u=function(){v9();var r=Yq.getRectangles(w);var s=R2.map(r,al);K5.append(c,s);};var v9=function(){O5.empty(c);};var a=function(){o.unbind();O5.remove(c);};var i=function(){return y5.children(c).length>0;};return{update:u,isActive:i,destroy:a,clear:v9};}var Nt=function(b){var cr=c1.none();var c=[];var s2=function(f){return Nt(function(n){V8(function(cr){n(f(cr));});});};var V8=function(n){if(i())J(n);else c.push(n);};var T8=function(x){cr=c1.some(x);W7(c);c=[];};var i=function(){return cr.isSome();};var W7=function(a){R2.each(a,J);};var J=function(a){cr.each(function(x){setTimeout(function(){a(x);},0);});};b(T8);return{get:V8,map:s2,isReady:i};};var Ot=function(a){return Nt(function(c){c(a);});};var Pt={nu:Nt,pure:Ot};var Qt=function(f){return function(){var a=Array.prototype.slice.call(arguments);var m=this;setTimeout(function(){f.apply(m,a);},0);};};var Rt={bounce:Qt};var St=function(b){var V8=function(a){b(Rt.bounce(a));};var s2=function(f){return St(function(d){V8(function(a){var f4=f(a);d(f4);});});};var F2=function(f){return St(function(d){V8(function(a){f(a).get(d);});});};var c=function(f){return St(function(d){V8(function(a){f.get(d);});});};var t=function(){return Pt.nu(V8);};return{map:s2,bind:F2,anonBind:c,toLazy:t,get:V8};};var Tt=function(a){return St(function(c){c(a);});};var Ut={nu:St,pure:Tt};var Vt=function(f4,d,a){if(Math.abs(f4-d)<=a){return c1.none();}else if(f4<d){return c1.some(f4+a);}else{return c1.some(f4-a);}};var Wt=function(){var i=null;var a=function(ik,d,b,c,e,r){var f=false;var g=function(v){f=true;e(v);};clearInterval(i);var U7=function(v){clearInterval(i);g(v);};i=setInterval(function(){var f4=ik();Vt(f4,d,b).fold(function(){clearInterval(i);g(d);},function(s){c(s,U7);if(!f){var n=ik();if(n!==s||Math.abs(n-d)>Math.abs(f4-d)){clearInterval(i);g(d);}}});},r);};return{animate:a};};var Xt={create:Wt,adjust:Vt};var Yt=function(d,a){var b=[{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}];return Fa.findMap(b,function(c){return d<=c.width&&a<=c.height?c1.some(c.keyboard):c1.none();}).getOr({portrait:a/5,landscape:d/4});};var Zt={findDevice:Yt};var $t=function(o){return Zt.findDevice(o.screen.width,o.screen.height);};var _t=function(o){var p=yo.get(o).isPortrait();var l=$t(o);var k=p?l.portrait:l.landscape;var v=p?o.screen.height:o.screen.width;return v-o.innerHeight>k?0:k;};var au=function(s,d){var o=y5.owner(s).dom().defaultView;var v=lc.get(s)+lc.get(d);var a=_t(o);return v-a;};var bu=function(c,s,d){var g=au(s,d);var a=lc.get(s)+lc.get(d)-g;ec.set(c,'padding-bottom',a+'px');};var cu={getGreenzone:au,updatePadding:bu};var du=_5.generate([{fixed:['element','property','offsetY']},{scroller:['element','offsetY']}]);var eu='data-'+Db.resolve('position-y-fixed');var fu='data-'+Db.resolve('y-property');var gu='data-'+Db.resolve('scrolling');var hu='data-'+Db.resolve('last-window-height');var iu=function(ya){return Lo.safeParse(ya,eu);};var ju=function(ya){return a9.get(ya,fu);};var ku=function(ya){return Lo.safeParse(ya,hu);};var lu=function(ya,o){var p=ju(ya);return du.fixed(ya,p,o);};var mu=function(ya,o){return du.scroller(ya,o);};var ou=function(ya){var o=iu(ya);var c=a9.get(ya,gu)==='true'?mu:lu;return c(ya,o);};var pu=function(c){var Li=yc.descendants(c,'['+eu+']');return R2.map(Li,ou);};var qu=function(t){var o=a9.get(t,'style');ec.setAll(t,{position:'absolute',top:'0px'});a9.set(t,eu,'0px');a9.set(t,fu,'top');var r=function(){a9.set(t,'style',o||'');a9.remove(t,eu);a9.remove(t,fu);};return{restore:r};};var ru=function(t,h,v){var o=a9.get(v,'style');Ln.register(v);ec.setAll(v,{position:'absolute',height:h+'px',width:'100%',top:t+'px'});a9.set(v,eu,t+'px');a9.set(v,gu,'true');a9.set(v,fu,'top');var r=function(){Ln.deregister(v);a9.set(v,'style',o||'');a9.remove(v,eu);a9.remove(v,gu);a9.remove(v,fu);};return{restore:r};};var su=function(d,t,v){var o=a9.get(d,'style');ec.setAll(d,{position:'absolute',bottom:'0px'});a9.set(d,eu,'0px');a9.set(d,fu,'bottom');var r=function(){a9.set(d,'style',o||'');a9.remove(d,eu);a9.remove(d,fu);};return{restore:r};};var tu=function(v,t,d){var o=y5.owner(v).dom().defaultView;var w=o.innerHeight;a9.set(v,hu,w+'px');return w-t-d;};var uu=function(v,c,t,d){var o=y5.owner(v).dom().defaultView;var a=qu(t);var b=lc.get(t);var e=lc.get(d);var f=tu(v,b,e);var g=ru(b,f,v);var h=su(d,b,f);var i=true;var r=function(){i=false;a.restore();g.restore();h.restore();};var j=function(){var k=o.innerHeight;var l=ku(v);return k>l;};var Dt=function(){if(i){var n=lc.get(t);var k=lc.get(d);var l=tu(v,n,k);a9.set(v,eu,n+'px');ec.set(v,'height',l+'px');ec.set(d,'bottom',-(n+l+k)+'px');cu.updatePadding(c,v,d);}};var s=function(n){var k=n+'px';a9.set(v,eu,k);Dt();};cu.updatePadding(c,v,d);return{setViewportOffset:s,isExpanding:j,isShrinking:$.not(j),refresh:Dt,restore:r};};var vu={findFixtures:pu,takeover:uu,getYFixedData:iu};var wu=Xt.create();var xu=15;var yu=10;var zu=10;var Au='data-'+Db.resolve('last-scroll-top');var Bu=function(ya){var r=ec.getRaw(ya,'top').getOr(0);return parseInt(r,10);};var Cu=function(ya){return parseInt(ya.dom().scrollTop,10);};var Du=function(ya,d,f){return Ut.nu(function(c){var ik=$.curry(Cu,ya);var u=function(n){ya.dom().scrollTop=n;ec.set(ya,'top',Bu(ya)+xu+'px');};var a=function(){ya.dom().scrollTop=d;ec.set(ya,'top',f+'px');c(d);};wu.animate(ik,d,xu,u,a,zu);});};var Eu=function(ya,d){return Ut.nu(function(c){var ik=$.curry(Cu,ya);a9.set(ya,Au,ik());var u=function(n,U7){var p=Lo.safeParse(ya,Au);if(p!==ya.dom().scrollTop){U7(ya.dom().scrollTop);}else{ya.dom().scrollTop=n;a9.set(ya,Au,n);}};var f=function(){ya.dom().scrollTop=d;a9.set(ya,Au,d);c(d);};var a=Math.abs(d-ik());var F4=Math.ceil(a/yu);wu.animate(ik,d,F4,u,f,zu);});};var Fu=function(ya,d){return Ut.nu(function(c){var ik=$.curry(Bu,ya);var u=function(n){ec.set(ya,'top',n+'px');};var f=function(){u(d);c(d);};var a=Math.abs(d-ik());var F4=Math.ceil(a/yu);wu.animate(ik,d,F4,u,f,zu);});};var Gu=function(ya,a){var n=a+vu.getYFixedData(ya)+'px';ec.set(ya,'top',n);};var Hu=function(t,v,d){var o=y5.owner(t).dom().defaultView;return Ut.nu(function(c){Gu(t,d);Gu(v,d);o.scrollTo(0,d);c(d);});};var Iu={moveScrollAndTop:Du,moveOnlyScroll:Eu,moveOnlyTop:Fu,moveWindowScroll:Hu};function Ju(d){var a=B9(Pt.pure({}));var s=function(f4){var f=Pt.nu(function(c){return d(f4).get(c);});a.set(f);};var i=function(g){a.get().get(function(){g();});};return{start:s,idle:i};}var Ku=function(c,s,d,t,b){var g=cu.getGreenzone(s,d);var r=$.curry(Et.refresh,c);if(t>g||b>g){Iu.moveOnlyScroll(s,s.dom().scrollTop-g+b).get(r);}else if(t<0){Iu.moveOnlyScroll(s,s.dom().scrollTop+t).get(r);}else{}};var Lu={scrollIntoView:Ku};var Mu=function(a,n){return n(function(c){var r=[];var b=0;var d=function(i){return function(f4){r[i]=f4;b++;if(b>=a.length){c(r);}};};if(a.length===0){c([]);}else{R2.each(a,function(e,i){e.get(d(i));});}});};var Nu={par:Mu};var Ou=function(f){return Nu.par(f,Ut.nu);};var Pu=function(a,f){var b=R2.map(a,f);return Ou(b);};var Qu=function(f,g){return function(a){return g(a).bind(f);};};var Ru={par:Ou,mapM:Pu,compose:Qu};var Su=function(ya,p,w,o){var d=w+o;ec.set(ya,p,d+'px');return Ut.pure(o);};var Tu=function(ya,w,o){var d=w+o;var a=ec.getRaw(ya,'top').getOr(o);var b=d-parseInt(a,10);var c=ya.dom().scrollTop+b;return Iu.moveScrollAndTop(ya,c,d);};var Uu=function(du,w){return du.fold(function(ya,p,o){return Su(ya,p,w,o);},function(ya,o){return Tu(ya,w,o);});};var Vu=function(c,w){var f=vu.findFixtures(c);var u=R2.map(f,function(du){return Uu(du,w);});return Ru.par(u);};var Wu={updatePositions:Vu};var Xu=5;var Yu=function(t,s,c,o,a,b){var d=Ju(function(y){return Iu.moveWindowScroll(t,s,y);});var e=function(){var r=Yq.getRectangles(b);return c1.from(r[0]).bind(function(h){var v=h.top()-s.dom().scrollTop;var i=v>o.innerHeight+Xu||v<-Xu;return i?c1.some({top:$.constant(v),bottom:$.constant(v+h.height())}):c1.none();});};var f=Nr.last(function(){d.idle(function(){Wu.updatePositions(c,o.pageYOffset).get(function(){var h=e();h.each(function(i){s.dom().scrollTop=s.dom().scrollTop+i.top();});d.start(0);a.refresh();});});},1000);var g=so.bind(b4.fromDom(o),'scroll',function(){if(o.pageYOffset<0){return;}f.throttle();});Wu.updatePositions(c,o.pageYOffset).get($.identity);return{unbind:g.unbind};};var Zu=function(b){var c=b.cWin();var a=b.ceBody();var s=b.socket();var t=b.toolstrip();var d=b.toolbar();var e=b.contentElement();var k=b.keyboardType();var o=b.outerWindow();var f=b.dropup();var g=vu.takeover(s,a,t,f);var h=k(b.outerBody(),c,p4.body(),e,t,d);var i=function(){h.toEditing();w();};var j=function(){h.toReading();};var l=function(a1){h.onToolbarTouch(a1);};var m=yo.onChange(o,{onChange:$.noop,onReady:g.refresh});m.onAdjustment(function(){g.refresh();});var n=so.bind(b4.fromDom(o),'resize',function(){if(g.isExpanding()){g.refresh();}});var p=Yu(t,s,b.outerBody(),o,g,c);var u=Mt(c,e);var r=function(){if(u.isActive()){u.update();}};var v=function(){u.update();};var w=function(){u.clear();};var Ku=function(a1,d1){Lu.scrollIntoView(c,s,f,a1,d1);};var x=function(){ec.set(e,'height',e.dom().contentWindow.document.body.scrollHeight+'px');};var y=function(a1){g.setViewportOffset(a1);Iu.moveOnlyTop(s,a1).get($.identity);};var _=function(){g.restore();m.destroy();p.unbind();n.unbind();h.destroy();u.destroy();Bt.input(p4.body(),X9.blur);};return{toEditing:i,toReading:j,onToolbarTouch:l,refreshSelection:r,clearSelection:w,highlightSelection:v,scrollIntoView:Ku,updateToolbarPadding:$.noop,setViewportOffset:y,syncHeight:x,refreshStructure:g.refresh,destroy:_};};var $u={setup:Zu};var _u=function(Fh,m){var a=Hr.tag();var p=jl.value();var b=jl.value();var i=jl.api();var c=jl.api();var e=function(){m.hide();var f=b4.fromDom(document);vr.getActiveApi(Fh.editor).each(function(g){p.set({socketHeight:ec.getRaw(Fh.socket,'height'),iframeHeight:ec.getRaw(g.frame(),'height'),outerScroll:document.body.scrollTop});b.set({exclusives:rs.exclusive(f,'.'+Ln.scrollable())});r9.add(Fh.container,Db.resolve('fullscreen-maximized'));Fr.clobberStyles(Fh.container,g.body());a.maximize();ec.set(Fh.socket,'overflow','scroll');ec.set(Fh.socket,'-webkit-overflow-scrolling','touch');X9.focus(g.body());var h=z4.immutableBag(['cWin','ceBody','socket','toolstrip','toolbar','dropup','contentElement','cursor','keyboardType','isScrolling','outerWindow','outerBody'],[]);i.set($u.setup(h({cWin:g.win(),ceBody:g.body(),socket:Fh.socket,toolstrip:Fh.toolstrip,toolbar:Fh.toolbar,dropup:Fh.dropup.element(),contentElement:g.frame(),cursor:$.noop,outerBody:Fh.body,outerWindow:Fh.win,keyboardType:Jt.stubborn,isScrolling:function(){return b.get().exists(function(s){return s.socket.isScrolling();});}})));i.run(function(gc){gc.syncHeight();});c.set(Lt.initEvents(g,i,Fh.toolstrip,Fh.socket,Fh.dropup));});};var d=function(){a.restore();c.clear();i.clear();m.show();p.on(function(s){s.socketHeight.each(function(h){ec.set(Fh.socket,'height',h);});s.iframeHeight.each(function(h){ec.set(Fh.editor.getFrame(),'height',h);});document.body.scrollTop=s.scrollTop;});p.clear();b.on(function(s){s.exclusives.unbind();});b.clear();r9.remove(Fh.container,Db.resolve('fullscreen-maximized'));Fr.restoreStyles();Ln.deregister(Fh.toolbar);ec.remove(Fh.socket,'overflow');ec.remove(Fh.socket,'-webkit-overflow-scrolling');X9.blur(Fh.editor.getFrame());vr.getActiveApi(Fh.editor).each(function(f){f.clearSelection();});};var r=function(){i.run(function(gc){gc.refreshStructure();});};return{enter:e,refreshStructure:r,exit:d};};var bv={create:_u};var cv=function(r){var q=t7('Getting IosWebapp schema',Qr,r);ec.set(q.toolstrip,'width','100%');ec.set(q.container,'position','relative');var o=function(){q.setReadOnly(q.readOnlyOnInit());b.enter();};var m=wm(Pr.sketch(o,q.translate));q.alloy.add(m);var a={show:function(){q.alloy.add(m);},hide:function(){q.alloy.remove(m);}};var b=bv.create(q,a);return{setReadOnly:q.setReadOnly,refreshStructure:b.refreshStructure,enter:b.enter,exit:b.exit,destroy:$.noop};};var dv={produce:cv};function ev(Ku){var B3=yt({classes:[Db.resolve('ios-container')]});var t=ss();var a=jl.api();var s=zs.makeEditSwitch(a);var b=zs.makeSocket();var d=_s(function(){a.run(function(w){w.refreshStructure();});},Ku);B3.add(t.wrapper());B3.add(b);B3.add(d.component());var c=function(h){var i=t.createGroups(h);t.setGroups(i);};var e=function(h){var i=t.createGroups(h);t.setContextToolbar(i);};var f=function(){t.focus();};var r=function(){t.restoreToolbar();};var F8=function(gh){a.set(dv.produce(gh));};var g=function(){a.run(function(w){bn.remove(b,s);w.exit();});};var ys=function(h){zs.updateMode(b,s,h,B3.root());};return{system:$.constant(B3),element:B3.element,init:F8,exit:g,setToolbarGroups:c,setContextToolbar:e,focusToolbar:f,restoreToolbar:r,updateMode:ys,socket:$.constant(b),dropup:$.constant(d)};}var fv=tinymce.util.Tools.resolve('tinymce.EditorManager');var gv=function(e){var z8=D6(e.settings,'skin_url').fold(function(){return fv.baseURL+'/skins/'+'lightgray';},function(u){return u;});return{content:z8+'/content.mobile.min.css',ui:z8+'/skin.mobile.min.css'};};var hv={derive:gv};var iv=['x-small','small','medium','large','x-large'];var jv=function(r,c,j7){r.system().broadcastOn([ga.formatChanged()],{command:c,state:j7});};var lv=function(r,e){var a=o1.keys(e.formatter.get());R2.each(a,function(c){e.formatter.formatChanged(c,function(j7){jv(r,c,j7);});});R2.each(['ul','ol'],function(c){e.selection.selectorChanged(c,function(j7,cr){jv(r,c,j7);});});};var mv={init:lv,fontSizes:$.constant(iv)};var nv=function(e){var d=function(){e._skinLoaded=true;e.fire('SkinLoaded');};return function(){if(e.initialized){d();}else{e.on('init',d);}};};var pv={fireSkinLoaded:nv};var qv=$.constant('toReading');var rv=$.constant('toEditing');Z9.add('mobile',function(e){var r=function(a){var c=hv.derive(e);if(aa(e)===false){e.contentCSS.push(c.content);Y9.DOM.styleSheetLoader.load(c.ui,pv.fireSkinLoaded(e));}else{pv.fireSkinLoaded(e)();}var d=function(){e.fire('scrollIntoView');};var w=b4.fromTag('div');var b=A3.detect().os.isAndroid()?zt(d):ev(d);var jg=b4.fromDom(a.targetNode);F5.after(jg,w);W5(w,b.system());var f=function(i){return X9.search(i).bind(function(j){return b.system().getByDom(j).toOption();});};var o=a.targetNode.ownerDocument.defaultView;var yb=yo.onChange(o,{onChange:function(){var B3=b.system();B3.broadcastOn([ga.orientationChanged()],{width:yo.getActualWidth(o)});},onReady:$.noop});var s=function(i,j,m,k){if(k===false){e.selection.collapse();}var t=g(i,j,m);b.setToolbarGroups(k===true?t.readOnly:t.main);e.setMode(k===true?'readonly':'design');e.fire(k===true?qv():rv());b.updateMode(k);};var g=function(i,j,m){var k=i.get();var t={readOnly:k.backToMask.concat(j.get()),main:k.backToMask.concat(m.get())};if(ba(e)){t.readOnly=k.backToMask.concat(j.get());t.main=k.backToReadOnly.concat(m.get());}return t;};var h=function(l,i){e.on(l,i);return{unbind:function(){e.off(l);}};};e.on('init',function(){b.init({editor:{getFrame:function(){return b4.fromDom(e.contentAreaContainer.querySelector('iframe'));},onDomChanged:function(){return{unbind:$.noop};},onToReading:function(y){return h(qv(),y);},onToEditing:function(y){return h(rv(),y);},onScrollToCursor:function(y){e.on('scrollIntoView',function(_){y(_);});var mo=function(){e.off('scrollIntoView');yb.destroy();};return{unbind:mo};},onTouchToolstrip:function(){i();},onTouchContent:function(){var y=b4.fromDom(e.editorContainer.querySelector('.'+Db.resolve('toolbar')));f(y).each(T3);b.restoreToolbar();i();},onTapContent:function(y){var _=y.target();if(l4.name(_)==='img'){e.selection.select(_.dom());y.kill();}else if(l4.name(_)==='a'){var a1=b.system().getByDom(b4.fromDom(e.editorContainer));a1.each(function(d1){if(A9.isAlpha(d1)){_9.openLink(_.dom());}});}}},container:b4.fromDom(e.editorContainer),socket:b4.fromDom(e.contentAreaContainer),toolstrip:b4.fromDom(e.editorContainer.querySelector('.'+Db.resolve('toolstrip'))),toolbar:b4.fromDom(e.editorContainer.querySelector('.'+Db.resolve('toolbar'))),dropup:b.dropup(),alloy:b.system(),translate:$.noop,setReadOnly:function(y){s(x,v,u,y);},readOnlyOnInit:function(){return ba(e);}});var i=function(){b.dropup().disappear(function(){b.system().broadcastOn([ga.dropupDismissed()],{});});};var j={label:'The first group',scrollable:false,items:[mh.forToolbar('back',function(){e.selection.collapse();b.exit();},{})]};var k={label:'Back to read only',scrollable:false,items:[mh.forToolbar('readonly-back',function(){s(x,v,u,true);},{})]};var l={label:'The read only mode group',scrollable:true,items:[]};var m=fo.setup(b,e);var n=fo.detect(e.settings,m);var p={label:'the action group',scrollable:true,items:n};var t={label:'The extra group',scrollable:false,items:[]};var u=B9([p,t]);var v=B9([l,t]);var x=B9({backToMask:[j],backToReadOnly:[k]});mv.init(b,e);});return{iframeContainer:b.socket().element().dom(),editorContainer:b.element().dom()};};return{getNotificationManagerImpl:function(){return{open:$.identity,close:$.noop,reposition:$.noop,getArgs:$.identity};},renderUI:r};});function sv(){}return sv;}());})();
