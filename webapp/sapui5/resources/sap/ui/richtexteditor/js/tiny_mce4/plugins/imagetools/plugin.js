(function(){var c=(function(){'use strict';var C=function(i){var a=i;var g=function(){return a;};var s=function(v){a=v;};var A=function(){return C(g());};return{get:g,set:s,clone:A};};var l=tinymce.util.Tools.resolve('tinymce.PluginManager');var q=tinymce.util.Tools.resolve('tinymce.util.Tools');function z(w,h){return E(document.createElement('canvas'),w,h);}function A(a){var t,b;t=z(a.width,a.height);b=B(t);b.drawImage(a,0,0);return t;}function B(a){return a.getContext('2d');}function D(a){var g=null;try{g=a.getContext('webgl')||a.getContext('experimental-webgl');}catch(e){}if(!g){g=null;}return g;}function E(a,w,h){a.width=w;a.height=h;return a;}var $={create:z,clone:A,resize:E,get2dContext:B,get3dContext:D};function F(i){return i.naturalWidth||i.width;}function G(i){return i.naturalHeight||i.height;}var H={getWidth:F,getHeight:G};var I=function(){var P=function(e){if(typeof this!=='object')throw new TypeError('Promises must be constructed via new');if(typeof e!=='function')throw new TypeError('not a function');this._state=null;this._value=null;this._deferreds=[];g(e,g4(h1,this),g4(r,this));};var a=P.immediateFn||typeof setImmediate==='function'&&setImmediate||function(e){setTimeout(e,1);};function g4(e,t){return function(){e.apply(t,arguments);};}var b=Array.isArray||function(v){return Object.prototype.toString.call(v)==='[object Array]';};function h(i){var m=this;if(this._state===null){this._deferreds.push(i);return;}a(function(){var j=m._state?i.onFulfilled:i.onRejected;if(j===null){(m._state?i.resolve:i.reject)(m._value);return;}var k;try{k=j(m._value);}catch(e){i.reject(e);return;}i.resolve(k);});}function h1(n){try{if(n===this)throw new TypeError('A promise cannot be resolved with itself.');if(n&&(typeof n==='object'||typeof n==='function')){var t=n.then;if(typeof t==='function'){g(g4(t,n),g4(h1,this),g4(r,this));return;}}this._state=true;this._value=n;f.call(this);}catch(e){r.call(this,e);}}function r(n){this._state=false;this._value=n;f.call(this);}function f(){for(var i=0,e=this._deferreds.length;i<e;i++){h.call(this,this._deferreds[i]);}this._deferreds=null;}function d(o,e,h1,r){this.onFulfilled=typeof o==='function'?o:null;this.onRejected=typeof e==='function'?e:null;this.resolve=h1;this.reject=r;}function g(e,o,i){var j=false;try{e(function(v){if(j)return;j=true;o(v);},function(m){if(j)return;j=true;i(m);});}catch(k){if(j)return;j=true;i(k);}}P.prototype['catch']=function(o){return this.then(null,o);};P.prototype.then=function(o,e){var m=this;return new P(function(h1,r){h.call(m,new d(o,e,h1,r));});};P.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&b(arguments[0])?arguments[0]:arguments);return new P(function(h1,r){if(e.length===0)return h1([]);var j=e.length;function k(i,v){try{if(v&&(typeof v==='object'||typeof v==='function')){var t=v.then;if(typeof t==='function'){t.call(v,function(v){k(i,v);},r);return;}}e[i]=v;if(--j===0){h1(e);}}catch(m){r(m);}}for(var i=0;i<e.length;i++){k(i,e[i]);}});};P.resolve=function(v){if(v&&typeof v==='object'&&v.constructor===P){return v;}return new P(function(h1){h1(v);});};P.reject=function(v){return new P(function(h1,r){r(v);});};P.race=function(v){return new P(function(h1,r){for(var i=0,e=v.length;i<e;i++){v[i].then(h1,r);}});};return P;};var P=window.Promise?window.Promise:I();var J=function(){var x=[];for(var a=0;a<arguments.length;a++){x[a]=arguments[a];}};var K=function(f){return function(){var x=[];for(var a=0;a<arguments.length;a++){x[a]=arguments[a];}return f();};};var L=function(f,a){return function(){var x=[];for(var b=0;b<arguments.length;b++){x[b]=arguments[b];}return f(a.apply(null,arguments));};};var M=function(v){return function(){return v;};};var N=function(x){return x;};var O=function(a,b){return a===b;};var Q=function(f){var x=[];for(var a=1;a<arguments.length;a++){x[a-1]=arguments[a];}var b=new Array(arguments.length-1);for(var i=1;i<arguments.length;i++)b[i-1]=arguments[i];return function(){var x=[];for(var a=0;a<arguments.length;a++){x[a]=arguments[a];}var n=new Array(arguments.length);for(var j=0;j<n.length;j++)n[j]=arguments[j];var d=b.concat(n);return f.apply(null,d);};};var R=function(f){return function(){var x=[];for(var a=0;a<arguments.length;a++){x[a]=arguments[a];}return!f.apply(null,arguments);};};var S=function(m){return function(){throw new Error(m);};};var T=function(f){return f();};var U=function(f){f();};var V=M(false);var W=M(true);var X={noop:J,noarg:K,compose:L,constant:M,identity:N,tripleEquals:O,curry:Q,not:R,die:S,apply:T,call:U,never:V,always:W};var Y=X.never;var Z=X.always;var _=function(){return b1;};var b1=function(){var e=function(o){return o.isNone();};var U=function(t){return t();};var i=function(n){return n;};var J=function(){};var m={fold:function(n,s){return n();},is:Y,isSome:Y,isNone:Z,getOr:i,getOrThunk:U,getOrDie:function(a){throw new Error(a||'error: getOrDie called on none.');},or:i,orThunk:U,map:_,ap:_,each:J,bind:_,flatten:_,exists:Y,forall:Z,filter:_,equals:e,equals_:e,toArray:function(){return[];},toString:X.constant('none()')};if(Object.freeze)Object.freeze(m);return m;}();var c1=function(a){var d=function(){return a;};var e=function(){return m;};var V3=function(f){return c1(f(a));};var g4=function(f){return f(a);};var m={fold:function(n,s){return s(a);},is:function(v){return a===v;},isSome:Z,isNone:Y,getOr:d,getOrThunk:d,getOrDie:d,or:e,orThunk:e,map:V3,ap:function(o){return o.fold(_,function(f){return c1(f(a));});},each:function(f){f(a);},bind:g4,flatten:d,exists:g4,forall:g4,filter:function(f){return f(a)?m:b1;},equals:function(o){return o.is(a);},equals_:function(o,f){return o.fold(Y,function(b){return f(a,b);});},toArray:function(){return[a];},toString:function(){return'some('+a+')';}};return m;};var d1=function(v){return v===null||v===undefined?b1:c1(v);};var e1={some:c1,none:_,from:d1};var f1=typeof window!=='undefined'?window:Function('return this;')();var g1=function(p,s){var o=s!==undefined&&s!==null?s:f1;for(var i=0;i<p.length&&o!==undefined&&o!==null;++i)o=o[p[i]];return o;};var h1=function(p,s){var a=p.split('.');return g1(a,s);};var i1=function(o,p){if(o[p]===undefined||o[p]===null)o[p]={};return o[p];};var j1=function(p,t){var o=t!==undefined?t:f1;for(var i=0;i<p.length;++i)o=i1(o,p[i]);return o;};var k1=function(n,t){var p=n.split('.');return j1(p,t);};var l1={path:g1,resolve:h1,forge:j1,namespace:k1};var n1=function(n,s){return l1.resolve(n,s);};var o1=function(n,s){var a=n1(n,s);if(a===undefined||a===null)throw n+' not available on this browser';return a;};var p1={getOrDie:o1};function q1(p,a){var f=p1.getOrDie('Blob');return new f(p,a);}function r1(){var f=p1.getOrDie('FileReader');return new f();}function s1(a){var f=p1.getOrDie('Uint8Array');return new f(a);}var t1=function(a){var f=p1.getOrDie('requestAnimationFrame');f(a);};var u1=function(b){var f=p1.getOrDie('atob');return f(b);};var v1={atob:u1,requestAnimationFrame:t1};function w1(i){var s=i.src;if(s.indexOf('data:')===0){return A1(s);}return y1(s);}function x1(b){return new P(function(h1,r){var a=URL.createObjectURL(b);var i=new Image();var d=function(){i.removeEventListener('load',e);i.removeEventListener('error',f);};function e(){d();h1(i);}function f(){d();r('Unable to load data of type '+b.type+': '+a);}i.addEventListener('load',e);i.addEventListener('error',f);i.src=a;if(i.complete){e();}});}function y1(a3){return new P(function(h1,r){var x=new XMLHttpRequest();x.open('GET',a3,true);x.responseType='blob';x.onload=function(){if(this.status==200){h1(this.response);}};x.onerror=function(){var a=this;var b=function(){var o=new Error('No access to download image');o.code=18;o.name='SecurityError';return o;};var g=function(){return new Error('Error '+a.status+' downloading image');};r(this.status===0?b():g());};x.send();});}function z1(u){var d=u.split(',');var m=/data:([^;]+)/.exec(d[0]);if(!m)return e1.none();var a=m[1];var b=d[1];var s=1024;var e=v1.atob(b);var f=e.length;var g=Math.ceil(f/s);var h=new Array(g);for(var j=0;j<g;++j){var k=j*s;var n=Math.min(k+s,f);var o=new Array(n-k);for(var p=k,i=0;p<n;++i,++p){o[i]=e[p].charCodeAt(0);}h[j]=s1(o);}return e1.some(q1(h,{type:a}));}function A1(u){return new P(function(h1,r){z1(u).fold(function(){r('uri is not base64: '+u);},h1);});}function B1(a3){if(a3.indexOf('blob:')===0){return y1(a3);}if(a3.indexOf('data:')===0){return A1(a3);}return null;}function C1(a,t,b){t=t||'image/png';if(HTMLCanvasElement.prototype.toBlob){return new P(function(h1){a.toBlob(function(d){h1(d);},t,b);});}else{return A1(a.toDataURL(t,b));}}function D1(g,t,a){t=t||'image/png';return g.then(function(b){return b.toDataURL(t,a);});}function E1(b){return x1(b).then(function(i){I1(i);var a,d;d=$.create(H.getWidth(i),H.getHeight(i));a=$.get2dContext(d);a.drawImage(i,0,0);return d;});}function F1(b){return new P(function(h1){var r=new r1();r.onloadend=function(){h1(r.result);};r.readAsDataURL(b);});}function G1(b){return new P(function(h1){var r=new r1();r.onloadend=function(){h1(r.result);};r.readAsArrayBuffer(b);});}function H1(b){return F1(b).then(function(d){return d.split(',')[1];});}function I1(i){URL.revokeObjectURL(i.src);}var J1={blobToImage:x1,imageToBlob:w1,blobToArrayBuffer:G1,blobToDataUri:F1,blobToBase64:H1,dataUriToBlobSync:z1,canvasToBlob:C1,canvasToDataURL:D1,blobToCanvas:E1,uriToBlob:B1};var K1=function(i){return J1.blobToImage(i);};var L1=function(b){return J1.imageToBlob(b);};var M1=function(b){return J1.blobToDataUri(b);};var N1=function(b){return J1.blobToBase64(b);};var O1=function(u){return J1.dataUriToBlobSync(u);};var P1=function(u){return e1.from(J1.uriToBlob(u));};var Q1={blobToImage:K1,imageToBlob:L1,blobToDataUri:M1,blobToBase64:N1,dataUriToBlobSync:O1,uriToBlob:P1};function R1(g,b,u){var i=b.type;var a=X.constant(i);function t(){return P.resolve(b);}function d(){return u;}function e(){return u.split(',')[1];}function f(m,n){return g.then(function(o){return J1.canvasToBlob(o,m,n);});}function h(m,n){return g.then(function(o){return J1.canvasToDataURL(o,m,n);});}function j(m,n){return h(m,n).then(function(o){return o.split(',')[1];});}function k(){return g.then($.clone);}return{getType:a,toBlob:t,toDataURL:d,toBase64:e,toAdjustedBlob:f,toAdjustedDataURL:h,toAdjustedBase64:j,toCanvas:k};}function S1(b){return J1.blobToDataUri(b).then(function(u){return R1(J1.blobToCanvas(b),b,u);});}function T1(a,t){return J1.canvasToBlob(a,t).then(function(b){return R1(P.resolve(a),b,a.toDataURL());});}function U1(i){return J1.imageToBlob(i).then(function(b){return S1(b);});}var V1=function(b,a3){return R1(J1.blobToCanvas(b),b,a3);};var W1={fromBlob:S1,fromCanvas:T1,fromImage:U1,fromBlobAndUrlSync:V1};function X1(v,m,a){v=parseFloat(v);if(v>a){v=a;}else if(v<m){v=m;}return v;}function Y1(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1];}var Z1=[0,0.01,0.02,0.04,0.05,0.06,0.07,0.08,0.1,0.11,0.12,0.14,0.15,0.16,0.17,0.18,0.2,0.21,0.22,0.24,0.25,0.27,0.28,0.3,0.32,0.34,0.36,0.38,0.4,0.42,0.44,0.46,0.48,0.5,0.53,0.56,0.59,0.62,0.65,0.68,0.71,0.74,0.77,0.8,0.83,0.86,0.89,0.92,0.95,0.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];function $1(m,a){var i,j,k,v,b=[],o=new Array(10);for(i=0;i<5;i++){for(j=0;j<5;j++){b[j]=a[j+i*5];}for(j=0;j<5;j++){v=0;for(k=0;k<5;k++){v+=m[j+k*5]*b[k];}o[j+i*5]=v;}}return o;}function _1(m,a){a=X1(a,0,1);return m.map(function(v,i){if(i%6===0){v=1-(1-v)*a;}else{v*=a;}return X1(v,0,1);});}function b2(m,v){var x;v=X1(v,-1,1);v*=100;if(v<0){x=127+v/100*127;}else{x=v%1;if(x===0){x=Z1[v];}else{x=Z1[Math.floor(v)]*(1-x)+Z1[Math.floor(v)+1]*x;}x=x*127+127;}return $1(m,[x/127,0,0,0,0.5*(127-x),0,x/127,0,0,0.5*(127-x),0,0,x/127,0,0.5*(127-x),0,0,0,1,0,0,0,0,0,1]);}function c2(m,v){var x,a,b,d;v=X1(v,-1,1);x=1+(v>0?3*v:v);a=0.3086;b=0.6094;d=0.082;return $1(m,[a*(1-x)+x,b*(1-x),d*(1-x),0,0,a*(1-x),b*(1-x)+x,d*(1-x),0,0,a*(1-x),b*(1-x),d*(1-x)+x,0,0,0,0,0,1,0,0,0,0,0,1]);}function d2(m,a){var b,s,d,e,f;a=X1(a,-180,180)/180*Math.PI;b=Math.cos(a);s=Math.sin(a);d=0.213;e=0.715;f=0.072;return $1(m,[d+b*(1-d)+s*-d,e+b*-e+s*-e,f+b*-f+s*(1-f),0,0,d+b*-d+s*0.143,e+b*(1-e)+s*0.14,f+b*-f+s*-0.283,0,0,d+b*-d+s*-(1-d),e+b*-e+s*e,f+b*(1-f)+s*f,0,0,0,0,0,1,0,0,0,0,0,1]);}function e2(m,v){v=X1(255*v,-255,255);return $1(m,[1,0,0,0,v,0,1,0,0,v,0,0,1,0,v,0,0,0,1,0,0,0,0,0,1]);}function f2(m,a,b,d){a=X1(a,0,2);b=X1(b,0,2);d=X1(d,0,2);return $1(m,[a,0,0,0,0,0,b,0,0,0,0,0,d,0,0,0,0,0,1,0,0,0,0,0,1]);}function g2(m,v){v=X1(v,0,1);return $1(m,_1([0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0,0,0,0,0,1],v));}function h2(m,v){v=X1(v,0,1);return $1(m,_1([0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0.33,0.34,0.33,0,0,0,0,0,1,0,0,0,0,0,1],v));}var i2={identity:Y1,adjust:_1,multiply:$1,adjustContrast:b2,adjustBrightness:e2,adjustSaturation:c2,adjustHue:d2,adjustColors:f2,adjustSepia:g2,adjustGrayscale:h2};function j2(i,m){return i.toCanvas().then(function(a){return k2(a,i.getType(),m);});}function k2(e,t,f){var h=$.get2dContext(e);var p;function j(p,m){var d=p.data,r,g,b,a,i,k=m[0],n=m[1],o=m[2],s=m[3],u=m[4],v=m[5],w=m[6],x=m[7],y=m[8],m9=m[9],m1=m[10],a2=m[11],m2=m[12],m3=m[13],m4=m[14],m5=m[15],r5=m[16],s5=m[17],t5=m[18],u5=m[19];for(i=0;i<d.length;i+=4){r=d[i];g=d[i+1];b=d[i+2];a=d[i+3];d[i]=r*k+g*n+b*o+a*s+u;d[i+1]=r*v+g*w+b*x+a*y+m9;d[i+2]=r*m1+g*a2+b*m2+a*m3+m4;d[i+3]=r*m5+g*r5+b*s5+a*t5+u5;}return p;}p=j(h.getImageData(0,0,e.width,e.height),f);h.putImageData(p,0,0);return W1.fromCanvas(e,t);}function l2(i,m){return i.toCanvas().then(function(a){return n2(a,i.getType(),m);});}function n2(a,t,m){var d=$.get2dContext(a);var p,e;function f(p,e,m){var i,j,s,k,x,y,r,g,b,n,o,u,v,a1,wt,w,h;function X1(m1,a2,m2){if(m1>m2){m1=m2;}else if(m1<a2){m1=a2;}return m1;}s=Math.round(Math.sqrt(m.length));k=Math.floor(s/2);i=p.data;j=e.data;w=p.width;h=p.height;for(y=0;y<h;y++){for(x=0;x<w;x++){r=g=b=0;for(o=0;o<s;o++){for(n=0;n<s;n++){u=X1(x+n-k,0,w-1);v=X1(y+o-k,0,h-1);a1=(v*w+u)*4;wt=m[o*s+n];r+=i[a1]*wt;g+=i[a1+1]*wt;b+=i[a1+2]*wt;}}a1=(y*w+x)*4;j[a1]=X1(r,0,255);j[a1+1]=X1(g,0,255);j[a1+2]=X1(b,0,255);}}return e;}p=d.getImageData(0,0,a.width,a.height);e=d.getImageData(0,0,a.width,a.height);e=f(p,e,m);d.putImageData(e,0,0);return W1.fromCanvas(a,t);}function o2(a){var f=function(b,t,v){var e=$.get2dContext(b);var p,i,g=new Array(256);function h(p,g){var d=p.data,i;for(i=0;i<d.length;i+=4){d[i]=g[d[i]];d[i+1]=g[d[i+1]];d[i+2]=g[d[i+2]];}return p;}for(i=0;i<g.length;i++){g[i]=a(i,v);}p=h(e.getImageData(0,0,b.width,b.height),g);e.putImageData(p,0,0);return W1.fromCanvas(b,t);};return function(i,v){return i.toCanvas().then(function(b){return f(b,i.getType(),v);});};}function p2(m){return function(i,_1){return j2(i,m(i2.identity(),_1));};}function q2(m){return function(i){return j2(i,m);};}function r2(k){return function(i){return l2(i,k);};}var s2={invert:q2([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:p2(i2.adjustBrightness),hue:p2(i2.adjustHue),saturate:p2(i2.adjustSaturation),contrast:p2(i2.adjustContrast),grayscale:p2(i2.adjustGrayscale),sepia:p2(i2.adjustSepia),colorize:function(i,a,b,d){return j2(i,i2.adjustColors(i2.identity(),a,b,d));},sharpen:r2([0,-1,0,-1,5,-1,0,-1,0]),emboss:r2([-2,-1,0,-1,1,1,0,1,2]),gamma:o2(function(a,v){return Math.pow(a/255,1-v)*255;}),exposure:o2(function(a,v){return 255*(1-Math.exp(-(a/255)*v));}),colorFilter:j2,convoluteFilter:l2};function t2(i,w,h){var s=H.getWidth(i);var a=H.getHeight(i);var b=w/s;var d=h/a;var e=false;if(b<0.5||b>2){b=b<0.5?0.5:2;e=true;}if(d<0.5||d>2){d=d<0.5?0.5:2;e=true;}var f=u2(i,b,d);return!e?f:f.then(function(t){return t2(t,w,h);});}function u2(i,w,h){return new P(function(h1){var s=H.getWidth(i);var a=H.getHeight(i);var d=Math.floor(s*w);var b=Math.floor(a*h);var e=$.create(d,b);var f=$.get2dContext(e);f.drawImage(i,0,0,s,a,0,0,d,b);h1(e);});}var v2={scale:t2};function w2(i,a){return i.toCanvas().then(function(b){return x2(b,i.getType(),a);});}function x2(i,t,a){var b=$.create(i.width,i.height);var d=$.get2dContext(b);var e=0,f=0;a=a<0?360+a:a;if(a==90||a==270){$.resize(b,b.height,b.width);}if(a==90||a==180){e=b.width;}if(a==270||a==180){f=b.height;}d.translate(e,f);d.rotate(a*Math.PI/180);d.drawImage(i,0,0);return W1.fromCanvas(b,t);}function y2(i,a){return i.toCanvas().then(function(b){return z2(b,i.getType(),a);});}function z2(i,t,a){var b=$.create(i.width,i.height);var d=$.get2dContext(b);if(a=='v'){d.scale(1,-1);d.drawImage(i,0,-b.height);}else{d.scale(-1,1);d.drawImage(i,-b.width,0);}return W1.fromCanvas(b,t);}function A2(i,x,y,w,h){return i.toCanvas().then(function(a){return B2(a,i.getType(),x,y,w,h);});}function B2(i,t,x,y,w,h){var a=$.create(w,h);var b=$.get2dContext(a);b.drawImage(i,-x,-y);return W1.fromCanvas(a,t);}function C2(i,w,h){return i.toCanvas().then(function(a){return v2.scale(a,w,h).then(function(n){return W1.fromCanvas(n,i.getType());});});}var D2={rotate:w2,flip:y2,crop:A2,resize:C2};var E2=function(i){return s2.invert(i);};var F2=function(i){return s2.sharpen(i);};var G2=function(i){return s2.emboss(i);};var H2=function(i,v){return s2.gamma(i,v);};var I2=function(i,v){return s2.exposure(i,v);};var J2=function(i,a,b,d){return s2.colorize(i,a,b,d);};var K2=function(i,_1){return s2.brightness(i,_1);};var L2=function(i,_1){return s2.hue(i,_1);};var M2=function(i,_1){return s2.saturate(i,_1);};var N2=function(i,_1){return s2.contrast(i,_1);};var O2=function(i,_1){return s2.grayscale(i,_1);};var P2=function(i,_1){return s2.sepia(i,_1);};var Q2=function(i,a){return D2.flip(i,a);};var R2=function(i,x,y,w,h){return D2.crop(i,x,y,w,h);};var S2=function(i,w,h){return D2.resize(i,w,h);};var T2=function(i,a){return D2.rotate(i,a);};var U2={invert:E2,sharpen:F2,emboss:G2,brightness:K2,hue:L2,saturate:M2,contrast:N2,grayscale:O2,sepia:P2,colorize:J2,gamma:H2,exposure:I2,flip:Q2,crop:R2,resize:S2,rotate:T2};var V2=function(b){return W1.fromBlob(b);};var W2=function(b,u){return W1.fromBlobAndUrlSync(b,u);};var X2=function(i){return W1.fromImage(i);};var Y2=function(i,t,a){if(t===undefined&&a===undefined){return Z2(i);}else{return i.toAdjustedBlob(t,a);}};var Z2=function(i){return i.toBlob();};var $2=function(i){return i.toDataURL();};var _2={blobToImageResult:V2,fromBlobAndUrlSync:W2,imageToImageResult:X2,imageResultToBlob:Y2,imageResultToOriginalBlob:Z2,imageResultToDataURL:$2};var a3=function(){return p1.getOrDie('URL');};var b3=function(b){return a3().createObjectURL(b);};var c3=function(u){a3().revokeObjectURL(u);};var d3={createObjectURL:b3,revokeObjectURL:c3};var e3=tinymce.util.Tools.resolve('tinymce.util.Delay');var f3=tinymce.util.Tools.resolve('tinymce.util.Promise');var g3=tinymce.util.Tools.resolve('tinymce.util.URI');var h3=function(e){return e.getParam('imagetools_toolbar','rotateleft rotateright | flipv fliph | crop editimage imageoptions');};var i3=function(e){return e.getParam('imagetools_proxy');};var j3=function(e){return e.getParam('imagetools_cors_hosts',[],'string[]');};var k3=function(e){return e.getParam('imagetools_credentials_hosts',[],'string[]');};var l3=function(e){return e.getParam('api_key',e.getParam('imagetools_api_key','','string'),'string');};var n3=function(e){return e.getParam('images_upload_timeout',30000,'number');};var o3=function(e){return e.getParam('images_reuse_filename',false,'boolean');};var p3=tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');var q3=tinymce.util.Tools.resolve('tinymce.ui.Factory');function r3(){var d=[];var i=-1;function a(s){var f;f=d.splice(++i);d.push(s);return{state:s,removed:f};}function u(){if(b()){return d[--i];}}function r(){if(e()){return d[++i];}}function b(){return i>0;}function e(){return i!==-1&&i<d.length-1;}return{data:d,add:a,undo:u,redo:r,canUndo:b,canRedo:e};}var s3=tinymce.util.Tools.resolve('tinymce.geom.Rect');var t3=function(i){return new f3(function(h1){var a=function(){i.removeEventListener('load',a);h1(i);};if(i.complete){h1(i);}else{i.addEventListener('load',a);}});};var u3={loadImage:t3};var v3=tinymce.util.Tools.resolve('tinymce.dom.DomQuery');var w3=tinymce.util.Tools.resolve('tinymce.util.Observable');var x3=tinymce.util.Tools.resolve('tinymce.util.VK');var y3=0;function z3(a,v,b,d,f){var i;var g;var j;var k;var p='mce-';var m=p+'crid-'+y3++;g=[{name:'move',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:'Crop Mask'},{name:'nw',xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:'Top Left Crop Handle'},{name:'ne',xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:'Top Right Crop Handle'},{name:'sw',xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:'Bottom Left Crop Handle'},{name:'se',xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:'Bottom Right Crop Handle'}];k=['top','right','bottom','left'];function n(e,h){return{x:h.x+e.x,y:h.y+e.y,w:h.w,h:h.h};}function o(e,h){return{x:h.x-e.x,y:h.y-e.y,w:h.w,h:h.h};}function r(){return o(b,a);}function s(e,m5,r5,s5){var x,y,w,h,t5;x=m5.x;y=m5.y;w=m5.w;h=m5.h;x+=r5*e.deltaX;y+=s5*e.deltaY;w+=r5*e.deltaW;h+=s5*e.deltaH;if(w<20){w=20;}if(h<20){h=20;}t5=a=s3.clamp({x:x,y:y,w:w,h:h},b,e.name==='move');t5=o(b,t5);i.fire('updateRect',{rect:t5});m2(t5);}function t(){function h(w){var x;var y=q3.get('DragHelper');return new y(m,{document:d.ownerDocument,handle:m+'-'+w.name,start:function(){x=a;},drag:function(e){s(w,x,e.deltaX,e.deltaY);}});}v3('<div id="'+m+'" class="'+p+'croprect-container"'+' role="grid" aria-dropeffect="execute">').appendTo(d);q.each(k,function(e){v3('#'+m,d).append('<div id="'+m+'-'+e+'"class="'+p+'croprect-block" style="display: none" data-mce-bogus="all">');});q.each(g,function(e){v3('#'+m,d).append('<div id="'+m+'-'+e.name+'" class="'+p+'croprect-handle '+p+'croprect-handle-'+e.name+'"'+'style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1"'+' aria-label="'+e.label+'" aria-grabbed="false">');});j=q.map(g,h);a1(a);v3(d).on('focusin focusout',function(e){v3(e.target).attr('aria-grabbed',e.type==='focus');});v3(d).on('keydown',function(e){var w;q.each(g,function(y){if(e.target.id===m+'-'+y.name){w=y;return false;}});function x(y,m5,r5,s5,t5){y.stopPropagation();y.preventDefault();s(w,r5,s5,t5);}switch(e.keyCode){case x3.LEFT:x(e,w,a,-10,0);break;case x3.RIGHT:x(e,w,a,10,0);break;case x3.UP:x(e,w,a,0,-10);break;case x3.DOWN:x(e,w,a,0,10);break;case x3.ENTER:case x3.SPACEBAR:e.preventDefault();f();break;}});}function u(e){var h;h=q.map(g,function(w){return'#'+m+'-'+w.name;}).concat(q.map(k,function(w){return'#'+m+'-'+w;})).join(',');if(e){v3(h,d).show();}else{v3(h,d).hide();}}function a1(e){function h(w,e){if(e.h<0){e.h=0;}if(e.w<0){e.w=0;}v3('#'+m+'-'+w,d).css({left:e.x,top:e.y,width:e.w,height:e.h});}q.each(g,function(w){v3('#'+m+'-'+w.name,d).css({left:e.w*w.xMul+e.x,top:e.h*w.yMul+e.y});});h('top',{x:v.x,y:v.y,w:v.w,h:e.y-v.y});h('right',{x:e.x+e.w,y:e.y,w:v.w-e.x-e.w+v.x,h:e.h});h('bottom',{x:v.x,y:e.y+e.h,w:v.w,h:v.h-e.y-e.h+v.y});h('left',{x:v.x,y:e.y,w:e.x-v.x,h:e.h});h('move',e);}function m1(e){a=e;a1(a);}function a2(e){v=e;a1(a);}function m2(e){m1(n(b,e));}function m3(e){b=e;a1(a);}function m4(){q.each(j,function(h){h.destroy();});j=[];}t();i=q.extend({toggleVisibility:u,setClampRect:m3,setRect:m1,getInnerRect:r,setInnerRect:m2,setViewPortRect:a2,destroy:m4},w3);return i;}var A3=function(s){var a=q3.get('Control');var b=a.extend({Defaults:{classes:'imagepanel'},selection:function(r){if(arguments.length){this.state.set('rect',r);return this;}return this.state.get('rect');},imageSize:function(){var v=this.state.get('viewRect');return{w:v.w,h:v.h};},toggleCropRect:function(d){this.state.set('cropEnabled',d);},imageSrc:function(a3){var d=this,i=new Image();i.src=a3;u3.loadImage(i).then(function(){var r,e;var f=d.state.get('viewRect');e=d.$el.find('img');if(e[0]){e.replaceWith(i);}else{var g=document.createElement('div');g.className='mce-imagepanel-bg';d.getEl().appendChild(g);d.getEl().appendChild(i);}r={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight};d.state.set('viewRect',r);d.state.set('rect',s3.inflate(r,-20,-20));if(!f||f.w!==r.w||f.h!==r.h){d.zoomFit();}d.repaintImage();d.fire('load');});},zoom:function(v){if(arguments.length){this.state.set('zoom',v);return this;}return this.state.get('zoom');},postRender:function(){this.imageSrc(this.settings.imageSrc);return this._super();},zoomFit:function(){var d=this;var e,p,f,w,h,g,i;i=10;e=d.$el.find('img');p=d.getEl().clientWidth;f=d.getEl().clientHeight;w=e[0].naturalWidth;h=e[0].naturalHeight;g=Math.min((p-i)/w,(f-i)/h);if(g>=1){g=1;}d.zoom(g);},repaintImage:function(){var x,y,w,h,p,d,e,f,g,r,i;i=this.getEl();g=this.zoom();r=this.state.get('rect');e=this.$el.find('img');f=this.$el.find('.mce-imagepanel-bg');p=i.offsetWidth;d=i.offsetHeight;w=e[0].naturalWidth*g;h=e[0].naturalHeight*g;x=Math.max(0,p/2-w/2);y=Math.max(0,d/2-h/2);e.css({left:x,top:y,width:w,height:h});f.css({left:x,top:y,width:w,height:h});if(this.cropRect){this.cropRect.setRect({x:r.x*g+x,y:r.y*g+y,w:r.w*g,h:r.h*g});this.cropRect.setClampRect({x:x,y:y,w:w,h:h});this.cropRect.setViewPortRect({x:0,y:0,w:p,h:d});}},bindStates:function(){var d=this;function f(r){d.cropRect=z3(r,d.state.get('viewRect'),d.state.get('viewRect'),d.getEl(),function(){d.fire('crop');});d.cropRect.on('updateRect',function(e){var r=e.rect;var g=d.zoom();r={x:Math.round(r.x/g),y:Math.round(r.y/g),w:Math.round(r.w/g),h:Math.round(r.h/g)};d.state.set('rect',r);});d.on('remove',d.cropRect.destroy);}d.state.on('change:cropEnabled',function(e){d.cropRect.toggleVisibility(e.value);d.repaintImage();});d.state.on('change:zoom',function(){d.repaintImage();});d.state.on('change:rect',function(e){var r=e.value;if(!d.cropRect){f(r);}d.cropRect.setRect(r);});}});return new b(s);};var B3={create:A3};function C3(b){return{blob:b,url:d3.createObjectURL(b)};}function D3(s){if(s){d3.revokeObjectURL(s.url);}}function E3(s){q.each(s,D3);}function F3(a,d,h1,f){var w,u=r3(),m,h,t,i,j,k,n,s,o,p,v,x,y,a1,m1,a2,m2,m3,m4,m5,r5,s5,t5,u5,v5,w5;var x5=function(b){return a.rtl?b.reverse():b;};function y5(e){var b,g,r,V5;b=w.find('#w')[0];g=w.find('#h')[0];r=parseInt(b.value(),10);V5=parseInt(g.value(),10);if(w.find('#constrain')[0].checked()&&t5&&u5&&r&&V5){if(e.control.settings.name==='w'){V5=Math.round(r*v5);g.value(V5);}else{r=Math.round(V5*w5);b.value(r);}}t5=r;u5=V5;}function z5(b){return Math.round(b*100)+'%';}function A5(){w.find('#undo').disabled(!u.canUndo());w.find('#redo').disabled(!u.canRedo());w.statusbar.find('#save').disabled(!u.canUndo());}function B5(){w.find('#undo').disabled(true);w.find('#redo').disabled(true);}function C5(b){if(b){n.imageSrc(b.url);}}function D5(b){return function(){var e=q.grep(s5,function(g){return g.settings.name!==b;});q.each(e,function(g){g.hide();});b.show();b.focus();};}function E5(b){t=C3(b);C5(t);}function F5(b){d=C3(b);C5(d);E3(u.add(d).removed);A5();}function A2(){var r=n.selection();_2.blobToImageResult(d.blob).then(function(b){U2.crop(b,r.x,r.y,r.w,r.h).then(Y2).then(function(e){F5(e);I5();});});}var G5=function(b){var e=[].slice.call(arguments,1);return function(){var g=t||d;_2.blobToImageResult(g.blob).then(function(r){b.apply(this,[r].concat(e)).then(Y2).then(E5);});};};function H5(b){var e=[];for(var g=1;g<arguments.length;g++){e[g-1]=arguments[g];}var r=[].slice.call(arguments,1);return function(){_2.blobToImageResult(d.blob).then(function(ir){b.apply(this,[ir].concat(r)).then(Y2).then(F5);});};}function I5(){C5(d);D3(t);D5(m)();A5();}function J5(b,e){if(t){e();}else{setTimeout(function(){if(b-->0){J5(b,e);}else{a.windowManager.alert('Error: failed to apply image operation.');}},10);}}function K5(){if(t){F5(t.blob);I5();}else{J5(100,K5);}}function L5(){var b=n.zoom();if(b<2){b+=0.1;}n.zoom(b);}function M5(){var b=n.zoom();if(b>0.1){b-=0.1;}n.zoom(b);}function N5(){d=u.undo();C5(d);A5();}function O5(){d=u.redo();C5(d);A5();}function P5(){h1(d.blob);w.close();}function Q5(b){return q3.create('Form',{layout:'flex',direction:'row',labelGap:5,border:'0 0 1 0',align:'center',pack:'center',padding:'0 10 0 10',spacing:5,flex:0,minHeight:60,defaults:{classes:'imagetool',type:'button'},items:b});}var Y2=function(b){return b.toBlob();};function R5(b,Z3){return Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:K5}])).hide().on('show',function(){B5();_2.blobToImageResult(d.blob).then(function(e){return Z3(e);}).then(Y2).then(function(e){var g=C3(e);C5(g);D3(t);t=g;});});}function S5(b,Z3,g,r,V5){function W5(g){_2.blobToImageResult(d.blob).then(function(e){return Z3(e,g);}).then(Y2).then(function(e){var X5=C3(e);C5(X5);D3(t);t=X5;});}return Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{type:'slider',flex:1,ondragend:function(e){W5(e.value);},minValue:a.rtl?V5:r,maxValue:a.rtl?r:V5,value:g,previewFilter:z5},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:K5}])).hide().on('show',function(){this.find('slider').value(g);B5();});}function T5(e,Z3){function V5(){var r,g,b;r=w.find('#r')[0].value();g=w.find('#g')[0].value();b=w.find('#b')[0].value();_2.blobToImageResult(d.blob).then(function(ir){return Z3(ir,r,g,b);}).then(Y2).then(function(Y5){var Z5=C3(Y5);C5(Z5);D3(t);t=Z5;});}var W5=a.rtl?2:0;var X5=a.rtl?0:2;return Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{type:'slider',label:'R',name:'r',minValue:W5,value:1,maxValue:X5,ondragend:V5,previewFilter:z5},{type:'slider',label:'G',name:'g',minValue:W5,value:1,maxValue:X5,ondragend:V5,previewFilter:z5},{type:'slider',label:'B',name:'b',minValue:W5,value:1,maxValue:X5,ondragend:V5,previewFilter:z5},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:K5}])).hide().on('show',function(){w.find('#r,#g,#b').value(1);B5();});}i=Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:A2}])).hide().on('show hide',function(e){n.toggleCropRect(e.type==='show');}).on('show',B5);function U5(e){if(e.control.value()===true){v5=u5/t5;w5=t5/u5;}}j=Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{type:'textbox',name:'w',label:'Width',size:4,onkeyup:y5},{type:'textbox',name:'h',label:'Height',size:4,onkeyup:y5},{type:'checkbox',name:'constrain',text:'Constrain proportions',checked:true,onchange:U5},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:'submit'}])).hide().on('submit',function(e){var t5=parseInt(w.find('#w').value(),10),u5=parseInt(w.find('#h').value(),10);e.preventDefault();H5(U2.resize,t5,u5)();I5();}).on('show',B5);k=Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{icon:'fliph',tooltip:'Flip horizontally',onclick:G5(U2.flip,'h')},{icon:'flipv',tooltip:'Flip vertically',onclick:G5(U2.flip,'v')},{icon:'rotateleft',tooltip:'Rotate counterclockwise',onclick:G5(U2.rotate,-90)},{icon:'rotateright',tooltip:'Rotate clockwise',onclick:G5(U2.rotate,90)},{type:'spacer',flex:1},{text:'Apply',subtype:'primary',onclick:K5}])).hide().on('show',B5);p=R5('Invert',U2.invert);m3=R5('Sharpen',U2.sharpen);m4=R5('Emboss',U2.emboss);v=S5('Brightness',U2.brightness,0,-1,1);x=S5('Hue',U2.hue,180,0,360);y=S5('Saturate',U2.saturate,0,-1,1);a1=S5('Contrast',U2.contrast,0,-1,1);m1=S5('Grayscale',U2.grayscale,0,0,1);a2=S5('Sepia',U2.sepia,0,0,1);m2=T5('Colorize',U2.colorize);m5=S5('Gamma',U2.gamma,0,-1,1);r5=S5('Exposure',U2.exposure,1,0,2);h=Q5(x5([{text:'Back',onclick:I5},{type:'spacer',flex:1},{text:'hue',icon:'hue',onclick:D5(x)},{text:'saturate',icon:'saturate',onclick:D5(y)},{text:'sepia',icon:'sepia',onclick:D5(a2)},{text:'emboss',icon:'emboss',onclick:D5(m4)},{text:'exposure',icon:'exposure',onclick:D5(r5)},{type:'spacer',flex:1}])).hide();m=Q5(x5([{tooltip:'Crop',icon:'crop',onclick:D5(i)},{tooltip:'Resize',icon:'resize2',onclick:D5(j)},{tooltip:'Orientation',icon:'orientation',onclick:D5(k)},{tooltip:'Brightness',icon:'sun',onclick:D5(v)},{tooltip:'Sharpen',icon:'sharpen',onclick:D5(m3)},{tooltip:'Contrast',icon:'contrast',onclick:D5(a1)},{tooltip:'Color levels',icon:'drop',onclick:D5(m2)},{tooltip:'Gamma',icon:'gamma',onclick:D5(m5)},{tooltip:'Invert',icon:'invert',onclick:D5(p)}]));n=B3.create({flex:1,imageSrc:d.url});s=q3.create('Container',{layout:'flex',direction:'column',pack:'start',border:'0 1 0 0',padding:5,spacing:5,items:[{type:'button',icon:'undo',tooltip:'Undo',name:'undo',onclick:N5},{type:'button',icon:'redo',tooltip:'Redo',name:'redo',onclick:O5},{type:'button',icon:'zoomin',tooltip:'Zoom in',onclick:L5},{type:'button',icon:'zoomout',tooltip:'Zoom out',onclick:M5}]});o=q3.create('Container',{type:'container',layout:'flex',direction:'row',align:'stretch',flex:1,items:x5([s,n])});s5=[m,i,j,k,h,p,v,x,y,a1,m1,a2,m2,m3,m4,m5,r5];w=a.windowManager.open({layout:'flex',direction:'column',align:'stretch',minWidth:Math.min(p3.DOM.getViewPort().w,800),minHeight:Math.min(p3.DOM.getViewPort().h,650),title:'Edit image',items:s5.concat([o]),buttons:x5([{text:'Save',name:'save',subtype:'primary',onclick:P5},{text:'Cancel',onclick:'close'}])});w.on('close',function(){f();E3(u.data);u=null;t=null;});u.add(d);A5();n.on('load',function(){t5=n.imageSize().w;u5=n.imageSize().h;v5=u5/t5;w5=t5/u5;w.find('#w').value(t5);w.find('#h').value(u5);});n.on('crop',A2);}function G3(e,i){return new f3(function(h1,r){return i.toBlob().then(function(b){F3(e,C3(b),h1,r);});});}var H3={edit:G3};function I3(i){var w,h;function a(v){return/^[0-9\.]+px$/.test(v);}w=i.style.width;h=i.style.height;if(w||h){if(a(w)&&a(h)){return{w:parseInt(w,10),h:parseInt(h,10)};}return null;}w=i.width;h=i.height;if(w&&h){return{w:parseInt(w,10),h:parseInt(h,10)};}return null;}function J3(i,s){var w,h;if(s){w=i.style.width;h=i.style.height;if(w||h){i.style.width=s.w+'px';i.style.height=s.h+'px';i.removeAttribute('data-mce-style');}w=i.width;h=i.height;if(w||h){i.setAttribute('width',s.w);i.setAttribute('height',s.h);}}}function K3(i){return{w:i.naturalWidth,h:i.naturalHeight};}var L3={getImageSize:I3,setImageSize:J3,getNaturalImageSize:K3};var M3=function(x){if(x===null)return'null';var t=typeof x;if(t==='object'&&Array.prototype.isPrototypeOf(x))return'array';if(t==='object'&&String.prototype.isPrototypeOf(x))return'string';return t;};var N3=function(t){return function(v){return M3(v)===t;};};var O3={isString:N3('string'),isObject:N3('object'),isArray:N3('array'),isNull:N3('null'),isBoolean:N3('boolean'),isUndefined:N3('undefined'),isFunction:N3('function'),isNumber:N3('number')};var P3=function(){var p=Array.prototype.indexOf;var f=function(a,x){return p.call(a,x);};var s=function(a,x){return d4(a,x);};return p===undefined?s:f;}();var Q3=function(a,x){var r=P3(a,x);return r===-1?e1.none():e1.some(r);};var R3=function(a,x){return P3(a,x)>-1;};var S3=function(x,p){return c4(x,p).isSome();};var T3=function(n,f){var r=[];for(var i=0;i<n;i++){r.push(f(i));}return r;};var U3=function(a,b){var r=[];for(var i=0;i<a.length;i+=b){var s=a.slice(i,i+b);r.push(s);}return r;};var V3=function(a,f){var b=a.length;var r=new Array(b);for(var i=0;i<b;i++){var x=a[i];r[i]=f(x,i,a);}return r;};var W3=function(a,f){for(var i=0,b=a.length;i<b;i++){var x=a[i];f(x,i,a);}};var X3=function(a,f){for(var i=a.length-1;i>=0;i--){var x=a[i];f(x,i,a);}};var Y3=function(a,p){var b=[];var f=[];for(var i=0,d=a.length;i<d;i++){var x=a[i];var e=p(x,i,a)?b:f;e.push(x);}return{pass:b,fail:f};};var Z3=function(a,p){var r=[];for(var i=0,b=a.length;i<b;i++){var x=a[i];if(p(x,i,a)){r.push(x);}}return r;};var $3=function(a,f){if(a.length===0){return[];}else{var w=f(a[0]);var r=[];var g=[];for(var i=0,b=a.length;i<b;i++){var x=a[i];var t=f(x);if(t!==w){r.push(g);g=[];}w=t;g.push(x);}if(g.length!==0){r.push(g);}return r;}};var _3=function(a,f,b){X3(a,function(x){b=f(b,x);});return b;};var a4=function(a,f,b){W3(a,function(x){b=f(b,x);});return b;};var b4=function(a,p){for(var i=0,b=a.length;i<b;i++){var x=a[i];if(p(x,i,a)){return e1.some(x);}}return e1.none();};var c4=function(a,p){for(var i=0,b=a.length;i<b;i++){var x=a[i];if(p(x,i,a)){return e1.some(i);}}return e1.none();};var d4=function(a,x){for(var i=0,b=a.length;i<b;++i){if(a[i]===x){return i;}}return-1;};var e4=Array.prototype.push;var f4=function(x){var r=[];for(var i=0,a=x.length;i<a;++i){if(!Array.prototype.isPrototypeOf(x[i]))throw new Error('Arr.flatten item '+i+' was not an array, input: '+x);e4.apply(r,x[i]);}return r;};var g4=function(x,f){var o=V3(x,f);return f4(o);};var h4=function(a,p){for(var i=0,b=a.length;i<b;++i){var x=a[i];if(p(x,i,a)!==true){return false;}}return true;};var i4=function(a,b){return a.length===b.length&&h4(a,function(x,i){return x===b[i];});};var j4=Array.prototype.slice;var k4=function(x){var r=j4.call(x,0);r.reverse();return r;};var l4=function(a,b){return Z3(a,function(x){return!R3(b,x);});};var n4=function(a,f){var r={};for(var i=0,b=a.length;i<b;i++){var x=a[i];r[String(x)]=f(x,i);}return r;};var o4=function(x){return[x];};var p4=function(x,a){var b=j4.call(x,0);b.sort(a);return b;};var q4=function(x){return x.length===0?e1.none():e1.some(x[0]);};var r4=function(x){return x.length===0?e1.none():e1.some(x[x.length-1]);};var s4=O3.isFunction(Array.from)?Array.from:function(x){return j4.call(x);};var t4={map:V3,each:W3,eachr:X3,partition:Y3,filter:Z3,groupBy:$3,indexOf:Q3,foldr:_3,foldl:a4,find:b4,findIndex:c4,flatten:f4,bind:g4,forall:h4,exists:S3,contains:R3,equal:i4,reverse:k4,chunk:U3,difference:l4,mapToObject:n4,pure:o4,sort:p4,range:T3,head:q4,last:r4,from:s4};function u4(){var f=p1.getOrDie('XMLHttpRequest');return new f();}var v4=function(o){return o!==null&&o!==undefined;};var w4=function(j,g1){var v;v=g1.reduce(function(r,k){return v4(r)?r[k]:undefined;},j);return v4(v)?v:null;};var x4=function(a3,h,w){return new f3(function(h1){var x;x=new u4();x.onreadystatechange=function(){if(x.readyState===4){h1({status:x.status,blob:this.response});}};x.open('GET',a3,true);x.withCredentials=w;q.each(h,function(v,k){x.setRequestHeader(k,v);});x.responseType='blob';x.send();});};var y4=function(b){return new f3(function(h1){var f=new r1();f.onload=function(e){var d=e.target;h1(d.result);};f.readAsText(b);});};var z4=function(t){var j;try{j=JSON.parse(t);}catch(e){}return j;};var A4={traverse:w4,readBlob:y4,requestUrlAsBlob:x4,parseJson:z4};var B4=[{code:404,message:'Could not find Image Proxy'},{code:403,message:'Rejected request'},{code:0,message:'Incorrect Image Proxy URL'}];var C4=[{type:'key_missing',message:'The request did not include an api key.'},{type:'key_not_found',message:'The provided api key could not be found.'},{type:'domain_not_trusted',message:'The api key is not valid for the request origins.'}];var D4=function(a){return a===400||a===403||a===500;};var E4=function(s){var m=t4.find(B4,function(e){return s===e.code;}).fold(X.constant('Unknown ImageProxy error'),function(e){return e.message;});return'ImageProxy HTTP error: '+m;};var F4=function(s){var m=E4(s);return f3.reject(m);};var G4=function(t){return t4.find(C4,function(e){return e.type===t;}).fold(X.constant('Unknown service error'),function(e){return e.message;});};var H4=function(t){var s=A4.parseJson(t);var e=A4.traverse(s,['error','type']);var a=e?G4(e):'Invalid JSON in service error message';return'ImageProxy Service error: '+a;};var I4=function(s,b){return A4.readBlob(b).then(function(t){var a=H4(t);return f3.reject(a);});};var J4=function(s,b){return D4(s)?I4(s,b):F4(s);};var K4={handleServiceErrorResponse:J4,handleHttpError:F4,getHttpErrorMsg:E4,getServiceErrorMsg:G4};var L4=function(a3,a){var s=a3.indexOf('?')===-1?'?':'&';if(/[?&]apiKey=/.test(a3)||!a){return a3;}else{return a3+s+'apiKey='+encodeURIComponent(a);}};var M4=function(a3,a){var h={'Content-Type':'application/json;charset=UTF-8','tiny-api-key':a};return A4.requestUrlAsBlob(L4(a3,a),h,false).then(function(r){return r.status<200||r.status>=300?K4.handleServiceErrorResponse(r.status,r.blob):f3.resolve(r.blob);});};function N4(a3,w){return A4.requestUrlAsBlob(a3,{},w).then(function(r){return r.status<200||r.status>=300?K4.handleHttpError(r.status):f3.resolve(r.blob);});}var O4=function(a3,a,w){return a?M4(a3,a):N4(a3,w);};var P4={getUrl:O4};var Q4=0;var R4=function(e,i){var s=e.dom.is(i,'img:not([data-mce-object],[data-mce-placeholder])');return s&&(W4(e,i)||X4(e,i)||e.settings.imagetools_proxy);};var S4=function(e,a){e.notificationManager.open({text:a,type:'error'});};var T4=function(e){return e.selection.getNode();};var U4=function(e,a3){var m=a3.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);if(m){return e.dom.encode(m[1]);}return null;};var V4=function(){return'imagetools'+Q4++;};var W4=function(e,i){var a3=i.src;return a3.indexOf('data:')===0||a3.indexOf('blob:')===0||new g3(a3).host===e.documentBaseURI.host;};var X4=function(e,i){return q.inArray(j3(e),new g3(i.src).host)!==-1;};var Y4=function(e,i){return q.inArray(k3(e),new g3(i.src).host)!==-1;};var Z4=function(e,i){var s=i.src,a;if(X4(e,i)){return P4.getUrl(i.src,null,Y4(e,i));}if(!W4(e,i)){s=i3(e);s+=(s.indexOf('?')===-1?'?':'&')+'url='+encodeURIComponent(i.src);a=l3(e);return P4.getUrl(s,a,false);}return Q1.imageToBlob(i);};var $4=function(e){var b;b=e.editorUpload.blobCache.getByUri(T4(e).src);if(b){return f3.resolve(b.blob());}return Z4(e,T4(e));};var _4=function(e,i){var a=e3.setEditorTimeout(e,function(){e.editorUpload.uploadImagesAuto();},n3(e));i.set(a);};var a5=function(i){clearTimeout(i.get());};var b5=function(e,i,u,a,s){return i.toBlob().then(function(b){var d,n,f,g,h;f=e.editorUpload.blobCache;h=T4(e);d=h.src;if(o3(e)){g=f.getByUri(d);if(g){d=g.uri();n=g.name();}else{n=U4(e,d);}}g=f.create({id:V4(),blob:b,base64:i.toBase64(),uri:d,name:n});f.add(g);e.undoManager.transact(function(){function j(){e.$(h).off('load',j);e.nodeChanged();if(u){e.editorUpload.uploadImagesAuto();}else{a5(a);_4(e,a);}}e.$(h).on('load',j);if(s){e.$(h).attr({width:s.w,height:s.h});}e.$(h).attr({src:g.blobUri()}).removeAttr('data-mce-src');});return g;});};var c5=function(e,i,f,s){return function(){return e._scanForImages().then(X.curry($4,e)).then(_2.blobToImageResult).then(f).then(function(a){return b5(e,a,false,i,s);},function(a){S4(e,a);});};};var d5=function(e,i,a){return function(){var s=L3.getImageSize(T4(e));var f=s?{w:s.h,h:s.w}:null;return c5(e,i,function(b){return U2.rotate(b,a);},f)();};};var e5=function(e,i,a){return function(){return c5(e,i,function(b){return U2.flip(b,a);})();};};var f5=function(e,i){return function(){var a=T4(e),o=L3.getNaturalImageSize(a);var h=function(d){return new f3(function(h1){Q1.blobToImage(d).then(function(n){var f=L3.getNaturalImageSize(n);if(o.w!==f.w||o.h!==f.h){if(L3.getImageSize(a)){L3.setImageSize(a,f);}}d3.revokeObjectURL(n.src);h1(d);});});};var b=function(e,d){return H3.edit(e,d).then(h).then(_2.blobToImageResult).then(function(d){return b5(e,d,true,i);},function(){});};$4(e).then(_2.blobToImageResult).then(X.curry(b,e),function(d){S4(e,d);});};};var g5={rotate:d5,flip:e5,editImageDialog:f5,isEditableImage:R4,cancelTimedUpload:a5};var h5=function(e,i){q.each({mceImageRotateLeft:g5.rotate(e,i,-90),mceImageRotateRight:g5.rotate(e,i,90),mceImageFlipVertical:g5.flip(e,i,'v'),mceImageFlipHorizontal:g5.flip(e,i,'h'),mceEditImage:g5.editImageDialog(e,i)},function(f,a){e.addCommand(a,f);});};var i5={register:h5};var j5=function(a,i,b){a.on('NodeChange',function(e){var d=b.get();if(d&&d.src!==e.element.src){g5.cancelTimedUpload(i);a.editorUpload.uploadImagesAuto();b.set(null);}if(g5.isEditableImage(a,e.element)){b.set(e.element);}});};var k5={setup:j5};var l5=function(e){e.addButton('rotateleft',{title:'Rotate counterclockwise',cmd:'mceImageRotateLeft'});e.addButton('rotateright',{title:'Rotate clockwise',cmd:'mceImageRotateRight'});e.addButton('flipv',{title:'Flip vertically',cmd:'mceImageFlipVertical'});e.addButton('fliph',{title:'Flip horizontally',cmd:'mceImageFlipHorizontal'});e.addButton('editimage',{title:'Edit image',cmd:'mceEditImage'});e.addButton('imageoptions',{title:'Image options',icon:'options',cmd:'mceImage'});};var n5={register:l5};var o5=function(e){e.addContextToolbar(X.curry(g5.isEditableImage,e),h3(e));};var p5={register:o5};l.add('imagetools',function(e){var i=C(0);var a=C(null);i5.register(e,i);n5.register(e);p5.register(e);k5.setup(e,i,a);});function q5(){}return q5;}());})();
