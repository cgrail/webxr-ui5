(function(){var t=(function(){'use strict';var g=tinymce.util.Tools.resolve('tinymce.PluginManager');var a=tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');var b=tinymce.util.Tools.resolve('tinymce.util.I18n');var c=tinymce.util.Tools.resolve('tinymce.util.Tools');var d=function(e){return e.getParam('toc_class','mce-toc');};var f=function(e){var h=e.getParam('toc_header','h2');return/^h[1-6]$/.test(h)?h:'h2';};var j=function(e){var h=parseInt(e.getParam('toc_depth','3'),10);return h>=1&&h<=9?h:3;};var k={getTocClass:d,getTocHeader:f,getTocDepth:j};var l=function(e){var h=0;return function(){var i=new Date().getTime().toString(32);return e+i+(h++).toString(32);};};var m={create:l};var n=m.create('mcetoc_');var o=function o(e){var i;var h=[];for(i=1;i<=e;i++){h.push('h'+i);}return h.join(',');};var p=function(e){return r(e).length>0;};var r=function(e){var I=k.getTocClass(e);var J=k.getTocHeader(e);var K=o(k.getTocDepth(e));var L=e.$(K);if(L.length&&/^h[1-9]$/i.test(J)){L=L.filter(function(i,h){return!e.dom.hasClass(h.parentNode,I);});}return c.map(L,function(h){return{id:h.id?h.id:n(),level:parseInt(h.nodeName.replace(/^H/i,''),10),title:e.$.text(h),element:h};});};var q=function(h){var i,e=9;for(i=0;i<h.length;i++){if(h[i].level<e){e=h[i].level;}if(e===1){return e;}}return e;};var s=function(e,h){var i='<'+e+' contenteditable="true">';var I='</'+e+'>';return i+a.DOM.encode(h)+I;};var u=function(e){var h=v(e);return'<div class="'+e.dom.encode(k.getTocClass(e))+'" contenteditable="false">'+h+'</div>';};var v=function(e){var I='';var J=r(e);var K=q(J)-1;var i,L,h,M;if(!J.length){return'';}I+=s(k.getTocHeader(e),b.translate('Table of Contents'));for(i=0;i<J.length;i++){h=J[i];h.element.id=h.id;M=J[i+1]&&J[i+1].level;if(K===h.level){I+='<li>';}else{for(L=K;L<h.level;L++){I+='<ul><li>';}}I+='<a href="#'+h.id+'">'+h.title+'</a>';if(M===h.level||!M){I+='</li>';if(!M){I+='</ul>';}}else{for(L=h.level;L>M;L--){I+='</li></ul><li>';}}K=h.level;}return I;};var w=function(e,h){return!h.length||e.dom.getParents(h[0],'.mce-offscreen-selection').length>0;};var x=function(e){var h=k.getTocClass(e);var $=e.$('.'+h);if(w(e,$)){e.insertContent(u(e));}else{y(e);}};var y=function(e){var h=k.getTocClass(e);var $=e.$('.'+h);if($.length){e.undoManager.transact(function(){$.html(v(e));});}};var z={hasHeaders:p,insertToc:x,updateToc:y};var A=function(e){e.addCommand('mceInsertToc',function(){z.insertToc(e);});e.addCommand('mceUpdateToc',function(){z.updateToc(e);});};var B={register:A};var C=function(h){var $=h.$,i=k.getTocClass(h);h.on('PreProcess',function(e){var I=$('.'+i,e.node);if(I.length){I.removeAttr('contentEditable');I.find('[contenteditable]').removeAttr('contentEditable');}});h.on('SetContent',function(){var e=$('.'+i);if(e.length){e.attr('contentEditable',false);e.children(':first-child').attr('contentEditable',true);}});};var D={setup:C};var E=function(h){return function(e){var i=e.control;h.on('LoadContent SetContent change',function(){i.disabled(h.readonly||!z.hasHeaders(h));});};};var F=function(e){return function(h){return h&&e.dom.is(h,'.'+k.getTocClass(e))&&e.getBody().contains(h);};};var G=function(e){e.addButton('toc',{tooltip:'Table of Contents',cmd:'mceInsertToc',icon:'toc',onPostRender:E(e)});e.addButton('tocupdate',{tooltip:'Update',cmd:'mceUpdateToc',icon:'reload'});e.addMenuItem('toc',{text:'Table of Contents',context:'insert',cmd:'mceInsertToc',onPostRender:E(e)});e.addContextToolbar(F(e),'tocupdate');};var H={register:G};g.add('toc',function(e){B.register(e);H.register(e);D.setup(e);});function P(){}return P;}());})();
