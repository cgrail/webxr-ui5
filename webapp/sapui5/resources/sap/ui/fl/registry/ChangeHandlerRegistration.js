/*!
* OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/fl/registry/ChangeRegistry","sap/ui/thirdparty/jquery"],function(C,q){"use strict";var a={_mRegistrationPromises:{},_addRegistrationPromise:function(k,p){this._mRegistrationPromises[k]=p;p.then(function(){delete this._mRegistrationPromises[k];}.bind(this));p.catch(function(e){delete this._mRegistrationPromises[k];return Promise.reject(e);}.bind(this));},waitForChangeHandlerRegistration:function(k){return this._mRegistrationPromises[k]||Promise.resolve();},getChangeHandlersOfLoadedLibsAndRegisterOnNewLoadedLibs:function(){var c=sap.ui.getCore();var A=c.getLoadedLibraries();var p=[];q.each(A,function(l,L){if(L.extensions&&L.extensions.flChangeHandlers){p.push(this._registerFlexChangeHandlers(L.extensions.flChangeHandlers));}}.bind(this));c.attachLibraryChanged(this._handleLibraryRegistrationAfterFlexLibraryIsLoaded.bind(this));return Promise.all(p);},_registerFlexChangeHandlers:function(f){if(f){var c=C.getInstance();return c.registerControlsForChanges(f);}return Promise.resolve();},_handleLibraryRegistrationAfterFlexLibraryIsLoaded:function(l){if(l.getParameter("operation")==="add"){var L=l.getParameter("metadata"),o=L.sName;if(L&&L.extensions&&L.extensions.flChangeHandlers){var f=L.extensions.flChangeHandlers;var r=this._registerFlexChangeHandlers(f);this._addRegistrationPromise(o,r);return r;}}return Promise.resolve();}};return a;},true);
