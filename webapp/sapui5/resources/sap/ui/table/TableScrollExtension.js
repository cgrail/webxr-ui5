/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableExtension","./TableUtils","sap/ui/Device","./library","sap/ui/performance/trace/Interaction","sap/base/Log","sap/ui/thirdparty/jquery"],function(T,c,D,l,I,L,q){"use strict";var S=l.SharedDomRef;var M=1000000;var V=2;var d={HORIZONAL:"HORIZONTAL",VERTICAL:"VERTICAL",BOTH:"BOTH"};var e={SCROLLBAR:"Scrollbar",KEYBOARD:"Keyboard",MOUSEWHEEL:"MouseWheel",TOUCH:"Touch",FOCUS:"Focus",EXTENSION:"Extension",TABLE:"Table"};function f(s,t){L.debug("sap.ui.table.TableScrollExtension",s,t);}var g=new window.WeakMap();var h=function(t){if(!t){return{};}if(!g.has(t)){g.set(t,{oHorizontalScrollbar:null,iHorizontalScrollPosition:null,bVerticalScrollingSuspended:false,oVerticalScrollbar:null,oExternalVerticalScrollbar:null,nVerticalScrollPosition:null,iVerticalScrollHeight:null,iVerticalScrollbarHeight:null,iFirstVisibleRowInBuffer:null,bIsScrolledVerticallyByWheel:false,bIsScrolledVerticallyByKeyboard:false,mTouchSessionData:null,bIsVerticalScrollbarExternal:false,fnOnRowsUpdatedPreprocessor:null});}return g.get(t);};h.destroy=function(t){delete g.delete(t);};var H={onScroll:function(o){var n=o.target.scrollLeft;var O=o.target._scrollLeft;I.notifyScrollEvent&&I.notifyScrollEvent(o);if(n!==O){var s=H.getScrollAreas(this);o.target._scrollLeft=n;for(var i=0;i<s.length;i++){var a=s[i];if(a!==o.target&&a.scrollLeft!==n){a.scrollLeft=n;a._scrollLeft=n;}}h(this).iHorizontalScrollPosition=n;}},restoreScrollPosition:function(t){var s=t._getScrollExtension();var o=s.getHorizontalScrollbar();if(o&&h(t).iHorizontalScrollPosition!==null){var a=H.getScrollAreas(t);for(var i=0;i<a.length;i++){var b=a[i];delete b._scrollLeft;}if(o.scrollLeft!==h(t).iHorizontalScrollPosition){o.scrollLeft=h(t).iHorizontalScrollPosition;}else{var n=q.Event("scroll");n.target=o;H.onScroll.call(t,n);}}},onScrollbarMouseDown:function(o){this._getKeyboardExtension().setActionMode(false);},addEventListeners:function(t){var s=t._getScrollExtension();var o=s.getHorizontalScrollbar();var a=H.getScrollAreas(t);if(!s._onHorizontalScrollEventHandler){s._onHorizontalScrollEventHandler=H.onScroll.bind(t);}for(var i=0;i<a.length;i++){a[i].addEventListener("scroll",s._onHorizontalScrollEventHandler);}if(o){if(!s._onHorizontalScrollbarMouseDownEventHandler){s._onHorizontalScrollbarMouseDownEventHandler=H.onScrollbarMouseDown.bind(t);}o.addEventListener("mousedown",s._onHorizontalScrollbarMouseDownEventHandler);}},removeEventListeners:function(t){var s=t._getScrollExtension();var o=s.getHorizontalScrollbar();var a=H.getScrollAreas(t);if(s._onHorizontalScrollEventHandler){for(var i=0;i<a.length;i++){a[i].removeEventListener("scroll",s._onHorizontalScrollEventHandler);delete a[i]._scrollLeft;}delete s._onHorizontalScrollEventHandler;}if(o&&s._onHorizontalScrollbarMouseDownEventHandler){o.removeEventListener("mousedown",s._onHorizontalScrollbarMouseDownEventHandler);delete s._onHorizontalScrollbarMouseDownEventHandler;}},getScrollAreas:function(t){var s=[t._getScrollExtension().getHorizontalScrollbar(),t.getDomRef("sapUiTableColHdrScr"),t.getDomRef("sapUiTableCtrlScr")];return s.filter(function(o){return o!=null;});}};var j={updateScrollPosition:function(t,n,s,p){s=s==null?e.EXTENSION:s;var o=t?t._getScrollExtension():null;var v=o?o.getVerticalScrollbar():null;if(!t||!v||!o.isVerticalScrollbarRequired()||h(t).bVerticalScrollingSuspended){f("VerticalScrollingHelper#updateScrollPosition: Not executed - Guard clause not passed",t);return;}var a=h(t).nVerticalScrollPosition;var i=j.getScrollRange(t);if(n==null){var F=t.getFirstVisibleRow();var b=t._getMaxFirstRenderedRowIndex();if(F>b){n=i;h(t).iFirstVisibleRowInBuffer=F-b;}else{n=F*j.getScrollRangeRowFraction(t);h(t).iFirstVisibleRowInBuffer=null;}}else{h(t).iFirstVisibleRowInBuffer=null;}h(t).nVerticalScrollPosition=Math.min(Math.max(0,n),i);f("VerticalScrollingHelper#updateScrollPosition: From "+a+" to "+h(t).nVerticalScrollPosition+" (diff: "+(h(t).nVerticalScrollPosition-a)+", trigger: "+s+")",t);if(p===true){f("VerticalScrollingHelper#updateScrollPosition: Scrolling prevented",t);return;}window.cancelAnimationFrame(t._mAnimationFrames.verticalScrollUpdate);delete t._mAnimationFrames.verticalScrollUpdate;switch(s){case e.SCROLLBAR:clearTimeout(t._mTimeouts.largeDataScrolling);delete t._mTimeouts.largeDataScrolling;if(t._bLargeDataScrolling&&!h(t).bIsScrolledVerticallyByWheel){t._mTimeouts.largeDataScrolling=setTimeout(function(){delete t._mTimeouts.largeDataScrolling;j.updateFirstVisibleRow(t);},300);}else{j.updateFirstVisibleRow(t);}break;case e.KEYBOARD:case e.MOUSEWHEEL:case e.TOUCH:case e.EXTENSION:case e.TABLE:var N=0;var r=j.getScrollRange(t);if(h(t).nVerticalScrollPosition>0&&h(t).nVerticalScrollPosition<0.5){N=1;}else if(h(t).nVerticalScrollPosition>=r-0.5&&h(t).nVerticalScrollPosition<r){N=r-1;}else{N=Math.round(h(t).nVerticalScrollPosition);}if(v.scrollTop!==N){f("VerticalScrollingHelper#updateScrollPosition: scrollTop will be set asynchronously",t);t._mAnimationFrames.verticalScrollUpdate=window.requestAnimationFrame(function(){var u=v.scrollTop;delete t._mAnimationFrames.verticalScrollUpdate;f("VerticalScrollingHelper#updateScrollPosition: (async) Set scrollTop from "+u+" to "+N,t);v.scrollTop=N;v._scrollTop=v.scrollTop;if(N===r&&N!==v.scrollTop){f("VerticalScrollingHelper#updateScrollPosition: (async) Adjusted from "+h(t).nVerticalScrollPosition+" to "+v.scrollTop,t);h(t).nVerticalScrollPosition=v.scrollTop;}j.updateFirstVisibleRow(t);});}else if(h(t).nVerticalScrollPosition!==a){f("VerticalScrollingHelper#updateScrollPosition: firstVisibleRow will be set asynchronously",t);t._mAnimationFrames.verticalScrollUpdate=window.requestAnimationFrame(function(){delete t._mAnimationFrames.verticalScrollUpdate;j.updateFirstVisibleRow(t);});}else{f("VerticalScrollingHelper#updateScrollPosition: scrollTop and nVerticalScrollPosition not changed"+" -> update inner vertical scroll position",t);o.updateInnerVerticalScrollPosition();}break;default:}},onScroll:function(o){I.notifyScrollEvent&&I.notifyScrollEvent(o);if(h(this).bIsScrolledVerticallyByKeyboard){f("Vertical scroll event handler: Aborted - Scrolled by keyboard",this);return;}this._getKeyboardExtension().setActionMode(false);var n=o.target.scrollTop;var a=o.target._scrollTop;var s=n!==a;if(s){f("Vertical scroll event handler: Scroll position changed by scrolling with the scrollbar:"+" From "+h(this).nVerticalScrollPosition+" to "+n,this);delete o.target._scrollTop;j.updateScrollPosition(this,n,e.SCROLLBAR);}else{f("Vertical scroll event handler: Scroll position changed by scrolling with VerticalScrollingHelper#updateScrollPosition",this);}h(this).bIsScrolledVerticallyByWheel=false;},updateFirstVisibleRow:function(t){var s=t._getScrollExtension();var i=t._getMaxFirstRenderedRowIndex();var n=j.getRowIndexAtCurrentScrollPosition(t);var o=t.getFirstVisibleRow();var N=n<0;var O=o>=i;var F=n!==o;var r=F&&!(N&&O);if(r){var b=!O||n!==i;if(N){n=i;}f("updateFirstVisibleRow: From "+o+" to "+n,t);t.setFirstVisibleRow(n,true,N);if(b){j.setOnRowsUpdatedPreprocessor(t,function(a){f("updateFirstVisibleRow - onRowsUpdatedPreprocessor: Reason "+a.getParameters().reason,this);s.updateInnerVerticalScrollPosition();if(N){var C=this.getFirstVisibleRow();var p=n===C;if(p){this.setProperty("firstVisibleRow",-1,true);this.setFirstVisibleRow(C,true);}}return false;});}else{f("updateFirstVisibleRow: Update inner vertical scroll position",t);s.updateInnerVerticalScrollPosition();}}else if(c.isVariableRowHeightEnabled(t)){f("updateFirstVisibleRow: Update inner vertical scroll position",t);s.updateInnerVerticalScrollPosition();}},getRowIndexAtCurrentScrollPosition:function(t){var s=t._getScrollExtension();var i=t._getMaxFirstVisibleRowIndex();if(i===0){return 0;}else{var n=j.getScrollPosition(t);var a=j.getScrollRange(t);var b=j.getScrollRangeRowFraction(t);if(c.isVariableRowHeightEnabled(t)){if(j.isScrollPositionInBuffer(t)){return-1;}else{return Math.min(i,Math.floor(n/b));}}else{var r=Math.floor(n/b);var o=a-n;var p=s.getVerticalScrollbar()._scrollTop==null||h(t).bIsScrolledVerticallyByWheel;var u=o<1&&p||o<0.01;if(u){j.updateScrollPosition(t,a,null,true);}return u?i:Math.min(i,r);}}},getScrollRange:function(t){var s=t._getScrollExtension();var v=s.getVerticalScrollHeight()-s.getVerticalScrollbarHeight();return Math.max(0,v);},getScrollRangeBuffer:function(t){if(!c.isVariableRowHeightEnabled(t)){return 0;}return V*t._getDefaultRowHeight();},getScrollPosition:function(t){var s=t._getScrollExtension();if(h(t).nVerticalScrollPosition!=null){return h(t).nVerticalScrollPosition;}else if(s.isVerticalScrollbarVisible()){return s.getVerticalScrollbar().scrollTop;}else{return 0;}},getScrollRangeRowFraction:function(t){var s=t._getScrollExtension();var v=t._getTotalRowCount()-t.getVisibleRowCount();var i;if(c.isVariableRowHeightEnabled(t)){i=j.getScrollRange(t)-j.getScrollRangeBuffer(t);var b=s.getVerticalScrollHeight()===M;if(!b){i+=t._getDefaultRowHeight();}}else{i=j.getScrollRange(t);}return i/Math.max(1,v);},isScrollPositionInBuffer:function(t){if(!c.isVariableRowHeightEnabled(t)){return false;}var s=j.getScrollRange(t);var n=j.getScrollPosition(t);var i=j.getScrollRangeBuffer(t);return s-n<=i;},getInnerScrollRange:function(t){if(!t||!t._aRowHeights){return 0;}var r=t._aRowHeights;var i=t._getDefaultRowHeight()*t.getVisibleRowCount();if(t.getVisibleRowCount()>=t._getTotalRowCount()){r=r.slice(0,t._getTotalRowCount());}var n=r.reduce(function(a,b){return a+b;},0)-i;if(n>0){n=Math.ceil(n);}return Math.max(0,n);},onScrollbarMouseDown:function(o){h(this).bIsScrolledVerticallyByWheel=false;h(this).bIsScrolledVerticallyByKeyboard=false;},setOnRowsUpdatedPreprocessor:function(t,p){h(t).fnOnRowsUpdatedPreprocessor=p;},runOnRowsUpdatedPreprocessor:function(t,o){var b=true;if(h(t).fnOnRowsUpdatedPreprocessor!=null){b=h(t).fnOnRowsUpdatedPreprocessor.call(t,o)!==false;}h(t).fnOnRowsUpdatedPreprocessor=null;return b;},onRowsUpdated:function(o){var s=this._getScrollExtension();var b=j.runOnRowsUpdatedPreprocessor(this,o);if(!c.isVariableRowHeightEnabled(this)||!b){return;}var r=o.getParameters().reason;var R=r===c.RowsUpdateReason.Expand||r===c.RowsUpdateReason.Collapse;var F=this.getFirstVisibleRow()-this._getMaxFirstRenderedRowIndex();f("onRowsUpdated: Reason "+r,this);if(F>=0&&R){h(this).iFirstVisibleRowInBuffer=F;s.updateInnerVerticalScrollPosition();}},restoreScrollPosition:function(t){j.updateScrollPosition(t,h(t).nVerticalScrollPosition);},addEventListeners:function(t){var s=t._getScrollExtension();var a=j.getScrollAreas(t);var v=s.getVerticalScrollbar();if(!s._onVerticalScrollEventHandler){s._onVerticalScrollEventHandler=j.onScroll.bind(t);}for(var i=0;i<a.length;i++){a[i].addEventListener("scroll",s._onVerticalScrollEventHandler);}if(v){if(!s._onVerticalScrollbarMouseDownEventHandler){s._onVerticalScrollbarMouseDownEventHandler=j.onScrollbarMouseDown.bind(t);}v.addEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);}t.attachEvent("_rowsUpdated",j.onRowsUpdated);},removeEventListeners:function(t){var s=t._getScrollExtension();var a=j.getScrollAreas(t);var v=s.getVerticalScrollbar();if(s._onVerticalScrollEventHandler){for(var i=0;i<a.length;i++){a[i].removeEventListener("scroll",s._onVerticalScrollEventHandler);}delete s._onVerticalScrollEventHandler;}if(v&&s._onVerticalScrollbarMouseDownEventHandler){v.removeEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);delete s._onVerticalScrollbarMouseDownEventHandler;}t.detachEvent("_rowsUpdated",j.onRowsUpdated);},isUpdatePending:function(t){return!!(t&&t._mAnimationFrames.verticalScrollUpdate);},getScrollAreas:function(t){var s=[t._getScrollExtension().getVerticalScrollbar()];return s.filter(function(o){return o!=null;});}};var k={onMouseWheelScrolling:function(o,a){var s=this._getScrollExtension();var v=Math.abs(a.deltaY)>Math.abs(a.deltaX);var i=v?a.deltaY:a.deltaX;var b=v&&a.shiftKey||!v;var n=i>0;var p=false;if(i===0){return;}if(b&&(o.scrollDirection===d.HORIZONAL||o.scrollDirection===d.BOTH)){var r=s.getHorizontalScrollbar();if(a.deltaMode>0){var t=c.Column.getMinColumnWidth();i=n?t:-t;}if(n){p=r.scrollLeft===r.scrollWidth-r.offsetWidth;}else{p=r.scrollLeft===0;}if(s.isHorizontalScrollbarVisible()&&!p){a.preventDefault();a.stopPropagation();this._getKeyboardExtension().setActionMode(false);r.scrollLeft=r.scrollLeft+i;}}else if(!b&&(o.scrollDirection===d.VERTICAL||o.scrollDirection===d.BOTH)){var u=s.getVerticalScrollbar();var w=this._getMaxFirstRenderedRowIndex();var x=c.isVariableRowHeightEnabled(this)&&this._getFirstRenderedRowIndex()===w;var y=j.getScrollRangeRowFraction(this);var z=x?this._getDefaultRowHeight():y;if(a.deltaMode===1){i*=z;}else if(a.deltaMode===2){i*=z*this.getVisibleRowCount();}if(n){p=u.scrollTop===u.scrollHeight-u.offsetHeight;}else{p=u.scrollTop===0;}if(s.isVerticalScrollbarVisible()&&!p){a.preventDefault();a.stopPropagation();var A=j.getScrollPosition(this);var B=A-(w*y);var C=i;if(!x||(x&&B===0&&!n)){var F=i/(a.deltaMode===0?this._getDefaultRowHeight():y);if(F>1){F=Math.floor(F);}else if(F<-1){F=Math.ceil(F);}C=F*y;}else if(!n){if(B+C<0){C=-B;}}h(this).bIsScrolledVerticallyByWheel=true;h(this).bIsScrolledVerticallyByKeyboard=false;this._getKeyboardExtension().setActionMode(false);j.updateScrollPosition(this,A+C,e.MOUSEWHEEL);}}},onTouchStart:function(o,a){if(a.type==="touchstart"||a.pointerType==="touch"){var s=this._getScrollExtension();var b=s.getHorizontalScrollbar();var v=s.getVerticalScrollbar();var t=a.touches?a.touches[0]:a;h(this).mTouchSessionData={initialPageX:t.pageX,initialPageY:t.pageY,initialScrollTop:v?v.scrollTop:0,initialScrollLeft:b?b.scrollLeft:0,initialScrolledToEnd:null,touchMoveDirection:null};}},onTouchMoveScrolling:function(o,a){if(a.type!=="touchmove"&&a.pointerType!=="touch"){return;}var s=this._getScrollExtension();var t=h(this).mTouchSessionData;if(!t){return;}var b=a.touches?a.touches[0]:a;var i=(b.pageX-t.initialPageX);var n=(b.pageY-t.initialPageY);var p=false;if(!t.touchMoveDirection){if(i===0&&n===0){return;}t.touchMoveDirection=Math.abs(i)>Math.abs(n)?"horizontal":"vertical";}switch(t.touchMoveDirection){case"horizontal":var r=s.getHorizontalScrollbar();if(r&&(o.scrollDirection===d.HORIZONAL||o.scrollDirection===d.BOTH)){this._getKeyboardExtension().setActionMode(false);if(t.initialScrolledToEnd==null){if(i<0){t.initialScrolledToEnd=r.scrollLeft===r.scrollWidth-r.offsetWidth;}else{t.initialScrolledToEnd=r.scrollLeft===0;}}if(!t.initialScrolledToEnd){r.scrollLeft=t.initialScrollLeft-i;p=true;}}break;case"vertical":var v=s.getVerticalScrollbar();if(v&&(o.scrollDirection===d.VERTICAL||o.scrollDirection===d.BOTH)){this._getKeyboardExtension().setActionMode(false);if(t.initialScrolledToEnd==null){if(n<0){t.initialScrolledToEnd=v.scrollTop===v.scrollHeight-v.offsetHeight;}else{t.initialScrolledToEnd=v.scrollTop===0;}}if(!t.initialScrolledToEnd){j.updateScrollPosition(this,t.initialScrollTop-n,e.TOUCH);p=true;}}break;default:}if(p){a.preventDefault();}},addEventListeners:function(t){var s=t._getScrollExtension();var a=k.getEventListenerTargets(t);s._mMouseWheelEventListener=this.addMouseWheelEventListener(a,t,{scrollDirection:d.BOTH});s._mTouchEventListener=this.addTouchEventListener(a,t,{scrollDirection:d.BOTH});},addMouseWheelEventListener:function(a,t,o){var O=k.onMouseWheelScrolling.bind(t,o);for(var i=0;i<a.length;i++){a[i].addEventListener("wheel",O);}return{wheel:O};},addTouchEventListener:function(a,t,o){var O=k.onTouchStart.bind(t,o);var b=k.onTouchMoveScrolling.bind(t,o);var n={};for(var i=0;i<a.length;i++){if(D.support.pointer&&D.system.desktop){a[i].addEventListener("pointerdown",O);a[i].addEventListener("pointermove",b,D.browser.chrome?{passive:true}:false);}else if(D.support.touch){a[i].addEventListener("touchstart",O);a[i].addEventListener("touchmove",b);}}if(D.support.pointer&&D.system.desktop){n={pointerdown:O,pointermove:b};}else if(D.support.touch){n={touchstart:O,touchmove:b};}return n;},removeEventListeners:function(t){var s=t._getScrollExtension();var a=k.getEventListenerTargets(t);function r(o,b){for(var n in b){var p=b[n];if(p){o.removeEventListener(n,p);}}}for(var i=0;i<a.length;i++){r(a[i],s._mMouseWheelEventListener);r(a[i],s._mTouchEventListener);}delete s._mMouseWheelEventListener;delete s._mTouchEventListener;},getEventListenerTargets:function(t){var a=[t.getDomRef("tableCCnt")];return a.filter(function(o){return o!=null;});}};var E={onBeforeRendering:function(o){var s=this._getScrollExtension();var r=o!=null&&o.isMarked("renderRows");s._clearCache();if(!r){h(this).bVerticalScrollingSuspended=true;this.attachEventOnce("_rowsUpdated",function(){h(this).bVerticalScrollingSuspended=false;j.restoreScrollPosition(this);});}},onAfterRendering:function(o){var s=this._getScrollExtension();var r=o!=null&&o.isMarked("renderRows");if(r){s.updateVerticalScrollbarHeight();s.updateVerticalScrollHeight();}H.restoreScrollPosition(this);},onfocusin:function(o){var r;var C=c.getCellInfo(o.target);if(C.isOfType(c.CELLTYPE.DATACELL)){r=this.getDomRef("sapUiTableCtrlScr");}else if(C.isOfType(c.CELLTYPE.COLUMNHEADER)){r=this.getDomRef("sapUiTableColHdrScr");}if(r&&C.columnIndex>=this.getComputedFixedColumnCount()){var a=this._getScrollExtension().getHorizontalScrollbar();var $=q(a);var b=C.cell[0];var i=this._bRtlMode?$.scrollLeftRTL():a.scrollLeft;var R=r.clientWidth;var n=b.offsetLeft;var p=n+b.offsetWidth;var O=n-i;var s=p-R-i;var N;if(O<0&&s<0){N=i+O;}else if(s>0&&O>0){N=i+s;}if(N!=null){if(this._bRtlMode){$.scrollLeftRTL(N);}else{a.scrollLeft=N;}}}var P=c.getParentCell(this,o.target);if(P){var t=this;var u=function(){var v=P.find(".sapUiTableCellInner");if(v.length>0){if(t._bRtlMode){v.scrollLeftRTL(v[0].scrollWidth-v[0].clientWidth);}else{v[0].scrollLeft=0;}v[0].scrollTop=0;}};Promise.resolve().then(function(){if(D.browser.safari){window.setTimeout(u,0);}else{u();}});}}};var m=T.extend("sap.ui.table.TableScrollExtension",{_init:function(t,s,a){this._delegate=E;t.addEventDelegate(this._delegate,t);return"ScrollExtension";},_attachEvents:function(){var t=this.getTable();H.addEventListeners(t);j.addEventListeners(t);k.addEventListeners(t);},_detachEvents:function(){var t=this.getTable();H.removeEventListeners(t);j.removeEventListeners(t);k.removeEventListeners(t);},_debug:function(){this._ScrollingHelper=k;this._ExtensionDelegate=E;this._HorizontalScrollingHelper=H;this._VerticalScrollingHelper=j;},destroy:function(){var t=this.getTable();if(t){t.removeEventDelegate(this._delegate);}this._delegate=null;this._clearCache();h.destroy(t);T.prototype.destroy.apply(this,arguments);}});m.prototype.scrollVertically=function(b,p,i,a,B){var t=this.getTable();if(!t){return false;}b=b===true;p=p===true;i=i===true;a=a===true;var s=false;var r=t._getTotalRowCount();var v=t.getVisibleRowCount();var n=v-t.getFixedRowCount()-t.getFixedBottomRowCount();var F=t.getFirstVisibleRow();var o=p?n:1;if(b){if(F+v<r){if(B){B();}if(a){setTimeout(function(){t.setFirstVisibleRow(Math.min(F+o,r-v));},0);}else{t.setFirstVisibleRow(Math.min(F+o,r-v));}s=true;}}else if(F>0){if(B){B();}if(a){setTimeout(function(){t.setFirstVisibleRow(Math.max(F-o,0));},0);}else{t.setFirstVisibleRow(Math.max(F-o,0));}s=true;}if(s&&i){h(t).bIsScrolledVerticallyByKeyboard=true;}return s;};m.prototype.scrollVerticallyMax=function(b,i){var t=this.getTable();if(!t){return false;}if(b==null){b=false;}if(i==null){i=false;}var s=false;var F=t.getFirstVisibleRow();if(b){var a=t._getTotalRowCount()-c.getNonEmptyVisibleRowCount(t);if(F<a){t.setFirstVisibleRow(a);s=true;}}else if(F>0){t.setFirstVisibleRow(0);s=true;}if(s&&i){h(t).bIsScrolledVerticallyByKeyboard=true;}return s;};m.prototype.getHorizontalScrollbar=function(){var t=this.getTable();if(t&&!t._bInvalid&&!h(t).oHorizontalScrollbar){h(t).oHorizontalScrollbar=t.getDomRef(S.HorizontalScrollBar);}return h(t).oHorizontalScrollbar||null;};m.prototype.getVerticalScrollbar=function(){var t=this.getTable();if(t&&!t._bInvalid&&!h(t).oVerticalScrollbar){h(t).oVerticalScrollbar=t.getDomRef(S.VerticalScrollBar);if(!h(t).oVerticalScrollbar&&this.isVerticalScrollbarExternal()){h(t).oVerticalScrollbar=h(t).oExternalVerticalScrollbar;}}return h(t).oVerticalScrollbar||null;};m.prototype.isHorizontalScrollbarVisible=function(){var o=this.getHorizontalScrollbar();return o!=null&&!o.classList.contains("sapUiTableHidden");};m.prototype.isVerticalScrollbarVisible=function(){var v=this.getVerticalScrollbar();return v!=null&&!v.classList.contains("sapUiTableHidden");};m.prototype.isVerticalScrollbarExternal=function(){return h(this.getTable()).bIsVerticalScrollbarExternal;};m.prototype.markVerticalScrollbarAsExternal=function(s){if(s){h(this.getTable()).bIsVerticalScrollbarExternal=true;h(this.getTable()).oExternalVerticalScrollbar=s;}};m.prototype.updateHorizontalScrollbar=function(t){var o=this.getTable();var a=this.getHorizontalScrollbar();if(!o||!a||!t){return;}var $=o.$();var C=t.tableCtrlScrollWidth;if(D.browser.safari){C=Math.max(C,o._getColumnsWidth(o.getComputedFixedColumnCount()));}var b=C>t.tableCtrlScrWidth;if(b){if(!this.isHorizontalScrollbarVisible()){$.addClass("sapUiTableHScr");a.classList.remove("sapUiTableHidden");if(D.browser.safari){var i=$.find(".sapUiTableCtrlScroll, .sapUiTableColHdrScr > .sapUiTableColHdr");i.outerWidth(C);}}var s=t.tableCtrlFixedWidth;if($.find(".sapUiTableRowHdrScr").length>0){s+=t.tableRowHdrScrWidth;}if(o._bRtlMode){a.style.marginRight=s+"px";a.style.marginLeft="";}else{a.style.marginLeft=s+"px";a.style.marginRight="";}var n=o.getDomRef("hsb-content");if(n){n.style.width=C+"px";}}if(!b&&this.isHorizontalScrollbarVisible()){$.removeClass("sapUiTableHScr");a.classList.add("sapUiTableHidden");if(D.browser.safari){$.find(".sapUiTableCtrlScroll, .sapUiTableColHdr").css("width","");}}};m.prototype.updateVerticalScrollbarHeight=function(){var t=this.getTable();var v=this.getVerticalScrollbar();if(!t||!v){return;}var n=this.getVerticalScrollbarHeight();v.style.maxHeight=n+"px";if(h(t).iVerticalScrollbarHeight!==n){h(t).iVerticalScrollbarHeight=n;j.updateScrollPosition(t);}};m.prototype.getVerticalScrollbarHeight=function(){var t=this.getTable();if(!t){return 0;}var s=Math.max(1,t.getVisibleRowCount()-t.getFixedRowCount()-t.getFixedBottomRowCount());return s*t._getDefaultRowHeight();};m.prototype.updateVerticalScrollbarPosition=function(){var t=this.getTable();var v=this.getVerticalScrollbar();if(!t||!v){return;}var o=t.getDomRef("tableCCnt");if(o){var i=o.offsetTop;var a=t.getDomRef("vsb-bg");if(a){a.style.top=i+"px";}var F=t.getFixedRowCount();if(F>0){i+=t._iVsbTop;}v.style.top=i+"px";}};m.prototype.updateVerticalScrollPosition=function(){j.updateScrollPosition(this.getTable(),undefined,e.TABLE);};m.prototype.restoreVerticalScrollPosition=function(){j.restoreScrollPosition(this.getTable());};m.prototype.updateVerticalScrollHeight=function(){var v=this.getVerticalScrollbar();var o=v?v.firstChild:null;if(!o){return;}var n=this.getVerticalScrollHeight(true);o.style.height=this.getVerticalScrollHeight()+"px";if(h(this.getTable()).iVerticalScrollHeight!==n){h(this.getTable()).iVerticalScrollHeight=n;j.updateScrollPosition(this.getTable());}};m.prototype.getVerticalScrollHeight=function(b){var t=this.getTable();if(!t){return 0;}var i=t._getTotalRowCount();var v=t.getVisibleRowCount();var a=t._getDefaultRowHeight();var r;var s;if(c.isVariableRowHeightEnabled(t)){r=Math.max(i,v+1);s=a*(r-1)+j.getScrollRangeBuffer(t);}else{r=Math.max(i,v);s=a*r;}if(b===true){return s;}else{return Math.min(M,s);}};m.prototype.updateVerticalScrollbarVisibility=function(){var t=this.getTable();var o=t?t.getDomRef():null;var v=this.getVerticalScrollbar();if(!o||!v){return;}var b=this.isVerticalScrollbarRequired();if(b&&!this.isVerticalScrollbarVisible()){if(!this.isVerticalScrollbarExternal()){o.classList.add("sapUiTableVScr");}v.classList.remove("sapUiTableHidden");}if(!b&&this.isVerticalScrollbarVisible()){o.classList.remove("sapUiTableVScr");v.classList.add("sapUiTableHidden");}};m.prototype.isVerticalScrollbarRequired=function(){var t=this.getTable();if(!t){return false;}return j.getInnerScrollRange(t)>0||(t._getTotalRowCount()>t.getVisibleRowCount());};m.prototype.updateInnerVerticalScrollPosition=function(){var t=this.getTable();var C=t?t.getDomRef("tableCCnt"):null;if(!c.isVariableRowHeightEnabled(t)||!C||j.isUpdatePending(t)){return;}if(t._getFirstRenderedRowIndex()!==t._iRenderedFirstVisibleRow){f("updateInnerVerticalScrollPosition: Skipped, because rows will be updated",t);return;}var a=j.getInnerScrollRange(t);if(a===0){f("updateInnerVerticalScrollPosition: 0",t);t.setFirstVisibleRow(0,true);this._nVerticalScrollPosition=0;C.scrollTop=0;return;}var F=t.getFirstVisibleRow();var n=j.getScrollPosition(t);var s=j.isScrollPositionInBuffer(t);var b=0;var o;var p;var r=null;var R=t._aRowHeights;if(!s){var u=j.getScrollRangeRowFraction(t);b=n-(F*u);o=R[0];p=Math.max(0,Math.min(b/u,1));r=Math.round(o*p);}else{var v=0;var w=0;var i;for(i=0;i<R.length&&w<a;i++){v++;w+=R[i];}var x=j.getScrollRange(t);var B=j.getScrollRangeBuffer(t);var y=B/v;if(h(t).iFirstVisibleRowInBuffer==null){b=n-x+B;var z=b/y;var A;if(Math.ceil(z)-z<0.00001){A=Math.ceil(b/y);}else{A=Math.floor(b/y);}A=Math.min(A,v);o=R[A]||0;p=Math.max(0,Math.min((b-(y*A))/y,1));for(i=0;i<A;i++){r+=R[i];}r+=o*p;r=Math.min(r,a);var N=t._getMaxFirstRenderedRowIndex()+A;if(N!==F){f("updateInnerVerticalScrollPosition: Set firstVisibleRow from "+F+" to "+N,t);t.setFirstVisibleRow(N,true);}}else{var G=x-B;b=h(t).iFirstVisibleRowInBuffer*y;var J=G+b;p=0;f("updateInnerVerticalScrollPosition: Set scroll position to "+J,t);j.updateScrollPosition(t,J);return;}}f("updateInnerVerticalScrollPosition: "+r+" of "+o+" ("+(p*100)+"%)"+" (in buffer: "+s+")",t);C.scrollTop=r;};m.prototype.registerForMouseWheel=function(a,o){var t=this.getTable();if(T.isEnrichedWith(t,"sap.ui.table.TableSyncExtension")){return k.addMouseWheelEventListener(a,t,o);}else{L.error("This method can only be used with synchronization enabled.",t,"TableScrollExtension#registerForMouseWheel");return null;}};m.prototype.registerForTouch=function(a,o){var t=this.getTable();if(T.isEnrichedWith(t,"sap.ui.table.TableSyncExtension")){return k.addTouchEventListener(a,t,o);}else{L.error("This method can only be used with synchronization enabled.",t,"TableScrollExtension#registerForTouch");return null;}};m.prototype._clearCache=function(){h(this.getTable()).oVerticalScrollbar=null;h(this.getTable()).oHorizontalScrollbar=null;};m.ScrollDirection=d;return m;});
