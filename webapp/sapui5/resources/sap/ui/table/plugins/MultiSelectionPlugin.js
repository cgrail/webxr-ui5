/*
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./SelectionPlugin','./SelectionModelPlugin','./BindingSelectionPlugin','../library','sap/ui/core/Icon','sap/ui/core/IconPool','sap/ui/core/theming/Parameters'],function(S,a,B,l,I,b,T){"use strict";var c=l.SelectionMode;var M=S.extend("sap.ui.table.plugins.MultiSelectionPlugin",{metadata:{properties:{limit:{type:"int",group:"Behavior",defaultValue:200}},events:{selectionChange:{parameters:{indices:{type:"int[]"},limitReached:{type:"boolean"}}}}}});M.prototype.init=function(){S.prototype.init.call(this);var s=T.get("_sap_ui_table_DeleteIcon");var i=new I({src:b.getIconURI(s),useIconTooltip:false});i.addStyleClass("sapUiTableSelectClear");this._bLimitReached=false;this.oSelectionPlugin=null;this.oDeselectAllIcon=i;};M.prototype.exit=function(){if(this.oSelectionPlugin){this.oSelectionPlugin.destroy();this.oSelectionPlugin=null;}if(this.oDeselectAllIcon){this.oDeselectAllIcon.destroy();this.oDeselectAllIcon=null;}};M.prototype.getRenderConfig=function(){return{headerSelector:{type:"clear",icon:this.oDeselectAllIcon}};};M.prototype.onHeaderSelectorPress=function(){this.clearSelection();return true;};M.prototype.onKeyboardShortcut=function(t){this.clearSelection();if(t==="toggle"){return true;}};M.prototype.addSelectionInterval=function(i,f){if(!this.oSelectionPlugin){return;}var L=this.getLimit();var g=f-i;var t=this;var o=this._getBinding();this.setLimitReached(false);if(g>L){f=i+L;g=L;this.setLimitReached(true);}if(o&&i>=0&&g>=0){d(o,i,g).then(function(){t.oSelectionPlugin.addSelectionInterval(i,f);});}};function d(o,s,L){return new Promise(function(r){e(o,s,L,r);});}function e(o,s,L,r){var C=o.getContexts(s,L);var f=false;for(var i=0;i<C.length;i++){if(!C[i]){f=true;break;}}if(!f&&!C.dataRequested){r(C);return;}o.attachEventOnce("dataReceived",function(){C=o.getContexts(s,L);if(C.length==L){r(C);}else{e(o,s,L,r);}});}M.prototype.isLimitReached=function(){return this._bLimitReached;};M.prototype.setLimitReached=function(L){this._bLimitReached=L;};M.prototype.clearSelection=function(){if(this.oSelectionPlugin){this.oSelectionPlugin.clearSelection();}};M.prototype.getSelectedIndex=function(){if(this.oSelectionPlugin){return this.oSelectionPlugin.getSelectedIndex();}return-1;};M.prototype.getSelectedIndices=function(){if(this.oSelectionPlugin){return this.oSelectionPlugin.getSelectedIndices();}return[];};M.prototype.getSelectableCount=function(){if(this.oSelectionPlugin){return this.oSelectionPlugin.getSelectableCount();}return 0;};M.prototype.getSelectedCount=function(){if(this.oSelectionPlugin){return this.oSelectionPlugin.getSelectedCount();}return 0;};M.prototype.isIndexSelectable=function(i){if(this.oSelectionPlugin){return this.oSelectionPlugin.isIndexSelectable(i);}return false;};M.prototype.isIndexSelected=function(i){if(this.oSelectionPlugin){return this.oSelectionPlugin.isIndexSelected(i);}return false;};M.prototype.removeSelectionInterval=function(i,f){if(this.oSelectionPlugin){this.oSelectionPlugin.removeSelectionInterval(i,f);}};M.prototype.setSelectedIndex=function(i){if(this.oSelectionPlugin){var t=this;var o=this._getBinding();if(o&&i>=0){d(o,i,1).then(function(){t.oSelectionPlugin.setSelectedIndex(i);});}}};M.prototype.setSelectionInterval=function(i,f){if(!this.oSelectionPlugin){return;}var L=this.getLimit();var g=f-i+1;var t=this;var o=this._getBinding();this.setLimitReached(false);if(g>L){f=i+L-1;g=L;this.setLimitReached(true);}if(o&&i>=0&&g>0){d(o,i,g).then(function(){t.oSelectionPlugin.setSelectionInterval(i,f);});}};M.prototype.setParent=function(p){var r=S.prototype.setParent.apply(this,arguments);if(this.oSelectionPlugin){this.oSelectionPlugin.destroy();this.oSelectionPlugin=null;}if(p){this.oSelectionPlugin=new p._SelectionAdapterClass();this.oSelectionPlugin.attachEvent("selectionChange",this._onSelectionChange,this);p.setSelectionMode(c.MultiToggle);}return r;};M.prototype._onSelectionChange=function(E){var r=E.getParameter("rowIndices");this.fireSelectionChange({rowIndices:r,limitReached:this.isLimitReached()});};M.prototype._getLastIndex=function(){if(this.oSelectionPlugin){return this.oSelectionPlugin._getLastIndex();}return 0;};M.prototype._getBinding=function(){if(this.oSelectionPlugin){return this.oSelectionPlugin._getBinding();}return null;};M.prototype._setBinding=function(o){if(this.oSelectionPlugin){return this.oSelectionPlugin._setBinding(o);}};M.prototype._onBindingChange=function(E){if(this.oSelectionPlugin){return this.oSelectionPlugin._onBindingChange(E);}};M.prototype.onThemeChanged=function(){this.oDeselectAllIcon.setSrc(T.get("_sap_ui_table_DeleteIcon"));};return M;});
