
VBI.addSceneLabelFunctions=function(s){"use strict";s.InternalDrawLabelTexts=function(d,l,t,a){for(var n=0;n<l.m_Pos.length;++n){for(var b=0;b<l.m_Pos[n].length;b++){var h=Math.round(l.m_Height);var w=Math.round(l.m_Width);var c=Math.round(l.m_Pos[n][b][0]);var e=Math.round(l.m_Pos[n][b][1]);var f=l.m_Arrow?l.m_Align:0;var r=l.m_Rounded?h/2:10;var g;d.beginPath();d.lineWidth=2;d.moveTo(c+r,e);if(f==5){l.m_Pos[n][b].tri=[[c+w/2-3,e],[c+w/2,e-5],[c+w/2+3,e]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c+w-r,e);d.arcTo(c+w,e,c+w,e+r,r);if(f==7&&!l.m_Rounded){l.m_Pos[n][b].tri=[[c+w,e+h/2-3],[c+w+5,e+h/2],[c+w,e+h/2+3]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c+w,e+h-r);d.arcTo(c+w,e+h,c+w-r,e+h,r);if(f==1){l.m_Pos[n][b].tri=[[c+w/2+3,e+h],[c+w/2,e+h+5],[c+w/2-3,e+h]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c+r,e+h);d.arcTo(c,e+h,c,e+h-r,r);if(f==3&&!l.m_Rounded){l.m_Pos[n][b].tri=[[c,e+h/2+3],[c-5,e+h/2],[c,e+h/2-3]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c,e+r);d.arcTo(c,e,c+r,e,r);d.fillStyle=l.m_BgColor;d.fill();if(l.m_BrdrCol){d.strokeStyle=l.m_BrdrCol;}else{d.strokeStyle=l.m_BgColor;}d.stroke();var i=t.length==1?VBI.Utilities.RemToPixel(0.75):VBI.Utilities.RemToPixel(0.75)+1;var j=0;for(var k=0;k<t.length;++k){d.fillStyle=t[k];var m=0;for(g=0;g<a.length;g++){m=l.m_Padding[1]+i*g;d.fillText(a[g],c+l.m_Padding[0]+j,e+m+j+7);}j++;}if(l.m_Icon){l.m_IcInfo=sap.ui.core.IconPool.getIconInfo(l.m_Icon);if(l.m_IcInfo){var o=(l.m_Align==7&&l.m_Arrow)?c:c+w;d.fillStyle=l.m_IcBgrdCol;d.fillRect(o-7,e+h-7,14,14);l.m_Pos[n][b].rc=[o-7,e+h-7,o-7+14,e+h-7+14];}}}}};s.InternalDrawLabels=function(d,l,t,a){for(var n=0;n<l.m_Pos.length;++n){for(var b=0;b<l.m_Pos[n].length;b++){VBI.Utilities.SetTextAttributes(d,VBI.Utilities.RemToPixel(0.75)+"px 'Lucida Sans Unicode',sans-serif",undefined,undefined,"start","middle");var h=Math.round(l.m_Height);var w=Math.round(l.m_Width);var c=Math.round(l.m_Pos[n][b][0]);var e=Math.round(l.m_Pos[n][b][1]);var f=l.m_Arrow?l.m_Align:0;var r=l.m_Rounded?h/2:6;var g;d.beginPath();d.lineWidth=2;d.moveTo(c+r,e);if(f==5){l.m_Pos[n][b].tri=[[c+w/2-3,e],[c+w/2,e-5],[c+w/2+3,e]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c+w-r,e);d.arcTo(c+w,e,c+w,e+r,r);if(f==7&&!l.m_Rounded){l.m_Pos[n][b].tri=[[c+w,e+h/2-3],[c+w+5,e+h/2],[c+w,e+h/2+3]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c+w,e+h-r);d.arcTo(c+w,e+h,c+w-r,e+h,r);if(f==1){l.m_Pos[n][b].tri=[[c+w/2+3,e+h],[c+w/2,e+h+5],[c+w/2-3,e+h]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c+r,e+h);d.arcTo(c,e+h,c,e+h-r,r);if(f==3&&!l.m_Rounded){l.m_Pos[n][b].tri=[[c,e+h/2+3],[c-5,e+h/2],[c,e+h/2-3]];for(g=0;g<3;++g){d.lineTo(l.m_Pos[n][b].tri[g][0],l.m_Pos[n][b].tri[g][1]);}}d.lineTo(c,e+r);d.arcTo(c,e,c+r,e,r);d.fillStyle=l.m_BgColor;d.fill();d.strokeStyle=(l.m_BrdrCol?l.m_BrdrCol:l.m_BgColor);d.stroke();var i=t.length==1?VBI.Utilities.RemToPixel(0.75):VBI.Utilities.RemToPixel(0.75)+1;var j=0;for(var k=0;k<t.length;++k){d.fillStyle=t[k];var m=0;for(g=0;g<a.length;g++){m=l.m_Padding[1]+i*g;d.fillText(a[g],(VBI.m_bIsRtl)?(c+w-l.m_Padding[0]+j):(c+l.m_Padding[0]+j),e+m+j+7);}j++;}if(l.m_Icon){l.m_IcInfo=sap.ui.core.IconPool.getIconInfo(l.m_Icon);if(l.m_IcInfo){var o=(l.m_Align==7&&l.m_Arrow)?c:c+w;d.fillStyle=l.m_IcBgrdCol;d.fillRect(o-7,e+h-7,14,14);l.m_Pos[n][b].rc=[o-7,e+h-7,o-7+14,e+h-7+14];VBI.Utilities.SetTextAttributes(d,"12px SAP-icons",undefined,undefined,"center","middle");d.fillStyle=l.GetLabelIconColor();d.fillText(l.m_IcInfo.content,o,e+h);}}}}};s.InternalDrawLabelIcons=function(d,l){var h=Math.round(l.m_Height);var w=Math.round(l.m_Width);for(var n=0;n<l.m_Pos.length;++n){for(var a=0;a<l.m_Pos[n].length;a++){var b=Math.round(l.m_Pos[n][a][0]);var c=Math.round(l.m_Pos[n][a][1]);if(l.m_Icon&&l.m_IcInfo){d.fillStyle=l.GetLabelIconColor();var i=(l.m_Align==7&&l.m_Arrow)?b:b+w;d.fillText(l.m_IcInfo.content,i,c+h);}}}};s.InternalRenderLabels=function(c,d){var v=s.m_VOS;for(var n=0,l=v.length;n<l;++n){var L=v[n].getLabelData(true);for(var a=0;a<L.length;++a){var b=L[a];VBI.Utilities.SetTextAttributes(d,VBI.Utilities.RemToPixel(0.75)+"px 'Lucida Sans Unicode',sans-serif",undefined,undefined,"start","middle");b.SetDimensions(d);b.AlignLabel();var t=b.GetLabelTextColor();var e=b.m_Text.split(/\r\n/);var f=s.GetViewport();for(var i=0;i<b.m_Pos.length;i++){for(var j=0;j<b.m_Pos[i].length;j++){var g=b.m_PosArray.pa,h=b.m_Pos[i][j];if(g.length!==3||g[0]>f[0]&&g[0]<f[2]){if(h[0]-f[0]<5){h[0]=f[0]+5;}else if(h[0]+b.m_Width>f[2]-5){h[0]=f[2]-b.m_Width-5;}if(h[1]-f[1]<5){h[1]=f[1]+5;}else if(h[1]+b.m_Height>f[3]-5){h[1]=f[3]-b.m_Height-5;}}else{if(h[0]+(b.m_aIO[1]||0)-f[0]<5){h[0]=f[0]+5;}else if(h[0]+(b.m_aIO[1]||0)+b.m_Width>f[2]-5){h[0]=f[2]-b.m_Width-5;}else{h[0]+=b.m_aIO[1]||0;}if(h[1]-f[1]<5){h[1]=f[1]+5;}else if(h[1]+b.m_Height>f[3]-5){h[1]=f[3]-b.m_Height-5;}}}}s.InternalDrawLabels(d,b,t,e);}}};};
VBI.Label=function(l,n,r,p,a,i){"use strict";this.m_bAligned=false;this.mIndex=n;this.m_aIO=i;this.m_rcBox=a;this.m_Text=l.text;this.m_BgColor=l.bgColor;this.m_BrdrCol=l.brdrCol;this.m_Icon=l.icon;this.m_IcBgrdCol=l.icColor;this.m_IcTextCol=l.icTextColor;this.m_Arrow=l.arrow;this.m_Rounded=l.rounded;this.m_Align=l.Align;this.m_Offset=l.offset;this.m_Padding=[7,5];this.m_ArrowHeight=5;this.m_ArrowWidth=3;this.m_LineWidth=2;this.m_LabelIconColor=null;this.m_PosArray=p;this.m_Pos=[];this.m_Width=0;this.m_Height=0;this.m_LabelTextColor=[];if(!r){var b=Math.floor(this.m_PosArray.pa.length/3)*3;for(var c=0;c<i.length;c++){var t=[];for(var d=0;d<b;d+=3){var e=[this.m_PosArray.pa[d]+i[c],this.m_PosArray.pa[d+1]];t.push(e);}this.m_Pos.push(t);}}this.CalculateLabelPos=r;this.getContrastCol=function(f){var g=(299*250+587*250+114*250)/1000.0;var h=(299*f[0]+587*f[1]+114*f[2])/1000.0;return(Math.abs(h-g)<=125.0?"#000000":"#FAFAFA");};this.GetLabelTextColor=function(){if(!this.m_LabelTextColor.length){var f=VBI.Types.string2rgba(this.m_BgColor);if(f[3]==0&&f[4]==1){this.m_LabelTextColor[0]="#FFFFFF";this.m_LabelTextColor[1]="#000000";}else{this.m_LabelTextColor[0]=this.getContrastCol(f);}}return this.m_LabelTextColor;};this.GetLabelIconColor=function(){if(!this.m_LabelIconColor){if(this.m_IcTextCol){this.m_LabelIconColor=this.m_IcTextCol;}else{var f=VBI.Types.string2rgba(this.m_IcBgrdCol);this.m_LabelIconColor=((f[3]==0&&f[4]==1)?"#000000":this.getContrastCol(f));}}return this.m_LabelIconColor;};this.SetDimensions=function(f){if(!this.m_Width||!this.m_Height){var s=this.m_Text.split(/\r\n/);var g=0;var h=0;var j=VBI.Utilities.RemToPixel(0.75);for(var k=0;k<s.length;k++){var m=s[k].length;if(m>g){g=m;h=k;}}this.m_Width=f.measureText(s[h]).width+this.m_Padding[0]*2;this.m_Height=j*s.length+this.m_Padding[1]*2;}};this.AlignLabel=function(){if(!this.m_bAligned){var f=[0,0,0,0];var e;var g=this.m_ArrowHeight+this.m_LineWidth;if(this.m_rcBox){f=this.m_rcBox;}for(var d=0;d<this.m_Pos.length;d++){for(var h=0;h<this.m_Pos[d].length;h++){e=(this.m_rcBox?[this.m_rcBox[0]+(this.m_rcBox[2]-this.m_rcBox[0])/2,this.m_rcBox[1]+(this.m_rcBox[3]-this.m_rcBox[1])/2]:this.m_Pos[d][h]);switch(this.m_Align){case 0:e[0]-=this.m_Width/2;e[1]-=this.m_Height/2;break;case 1:e[0]-=this.m_Width/2;e[1]-=(f[3]-f[1])/2+this.m_Height;if(this.m_Arrow){e[1]-=g;}break;case 2:e[0]+=(f[2]-f[0])/2;e[1]-=(f[3]-f[1])/2+this.m_Height;break;case 3:e[0]+=(f[2]-f[0])/2;e[1]-=this.m_Height/2;if(this.m_Arrow&&!this.m_Rounded){e[0]+=g;}break;case 4:e[0]+=(f[2]-f[0])/2;e[1]+=(f[3]-f[1])/2;break;case 5:e[0]-=(this.m_Width/2);e[1]+=(f[3]-f[1])/2;if(this.m_Arrow){e[1]+=g;}break;case 6:e[0]-=(f[2]-f[0])/2+this.m_Width;e[1]+=(f[3]-f[1])/2;break;case 7:e[0]-=(f[2]-f[0])/2+this.m_Width;e[1]-=this.m_Height/2;if(this.m_Arrow&&!this.m_Rounded){e[0]-=g;}break;case 8:e[0]-=(f[2]-f[0])/2+this.m_Width;e[1]-=(f[3]-f[1])/2+this.m_Height;break;default:if(VBI.m_bIsRtl){e[0]-=this.m_Width;}e[1]+=(f[3]-f[1])/2;break;}if(!this.CalculateLabelPos){e[0]+=this.m_aIO[d];}e[0]+=this.m_Offset[0];e[1]+=this.m_Offset[1];this.m_Pos[d][h]=e;}}}this.m_bAligned=true;};this.clear=function(){this.CalculateLabelPos=null;this.m_Pos=null;this.m_PosArray=null;this.m_rcBox=null;this.m_aIO=null;this.m_LabelTextColor=null;this.m_LabelIconColor=null;};return this;};
