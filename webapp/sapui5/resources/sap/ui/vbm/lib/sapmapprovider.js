
VBI.MapProviders=function(){"use strict";var m={};m.vbiclass="MapProviders";m.m_MapProviderArray=[];m.clear=function(){for(var n=0;n<m.m_MapProviderArray.length;++n){m.m_MapProviderArray[n].clear();}m.m_MapProviderArray=[];};m.load=function(d,c){if(d.Set){var a;m.clear();if(d.Set.MapProvider){if(jQuery.type(d.Set.MapProvider)=='object'){a=new VBI.MapProvider();a.load(d.Set.MapProvider);m.Add(a);}else if(jQuery.type(d.Set.MapProvider)=='array'){for(var n=0;n<d.Set.MapProvider.length;++n){a=new VBI.MapProvider();a.load(d.Set.MapProvider[n]);m.Add(a);}}}}};m.Add=function(a){this.m_MapProviderArray.push(a);};m.GetMapProviderByName=function(n){for(var a=0;a<m.m_MapProviderArray.length;++a){if(m.m_MapProviderArray[a].m_Name==n){return m.m_MapProviderArray[a];}}return null;};return m;};
VBI.MapProvider=function(n,d,c,t,a,m,b,f,r,p){"use strict";var e={};e.vbiclass="MapProvider";e.m_SourceArray=[];e.m_Name=n;e.m_Description=d;e.m_Copyright=c;e.m_tileX=typeof t!=='undefined'?t:256;e.m_tileY=typeof a!=='undefined'?a:256;e.m_maxLOD=typeof b!=='undefined'?b:19;e.m_minLOD=typeof m!=='undefined'?m:0;e.m_nResolution=typeof r!='undefined'?r:256;e.m_nProjection=typeof p!='undefined'?p:1;if(f!=null){e.fillStyle=f;}e.clear=function(){for(var g=0;g<e.m_SourceArray.length;++g){e.m_SourceArray[g].clear();}e.m_SourceArray=[];};e.GetCopyright=function(){return VBI.Utilities.AssembleCopyrightString(this.m_Copyright,this.m_CopyrightLink,this.m_CopyrightImage);};e.addMapBase=function(l,g,h,i,j,s){var k={};if(l){k.left=parseFloat(l);}if(g){k.right=parseFloat(g);}if(h){k.top=parseFloat(h);}if(i){k.bottom=parseFloat(i);}k.round=(j!=undefined?parseFloat(j):0);k.xSize=g-l;k.ySize=h-i;if(s!=undefined){k.relXSize=k.xSize/s.xSize;k.relYSize=k.ySize/s.ySize;}return k;};e.addMapBaseBorder=function(g,h,i,j,k){g.leftBorder=h;g.rightBorder=i;g.bottomBorder=j;g.topBorder=k;};e.load=function(g){if(g.name){e.m_Name=g.name;}if(g.description){e.m_Description=g.description;}if(g.copyright){e.m_Copyright=g.copyright;}if(g.copyrightLink){e.m_CopyrightLink=g.copyrightLink;}if(g.copyrightImage){e.m_CopyrightImage=g.copyrightImage;}if(g.tileX){e.m_tileX=g.tileX;}if(g.tileY){e.m_tileY=g.tileY;}if(g.maxLOD){e.m_maxLOD=g.maxLOD;}if(g.minLOD){e.m_minLOD=g.minLOD;}if(g.resolution){e.m_nResolution=g.resolution;}if(g.projection){if(g.projection==="Linear"){e.m_nProjection=2;}else if(g.projection==="Elliptical"){e.m_nProjection=3;}}var h=g.MapBase;e.m_StdMapBase=e.addMapBase(-1,1,1,-1,10);if(g.MapBase){e.m_MapBase=e.addMapBase(h.left,h.right,h.top,h.bottom,h.round,e.m_StdMapBase);e.addMapBaseBorder(e.m_MapBase,h.minX,h.maxX,h.minY,h.maxY);}else{e.m_MapBase=e.addMapBase(-180,180,90,-90,10,e.m_StdMapBase);}if(g.Source){var s;if(jQuery.type(g.Source)=='object'){s=new VBI.Source(null);e.m_bPosRequired=s.load(g.Source);e.Add(s);}else if(jQuery.type(g.Source)=='array'){e.m_bPosRequired=false;for(var i=0;i<g.Source.length;++i){s=new VBI.Source(null);e.m_bPosRequired=(s.load(g.Source[i])||e.m_bPosRequired);e.Add(s);}}}};e.Add=function(s){this.m_SourceArray.push(s);};e.CombineUrlWPos=function(x,y,l,T,g,h,i,j,k,o){var q=1<<l;var s=10;if(e.m_MapBase){var u=e.m_StdMapBase;var v=e.m_MapBase;g[0]=(g[0]-u.left)*v.relXSize+v.left;g[1]=-((g[1]-u.bottom)*v.relYSize+v.bottom);h[0]=(h[0]-u.left)*v.relXSize+v.left;h[1]=-((h[1]-u.bottom)*v.relYSize+v.bottom);s=v.round;}if(this.m_SourceArray.length==0){return null;}return this.m_SourceArray[((y+x*q)%this.m_SourceArray.length)].CombineUrlWPos(x,y,l,T,g,h,i,j,s,Math.min(k,e.m_nResolution),Math.min(o,e.m_nResolution));};e.CombineUrl=function(x,y,l){var g=1<<l;if(x<0||y<0||(x>=g)||(y>=g)){return null;}if(this.m_SourceArray.length==0){return null;}return this.m_SourceArray[((y+x*g)%this.m_SourceArray.length)].CombineUrl(x,y,l);};e.GetMaxLOD=function(){return this.m_maxLOD;};e.GetMinLOD=function(){return this.m_minLOD;};return e;};
VBI.Source=function(u){"use strict";var s={};s.vbiclass="Source";s.m_ID=null;s.m_Url=u;s.clear=function(){};s.load=function(d){if(d.url){s.m_Url=d.url;}if(d.id){s.m_ID=d.id;}s.m_bQuadkey=(s.m_Url.indexOf("{QUAD}")>=0);s.m_bNumkey=(s.m_Url.indexOf("{NUM}")>=0);return((s.m_Url.indexOf("LU_LAT")>=0)||(s.m_Url.indexOf("LU_LONG")>=0)||(s.m_Url.indexOf("RL_LAT")>=0)||(s.m_Url.indexOf("RL_LONG")>=0));};s.CombineUrl=function(x,y,l){var t=s.m_Url;t=t.replace("{X}",x);t=t.replace("{Y}",y);t=t.replace("{-Y}",(1<<l)-y-1);t=t.replace("{LOD}",l);if(s.m_bQuadkey){t=t.replace("{QUAD}",this.TileXYToQuadKey(x,y,l));}if(s.m_bNumkey){t=t.replace("{NUMT}",this.TileXYToNumKey(x,y,l));}return t;};s.CombineUrlWPos=function(x,y,l,t,a,r,b,c,n,d,e){var f=s.m_Url;var g=Math.pow(10,n);f=f.replace("{X}",x);f=f.replace("{Y}",y);f=f.replace("{-Y}",(1<<l)-y-1);f=f.replace("{LOD}",l);if(s.m_bQuadkey){f=f.replace("{QUAD}",this.TileXYToQuadKey(x,y,l));}if(s.m_bNumkey){f=f.replace("{NUMT}",this.TileXYToNumKey(x,y,l));}f=f.replace("{WIDTH}",d*b);f=f.replace("{HEIGHT}",e*c);f=f.replace("{LU_LONG}",Math.round(a[0]*g)/g);f=f.replace("{LU_LAT}",Math.round(a[1]*g)/g);f=f.replace("{RL_LONG}",Math.round(r[0]*g)/g);f=f.replace("{RL_LAT}",Math.round(r[1]*g)/g);return f;};s.TileXYToQuadKey=function(x,y,l){var q=[];for(var i=l;i>0;--i){var d='0';var m=1<<(i-1);if(x&m){d++;}if(y&m){d++;d++;}q.push(d);}var a=q.join("");return a;};s.TileXYToNumKey=function(x,y,l){var n=0;for(var i=1;i<l;++i){n+=(1<<i)*(1<<i);}n+=(y*(1<<l)+x+1);return n;};return s;};
