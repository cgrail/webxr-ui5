VBI.Tex=null;VBI.Shader=null;VBI.FB=null;VBI.Vals=null;VBI.Ro=null;VBI.Hm=null;VBI.Hook=(function(){"use strict";if(window.WebGLRenderingContext){var g=WebGLRenderingContext.prototype.getExtension;WebGLRenderingContext.prototype.getExtension=function(n){var v=['','MS','WEBKIT','MOZ','O'];var e,a;if((e=g.call(this,n))===null){for(var b=0,l=v.length;b<l;++b){a=v[b];if((e=g.call(this,a+'_'+n))!==null){return e;}}return null;}else{return e;}};WebGLRenderingContext.prototype.getExtensions=function(s){return this.getExtension('OES_texture_float');};}})();VBI.Shader=(function(){"use strict";function S(g,v,f){this.m_GL=g;this.m_UL={};this.m_Prog=this.m_GL.createProgram();this.m_VS=this.m_GL.createShader(this.m_GL.VERTEX_SHADER);this.m_FS=this.m_GL.createShader(this.m_GL.FRAGMENT_SHADER);this.m_GL.attachShader(this.m_Prog,this.m_VS);this.Compile(this.m_VS,v);this.m_GL.attachShader(this.m_Prog,this.m_FS);this.Compile(this.m_FS,f);this.Link();}S.prototype.getShaderVar=function(n){return this.m_GL.getAttribLocation(this.m_Prog,n);};S.prototype.Compile=function(s,a){this.m_GL.shaderSource(s,a);this.m_GL.compileShader(s);if(!this.m_GL.getShaderParameter(s,this.m_GL.COMPILE_STATUS)){jQuery.sap.log.error("Shader Compilation Error");jQuery.sap.log.error(this.m_GL.getShaderInfoLog(s));}};S.prototype.Link=function(){this.m_GL.linkProgram(this.m_Prog);if(!this.m_GL.getProgramParameter(this.m_Prog,this.m_GL.LINK_STATUS)){jQuery.sap.log.error("Shader Link Error");jQuery.sap.log.error(this.m_GL.getProgramInfoLog(this.m_Prog));}};S.prototype.Apply=function(){this.m_GL.useProgram(this.m_Prog);return this;};S.prototype.getLoc=function(n){var l=this.m_UL[n];if(typeof(l)==="undefined"){l=this.m_UL[n]=this.m_GL.getUniformLocation(this.m_Prog,n);}return l;};S.prototype.SetInt=function(n,v){this.m_GL.uniform1i(this.getLoc(n),v);return this;};return S;})();VBI.FB=(function(){"use strict";function F(g){this.m_GL=g;this.m_FB=this.m_GL.createFramebuffer();}F.prototype.destroy=function(){return this.m_GL.deleteFramebuffer(this.m_FB);};F.prototype.BindFB=function(){this.m_GL.bindFramebuffer(this.m_GL.FRAMEBUFFER,this.m_FB);return this;};F.prototype.UnBindFB=function(){this.m_GL.bindFramebuffer(this.m_GL.FRAMEBUFFER,null);return this;};F.prototype.SetTex=function(t){this.m_GL.framebufferTexture2D(this.m_GL.FRAMEBUFFER,this.m_GL.COLOR_ATTACHMENT0,this.m_GL.TEXTURE_2D,t.m_Tex,0);var s=this.m_GL.checkFramebufferStatus(this.m_GL.FRAMEBUFFER);if(s!==this.m_GL.FRAMEBUFFER_COMPLETE){return null;}return this;};return F;})();VBI.Tex=(function(){"use strict";function T(g,p){var t;this.m_GL=g;p=p?p:{};this.m_colFmt=this.m_GL[((t=p.colfmt)!=null?t:'rgba').toUpperCase()];if(typeof p.type==='number'){this.type=p.type;}else{this.type=this.m_GL[((t=p.type)!=null?t:'unsigned_byte').toUpperCase()];}this.m_Tex=this.m_GL.createTexture();}T.prototype.destroy=function(){return this.m_GL.deleteTexture(this.m_Tex);};T.prototype.BindTex=function(s){if(s==null){s=0;}this.m_GL.activeTexture(this.m_GL.TEXTURE0+s);this.m_GL.bindTexture(this.m_GL.TEXTURE_2D,this.m_Tex);return this;};T.prototype.AdjustSize=function(w,h){this.m_W=w;this.m_H=h;this.m_GL.texImage2D(this.m_GL.TEXTURE_2D,0,this.m_colFmt,w,h,0,this.m_colFmt,this.type,null);return this;};T.prototype.SetImage=function(d){this.m_W=d.width;this.m_H=d.height;this.m_GL.texImage2D(this.m_GL.TEXTURE_2D,0,this.m_colFmt,this.m_colFmt,this.type,d);return this;};T.prototype.SetFilterNearest=function(){this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_MAG_FILTER,this.m_GL.NEAREST);this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_MIN_FILTER,this.m_GL.NEAREST);return this;};T.prototype.SetWrapEdge=function(){this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_WRAP_S,this.m_GL.CLAMP_TO_EDGE);this.m_GL.texParameteri(this.m_GL.TEXTURE_2D,this.m_GL.TEXTURE_WRAP_T,this.m_GL.CLAMP_TO_EDGE);return this;};return T;})();VBI.Ro=(function(){"use strict";function R(g,w,h){this.m_GL=g;this.m_W=w;this.m_H=h;var e=this.m_GL.getExtensions();var t=null;if(e){t=this.m_GL.FLOAT;}this.m_Tex=new VBI.Tex(this.m_GL,{type:t});this.m_Tex.BindTex(0);this.m_Tex.AdjustSize(w,h);this.m_Tex.SetFilterNearest();this.m_Tex.SetWrapEdge();this.m_FB=new VBI.FB(this.m_GL);this.m_FB.BindFB();if(!this.m_FB.SetTex(this.m_Tex)){this.m_FB.UnBindFB();this.m_Tex=new VBI.Tex(this.m_GL,{type:null});this.m_Tex.BindTex(0);this.m_Tex.AdjustSize(w,h);this.m_Tex.SetFilterNearest();this.m_Tex.SetWrapEdge();this.m_FB=new VBI.FB(this.m_GL);this.m_FB.BindFB();this.m_FB.SetTex(this.m_Tex);this.m_FB.UnBindFB();}else{this.m_FB.UnBindFB();}}R.prototype.Apply=function(){return this.m_FB.BindFB();};R.prototype.BindRo=function(s){return this.m_Tex.BindTex(s);};R.prototype.UnBindRo=function(){this.m_FB.UnBindFB();};R.prototype.AdjustSize=function(w,h){this.m_W=w;this.m_H=h;return this.m_Tex.BindTex(0).AdjustSize(w,h);};return R;})();VBI.Vals=(function(){"use strict";function V(g,w,h){this.m_GL=g;this.m_nPointChunk=10240;this.m_nVertexSize=8;this.m_W=w;this.m_H=h;this.m_Shader=new VBI.Shader(this.m_GL,"uniform vec4 uTM;"+"attribute vec4 aPos;"+"attribute float aValue;"+"varying vec3 vData;"+"void main(){"+"  gl_Position = vec4(aPos.xy * uTM.xy + uTM.zw, 0.0, 1.0);"+"  vData.xy = aPos.zw;"+"  vData.z = aValue;"+"}","#ifdef GL_FRAGMENT_PRECISION_HIGH\n"+"  precision highp int;"+"  precision highp float;\n"+"#else\n"+"  precision mediump int;"+"  precision mediump float;\n"+"#endif\n"+"varying vec3 vData;"+"void main(){"+"  float f = smoothstep(1.0, 0.0, length(vData.xy)) * vData.z;"+"  gl_FragColor = vec4(f);"+"}");this.m_Shader.aPos=this.m_Shader.getShaderVar('aPos');this.m_Shader.aValue=this.m_Shader.getShaderVar('aValue');this.m_Shader.uTM=this.m_Shader.getLoc('uTM');this.m_Ro=new VBI.Ro(this.m_GL,this.m_W,this.m_H);this.m_VB=this.m_GL.createBuffer();this.m_vBuf=new Float32Array(this.m_nPointChunk*this.m_nVertexSize*6);this.m_IB=this.m_GL.createBuffer();var e=new Uint16Array(this.m_nPointChunk*6);for(var i=0,j=0;i<e.length;j+=4){e[i++]=j;e[i++]=j+1;e[i++]=j+2;e[i++]=j+2;e[i++]=j+1;e[i++]=j+3;}this.m_GL.bindBuffer(this.m_GL.ELEMENT_ARRAY_BUFFER,this.m_IB);this.m_GL.bufferData(this.m_GL.ELEMENT_ARRAY_BUFFER,e,this.m_GL.STATIC_DRAW);this.m_nIdx=0;this.m_nPoints=0;}V.prototype.AdjustSize=function(w,h){this.m_W=w;this.m_H=h;this.m_Ro.AdjustSize(this.m_W,this.m_H);return;};V.prototype.Render=function(){if(this.m_nPoints>0){var g=this.m_GL;g.enable(g.BLEND);this.m_Ro.Apply();g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this.m_IB);g.bindBuffer(g.ARRAY_BUFFER,this.m_VB);g.bufferData(g.ARRAY_BUFFER,this.m_vBuf,g.STREAM_DRAW);this.m_Shader.Apply();g.enableVertexAttribArray(1);g.vertexAttribPointer(this.m_Shader.aPos,4,g.FLOAT,false,20,0);g.vertexAttribPointer(this.m_Shader.aValue,1,g.FLOAT,false,20,16);g.uniform4f(this.m_Shader.uTM,2/this.m_W,2/this.m_H,-1,-1);g.drawElements(g.TRIANGLES,this.m_nPoints*6,g.UNSIGNED_SHORT,0);g.disableVertexAttribArray(1);this.m_Ro.UnBindRo();g.disable(g.BLEND);this.m_nPoints=0;this.m_nIdx=0;}};V.prototype.Clear=function(){this.m_Ro.Apply();this.m_GL.clearColor(0.0,0.0,0.0,0.0);this.m_GL.clear(this.m_GL.COLOR_BUFFER_BIT);return this.m_Ro.UnBindRo();};V.prototype.AddPoint=function(x,y,v,s){if((this.m_nPoints+1)>=this.m_nPointChunk){this.Render();}y=this.m_H-y;this.PushVertex(x-s,y-s,-1,-1,v);this.PushVertex(x+s,y-s,+1,-1,v);this.PushVertex(x-s,y+s,-1,+1,v);this.PushVertex(x+s,y+s,+1,+1,v);this.m_nPoints+=1;return this.m_nPoints;};V.prototype.PushVertex=function(x,y,b,c,v){var a=this.m_vBuf;var d=this.m_nIdx;a[d++]=x;a[d++]=y;a[d++]=b;a[d++]=c;a[d++]=v;this.m_nIdx=d;};return V;})();VBI.Hm=(function(){"use strict";function H(a){var c;var b;var s=a.scene;if(typeof(a.alphaBounds=='undefined')){a.alphaBounds=[0.0,1.0];}if(typeof(a.alpha=='undefined')){a.alpha=true;}this.m_Canv=a.canvas;this.m_W=a.width;this.m_H=a.height;this.m_aFunc=a.aFunc.toFixed(8);this.m_cFunc=a.cFunc.toFixed(8);if(!this.m_Canv){this.m_Canv=document.createElement("canvas");}var A={depth:false,antialias:false,alpha:true};if(!this.m_GL){this.m_GL=this.m_Canv.getContext("experimental-webgl",A);}if(!this.m_GL){this.m_GL=this.m_Canv.getContext("webgl",A);}if(!this.m_GL){jQuery.sap.log.error("WebGL not supported");return;}this.m_GL.blendFunc(this.m_GL.ONE,this.m_GL.ONE);this.m_GL.enableVertexAttribArray(0);if(a.colorTexture){this.m_ColorTexture=new VBI.Tex(this.m_GL,{colfmt:"rgba"});this.m_ColorTexture.BindTex(0);this.m_ColorTexture.SetFilterNearest();this.m_ColorTexture.SetWrapEdge();this.m_ColorTexture.AdjustSize(2,2);this.m_ColorTexture.BindTex(0);this.m_ColorTexture.SetImage(a.colorTex);if(!a.colorTex.IsLoaded){s.RenderAsync(false);}b="uniform sampler2D colTex; "+"vec3 calcCol( float g ){ "+"  return texture2D( colTex, vec2( g, 0.5 )).rgb; "+"}";}else{b="vec3 calcCol( float g ){ "+"  return smoothstep( vec3( 0.0, 0.0, 1.0 ), vec3( 1.0, 1.0, 0.0 ), vec3( g ) ); "+"}";}if(a.alpha){c="vec4 calcAlpha(vec3 c,float i){ "+"  float a = smoothstep("+(a.alphaBounds[0].toFixed(8))+","+(a.alphaBounds[1].toFixed(8))+", pow(i, 1.0)); "+"  return vec4( c*a, a); "+"}";}else{c="vec4 calcAlpha(vec3 c, float i){ "+"  return vec4(c, 1.0);"+"}";}var f="#ifdef GL_FRAGMENT_PRECISION_HIGH \n"+"  precision highp int;"+"  precision highp float; \n"+"#else \n"+"  precision mediump int;"+"  precision mediump float; \n"+"#endif \n"+"uniform sampler2D src;"+"varying vec2 txy;";var d="void main(){ "+"  float f = clamp( texture2D(src, txy).r, 0.0, 1.0 ); "+"  vec3 color = calcCol(pow(f, "+(this.m_cFunc)+")); "+"  gl_FragColor = calcAlpha(color, pow(f, "+(this.m_aFunc)+")); "+"}";this.m_Shader=new VBI.Shader(this.m_GL,"attribute vec4 pos; "+"varying vec2 txy; "+"void main(){ "+"  txy = pos.xy * 0.5 + 0.5; "+"  gl_Position = pos; "+"}",f+b+"\n"+c+d);if(this.m_W==null){this.m_W=this.m_Canv.offsetWidth||2;}if(this.m_H==null){this.m_H=this.m_Canv.offsetHeight||2;}this.m_Canv.width=this.m_W;this.m_Canv.height=this.m_H;var g=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1]);this.m_Geo=this.m_GL.createBuffer();this.m_GL.viewport(0,0,this.m_W,this.m_H);this.m_GL.bindBuffer(this.m_GL.ARRAY_BUFFER,this.m_Geo);this.m_GL.bufferData(this.m_GL.ARRAY_BUFFER,g,this.m_GL.STATIC_DRAW);this.m_GL.bindBuffer(this.m_GL.ARRAY_BUFFER,null);this.m_V=new VBI.Vals(this.m_GL,this.m_W,this.m_H);}H.prototype.AdjustSize=function(){if(!this.m_GL){return;}var c=this.m_Canv.offsetHeight||2;var a=this.m_Canv.offsetWidth||2;if(this.m_W!==a||this.m_H!==c){this.m_GL.viewport(0,0,a,c);this.m_Canv.width=a;this.m_Canv.height=c;this.m_W=a;this.m_H=c;this.m_V.AdjustSize(this.m_W,this.m_H);}};H.prototype.RenderColors=function(){if(!this.m_GL){return;}this.m_GL.bindBuffer(this.m_GL.ARRAY_BUFFER,this.m_Geo);this.m_GL.vertexAttribPointer(0,4,this.m_GL.FLOAT,false,0,0);this.m_V.m_Ro.BindRo(0);if(this.m_ColorTexture){this.m_ColorTexture.BindTex(1);}this.m_Shader.Apply();this.m_Shader.SetInt("src",0);this.m_Shader.SetInt("colTex",1);this.m_GL.drawArrays(this.m_GL.TRIANGLE_STRIP,0,4);return;};H.prototype.RenderValues=function(){if(!this.m_GL){return;}if(this.m_V){this.m_V.Render();}};H.prototype.Render=function(){this.RenderValues();this.RenderColors();};H.prototype.Clear=function(){return this.m_V?this.m_V.Clear():null;};H.prototype.AddPoint=function(x,y,v,s){return this.m_V?this.m_V.AddPoint(x,y,v,s):null;};return H;})();
VBI.CreateHM=function(p){"use strict";return new VBI.Hm(p);};
