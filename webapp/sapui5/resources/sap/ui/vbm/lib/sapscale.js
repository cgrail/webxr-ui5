VBI.SupportedUnitsOfLength=[{RequestedUnit:"km",DisplayUnitDefault:"m",DisplayUnit2:"km",ConvFactor:1000.0,ConvFactorMeter:1.0},{RequestedUnit:"mi",DisplayUnitDefault:"ft",DisplayUnit2:"mi",ConvFactor:5280.0,ConvFactorMeter:0.3048},{RequestedUnit:"nm",DisplayUnitDefault:"ft",DisplayUnit2:"nm",ConvFactor:6076.12,ConvFactorMeter:0.3048}];
VBI.Scale=function(){"use strict";var s={};s.scene=null;s.m_ID=null;s.m_Image=null;s.m_CurrentUnit=null;s.m_DisplayUnit=null;s.m_nDivider=0;s.m_nScalerLength=0;s.m_nDistance=0;s.m_bRtl=false;s.clear=function(){var i=document.getElementById(s.m_canvas.id);if(i){i.parentNode.removeChild(i);}s.m_Image=null;s.scene=null;};s.Awake=function(a,t){s.scene=a;var l=jQuery.sap.byId(t);s.m_ID=jQuery(l).attr('id');s.AppendCanvas();};s.getId=function(a,b){return b+'-'+a;};s.AppendCanvas=function(){s.m_bRtl=(document.dir=='rtl')?true:false;s.m_canvas=document.createElementNS("http://www.w3.org/2000/svg","svg");s.m_canvas.setAttribute("class","vbi-scale");s.m_canvas.setAttribute("id",s.getId('vbi-scale-canvas',s.m_ID));s.m_canvas.m_VBIType="S";s.scene.m_MapDecoDiv.appendChild(s.m_canvas);};s.getConfig=function(){if(s.m_CurrentUnit){return s.m_CurrentUnit;}else{var c=s.scene.m_Ctx;var a,u;if(c){a=c.GetConfig();}if(a){u=a.GetData("UnitOfLength");}if(u){for(var n=0;n<VBI.SupportedUnitsOfLength.length;++n){if(VBI.SupportedUnitsOfLength[n].RequestedUnit==u){s.m_CurrentUnit=VBI.SupportedUnitsOfLength[n];break;}}}}if(!s.m_CurrentUnit){s.m_CurrentUnit=VBI.SupportedUnitsOfLength[0];}return s.m_CurrentUnit;};s.getImage=function(l){if(s.m_Image){return s.m_Image;}var i=new Image();if(l){i.onload=function(){if(typeof l==='function'){l(i);}this.onload=null;};}i.src=sap.ui.resource("sap.ui.vbm","themes/base/img/sapvisualbusiness.png");s.m_Image=i;return i;};s.CalcScaleDimensions=function(){if(s.scene.m_Canvas[0].m_nCurrentLOD<1){return false;}var r=s.scene.GetInternalDivClientRect();var c=s.getConfig();var p=[parseInt(r.width/2-75,10),parseInt(r.height/2,10)];var a=[p[0]+180,p[1]];var d=s.scene.GetDistance(p,a);var b;d=d*(1.0/c.ConvFactorMeter);if(d>=c.ConvFactor){b=parseInt(d/c.ConvFactor,10);s.m_DisplayUnit=c.DisplayUnit2;}else{b=d;s.m_DisplayUnit=c.DisplayUnitDefault;}var l=parseInt(Math.log(b)/Math.LN10,10);b=parseInt(b/Math.pow(10,l),10);if(b<2){b=1;}else if(b<5){b=2;}else if(b<10){b=5;}b=parseInt(b*Math.pow(10,l),10);var e;if(d>=c.ConvFactor){e=b*c.ConvFactor;e=e*c.ConvFactorMeter;}else{e=b*c.ConvFactorMeter;}var f=s.scene.GetTargetPointForDistance(e,p);var g=[f[0]+s.scene.m_Canvas[0].getPixelLeft(),f[1]+s.scene.m_Canvas[0].getPixelTop()];var t=b;var n=0;while(n==0&&t>0){n=t%5;t/=10;}if(n!=2){n=5;}var h=Math.round(g[0]-p[0]);if(h>60&&h<(r.right-r.left)){s.m_nScalerLength=h;s.m_nDistance=b;s.m_nDivider=n;return true;}return false;};s.Update=function(){s.CalcScaleDimensions();var p=(s.m_nScalerLength+s.m_nDivider)/2,d=s.m_nDistance/2;var a=document.getElementById(s.m_canvas.id);if(a){a.setAttribute("height",15);a.setAttribute("width",p+1);jQuery(a).empty();var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d","M 1 4 V 10 H "+p+" V 4");b.setAttribute("stroke","black");b.setAttribute("stroke-width",2);b.setAttribute("fill","none");a.appendChild(b);var t=document.createElementNS("http://www.w3.org/2000/svg","text");var c;if(document.dir==="rtl"){c=(d.toString().length+s.m_DisplayUnit.length+1)*6+2;}else{c=p-2-(d.toString().length+s.m_DisplayUnit.length+1)*6;}t.setAttribute("x",c);t.setAttribute("y",8);t.setAttribute("font-size",10);t.textContent=d+" "+s.m_DisplayUnit;a.appendChild(t);}};return s;};
