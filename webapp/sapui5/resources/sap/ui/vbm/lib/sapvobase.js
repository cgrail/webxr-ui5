VBI.VisualObjects=
function(){"use strict";VBI.EMHandle=0;VBI.EMBox=1;VBI.HTHANDLE=0;VBI.HTBOX=1;VBI.HTBOXHANDLE=2;var v={};v.vbiclass="VisualObjects";v.Factory={"{00100000-2012-0004-B001-64592B8DB964}":function(){return new VBI.VisualObjects.Spot();},"{00100000-2012-0004-B001-C46BD7336A1A}":function(){return new VBI.VisualObjects.Route();},"{00100000-2013-0004-B001-7EB3CCC039C4}":function(){return new VBI.VisualObjects.Circle();},"{00100000-2013-0004-B001-686F01B57873}":function(){return new VBI.VisualObjects.CircleDist();},"{00100000-2012-0004-B001-383477EA1DEB}":function(){return new VBI.VisualObjects.Pie();},"{00100000-2012-0004-B001-BFED458C3076}":function(){return new VBI.VisualObjects.Box();},"{00100000-2012-0004-B001-F311DE491C77}":function(){return new VBI.VisualObjects.Area();},"{00100000-2012-0004-B001-E180770E8A12}":function(){return new VBI.VisualObjects.HeatMap();},"{00100000-2012-0070-1000-35762CF28B6B}":function(){return new VBI.VisualObjects.Dummy();},"{00100000-2014-0004-B001-9F1B43BE944A}":function(){return new VBI.VisualObjects.Route();},"{00100000-2014-0004-BDA8-87B904609063}":function(){return new VBI.VisualObjects.Area();},"{00100000-2012-0004-B001-2297943F0CE6}":function(){return new VBI.VisualObjects.Container();},"{00100000-2013-1000-1100-50059A6A47FA}":function(){return new VBI.VisualObjects.Caption();},"{00100000-2013-1000-3700-AD84DDBBB31B}":function(){return new VBI.VisualObjects.Label();},"{00100000-2013-1000-2400-D305F7942B98}":function(){return new VBI.VisualObjects.Link();},"{00100000-2013-1000-2200-6B060A330B2C}":function(){return new VBI.VisualObjects.Image();},"{00100000-2013-1000-1200-855B919BB0E9}":function(){return new VBI.VisualObjects.Button();}};v.Factory3D={"{00100000-2012-0004-B001-BFED458C3076}":function(){return new VBI.VisualObjects.Box3D();},"{00100000-2012-0070-1000-35762CF28B6B}":function(){return new VBI.VisualObjects.Dummy();}};v.Factory.CreateInstance=function(c){return v.Factory[c]();};v.Factory3D.CreateInstance=function(c){return v.Factory3D[c]();};VBI.VisualObjects.Base={m_Scene:null,m_BB:[],m_IO:[],m_colorHot:'rgba( 240, 171, 0, 0.5 )',m_defaultColor:'rgba( 255, 0, 0, 1.0 )',m_defaultTooltip:'',m_defaultLabeltext:'',m_defaultLabelBgCol:'rgba(200,200,200,1.0)',m_DH:[],m_szHandle:6,m_Track:null,m_tt:"",m_pos:"",m_clientX:0,m_clientY:0,m_nActiveSelections:0,SetRichTooltip:function(h){var s=this.m_Scene;var c=this.m_Scene.m_Ctx;var p=(this.m_Pos!=null)?this.m_Pos.GetValueVector(c):this.m_PosM.GetValueVector(c);if(this.m_tt instanceof sap.ui.core.TooltipBase){if(h){if(this.m_tt!=""&&this.m_pos==""){s.SetToolTip(this.m_tt,true,this.m_clientX,this.m_clientY);this.m_pos=p;}}else if(JSON.stringify(this.m_pos)==JSON.stringify(p)){s.SetToolTip(this.m_tt,false);this.m_pos="";}}},SetClusteredRichTooltip:function(e){var s=this.m_Scene;var p=[e[0],e[1]];if(this.m_tt instanceof sap.ui.core.TooltipBase){if(e.h){if(this.m_tt!=""&&e.m_pos==undefined){s.SetToolTip(this.m_tt,true,this.m_clientX,this.m_clientY);e.m_pos=p;}}else if(JSON.stringify(e.m_pos)==JSON.stringify(p)){s.SetToolTip(this.m_tt,false);e.m_pos=undefined;}}},LoadDragDropInfo:function(d,c,i){if(d.DragSource&&d.DragSource.DragItem){i.m_DragSourceInfo=new VBI.DnDInfo();i.m_DragSourceInfo.load(d.DragSource.DragItem,c,i);}if(d.DropTarget&&d.DropTarget.DropItem){i.m_DropTargetInfo=new VBI.DnDInfo();i.m_DropTargetInfo.load(d.DropTarget.DropItem,c,i);}},BaseLoad:function(d,c,i){if(VBI.m_bTrace){VBI.Trace("BaseLoad");}i.m_Props.push(i.m_HotScale=new VBI.AttributeProperty(d,'hotScale',i.m_DataSource,c,[1.0,1.0,1.0]));i.m_Props.push(i.m_HotDeltaColor=new VBI.AttributeProperty(d,'hotDeltaColor',i.m_DataSource,c,null));i.m_Props.push(i.m_SelectColor=new VBI.AttributeProperty(d,'selectColor',i.m_DataSource,c,null));i.m_Props.push(i.m_NonSelectColor=new VBI.AttributeProperty(d,'nonSelectColor',i.m_DataSource,c,null));i.m_Props.push(i.m_FxSize=new VBI.AttributeProperty(d,'fxsize',i.m_DataSource,c,true));i.m_Props.push(i.m_FxDir=new VBI.AttributeProperty(d,'fxdir',i.m_DataSource,c));i.m_Props.push(i.m_Entity=new VBI.AttributeProperty(d,'entity',i.m_DataSource,c,null));i.m_Props.push(i.m_Labeltext=new VBI.AttributeProperty(d,'labelText',i.m_DataSource,c,i.m_defaultLabeltext));i.m_Props.push(i.m_LabelBgCol=new VBI.AttributeProperty(d,'labelBgColor',i.m_DataSource,c,i.m_defaultLabelBgCol));i.m_Props.push(i.m_LabelBrdrCol=new VBI.AttributeProperty(d,'labelBorderColor',i.m_DataSource,c,null));i.m_Props.push(i.m_LabelArrow=new VBI.AttributeProperty(d,'labelArrow',i.m_DataSource,c,false));i.m_Props.push(i.m_LabelRounded=new VBI.AttributeProperty(d,'labelRounded',i.m_DataSource,c,false));i.m_Props.push(i.m_LabelPos=new VBI.AttributeProperty(d,'labelPos',i.m_DataSource,c));i.m_Props.push(i.m_LabelOffset=new VBI.AttributeProperty(d,'labelOffset',i.m_DataSource,c,[0,0]));i.m_Props.push(i.m_LabelIcon=new VBI.AttributeProperty(d,'labelIcon',i.m_DataSource,c));i.m_Props.push(i.m_LabelIcBgrdCol=new VBI.AttributeProperty(d,'labelIconBgrdCol',i.m_DataSource,c));i.m_Props.push(i.m_LabelIcTextCol=new VBI.AttributeProperty(d,'labelIconTextCol',i.m_DataSource,c));i.m_Props.push(i.m_DragData=new VBI.AttributeProperty(d,'dragdata',i.m_DataSource,c,null));if(!VBI.m_bIsMobile){this.LoadDragDropInfo(d,c,i);}},BaseMousemove:function(e){if(VBI.m_bTrace){VBI.Trace("BaseMousemove");}if(this.m_Track){return false;}if(!this.GetHitArray){return false;}if(this.m_Scene.vbiclass=="3DScene"){return false;}var h=this.GetHitArray(e.offsetX,e.offsetY);var s=this.m_Scene;if(h.length>0){s.SetCursor('pointer');if(s.InternalSetHotItem(this,h[0])){if(!h[0].m_Design&&this.m_Tooltip){this.m_tt=this.getTooltip(s.m_Ctx,h[0]);if(VBI.m_bIsRtl){var x=s.GetEventVPCoords(e);this.m_clientX=x[0];}else{this.m_clientX=e.clientX;}this.m_clientY=e.clientY;var t=this.m_tt.split("#");if(t[0]=="rtt"){var i=t[1];this.m_tt=sap.ui.vbm.VBI.RttMap[i];}else{s.SetToolTip(this.m_tt);}}var c;if((c=this.DetailCursor(e,h[0]))){s.SetCursor(c);}}if(this.m_DragSourceInfo){s.m_Canvas[s.m_nLabelIndex].draggable=true;}}else if(s.m_Canvas[s.m_nLabelIndex].draggable==true){s.m_Canvas[s.m_nLabelIndex].draggable=false;}return h.length>0?true:false;},BaseContextmenu:function(e){if(VBI.m_bTrace){VBI.Trace("BaseContextmenu");}if(!this.GetHitArray){return false;}var s=this.m_Scene;if(s.vbiclass=="3DScene"){return false;}if(e.hitTests){e.hitTests=e.hitTests.concat(this.GetHitArray(e.offsetX,e.offsetY,true));return e.hitTests.length>0;}var h=e.hitCached?e.hitCached:this.GetHitArray(e.offsetX,e.offsetY,false)[0];if(!h){return false;}var i=this.GetDataIndex(h.m_Index);var a,b=s.m_Ctx.m_Actions;var d;var c=this.m_DataSource.GetIndexedElement(s.m_Ctx,i);if(c){if(b&&h.m_Design&&(h.m_Hit==VBI.HTHANDLE)){if((a=b.findAction("HandleContextMenu",s,this))){var p=s.GetEventVPCoordsObj(e);p.handle=h.m_Handle.toString();s.m_Ctx.FireAction(a,s,this,c,p);e.preventDefault();return true;}}if(this.DetailContextmenu(e,c,h)){e.preventDefault();return true;}}else{var r=this.m_BBRefs[h.m_Index];d=s.m_Ctx.m_Clustering.getClusterIdent(s.m_PreassembledData,r.cI,r.i);c=this.GetPreassembledElement(h.m_Index);}if(b){if((a=b.findAction("ContextMenu",s,this))){s.m_Ctx.FireAction(a,s,this,c,s.GetEventVPCoordsObjWithScene(e),d,null,h);e.preventDefault();return true;}}e.preventDefault();return false;},BaseFindAction:function(n){var s=this.m_Scene,a=s.m_Ctx.m_Actions;return a?a.findAction(n,s,this):null;},BaseClick:function(e){if(VBI.m_bTrace){VBI.Trace("BaseClick");}if(!this.GetHitArray){return false;}var s=this.m_Scene;if(s.vbiclass=="3DScene"){return false;}if(e.hitTests){e.hitTests=e.hitTests.concat(this.GetHitArray(e.offsetX,e.offsetY,true));return e.hitTests.length>0;}var h=e.hitCached?e.hitCached:this.GetHitArray(e.offsetX,e.offsetY,false)[0];if(!h){return false;}var i=this.GetDataIndex(h.m_Index);s.RenderAsync(false);var a;var d;if(i>=0&&(a=this.m_DataSource.GetIndexedElement(s.m_Ctx,i))){this.m_DataSource.Select(i);if((e.type.indexOf("touch")>=0)||(e.type.indexOf("pointer")>=0||((e.ctrlKey||e.metaKey)&&!e.shiftKey))){this.Select(a,s.m_Ctx,this.IsSelected(s.m_Ctx)?false:true);}else if(e.shiftKey){if(!this.IsSelected(s.m_Ctx)){this.Select(a,s.m_Ctx,true);}}else{this.m_nActiveSelections=a.GlobalSingleSelect();}if(s.m_PreassembledData){s.UpdatePreData4Selected(this.m_nPreDataIndex,this.GetInternalIndex(h.m_Index));}if(h.m_Handle>=0){e.preventDefault();return true;}else if(this.IsPosChangeable(s.m_Ctx)){var b=this.m_DataSource.GetEditMode(s.m_Ctx)==VBI.EMHandle?VBI.EMBox:VBI.EMHandle;if(VBI.m_bTrace){VBI.Trace("SetEditMode: "+b);}this.m_DataSource.SetEditMode(s.m_Ctx,b);e.preventDefault();return true;}if(this.DetailClick(e,a,h)){e.preventDefault();return true;}}else{var r=this.m_BBRefs[h.m_Index];d=s.m_Ctx.m_Clustering.getClusterIdent(s.m_PreassembledData,r.cI,r.i);a=this.GetPreassembledElement(h.m_Index);}var c;if((c=s.m_Ctx.m_Actions)){var f;if((f=c.findAction("Click",s,this))){this.m_Scene.m_Ctx.FireAction(f,s,this,a,s.GetEventVPCoordsObj(e),d,null,h);e.preventDefault();return true;}}return false;},GetPreassembledElement:function(i){return undefined;},BaseHitTest:function(n,a,o){var h=[];var b={};if(this.BaseDesignHitTest(n,a,b)){h.push(b);return h;}var m=new Map;var l=this.getLabelData(false);if(l){for(var i=l.length-1;i>=0;--i){var c=l[i];var r=VBI.Types.string2rgba(c.m_BgColor);if(r[3]<0.1&&r[4]==1){continue;}for(var j=0;j<c.m_Pos.length;++j){for(var k=0;k<c.m_Pos[j].length;++k){var p=[n,a];var x=c.m_Pos[j][k][0];var y=c.m_Pos[j][k][1];var t=c.m_Pos[j][k].tri;var d=c.m_Pos[j][k].rc;var e=[x,y,x+c.m_Width,y+c.m_Height];if(VBI.Utilities.PtInRect(p,e)||(t&&VBI.Utilities.pointInTriangle(t,p))||(d&&VBI.Utilities.PtInRect(p,d))){var f={m_Vo:this,m_Index:c.mIndex,m_Entity:this.GetEntity(c.mIndex,this.m_Scene.m_Ctx)};if(o.m_All){m.set(f.m_Index,f);}else{h.push(f);}if(!o.m_All){return h;}}}}}}for(var i=this.m_BB.length-1;i>=0;--i){var g=this.m_BB[i];if(g){for(var j=this.m_IO[i].length-1;j>=0;--j){var q=this.m_IO[i][j];if(!VBI.Utilities.PtInRect([n-q,a],g)){continue;}if(o){var s=o.m_cb(o,i,n-q,a);if(s&&s.m_hit>0){var f={m_Vo:this,m_Index:i,m_Entity:this.GetEntity(i,this.m_Scene.m_Ctx),m_Detail:s,m_IO:q};if(o.m_All){m.set(f.m_Index,f);}else{h.push(f);}if(!o.m_All&&s.m_hit==1){return h;}}}}}}if(o.m_All){m.forEach(function(u){h.push(u);});}return h;},clear:function(){var n;if(this.m_Props){for(n=0;n<this.m_Props.length;++n){this.m_Props[n].clear();}this.m_Props=null;}if(this.m_DragSourceInfo){this.m_DragSourceInfo.clear();this.m_DragSourceInfo=null;}if(this.m_DropTargetInfo){this.m_DropTargetInfo.clear();this.m_DropTargetInfo=null;}this.m_Scene=null;this.m_Track=null;this.m_BB=null;this.m_IO=null;this.m_DH=null;if(this.m_Label){for(n=0;n<this.m_Label.length;++n){this.m_Label[n].clear();}this.m_Label=[];}},load:function(d,c){if(d.id){this.m_ID=d.id;}this.m_Props=[];this.m_DragSourceInfo=null;this.m_DropTargetInfo=null;},NotifyDataChange:function(c){if(this.m_Props){for(var n=0,l=this.m_Props.length;n<l;++n){this.m_Props[n].NotifyDataChange(c);}}this.m_bChanged=true;this.m_nActiveSelections=undefined;},IsPosChangeable:function(c){if(VBI.m_bMouseSupported&&this.m_Pos){return this.m_Pos.IsChangeable(c);}return false;},IsSelected:function(c){if(this.m_DataSource){return this.m_DataSource.IsElementSelected(c);}return false;},GetNumActiveSelections:function(c){if(this.m_nActiveSelections===undefined){this.m_nActiveSelections=0;var a=this.m_DataSource.m_nCurElement;var n=this.m_DataSource.GetCurrentNode(c);if(n){for(var b=0,l=n.m_dataelements.length;b<l;++b){this.m_DataSource.Select(b);if(this.IsSelected(c)){this.m_nActiveSelections++;}}}this.m_DataSource.Select(a);}return this.m_nActiveSelections;},Select:function(e,c,s){this.m_nActiveSelections=e.Select(s,this.GetNumActiveSelections(c));},IsHandleMode:function(){return this.m_DataSource.GetEditMode(this.m_Scene.m_Ctx)==VBI.EMHandle?true:false;},IsBoxMode:function(){return this.m_DataSource.GetEditMode(this.m_Scene.m_Ctx)==VBI.EMBox?true:false;},IsDataAccepted:function(e){var s=this.m_Scene;if(this.m_Track){if(VBI.m_bTrace){VBI.Trace("Error: Track object should be already gone");}return false;}if(!this.GetHitArray){return false;}var h,a=this.GetHitArray(e.offsetX,e.offsetY);if(a.length&&(h=a[0]).m_Design){return false;}if(a.length&&s.m_DragInfo){this.m_DataSource.Select(h.m_Index);if(this.m_DropTargetInfo){var c=s.m_Ctx;var d=this.m_DropTargetInfo.getItemArray(c);var D=s.m_DragInfo.aItems;for(var n=0;n<d.length;++n){if(D.indexOf(d[n])!=-1){try{e.dataTransfer.dropEffect='copy';e.stopPropagation();e.preventDefault();}catch(b){if(VBI.m_bTrace){VBI.Trace("Warning: sapvobase.IsDataAccepted exception occured: "+b.message);}}return h;}}}}return false;},GetEntity:function(n,c){this.m_DataSource.Select(n);return this.m_Entity.GetValueString(c);},IsHot:function(i){var s=this.m_Scene,h=s.m_HotItem;if(h.m_Entity&&h.m_Entity==this.m_Entity.GetValueString(s.m_Ctx)){return true;}if(!h.m_HitObj||h.m_Index!=i){return false;}if(h.m_Design){return false;}if(h.m_VO!=this){return false;}return true;},InternalChangeHotItem:function(o,n){},IsClusterable:function(){return false;},GetDataIndex:function(B){return B;},GetInternalIndex:function(B){return B;},getTooltip:function(c,h){this.m_DataSource.Select(h.m_Index);return this.m_Tooltip.GetValueString(c);},getLabelText:function(c,h){this.m_DataSource.Select(h.m_Index);return this.m_Labeltext.GetValueString(c);},getLabelData:function(r){if(!this.m_Label){return null;}if(r){for(var n=0;n<this.m_Label.length;n++){var l=this.m_Label[n];if(l.CalculateLabelPos&&l.m_PosArray.pa.length>0){l.m_Pos=[];for(var a=0;a<l.m_aIO.length;a++){var p=this.CalculateLabelPos(this.m_Scene,l.m_PosArray,l.m_aIO[a]);if(p&&p.length>0){l.m_Pos.push(p);}}l.m_bAligned=false;}}}return this.m_Label;},SwitchPreDataRendering:function(s){if(this.bUsePreData!=s){this.bUsePreData=s;if(s){this.IsHot=this.PreDataIsHot;this.GetEntity=this.PreDataGetEntity;}else{this.IsHot=this.BaseIsHot;this.GetEntity=this.BaseGetEntity;}}},GetAnimClusterDistance:function(n,e){var s=this.m_Scene;var a=n-e;if(a&&s.m_bNonIntPosStable){var t=1000*a;var b=Date.now()-s.m_bNonIntPosStable;a*=(b<t?(t-b)/t:0);}s.m_bLineAnimationRunning=(a>0);return a;},RenderTree:function(n,e,c,a,b,l,d,f,g,h,x,y,o){var j=[h*n.bo[0]-x,h*n.bo[1]-y,h*n.bo[2]-x,h*n.bo[3]-y];var I=this.m_Scene.GetInstanceOffsets(j);if(I.length){if(n.lod<l){for(var i=0;i<n.bw.length;++i){b=this.RenderTree(n.bw[i],e,c,a,b,l,d,f,g,h,x,y,o);}}else if(n.isCl){if(this.RenderThisInstance(n,e,c,a,b,n.nJ,f,g,l,d,h,x,y,false)){b++;}}else if(!o){var m=this.m_Scene.m_VOS[n.vo];m.RenderThisInstance(n,e,c,a,m.m_BB.length,n.nJ,f,g,l,d,h,x,y,true);m.SetClusteredRichTooltip(n);}}return b;},Init4Render:function(){},StandardInit:function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];},StandardInitWithLPs:function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];this.m_LP=[];},BaseRender:function(c,d){var l=this.m_DH.length;if(!l){return;}var t,a,b;var s=this.m_szHandle,h=s/2,e=1.5*s*s;var f=d.fillStyle;var g='rgba(232,205,30,0.7)';var i='rgba(188,54,24,0.7)';var j='rgba(229, 66, 30, 1.0 )';var k=this.m_Scene.m_HotItem;var H,x,S=false;for(var n=0;n<l;++n){if(!(H=this.m_DH[n])){continue;}for(var m=0,o=this.m_IO[n].length;m<o;++m){d.setTransform(1.0,0.0,0.0,1.0,this.m_IO[n][m],0.0);if(H.m_EditMode==VBI.EMBox){if(H.length==1){x=H[0];VBI.Utilities.DrawDesignRect(d,this.DesignGetActiveBoxHandles(n),x);}}else{d.fillStyle=i;d.lineWidth=1;t=null;if(S){d.fillStyle=i;S=false;}for(var p=0,q=H.length;p<q;++p){x=H[p];var r=(k.m_VO==this&&k.m_Index==n&&k.m_Design&&k.m_HitObj&&k.m_HitObj.m_Handle==p);if(t&&(((a=(t[0]-x[0]))*a)+((b=(t[1]-x[1]))*b))<e){if(!S){S=true;d.fillStyle=r?j:g;d.fill();}continue;}if(S){d.fillStyle=i;S=false;}if(r){d.fillStyle=j;}d.beginPath();d.rect(x[0]-h,x[1]-h,s,s);d.closePath();d.fill();if(r){d.fillStyle=i;}t=x;}}}}d.fillStyle=f;d.setTransform(1.0,0.0,0.0,1.0,0.0,0.0);},BaseDesignHitTest:function(n,a,b){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest nsx:"+n+" nsy:"+a+" instance:"+this.m_ID);}var l=this.m_DH.length;if(!l){return false;}var s=this.m_szHandle+2,c=s/2.0;var P=VBI.Utilities.PtInRect;if(b.m_Handle){delete b.m_Handle;}var H,d;for(var e=l;e>=0;--e){if(!(H=this.m_DH[e])){continue;}for(var f=0;f<this.m_IO[e].length;++f){var g=this.m_IO[e][f];if(H.m_EditMode==VBI.EMHandle){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Handle");}for(var i=0,j=H.length;i<j;++i){d=H[i];if(P([n-g,a],[d[0]-c,d[1]-c,d[0]+c,d[1]+c])){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Handle Hit! Index:"+e+" Handle: "+i);}b.m_Index=e;b.m_Design=true;b.m_Hit=VBI.HTHANDLE;b.m_Handle=i;b.m_NsX=n;b.m_NsY=a;b.m_IO=g;return true;}}}else if(H.m_EditMode==VBI.EMBox){if(VBI.m_bTrace&&(H.length>1||H.length==0)){VBI.Trace("Error: Box edit mode must fill one rectangle only");}d=H[0];if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Box");}var r=9;var w=d[2]-d[0];var h=d[3]-d[1];var k=w/2;var m=h/2;var o=this.DesignGetActiveBoxHandles(e);for(var x=0;x<3;++x){for(var y=0;y<3;++y){if(x==1&&y==1){continue;}if(!o[y*3+x]){continue;}var p=d[0]+x*k-(n-g);var q=d[1]+y*m-(a);if((p*p+q*q)<r){b.m_Index=e;b.m_Handle=y*3+x;b.m_Design=true;b.m_Hit=VBI.HTBOXHANDLE;b.m_NsX=n;b.m_NsY=a;b.m_IO=g;return true;}}}if(P([n-g,a],d)){if(VBI.m_bTrace){VBI.Trace("BaseDesignHitTest Box Hit! Index:"+e);}b.m_Index=e;b.m_Handle=-1;b.m_Design=true;b.m_Hit=VBI.HTBOX;b.m_NsX=n;b.m_NsY=a;b.m_IO=g;return true;}}}}return false;},DesignHandleDrag:function(o,e){var s=this.m_Scene;if(VBI.m_bTrace){VBI.Trace("DesignHandleDrag");}if(VBI.m_bTrace&&(s.m_nInputMode!=VBI.InputModeTrackObject)){VBI.Trace("Error: DesignHandleDrag wrong input mode: "+s.m_nInputMode);}if(o.m_ClientX!=o.m_ClientStartX||o.m_ClientY!=o.m_ClientStartY){o.m_bDragStart=true;}if(o.m_bDragStart){this.m_DataSource.Select(o.m_Index);var p=s.GetPosFromPoint([o.m_ClientX-o.m_IO,o.m_ClientY,0]);var a=s.GetPosFromPoint([o.m_ClientStartX-o.m_IO,o.m_ClientStartY,0]);if(this.IsPosChangeable(s.m_Ctx)){var b=this.m_Pos.GetValueVector(s.m_Ctx).slice(0);var c=o.m_PosOrig;var i;if(o.hasOwnProperty('m_Handle')){if(VBI.m_bTrace){VBI.Trace("DesignHandleDrag Handle");}if(o.m_Hit==VBI.HTHANDLE){i=o.m_Handle*3;b[i]=p[0];b[i+1]=p[1];this.m_Pos.SetValueVector(s.m_Ctx,b);}else if(o.m_Hit==VBI.HTBOXHANDLE){if(this.DesignBoxSize){this.DesignBoxSize(o);}}else if(o.m_Hit==VBI.HTBOX){if(VBI.m_bTrace){VBI.Trace("DesignHandleDrag Box");}var d=(p[0]-a[0]);var f=(p[1]-a[1]);for(var n=0,l=b.length/3;n<l;++n){i=n*3;b[i]=c[i]+d;b[i+1]=c[i+1]+f;}this.m_Pos.SetValueVector(s.m_Ctx,b);}}}}s.RenderAsync(true);},DesignHandleDrop:function(o,e){var s=this.m_Scene;if(VBI.m_bTrace&&s.m_nInputMode!=VBI.InputModeTrackObject){VBI.Trace("Error: DesignHandleDrop wrong input mode: "+s.m_nInputMode);}var a,b=s.m_Ctx.m_Actions;if(b&&o.m_Design&&o.m_Handle>-1){var r=(o.m_bDragStart)?"HandleMoved":"HandleClick";if((a=b.findAction(r,s,this))){var c;if((c=this.m_DataSource.GetIndexedElement(s.m_Ctx,o.m_Index))){var p=s.GetEventVPCoordsObj(e);p.handle=o.m_Handle.toString();p.mode=o.m_Hit.toString();s.m_Ctx.FireAction(a,s,this,c,p);}}}s.SetInputMode(VBI.InputModeDefault);s.RenderAsync(true);return true;},DesignHandleEnd:function(o,e){this.m_Track.UnHook();this.m_Track=null;},DesignGetActiveBoxHandles:function(i){return[1,1,1,1,0,1,1,1,1];},onsapsecclick:function(e){return this.BaseContextmenu(e);},onsapclick:function(e){return this.BaseClick(e);},onsapmove:function(e){return this.BaseMousemove(e);},onsapup:function(e){if(!this.m_Track){return false;}this.m_Track.UnHook();this.m_Track=null;},onsapdrop:function(e){if(VBI.m_bTrace){VBI.Trace("onsapdrop in base "+e.type);}var h;if((h=this.IsDataAccepted(e))){var s=this.m_Scene;var m=this.GetDataIndex(h.m_Index);var a=this.m_DataSource.GetIndexedElement(s.m_Ctx,m);var b,c=s.m_Ctx.m_Actions;if(c){if((b=c.findAction("Drop",s,this))){this.m_Scene.m_Ctx.FireAction(b,s,this,a,s.GetEventDropObjWithScene(e));e.preventDefault();return true;}}return false;}return false;},onsapdrag:function(e){if(VBI.m_bTrace){VBI.Trace("onsapdrag in base "+e.type);}if(this.IsDataAccepted(e)){return true;}return false;},onsapdown:function(e){if(VBI.m_bTrace){VBI.Trace("onsapdown in base "+e.type);}var s=this.m_Scene;if(this.m_Track){if(VBI.m_bTrace){VBI.Trace("Error: Track object should be already gone");}return true;}if(s.vbiclass=="3DScene"){return false;}if(!this.GetHitArray){return false;}var h,a=this.GetHitArray(e.offsetX,e.offsetY);if(a.length&&(h=a[0]).m_Design){if(VBI.m_bTrace){VBI.Trace("Start Tracking on "+this.m_ID+" caused by "+e.type);}this.m_DataSource.Select(h.m_Index);h.m_CBDrag=this.DesignHandleDrag.bind(this);h.m_CBDrop=this.DesignHandleDrop.bind(this);h.m_CBEnd=this.DesignHandleEnd.bind(this);h.m_ClientStartX=e.offsetX;h.m_ClientStartY=e.offsetY;h.m_bDragStart=false;h.m_PosOrig=s.GetNearestPosArray(this.m_Pos.GetValueVector(s.m_Ctx).slice(0));s.SetInputMode(VBI.InputModeTrackObject);s.SetCursor(this.DetailCursor(e,h));if(this.DesignBeginDrag){this.DesignBeginDrag(h);}this.m_Track=new s.DesignTrack(h);e.stopPropagation();e.preventDefault();return true;}if(a.length){this.m_DataSource.Select(h.m_Index);if(this.m_DragSourceInfo&&!this.m_Pos.IsChangeable(s.m_Ctx)){var c=s.m_Ctx;var d=this.m_DragSourceInfo.getItemArray(c);if(d.length){s.m_DragInfo={};s.m_DragInfo.aItems=d;s.m_DragInfo.strInstance=this.m_DataSource.m_Path+"."+this.m_DataSource.GetCurrentElement().GetKeyValue();s.m_DragInfo.strScene=this.m_Scene.m_ID;s.m_DragInfo.strID=this.m_ID;s.m_DragInfo.strExtData=this.m_DragData.GetValueString(s.m_Ctx);s.m_DragInfo.bDragStart=false;return true;}}}return false;},DetailClick:function(e,a,h){return false;},DetailContextmenu:function(e,a,h){return false;},DetailCursor:function(e,h){if(h.m_Design){if(h.m_Hit==VBI.HTBOXHANDLE){var c=['nw-resize','n-resize','ne-resize','w-resize','','e-resize','sw-resize','s-resize','se-resize'];return c[h.m_Handle];}else if(h.m_Hit==VBI.HTBOX){return'move';}}return'pointer';},GetSelectColor:function(c,o){var r;if((r=this.m_SelectColor.GetValueString(c))){return this.ApplyDeltaColor(c,o,r);}else{return o;}},GetNonSelectColor:function(c,o){var r;if((r=this.m_NonSelectColor.GetValueString(c))){return this.ApplyDeltaColor(c,o,r);}else{return o;}},GetHotColor:function(c,o){var r;if((r=this.m_HotDeltaColor.GetValueString(c))){return this.ApplyDeltaColor(c,o,r);}else{return this.m_colorHot;}},GetAltBorderColor:function(c,o){var r;if((r=this.m_AltColorBorder.GetValueString(c))){return this.ApplyDeltaColor(c,o,r);}else{return this.GetHotColor(c,o);}},ApplyDeltaColor:function(c,o,r){var a;var k=o+r;if(c.m_deltacolTable[k]==undefined){if((a=VBI.Types.string2rhls(r))){var b;if((b=VBI.Types.color2array(o))){var h=VBI.Utilities.RGB2HLS(b[0],b[1],b[2]);var d=VBI.Utilities.HLS2RGB(h[0]+a[0],h[1]*a[1],h[2]*a[2]);c.m_deltacolTable[k]='rgba('+Math.min(Math.round(d[0]),255)+","+Math.min(Math.round(d[1]),255)+","+Math.min(Math.round(d[2]),255)+","+Math.min((a[3]*b[3]).toString(),1.0)+')';}}else{c.m_deltacolTable[k]=VBI.Types.string2color(r);}}return c.m_deltacolTable[k];},GetHotScale:function(c){var r;if((r=this.m_HotScale.GetValueVector(c))){return r;}return[1.0,1.0,1.0];},RectSelect:function(s,h,o){var t,a,f=false;for(var n=this.m_BB.length-1;n>=0;--n){if((t=this.m_BB[n])){for(var b=this.m_IO[n].length-1;b>=0;--b){var c=this.m_IO[n][b];a=[s[0]-c,s[1],s[2]-c,s[3]];if(t[0]>=a[0]&&t[1]>=a[1]&&t[2]<=a[2]&&t[3]<=a[3]){o.push(n);h.push(this.GetDataIndex(n));f=true;}}}}return f;},LassoSelectCircle:function(p,h,o){var c=[];var O,t;var f=false;for(var n=this.m_BB.length-1;n>=0;--n){var a=[];var x=this.m_BB[n].m_Pos;var r=this.m_BB[n].m_Radius;var b=20;for(var d=0;d<b;++d){t=d*2*Math.PI/b;c=[x[0]+r*Math.sin(t),x[1]+r*Math.cos(t)];a.push(c);}O=this.m_IO[n];if(VBI.Utilities.polyInPolygon(p,a,O)){h.push(n);o.push(n);f=true;}}return f;},LassoSelect:function(p,h,o){var t;var H=false,f=false;var n,a;for(var b=this.m_BB.length-1;b>=0;--b){if((t=this.m_BB[b])){H=false;for(var c=this.m_IO[b].length-1;c>=0&&!H;--c){var d=this.m_IO[b][c];var e=[[(t[0]+d),t[1]],[(t[2]+d),t[1]],[(t[2]+d),t[3]],[(t[0]+d),t[3]]];if((VBI.Utilities.pointInPolygon(p,e[0][0],e[0][1]))){H=true;for(n=0;n<e.length&&H;n+=2){var g=e[n];var i=e[n+1];for(a=0;a<p.length&&H;++a){var j=p[a];var k=(a+1==p.length)?p[0]:p[a+1];VBI.Utilities.LineLineIntersection(g,i,j,k,true);if((VBI.Utilities.LineLineIntersection(g,i,j,k,true))){H=false;}}}}}if(H){o.push(b);h.push(this.GetDataIndex(b));f=true;}}}return f;},GetLabel:function(c){var l={};var t=this.m_Labeltext.GetValueString(c);var i=this.m_LabelIcon.GetValueString(c);if(t||i){l.text=t;l.icon=i;l.icColor=this.m_LabelIcBgrdCol.GetValueColor(c);l.icTextColor=this.m_LabelIcTextCol.GetValueColor(c);l.bgColor=this.m_LabelBgCol.GetValueColor(c);l.brdrCol=this.m_LabelBrdrCol.GetValueColor(c);l.arrow=this.m_LabelArrow.GetValueBool(c);l.rounded=this.m_LabelRounded.GetValueBool(c);l.offset=this.m_LabelOffset.GetValueVector(c);l.Align=this.m_LabelPos.GetValueLong(c);return l;}else{return null;}},RenderShadowDot:function(d,n,l,x,y,s,z){if(n.isCl){for(var i=n.bw.length;i--;){this.RenderShadowDot(d,n.bw[i],l,x,y,s,z);}}else{d.beginPath();d.moveTo(z[0]*(l*n[0]-x-s),z[1]*(l*n[1]-y-s));d.lineTo(z[0]*(l*n[0]-x+s),z[1]*(l*n[1]-y-s));d.lineTo(z[0]*(l*n[0]-x+s),z[1]*(l*n[1]-y+s));d.lineTo(z[0]*(l*n[0]-x-s),z[1]*(l*n[1]-y+s));d.closePath();d.stroke();}},GetRefBorders:function(n,r,m,l){var e=this.m_Scene.m_Canvas[0].m_nExactLOD;var c=(e==Math.floor(e)?1:0.5);var x,y,a=r;var b=m;if(n.isCl==1){var d=(n.e[0])[0],f=(n.e[2])[0];x=(d[0]+f[0])/2;y=(d[1]+f[1])/2;a=1.2*l*Math.max(f[0]-d[0],f[1]-d[1]);}else{x=(n.bo[0]+n.bo[2])/2;y=(n.bo[1]+n.bo[3])/2;}var g=c*a/l;var h=[x-g,x+g,y-g,y+g];var i=n;while(i.c!=undefined){a*=(1<<(b-i.c.lod));b=i.c.lod;i=i.c;x=(i.bo[0]+i.bo[2])/2;y=(i.bo[1]+i.bo[3])/2;g=a/l;h=[Math.max(h[0],x-g),Math.min(h[1],x+g),Math.max(h[2],y-g),Math.min(h[3],y+g)];}return h;},GetNextPoint:function(p,a,b,x,c){var d,e;if(x!=0){var f=x<0?0:1;d=(p[0]-b[f])/(p[0]-a[0]);var y=p[1]+d*(a[1]-p[1]);if(c==0||((y>=b[2])&&(y<=b[3]))){return[b[f],y,true];}e=c<0?2:3;d=(p[1]-b[e])/(p[1]-a[1]);return[p[0]+d*(a[0]-p[0]),b[e],false];}if(c!=0){e=c<0?2:3;d=(p[1]-b[e])/(p[1]-a[1]);return[p[0]+d*(a[0]-p[0]),b[e],false];}},CheckNextLinePoint:function(p,a,b,i){var c=(i<2);var t=c?0:1;var o=1-t;var d=(p[t]-b[i])/(p[t]-a[t]);if((d<=0)||(d>1)){return undefined;}var e=p[o]+d*(a[o]-p[o]);if((e<b[2*o])||(e>b[2*o+1])){return undefined;}return c?[b[i],e]:[e,b[i]];},paintLineList:function(d,p,l,x,y,z){var f;for(var j=0;j<4;++j){var a=p[j];for(var k=0;k<a.length;++k){if(f==undefined){d.moveTo(z[0]*(l*(a[k])[0]-x),z[1]*(l*(a[k])[1]-y));f=true;}else{d.lineTo(z[0]*(l*(a[k])[0]-x),z[1]*(l*(a[k])[1]-y));}}}},GetNextLinePoint:function(p,a,b,s,i){var c;var t=i?0:1;var o=1-t;var d=2*t+(s<0?0:1);var e=(p[t]-b[d])/(p[t]-a[t]);var f=p[o]+e*(a[o]-p[o]);if(i){c=(f<b[2])||(f>=b[3]);return[b[d],Math.max(Math.min(f,b[3]),b[2]),!c];}c=(f<b[0])||(f>=b[1]);return[Math.max(Math.min(f,b[1]),b[0]),b[d],c];},doCornerConnection:function(d,x,y,l,p,a,b,m,o,c,e,i,z){var f=this.GetNextLinePoint(p,a,b,m,i);d.lineTo(z[0]*(l*f[0]-x),z[1]*(l*f[1]-y));if(e&&(f[2]==i)){f=this.GetNextLinePoint(p,a,b,e,!i);d.lineTo(z[0]*(l*f[0]-x),z[1]*(l*f[1]-y));}if(c&&(e==0||e==-o)){f=this.GetNextLinePoint(p,a,b,c,i);f[2]=!f[2];d.lineTo(z[0]*(l*f[0]-x),z[1]*(l*f[1]-y));}return f;},RenderAreaFromBox:function(d,n,e,b,l,a,c,z){var f=this.m_Scene.m_Ctx.m_Clustering;var g;var p=[[[b[1],b[2]]],[[b[1],b[3]]],[[b[0],b[3]]],[[b[0],b[2]]]];var h=b[1]-b[0],k=b[3]-b[2];var m=[3,1,0,2];var o=[1,1,0,0];var q=[2,3,3,2];var x,y;var r=n;for(var i=0;i<n.e.length;++i){var s=f.getEdge(n.e[i],e);var t=[],u=[];for(var j=0;j<4;++j){if((g=this.CheckNextLinePoint(s[0],s[1],b,j))!=undefined){u.push(m[j]);t.push(g);}}if(t.length==2){while(r.bw!=undefined){r=r.bw[0];}var w=((4+u[1]-u[0])%4);if((w%2)==1){var A=(w==1?0:1);var B=1-A;var C=p[u[A]];if(u[A]%2){x=(t[B])[0];y=(t[A])[1];}else{x=(t[A])[0];y=(t[B])[1];}var D=[b[o[u[A]]],b[q[u[A]]]];var E=Math.abs(D[0]-x);var F=Math.abs(D[1]-y);var G=Math.abs(D[0]-r[0]);var H=Math.abs(D[1]-r[1]);if(!E||!F||((G/E)+(H/F)>1)){C.splice(C.length-1,1,t[A],t[B]);}else{var I=p[(u[A]+1)%4];I.splice(I.length-1,1,t[B]);I=p[(u[A]+2)%4];I.splice(0,1,t[B]);I=p[(u[A]-1)%4];I.splice(0,1,t[A]);}}if(w==2){while(r.bw!=undefined){r=r.bw[0];}var J;if(u[0]%2){var K=(u[0]==1?0:1),L=1-K;J=(r[0]-b[0])/h;var M=(1-J)*(t[K])[1]+J*(t[L])[1];if(M>r[1]){p[1].splice(p[1].length-1,1,t[K]);p[2]=[t[L]];}else{p[3].splice(p[3].length-1,1,t[L]);p[0]=[t[K]];}}else{var N=(u[0]==0?0:1),O=1-N;J=(r[1]-b[2])/k;var P=(1-J)*(t[O])[0]+J*(t[N])[0];if(P>r[0]){p[0].splice(p[0].length-1,1,t[N]);p[1]=[t[O]];}else{p[2].splice(p[2].length-1,1,t[O]);p[3]=[t[N]];}}}}}this.paintLineList(d,p,l,a,c,z);},RenderAreaFromEdges:function(d,n,p,a,b,l,x,y,z){var c,e,f,g,h,j=p;var k=0,m=0;d.moveTo(z[0]*(l*p[0]-x),z[1]*(l*p[1]-y));var o=false;var q,r;var s=n.e.length-1;for(var i=s;i--;){c=p.ot;r=(c[0]>b[1])-(c[0]<b[0]);q=(c[1]>b[3])-(c[1]<b[2]);if(o){if(r==0&&q==0){if(k&&m){if((h=this.GetNextLinePoint(p,j,b,g[2]?k:m,g[2]))){d.lineTo(z[0]*(l*h[0]-x),z[1]*(l*h[1]-y));}}h=this.GetNextPoint(c,p,b,k,m);d.lineTo(z[0]*(l*h[0]-x),z[1]*(l*h[1]-y));d.lineTo(z[0]*(l*c[0]-x),z[1]*(l*c[1]-y));o=false;}else{if(g[2]){if(k!=r){g=this.doCornerConnection(d,x,y,l,p,c,b,k,m,r,q,true,z);}}else if(m!=q){g=this.doCornerConnection(d,x,y,l,p,c,b,m,k,q,r,false,z);}k=r;m=q;}}else if(r==0&&q==0){d.lineTo(z[0]*(l*c[0]-x),z[1]*(l*c[1]-y));}else{g=this.GetNextPoint(p,c,b,r,q);d.lineTo(z[0]*(l*g[0]-x),z[1]*(l*g[1]-y));o=true;}f=c.li;e=a[f.ot];p=e.p;k=r;m=q;}if(o){if(k&&m){if((h=this.GetNextLinePoint(p,j,b,g[2]?r:q,g[2]))){d.lineTo(z[0]*(l*h[0]-x),z[1]*(l*h[1]-y));}}h=this.GetNextPoint(j,p,b,k,m);d.lineTo(z[0]*(l*h[0]-x),z[1]*(l*h[1]-y));}},FindEndPointInBorders:function(n,p,a,b){var c=n.e.length;var d,l,e;while(c){if((a[0]>=b[0])&&(a[0]<=b[1])&&(a[1]>=b[2])&&(a[1]<=b[3])){return a;}d=a.ot;l=d.li;e=p[l.ot];a=e.p;c--;}return undefined;},RenderShadowArea:function(d,n,e,r,m,s,c,C,l,x,y,z,a){var b=this.m_Scene.m_Ctx.m_Clustering;var p;if(n.ei!=undefined&&!a){this.RenderShadowArea(d,n,e,r,m,s,c,C,l,x,y,z,true);p=b.createEdgeIndex(e,n.ei);d.strokeStyle="rgba(0,0,0,0)";}else{p=b.createEdgeIndex(e,n.e);d.strokeStyle=c;}var f=this.GetRefBorders(n,r,m,l);d.lineWidth=s;d.beginPath();var g=this.FindEndPointInBorders(n,p,p[0].p,f);if(g==undefined){this.RenderAreaFromBox(d,n,e,f,l,x,y,z);}else{this.RenderAreaFromEdges(d,n,g,p,f,l,x,y,z);}d.closePath();if(!a&&C!=undefined){d.fillStyle=C;d.fill();}d.stroke();},RenderShadow:function(d,n,e,c,a,l,x,y){var z=this.m_Scene.GetZoomFactor4Mode();if(c.sCol){d.strokeStyle=c.sCol;d.lineWidth=2;d.lineCap='round';var s=c.sSize;if(s==-1){if(n.cnt>100){s=1;}else if(n.cnt>30){s=2;}else{s=3;}}if(s){this.RenderShadowDot(d,n,l,x,y,s,z);}}if((c.permArea&&(n.grI>1))||(n.e==undefined)||(a<n.lod-4&&n.c==undefined)){return;}if(c.bCol){var r=c.baseConf.m_ref;var m=c.baseConf.m_lod;if(c.bCol3){if(n.c&&n.c.lod==m-1){this.RenderShadowArea(d,n.c,e,r*2,m-1,1,c.bCol3,c.fCol3,l,x,y,z);}else{this.RenderShadowArea(d,n,e,r*2,m-1,1,c.bCol3,c.fCol3,l,x,y,z);}}this.RenderShadowArea(d,n,e,r,m,c.bSize,c.bCol,c.fCol,l,x,y,z);if(c.bCol2&&n.bw){if(a==n.lod){for(var i=0;i<n.bw.length;i++){var b=n.bw[i];if(b.e.length>0){this.RenderShadowArea(d,b,e,r/2,m+1,1,c.bCol2,c.fCol2,l,x,y,z);}}}else{this.RenderShadowArea(d,n,e,r/2,m+1,1,c.bCol2,c.fCol2,l,x,y,z);}}}}};VBI.VisualObjects.Spot=function(){this.m_fHotScale=1.2;this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_Image=new VBI.AttributeProperty(d,'image',this.m_DataSource,c));this.m_Props.push(this.m_ImageSelected=new VBI.AttributeProperty(d,'imageSelected',this.m_DataSource,c,null));this.m_Props.push(this.m_Icon=new VBI.AttributeProperty(d,'icon',this.m_DataSource,c));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',this.m_DataSource,c));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.m_Props.push(this.m_Alignment=new VBI.AttributeProperty(d,'alignment',this.m_DataSource,c,"5"));this.m_Props.push(this.m_ContentColor=new VBI.AttributeProperty(d,'contentColor',this.m_DataSource,c,"rgb(0,0,0)"));this.m_Props.push(this.m_ContentOffset=new VBI.AttributeProperty(d,'contentOffset',this.m_DataSource,c,[0,0,0]));this.m_Props.push(this.m_ContentFont=new VBI.AttributeProperty(d,'contentFont',this.m_DataSource,c,"arial"));this.m_Props.push(this.m_ContentSize=new VBI.AttributeProperty(d,'contentSize',this.m_DataSource,c,null));this.BaseLoad(d,c,this);};this.DetailHitTest=function(o,n,a,b){var i,h,s;var c=o.m_Ctx;var m=n;var d=null;var e=null;h=this.IsHot(m,c);if(this.bUsePreData){var I=this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];var r=this.m_BBRefs[n];if(r.cI!=undefined){I=this.m_Scene.m_PreassembledData.clust[r.cI];}var f=I[r.i];i=f.im;if(h){d=f.hcol;}s=f.s;}else{this.m_DataSource.Select(m);i=this.m_Image.GetValueString(c);if(h){d=this.m_HotDeltaColor.GetValueString(c);}s=this.IsSelected(c);if(s){e=this.m_HotDeltaColor.GetValueString(c);}}var g,j=0;if((g=c.GetResources().GetImageBits(i,d,e))){var k=g[0];var l=this.m_BB[n];var w=l[2]-l[0];var p=l[3]-l[1];var q=Math.floor((a-l[0])/w*g[1]);var t=Math.floor((b-l[1])/p*g[2]);j=k[(t*g[1]+q)*4+3];}return(j>0)?{m_hit:(j==255?1:2)}:null;};this.MatchIcon=function(i){var a={};if(i){sap.ui.core.IconPool.insertFontFaceStyle();switch(i){case"A8":a.i="\ue078";a.f="SAP-icons";break;case"7T":a.i="\ue075";a.f="SAP-icons";break;case"7R":a.i="\ue08a";a.f="SAP-icons";break;case"7Q":a.i="\ue0b3";a.f="SAP-icons";break;case"13":a.i="\ue1cb";a.f="SAP-icons";break;case"89":a.i="\ue176";a.f="SAP-icons";break;case"5X":a.i="\ue326";a.f="VBI-Icons";break;case"7S":a.i="\ue345";a.f="VBI-Icons";break;default:a.f="SAP-icons";if(i.charCodeAt(0)>255){a.i=i;}else{var b=sap.ui.core.IconPool.getIconInfo(i);if(b){a.i=b.content;a.f=b.fontFamily;}}break;}}return a;};this.GetHitArray=function(x,y,a){var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var b=y/z[0];var o={m_cb:this.DetailHitTest.bind(this),m_Ctx:this.m_Scene.m_Ctx,m_All:a};return this.BaseHitTest(n,b,o);};this.GetLabelPos=function(x,w,h,e){var a=parseInt(e!=undefined?e:"5",10);switch(a){case 0:return{left:x[0]-w/2,top:x[1]-h/2};case 8:return{left:x[0],top:x[1]};case 1:return{left:x[0]-w/2,top:x[1]};case 2:return{left:x[0]-w,top:x[1]};case 3:return{left:x[0]-w,top:x[1]-h/2};case 4:return{left:x[0]-w,top:x[1]-h};case 6:return{left:x[0],top:x[1]-h};case 7:return{left:x[0],top:x[1]-h/2};case 5:default:return{left:x[0]-w/2,top:x[1]-h};}};this.RenderThisInstance=function(e,a,c,b,n,d,f,g,h,i,l,x,y,r){if(VBI.m_bTrace){VBI.Trace("Spot: RenderThisInstance");}var j;var s=this.m_Scene;var z=s.GetZoomFactor4Mode();if(e.c!=undefined&&c.anim&&(h>c.animLow)&&i&&e.c!=undefined&&e.c.lod==h-1){var E=e.c;var k=i*i;j=[z[0]*(l*(e[0]*(1-k)+E[0]*k)-x),z[1]*(l*(e[1]*(1-k)+E[1]*k)-y)];if(c.anim==2){var m=[z[0]*(l*E[0]-x),z[1]*(l*E[1]-y)];var t=2*Math.abs(0.5-i);var o=""+(1-t);f.strokeStyle="rgba(110,110,110,"+o+")";f.lineWidth=2;f.lineCap='round';f.beginPath();f.moveTo(j[0],j[1]);f.lineTo(m[0],m[1]);f.stroke();}}else{j=[z[0]*(l*e[0]-x),z[1]*(l*e[1]-y)];}var p=s.m_Ctx.GetResources().GetImage((e.s&&e.simag)?e.simag:e.im,e.s?e.scol:null,e.h?e.hcol:null,s.RenderAsync.bind(s));var q=e.sc;var u=e.tx;var w=e.ic;var A=e.ctfont;if(!p){return false;}var B=e.fs&&e.fz&&(e.cnt!=undefined?""+e.cnt:undefined);var C=s.GetStretchFactor4Mode();var D=p.naturalWidth*q[0]/C[0];var F=p.naturalHeight*q[1]/C[1],G=F;if(e.h){if(e.hscale!=undefined){D=D*e.hscale[0];F=F*e.hscale[1];}}var H=this.GetLabelPos(j,D,F,e.al);var I=this.m_IO[n]=s.GetCorrectedInstanceOffsets(this.m_BB[n]=[H.left,H.top,H.left+D,H.top+F],z);if(!I.length){return false;}this.m_BBRefs.push({cI:b,i:d});if(e.h){s.VerifyHotItem(this,this.m_BBRefs.length-1);}this.m_BB[n].nI=d;if(this.IsPosChangeable(s.m_Ctx)){var J=this.m_DH[n]=[];if(this.IsHandleMode()){J.m_EditMode=VBI.EMHandle;J.push(j);}else if(this.IsBoxMode()){J.m_EditMode=VBI.EMBox;J.push(this.m_BB[n]);}}var K,L;if(u){L=Math.floor((e.ctsz?e.ctsz:12)*F/p.naturalHeight);VBI.Utilities.SetTextAttributes(f,L.toString()+"px "+A,e.ctcol,e.ctcol,"center","middle");K=u;}else if(w){var M=this.MatchIcon(w);if(M&&M.i&&M.f){L=Math.floor((e.ctsz?e.ctsz:16)*F/p.naturalHeight);VBI.Utilities.SetTextAttributes(f,(L?L:16).toString()+"px "+M.f,e.ctcol,e.ctcol,"center","middle");K=M.i;}}var N,O;for(O=0;O<I.length;++O){N=I[O];if(c&&(e.h||c.permArea)){this.RenderShadow(g,e,a,c,h,l,x-N,y);}f.drawImage(p,H.left+N,H.top,D,F);if(K){var P=[0,0,0];if(e.ctoffs&&e.ctoffs.length){P=e.ctoffs;}var Q=P[0]*q[0]/C[0];var R=P[1]*q[1]/C[1];if(e.h&&e.hscale!=undefined){Q*=e.hscale[0];R*=e.hscale[1];}f.fillText(K,H.left+N+Q+D/2,H.top+R+F/2);}}if(B){var S=e.fz?e.fz*F/p.naturalHeight:Math.floor(G/e.fs);VBI.Utilities.SetTextAttributes(f,(S).toString()+"px "+e.f,e.fc,e.fc,"left","alphabetic");for(O=0;O<I.length;++O){N=I[O];f.fillText(B,D+H.left+N+e.fo/C[0],H.top+e.foy/C[1]+(F+S/1.5)/2.0);}}if(r==true){if(e.label&&I.length){var T={pa:[j[0],j[1],j[2]],bb:null};this.m_Label.push(new VBI.Label(e.label,n,this.CalculateLabelPos,T,this.m_BB[n],I));}}return true;};this.RenderInstance=function(n,d,r,i,t,s,h,l,a){if(VBI.m_bTrace){VBI.Trace("Spot: RenderInstance");}if(!i){return;}var b=this.m_Scene;var z=b.GetZoomFactor4Mode();var c=b.GetStretchFactor4Mode();var x=b.GetPointFromPos(r,true);var w=i.naturalWidth*s[0]/c[0];var e=i.naturalHeight*s[1]/c[1];var f=this.GetHotScale(b.m_Ctx);if(h){w=Math.round(w*f[0]);e=Math.round(e*f[1]);}var p=this.GetLabelPos(x,w,e,this.m_Alignment.GetValueString(b.m_Ctx));var I=this.m_IO[n]=b.GetCorrectedInstanceOffsets(this.m_BB[n]=[p.left,p.top,p.left+w,p.top+e],z);if(this.IsPosChangeable(b.m_Ctx)){var D=this.m_DH[n]=[];if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x);}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(this.m_BB[n]);}}var g=this.m_ContentColor.GetValueString(b.m_Ctx);var j=this.m_ContentOffset.GetValueVector(b.m_Ctx);var k=this.m_ContentFont.GetValueString(b.m_Ctx);var m=this.m_ContentSize.GetValueLong(b.m_Ctx);var o;if(t){if(!m){m=12;}m=m*e/i.naturalHeight;VBI.Utilities.SetTextAttributes(d,(Math.floor(m)).toString()+"px "+k,g,g,"center","middle");o=t;}else if(a){if(!m){m=16;}m=m*e/i.naturalHeight;var q=this.MatchIcon(a);if(q&&q.i&&q.f){VBI.Utilities.SetTextAttributes(d,(Math.floor(m)).toString()+"px "+q.f,g,g,"center","middle");o=q.i;}}for(var u=0;u<I.length;++u){var y=I[u];d.drawImage(i,p.left+y,p.top,w,e);if(o){var A=j[0]*s[0]/c[0];var B=j[1]*s[1]/c[1];if(h){A*=f[0];B*=f[1];}d.fillText(o,p.left+y+w/2+A,p.top+e/2+B);}}if(l&&I.length){var L={pa:[x[0],x[1],x[2]],bb:null};this.m_Label.push(new VBI.Label(l,n,this.CalculateLabelPos,L,this.m_BB[n],I));}};this.CalculateLabelPos=function(s,p,i){var n=Math.floor(p.pa.length/3)*3,t=[],a=s.GetViewport();for(var b=0;b<n;b+=3){var c=[p.pa[b]+i,p.pa[b+1]];if(c[0]>a[0]&&c[0]<a[2]&&c[1]>a[1]&&c[1]<a[3]){t.push(c);}}return t.length?t:null;};this.Init4Render=function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];this.m_BBRefs=[];};this.Render=function(c,d,p,s,a,S){var b=this.m_Scene;this.SwitchPreDataRendering(p!=undefined);var e;if(this.bUsePreData){if((p.m_nNumIgnore!=undefined)&&(p.m_nNumIgnore==p.length)){return 0;}var r=S?false:true;e=this.m_BB.length;var E=b.m_Canvas[0].m_nExactLOD;var x=b.m_Canvas[0].m_nCurrentX*b.m_MapManager.m_tileWidth;var y=b.m_Canvas[0].m_nCurrentY*b.m_MapManager.m_tileHeight;var f=p.config;var g=p.cI;var n=p.m_TreeFatherNode;var h;if(n){h=Math.ceil(E);var i=this.GetAnimClusterDistance(h,E);e=this.RenderTree(n,p.m_edges,f,g,e,h,i,d,a,p.m_lodOffset,x,y,false);}else{h=b.m_Canvas[0].m_nCurrentLOD;var j=p.length;var l=p.m_lodOffset;for(var k=0;k<j;++k){var m=p[k];if(!m.b2Ignore){if(this.RenderThisInstance(m,p.m_edges,f,g,e,k,d,a,h,0,l,x,y,r)){this.SetClusteredRichTooltip(m);e++;}}}}}else{var o=b.m_Ctx;var q,t;if((q=this.m_DataSource.GetCurrentNode(o))){var u=q.m_dataelements.length;for(var w=0;w<u;++w){this.m_DataSource.Select(w);var H=this.IsHot(w);var z=this.IsSelected(o);var A=this.m_Pos.GetValueVector(o);var B=this.m_Image.GetValueString(o);if(z&&(t=this.m_ImageSelected.GetValueString(o))){B=t;}var C=this.m_Text.GetValueString(o);var D=this.m_Icon.GetValueString(o);var F=this.m_Scale.GetValueVector(o);var G=o.GetResources().GetImage(B,z?this.m_SelectColor.GetValueString(o):null,H?this.m_HotDeltaColor.GetValueString(o):null,b.RenderAsync.bind(b));this.RenderInstance(w,d,A,G,C,F,H,this.GetLabel(o),D);this.SetRichTooltip(H);}}}this.BaseRender(c,d);return e;};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0);if(o.m_IO){(o.m_DhOrig[0])[0]+=o.m_IO;(o.m_DhOrig[0])[2]+=o.m_IO;}};this.DesignGetActiveBoxHandles=function(i){return[1,1,1,1,0,1,0,0,0];};this.InternalChangeHotItem=function(n,a,h){if(this.bUsePreData){var r=this.m_BBRefs[n];if(r!=undefined){var I=(r.cI!=undefined)?this.m_Scene.m_PreassembledData.clust[r.cI]:this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];if(I[r.i]!=undefined){I[r.i].h=a;this.m_HotClusterVO=((a&&I[r.i].isCl)?I[r.i]:undefined);}if(h){h.cI=a?r.cI:undefined;h.nI=a?r.i:undefined;}}}};this.BaseIsHot=this.IsHot;this.PreDataIsHot=function(n,c){var r=this.m_BBRefs[n];var I=(r.cI!=undefined)?this.m_Scene.m_PreassembledData.clust[r.cI]:this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];return I[r.i].h;};this.BaseGetEntity=this.GetEntity;this.PreDataGetEntity=function(n,c){this.m_DataSource.Select(n);return this.m_Entity.GetValueString(c);};this.SwitchHotItemToStandard=function(){var s=this.m_Scene;var r=this.m_BBRefs[s.m_HotItem.m_Index];var I=(r.cI!=undefined)?this.m_Scene.m_PreassembledData.clust[r.cI]:this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex];var e=I[r.i];if(e){if(e.isCl==true){s.InternalSetHotItem(null,null);return e;}else{s.m_HotItem.m_Index=e.nI;if(s.m_HotItem.m_HitObj){s.m_HotItem.m_HitObj.m_Index=e.nI;}return undefined;}}};this.IsClusterable=function(){return true;};this.GetDataIndex=function(B){if(this.bUsePreData){var p=this.m_BBRefs[B];if(p!=undefined){var I=(p.cI==undefined?this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex]:this.m_Scene.m_PreassembledData.clust[p.cI]);var e=I[p.i];if(e!=undefined){return e.nI;}}}return B;};this.GetPreassembledElement=function(B){var p=this.m_BBRefs[B];if(p==undefined){return undefined;}var I=(p.cI==undefined?this.m_Scene.m_PreassembledData.base[this.m_nPreDataIndex]:this.m_Scene.m_PreassembledData.clust[p.cI]);return I[p.i];};this.GetInternalIndex=function(B){if(this.bUsePreData){return this.m_BBRefs[B];}return B;};this.getTooltip=function(c,h){this.m_DataSource.Select(this.GetDataIndex(h.m_Index));return this.m_Tooltip.GetValueString(c);};this.DesignBoxSize=VBI.Utilities.SceneBindDesignSpotBoxSize.bind(this);};VBI.VisualObjects.Spot.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Route=function(){this.m_LP=[];this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'posarray',this.m_DataSource,c));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Start=new VBI.AttributeProperty(d,'start',this.m_DataSource,c,0));this.m_Props.push(this.m_End=new VBI.AttributeProperty(d,'end',this.m_DataSource,c,0));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_LineWidth=new VBI.AttributeProperty(d,'linewidth',this.m_DataSource,c,6.0));this.m_Props.push(this.m_DotColor=new VBI.AttributeProperty(d,'dotcolor',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_DotBorderColor=new VBI.AttributeProperty(d,'dotbordercolor',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,null));this.m_Props.push(this.m_LineDash=new VBI.AttributeProperty(d,'lineDash',this.m_DataSource,c,null));this.m_Props.push(this.m_DotWidth=new VBI.AttributeProperty(d,'dotwidth',this.m_DataSource,c,0.0));this.m_Props.push(this.m_Tri=new VBI.AttributeProperty(d,'directionIndicator',this.m_DataSource,c,0));this.BaseLoad(d,c,this);};this.DrawArrow=function(c,a,b,d,l,r,h){if((a.length<3)||(Math.max(a[0][0],a[1][0],a[2][0])<l)||(Math.max(a[0][1],a[1][1],a[2][1])<0)||(Math.min(a[0][0],a[1][0],a[2][0])>r)||(Math.min(a[0][1],a[1][1],a[2][1])>h)){return;}c.beginPath();c.moveTo(a[0][0],a[0][1]);c.lineTo(a[1][0],a[1][1]);c.lineTo(a[2][0],a[2][1]);c.lineTo(a[0][0],a[0][1]);c.closePath();if(d){c.strokeStyle=d;c.lineWidth=2;c.stroke();}c.fillStyle=b;c.fill();};this.CalcTriangle=function(p,a,b,c,r,R,i,n){var d=a[0]-p[0];var e=a[1]-p[1];while((Math.abs(d)>1000.0)&&(Math.abs(e)>1000.0)){d/=1000.0;e/=1000.0;}var l=Math.sqrt(d*d+e*e);var f=(d*b)/l;var g=(e*b)/l;var w=(d*c/2)/l;var h=(e*c/2)/l;var j,k;if(i){j=(d*n/2)/l;k=(e*n/2)/l;}var m=p[0]+f;var o=p[1]+g;if(!R){r.ta=[[p[0],p[1]],[m+h,o-w],[m-h,o+w]];r.pt=[m,o,0];if(i){r.int=[[m+k,o-j],[m-k,o+j]];}}else{r.ta=[[m,o,0],[p[0]+h,p[1]-w],[p[0]-h,p[1]+w]];r.pt=[p[0],p[1]];if(i){r.int=[[p[0]+k,p[1]-j],[p[0]-k,p[1]+j]];}}};this.getArrowLength=function(l){return(Math.min(15,l*5));};this.getArrowWidth=function(l){return(Math.min(Math.max(8,l*3),l+8));};this.CalcArrowIntermediate=function(L,p,n,a,s,e,b){var c=p;var r=false;var o=n;var d=this.getArrowWidth(a);var f=this.getArrowLength(a);var g=f*f;var h=0;var t,i,j;var k=[0,0,0];var m;var q;j=0;if(s){m={};h=0;for(q=o;q<L.length;++q){k=L[q];t=c[0]-k[0];i=c[1]-k[1];j=t*t+i*i;if(j>g){this.CalcTriangle(c,k,f,d,m,false,b,a);L.m_aArrows.push(m);r=true;break;}else{h++;}}if(m.pt){L.splice(o,h,c,m.pt);o=o+2;c=m.pt;}}if(e){var S=true;var u=c;var x=L[o];var w=this.getArrowWidth(a);var y=0;var l;c=[];while(S&&o<L.length){t=(x[0]-u[0]);i=(x[1]-u[1]);l=Math.sqrt(t*t+i*i);if(y+l>w){S=false;var z=t/(y+l)*w;var A=i/(y+l)*w;c=[u[0]+z,u[1]+A,0];}else{y+=l;o++;u=x;x=L[o];}}if(c.length){m={};h=0;for(q=o;q<L.length;++q){k=L[q];t=c[0]-k[0];i=c[1]-k[1];j=t*t+i*i;if(j>g){this.CalcTriangle(c,k,f,d,m,true,b,a);L.m_aArrows.push(m);r=true;break;}else{h++;}}if(m.pt){L.splice(o,h,c,[m.ta[0][0],m.ta[0][1],0]);o=o+2;}}}if(r){return o-1;}return-1;};this.CalcArrow=function(p,l,r,a,b,c){var d=this.getArrowWidth(a);var e=this.getArrowLength(a);var n=p.length/3;var t,f,g=e*e;if(((t=(l[0]-r[0]))*t+(f=(l[1]-r[1]))*f)<g){return false;}var h,i;var s,x=[0,0,0];var F=false;i=b?3*(n-1):0;s=[p[i],p[i+1],0.0];var j=3*n;for(h=3;h<j;h+=3){i=b?j-3-h:h;x=[p[i],p[i+1],0.0];if(((t=(s[0]-x[0]))*t+(f=(s[1]-x[1]))*f)>g){F=true;break;}}if(!F){return false;}this.CalcTriangle(s,x,e,d,c,false,false,0);c.idx=i;return true;};this.CalculateLabelPos=function(s,p,o){var a=VBI.Utilities.GetMidpointsForLine(p.pa,o,s.GetViewport());return a.aPos;};this.LassoSelect=function(p,h,o){var a,r,O;var f=false;for(var n=this.m_LP.length-1;n>=0;--n){a=this.m_LP[n];O=this.m_IO[n];var e=false;for(var b=0;b<O.length;++b){if(e){break;}for(var c=0;c<a.length;++c){r=a[c];if(!(e=VBI.Utilities.pointInPolygon(p,r[0]+O[b],r[1]))){break;}}}if(e){h.push(n);o.push(n);f=true;}}return f;};this.RenderInstance=function(n,d,h,c){var z=this.m_Scene.GetZoomFactor4Mode();this.m_LP[n]=[];var e;if(this.IsPosChangeable(c)){this.m_DH[n]=[];if(this.IsHandleMode()){e=VBI.EMHandle;}else if(this.IsBoxMode()){e=VBI.EMBox;}}var s=this.IsSelected(c);var p=this.m_Pos.GetValueVector(c);var a=this.m_Scene;if(p.cache==undefined){a.FillPositionCache(p);}var b=this.m_Color.GetValueColor(c);if(s){b=this.GetSelectColor(c,b);}if(h){b=this.GetHotColor(c,b);}var f=this.m_Start.GetValueLong(c);var g=this.m_End.GetValueLong(c);var t=this.m_Tri.GetValueLong(c);var l=this.m_LineWidth.GetValueFloat(c);if(h){l*=(this.GetHotScale(c))[0];}var i=this.m_DotColor.GetValueColor(c);if(s){i=this.GetSelectColor(c,i);}if(h){i=this.GetHotColor(c,i);}var j=this.m_DotBorderColor.GetValueColor(c);var k=this.m_ColorBorder.GetValueColor(c);if(s){j=this.GetSelectColor(c,j);k=this.GetSelectColor(c,k);}if(h){j=this.GetHotColor(c,j);k=this.GetHotColor(c,k);}var m=this.m_LineDash.GetValueString(c);var o=this.m_DotWidth.GetValueFloat(c);var q=this.GetLabel(c);var r=a.GetNearestPosArray(p);var u=a.GetPointFromPos([r.m_MinX,r.m_MaxY,0.0],false);var w=a.GetPointFromPos([r.m_MaxX,r.m_MinY,0.0],false);var x=Math.max(l,o/2);var I=this.m_IO[n]=a.GetCorrectedInstanceOffsets(this.m_BB[n]=[u[0]-x,u[1]-x,w[0]+x,w[1]+x],z);if(I.length){var y=a.GetPointArrayFromUCSArray(p.cache.data);if(e!=undefined){this.m_DH[n]=this.FillDesignHandles(y,e,n);}for(var A=0,B=I.length;A<B;++A){d.setTransform(1,0,0,1,I[A],0);this.RenderRoute(n,d,y,u,w,b,f,g,t,l,i,j,k,m,o,I[A]);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n]);}}d.setTransform(1,0,0,1,0,0);if(q){var C={pa:y,bb:[u,w]};this.m_Label.push(new VBI.Label(q,n,this.CalculateLabelPos,C,null,I));}}};this.FillDesignHandles=function(p,e,n){var h=[];if(e==VBI.EMHandle){var a=p.length;for(var b=0;b<a;b+=3){h.push([p[b],p[b+1]]);}}else if(e==VBI.EMBox){h.push(this.m_BB[n]);}h.m_EditMode=e;return h;};this.RenderRoute=function(n,d,p,l,r,c,s,e,t,b,f,g,h,i,j,o){if(p.length<6){return;}var x=-o,k=d.canvas.m_pixelWidth-o,y=d.canvas.m_pixelHeight;var R=((l[0]>x)&&(l[1]>0)&&(r[0]<k)&&(r[1]<y));var L=this.m_LP[n];var m=3,q=p.length-3;var C=L.length?false:true;var u={},w={};if(b&&s&&this.CalcArrow(p,l,r,b,false,u)){this.DrawArrow(d,u.ta,c,h,x,k,y);m=u.idx;if(C){L.m_RS=u;}}if(b&&e&&this.CalcArrow(p,l,r,b,true,w)){this.DrawArrow(d,w.ta,c,h,x,k,y);q=w.idx;if(C){L.m_RE=w;}}if(C){this.CollectLinePoints(p,L,m,q,s,e,t,u,w,b,o,h?true:false);}var z=this.CheckLineDashing(i,d);if(b){this.DrawActualRoute(d,L,c,h,b,R,x,k,y);}if(j){this.DrawRouteDots(d,L,s,e,f,g,j/2.0,R,x,k,y);}if(z){d.setLineDash([]);}if(L.m_aArrows&&L.m_aArrows.length){for(var A=0;A<L.m_aArrows.length;++A){this.DrawArrow(d,L.m_aArrows[A].ta,c,h,x,k,y);if(L.m_aArrows[A].int){var a=L.m_aArrows[A].int;d.beginPath();d.moveTo(a[0][0],a[0][1]);d.lineTo(a[1][0],a[1][1]);d.strokeStyle=c;d.lineWidth=2;d.stroke();}}}};this.CollectLinePoints=function(p,l,n,a,b,c,t,r,d,f,o,h){var g=Math.min(f*f/2,4);var i=this.m_Scene.GetViewport();l.m_aArrows=[];var s=r.pt?[r.pt[0],r.pt[1],0.0]:[p[0],p[1],0.0];var e=d.pt?[d.pt[0],d.pt[1],0.0]:[p[a],p[a+1],0.0];var j,k,x,m=s;l.push(m);for(var q=n;q<=a;q+=3){x=[p[q],p[q+1],0.0];if(((j=(m[0]-x[0]))*j+(k=(m[1]-x[1]))*k)>g){l.push(x);m=x;}}if(d.pt){l.push(d.pt);}if((b||c)&&t&&f&&this.CheckTriangleRendering()){if(!(s[0]>=i[0]&&s[0]<=i[2]&&s[1]>=i[1]&&s[1]<=i[3]&&e[0]>=i[0]&&e[0]<=i[2]&&e[1]>=i[1]&&e[1]<=i[3])){this.CalculateRouteArrows(l,b,c,f,o,h);}}};this.CheckTriangleRendering=function(){var s=this.m_Scene;var e=s.m_Canvas[0].m_nExactLOD;return(s.m_bNonIntPosStable||e==Math.floor(e)||e<=(s.m_CacheVars.minLOD+0.01));};this.CheckLineDashing=function(l,d){var s=this.m_Scene;var e=s.m_Canvas[0].m_nExactLOD;if(l&&d.setLineDash&&(s.m_bNonIntPosStable||e==Math.floor(e)||e<=(s.m_CacheVars.minLOD+0.01))){var a=l.split(";");d.setLineDash(a);return true;}return false;};this.DrawActualRoute=function(d,l,c,a,b,r,x,e,y){if(a){d.strokeStyle=a;d.lineWidth=b+2;d.lineJoin='round';d.lineCap='butt';}else{d.strokeStyle=c;d.lineWidth=b;d.lineJoin=d.lineCap='round';}var p=true;if(r){d.beginPath();p=false;d.moveTo((l[0])[0],(l[0])[1]);for(var n=1;n<l.length;++n){d.lineTo((l[n])[0],(l[n])[1]);}}else{var q,f;var t=this.m_Scene.m_TransitionTable;var g;var L=true;var h,i=l[0];if(i[1]<0){q=3;}else{q=i[1]>y?6:0;}if(i[0]<x){q++;}else{q+=(i[0]>e?2:0);}for(var j=1;j<l.length;++j){h=l[j];if(h[1]<0){f=3;}else{f=h[1]>y?6:0;}if(h[0]<x){f++;}else{f+=(h[0]>e?2:0);}g=t[q+9*f];if(g==1||(g>1&&this.Check4Intersect(i,h,g,x,e,0,y))){if(p){d.beginPath();p=false;}if(L){d.moveTo(i[0],i[1]);}d.lineTo(h[0],h[1]);L=false;}else{L=true;i=h;}q=f;}}if(!p){d.stroke();if(a){d.strokeStyle=c;d.lineWidth=b;d.stroke();}}};this.Check4Intersect=function(p,a,t,x,b,y,c){var d,e,f;var g=a[0]-p[0];var h=a[1]-p[1];if(t&20){f=(t&4)?c:y;e=(a[1]-f)/h;d=a[0]-g*e;if((d>=x)&&(d<=b)){return true;}}if(t&10){f=(t&2)?x:b;d=(a[0]-f)/g;e=a[1]-h*d;if((e>=y)&&(e<=c)){return true;}}return false;};this.DrawRouteDots=function(d,l,s,e,a,b,r,R,x,c,y){d.fillStyle=a;d.strokeStyle=b;d.lineWidth=1;var f=s?1:0;var g=l.length-(e?2:1);var z=2.0*Math.PI;for(var n=f;n<=g;++n){var h=l[n];if(R||((h[0]-r>x)&&(h[0]+r<c)&&(h[1]-r>0)&&(h[1]+r<y))){d.beginPath();d.arc(h[0],h[1],r,0,z);d.closePath();d.fill();d.stroke();}}};this.CalculateRouteArrows=function(l,s,e,a,o,b){var i=250;var S=0;var f=0;var t,c,n,d;var w=this.m_Scene.m_Canvas[this.m_Scene.m_nOverlayIndex].width;var h=this.m_Scene.m_Canvas[this.m_Scene.m_nOverlayIndex].height;var r=[-o,0,-o+w,h];var R=false;var L=false;var g=true;var p=l[0];var j=l[1];n=1;while(g){if(p==undefined||j==undefined){if(VBI.m_bTrace){VBI.Trace("Wrong offset in CalculateRouteArrows");}break;}R=VBI.Utilities.LineIntersectRect(p[0],p[1],j[0],j[1],r);if(R.bReturn==false){L=false;S=0;n++;if(n<l.length){p=j;j=l[n];}else{g=false;}}else{if(R.x0!=p[0]||R.y0!=p[1]){p=[R.x0,R.y0,0];l.splice(n,0,p);n++;L=false;}if(R.x1!=j[0]||R.y1!=j[1]){if(R.x1==p[0]&&R.y1==p[1]&&L){n+=2;if(n<l.length){p=l[n-1];j=l[n];L=false;}else{g=false;}}else{j=[R.x1,R.y1,0];l.splice(n,0,j);L=true;}}t=(j[0]-p[0]);c=(j[1]-p[1]);d=Math.sqrt(t*t+c*c);f+=d;if(S+d>i){var k=t/d*(i-S);var m=c/d*(i-S);var q=[p[0]+k,p[1]+m,0];var u=this.CalcArrowIntermediate(l,q,n,a,s,e,b);if(u>=0){n=u+1;p=l[u];j=l[n];S=0;}else{g=false;}}else{S+=d;n++;if(n<l.length){p=j;j=l[n];}else{g=false;}}}}};this.Init4Render=this.StandardInitWithLPs;this.Render=function(c,d,a){var s=this.m_Scene;var b=s.m_Ctx;var n;var h;if((n=this.m_DataSource.GetCurrentNode(b))){for(var e=0,l=n.m_dataelements.length;e<l;++e){this.m_DataSource.Select(e);if(this.IsHot(e)){h=e;}else{this.RenderInstance(e,d,false,b);}this.SetRichTooltip(this.IsHot(e));}}if(h!=undefined){this.m_DataSource.Select(h);this.RenderInstance(h,d,true,b);}this.BaseRender(c,d);};this.DetailHitDot=function(n,a,x,y,s){var t,b;return(((t=(x-n))*t+(b=(y-a))*b)<s)?true:false;};this.DetailHitTest=function(o,n,a,b){var x,y,c,d;this.m_DataSource.Select(n);var l=this.m_LineWidth.GetValueLong(this.m_Scene.m_Ctx)/2;var e=this.m_DotWidth.GetValueLong(this.m_Scene.m_Ctx)/2;var s=l*l;var f=e*e;var L=this.m_LP[n];x=L[0][0];y=L[0][1];if(f&&this.DetailHitDot(a,b,x,y,f)){return{m_hit:1,m_dot:0};}var g=L.length;var h;for(h=1;h<g;++h){c=L[h][0];d=L[h][1];if(l&&!((a<(Math.min(x,c)-l))||(a>(Math.max(x,c)+l))||(b<(Math.min(y,d)-l))||(b>(Math.max(y,d)+l)))&&(s>VBI.Utilities.sqDistance(x,y,c,d,a,b))){if(VBI.m_bTrace){VBI.Trace("VBI.VisualObjects.Route hit line "+n);}return{m_hit:1};}if(f&&this.DetailHitDot(a,b,c,d,f)){if(VBI.m_bTrace){VBI.Trace("VBI.VisualObjects.Route hit dot "+n);}return{m_hit:1,m_dot:h};}x=c;y=d;}if(L.m_aArrows){g=L.m_aArrows.length;for(h=0;h<g;++h){if(VBI.Utilities.pointInTriangle(L.m_aArrows[h].ta,[a,b])){return{m_hit:1};}}}if(L.m_RS&&VBI.Utilities.pointInTriangle(L.m_RS.ta,[a,b])){return{m_hit:1,m_arrow:0};}if(L.m_RE&&VBI.Utilities.pointInTriangle(L.m_RE.ta,[a,b])){return{m_hit:1,m_arrow:1};}return null;};this.GetHitArray=function(x,y,a){var o={m_cb:this.DetailHitTest.bind(this),m_All:a};var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var b=y/z[1];return this.BaseHitTest(n,b,o);};this.DesignBoxSize=VBI.Utilities.SceneBindPosArrayDesignBoxSize.bind(this);};VBI.VisualObjects.Route.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Circle=function(){this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(d,'radius',this.m_DataSource,c,5));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Slices=new VBI.AttributeProperty(d,'slices',this.m_DataSource,c,10));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(d,'altBorderDeltaColor',this.m_DataSource,c,null));this.BaseLoad(d,c,this);};this.CalculateLabelPos=function(s,p,o){var a=VBI.Utilities.GetMidpointForPolygon(p.pa,p.bb,o,s.GetViewport());if(a&&a.aPos){return a.aPos;}return null;};this.LassoSelect=this.LassoSelectCircle;this.RenderInstance=function(n,d,p,c,a,b,s,l){var e=this.m_Scene;var f;var z=e.GetStretchFactor4Mode();var g=e.GetZoomFactor4Mode();var r=b/z[0];var x=e.GetPointFromPos(p,false);var h;var i=this.m_IO[n]=e.GetCorrectedInstanceOffsets(h=this.m_BB[n]=[x[0]-r,x[1]-r,x[0]+r,x[1]+r],g);h.m_Radius=r;h.m_Pos=x;if(this.IsPosChangeable(e.m_Ctx)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x);}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(h);}}d.lineWidth=1;d.fillStyle=c;for(f=0;f<i.length;++f){d.setTransform(1,0,0,1,i[f],0);d.beginPath();d.arc(x[0],x[1],r,0,2*Math.PI);d.closePath();d.fill();d.strokeStyle=a;d.stroke();if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n]);}}d.setTransform(1,0,0,1,0,0);if(l&&i.length){var j=[];var k=20;for(f=0;f<k;++f){var t=f*2*Math.PI/k;var m=x[0]+r*Math.sin(t);var o=x[1]+r*Math.cos(t);j.push(m,o);}var q={pa:j,bb:[[h[0],h[1]],[h[2],h[3]]]};this.m_Label.push(new VBI.Label(l,n,this.CalculateLabelPos,q,null,i));}};this.Init4Render=this.StandardInit;this.Render=function(c,d,a){var b=this.m_Scene.m_Ctx;var e=0;var n;if((n=this.m_DataSource.GetCurrentNode(b))){e=n.m_dataelements.length;for(var f=0;f<e;++f){this.m_DataSource.Select(f);var h=this.IsHot(f);var S=this.IsSelected(b);var p=this.m_Pos.GetValueVector(b);var g=this.m_Color.GetValueColor(b);if(S){g=this.GetSelectColor(b,g);}if(h){g=this.GetHotColor(b,g);}var i=this.m_ColorBorder.GetValueColor(b);if(S){i=this.GetSelectColor(b,i);}if(h){i=this.GetAltBorderColor(b,i);}var r=this.m_Radius.GetValueFloat(b);if(h){r=(this.GetHotScale(b))[0]*r;}var s=this.m_Slices.GetValueLong(b);this.RenderInstance(f,d,p,g,i,r,s,this.GetLabel(b));this.SetRichTooltip(h);}}this.BaseRender(c,d);return e;};this.DetailHitTest=function(o,n,a,b){var c=this.m_BB[n];var r=c.m_Radius;var x=c.m_Pos;var t,d;if(((t=(x[0]-a))*t+(d=(x[1]-b))*d)<r*r){return{m_hit:1};}return null;};this.GetHitArray=function(x,y,a){var z=this.m_Scene.GetStretchFactor4Mode();var o={m_cb:this.DetailHitTest.bind(this),m_zf:z,m_All:a};var n=x/z[0];var b=y/z[1];return this.BaseHitTest(n,b,o);};this.DesignGetActiveBoxHandles=function(i){var s=this.m_Scene;this.m_DataSource.Select(i);return this.m_Radius.IsChangeable(s.m_Ctx)?[0,1,0,1,0,1,0,1,0]:[0,0,0,0,0,0,0,0,0];};this.DesignBoxSize=VBI.Utilities.SceneBindRadiusDesignBoxSize.bind(this);};VBI.VisualObjects.Circle.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.CircleDist=function(){this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'midpoint',this.m_DataSource,c));this.m_Props.push(this.m_ColBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(d,'radius',this.m_DataSource,c,10));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_ColFill=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_Slices=new VBI.AttributeProperty(d,'slices',this.m_DataSource,c,10));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(d,'altBorderDeltaColor',this.m_DataSource,c,null));this.BaseLoad(d,c,this);};this.CalculateLabelPos=function(s,p,o){var a=VBI.Utilities.GetMidpointForPolygon(p.pa,p.bb,o,s.GetViewport());if(a&&a.aPos){return a.aPos;}return null;};this.LassoSelect=function(p,h,o){var c=[];var O,t;var f=false;for(var n=this.m_LP.length-1;n>=0;--n){var a=[];if(this.m_BB[n].m_bArcCircle){var x=this.m_BB[n].m_Pos;var r=this.m_BB[n].m_Radius;var b=20;for(var d=0;d<b;++d){t=d*2*Math.PI/b;c=[x[0]+r*Math.sin(t),x[1]+r*Math.cos(t)];a.push(c);}}else{a=this.m_LP[n];}O=this.m_IO[n];if(VBI.Utilities.polyInPolygon(p,a,O)){o.push(n);h.push(n);f=true;}}return f;};this.RenderCircleDist=function(n,d,a,c,b){var s=this.m_Scene;var l=this.m_LP[n];if(l.length){l=null;}var t,e,x,f=s.GetPointFromGeo(a[0],false);var A=false;var g,h;var i=this.m_Scene.m_Ctx;var p=this.m_Pos.GetValueVector(i);var r=this.m_Radius.GetValueFloat(i);A=(Math.abs(p[1]-45)<=10&&r<=10000)?true:false;if(A){var j=0;g=s.GetPointFromGeo(VBI.MathLib.DegToRad(p),false);for(var k=0;k<a.length;++k){x=s.GetPointFromGeo(a[k],false);j+=Math.sqrt((x[0]-g[0])*(x[0]-g[0])+(x[1]-g[1])*(x[1]-g[1]));}h=j/a.length;var m=this.m_BB[n];m[1]=g[1]-h;m[3]=g[1]+h;m.m_Radius=h;m.m_Pos=g;m.m_bArcCircle=true;}d.strokeStyle=b;d.fillStyle=c;d.lineWidth=1;d.beginPath();if(!A){d.moveTo(f[0],f[1]);if(l){l.push(f);}for(var o=1;o<a.length;++o){x=s.GetPointFromGeo(a[o],false);if(((t=(f[0]-x[0]))*t+(e=(f[1]-x[1]))*e)<9.0){continue;}if(l){l.push(x);}d.lineTo(x[0],x[1]);f=x;}d.closePath();}else{d.arc(g[0],g[1],h,0,2*Math.PI);}d.stroke();d.fill();};this.RenderInstance=function(n,d,p,c,a,r,s,l){var b,e=this.m_Scene;var z=e.GetZoomFactor4Mode();var f=this.m_Scene.m_Canvas[0].m_nExactLOD;var g=Math.sqrt(f);var h=Math.log(r);var i=1/h;var j=2*Math.PI/i;s=(j>s)?j:s;var k=s*g;k=(k<7)?7:k;k=(k>500)?500:k;var m=VBI.MathLib.EquidistantLonLat(VBI.MathLib.DegToRad(p),r,k);if(this.m_Pos.IsChangeable(e.m_Ctx)){(this.m_DH[n]=[e.GetPointFromPos(p,false)]);}var o=e.GetPointFromGeo([m.m_MinX,m.m_MaxY,0.0],false);var q=e.GetPointFromGeo([m.m_MaxX,m.m_MinY,0.0],false);var I=this.m_IO[n]=e.GetCorrectedInstanceOffsets(b=this.m_BB[n]=[o[0],o[1],q[0],q[1]],z);if(this.IsPosChangeable(e.m_Ctx)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(e.GetPointFromPos(p,false));}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(b);}}for(var t=0;t<I.length;++t){d.setTransform(1,0,0,1,I[t],0);this.RenderCircleDist(n,d,m,c,a);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n]);}}d.setTransform(1,0,0,1,0,0);if(l&&I.length){var u=[];for(var w=0;w<this.m_LP[n].length;++w){u.push(this.m_LP[n][w][0],this.m_LP[n][w][1]);}var x={pa:u,bb:[o,q]};this.m_Label.push(new VBI.Label(l,n,this.CalculateLabelPos,x,null,I));}};this.Init4Render=this.StandardInitWithLPs;this.Render=function(c,d,a){var b=this.m_Scene.m_Ctx;var n;if((n=this.m_DataSource.GetCurrentNode(b))){for(var e=0,l=n.m_dataelements.length;e<l;++e){this.m_DataSource.Select(e);var h=this.IsHot(e);var S=this.IsSelected(b);var p=this.m_Pos.GetValueVector(b);var f=this.m_ColBorder.GetValueColor(b);if(S){f=this.GetSelectColor(b,f);}if(h){f=this.GetAltBorderColor(b,f);}var r=this.m_Radius.GetValueFloat(b);if(h){r=(this.GetHotScale(b))[0]*r;}var s=this.m_Slices.GetValueLong(b);var g=this.m_ColFill.GetValueColor(b);if(S){g=this.GetSelectColor(b,g);}if(h){g=this.GetHotColor(b,g);}this.m_LP[e]=[];this.RenderInstance(e,d,p,g,f,r,s,this.GetLabel(b));this.SetRichTooltip(h);}}this.BaseRender(c,d);};this.DetailHitTest=function(o,n,a,b){var c=this.m_BB[n];if(c.m_bArcCircle){var r=c.m_Radius;var x=c.m_Pos;var t,d;if(((t=(x[0]-a))*t+(d=(x[1]-b))*d)<r*r){return{m_hit:1};}return null;}else{return VBI.Utilities.pointInPolygon(this.m_LP[n],a,b)?{m_hit:1}:null;}};this.GetHitArray=function(x,y,a){var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var b=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_zf:z,m_All:a};return this.BaseHitTest(n,b,o);};this.DesignGetActiveBoxHandles=function(i){var s=this.m_Scene;this.m_DataSource.Select(i);return this.m_Radius.IsChangeable(s.m_Ctx)?[0,1,0,1,0,1,0,1,0]:[0,0,0,0,0,0,0,0,0];};this.DesignBoxSize=VBI.Utilities.SceneBindMeterRadiusDesignBoxSize.bind(this);};VBI.VisualObjects.CircleDist.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.m_AC=["rgba(0,143,211,1.0)","rgba(153,209,1,1.0)","rgba(243,155,2,1.0)","rgba(159,207,236,1.0)","rgba(75,167,7,1.0)","rgba(246,209,51,1.0)","rgba(203,77,44,1.0)","rgba(202,199,186,1.0)","rgba(13,134,156,1.0)","rgba(205,215,46,1.0)","rgba(36,114,48,1.0)","rgba(108,222,220,1.0)","rgba(235,115,0,1.0)","rgba(185,187,209,1.0)","rgba(0,109,211,1.0)","rgba(61,185,127,1.0)","rgba(165,84,148,1.0)","rgba(1,88,43,1.0)","rgba(77,182,239,1.0)","rgba(175,43,23,1.0)","rgba(212,153,18,1.0)","rgba(187,204,210,1.0)","rgba(48,146,13,1.0)","rgba(29,169,193,1.0)","rgba(42,71,201,1.0)","rgba(209,153,194,1.0)","rgba(204,88,38,1.0)","rgba(114,191,68,1.0)","rgba(10,72,157,1.0)","rgba(151,156,163,1.0)","rgba(14,145,144,1.0)","rgba(97,32,154,1.0)"];VBI.VisualObjects.Pie=function(){this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Series=new VBI.NodeProperty(d,'series',this.m_DataSource,c));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_Values=new VBI.AttributeProperty(d,'value',this.m_Series,c));this.m_Props.push(this.m_Texts=new VBI.AttributeProperty(d,'text',this.m_Series,c));this.m_Props.push(this.m_SliceColor=new VBI.AttributeProperty(d,'slicecolor',this.m_Series,c));this.m_Props.push(this.m_Tooltips=new VBI.AttributeProperty(d,'extooltip',this.m_Series,c,this.m_defaultTooltip));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_StartColor=new VBI.AttributeProperty(d,'startcolor',this.m_DataSource,c,0));this.BaseLoad(d,c,this);};this.LassoSelect=this.LassoSelectCircle;this.RenderInstance=function(n,d,p,r,a,t,c,b,s){var e=this.m_Scene;var z=e.GetZoomFactor4Mode();var f=e.m_Ctx;var g=0;var h;for(h=0;h<a.length;++h){g+=a[h];}this.m_SUM[n]=g;var x=e.GetPointFromPos(p,false);var i;var I=this.m_IO[n]=e.GetCorrectedInstanceOffsets(i=this.m_BB[n]=[x[0]-r,x[1]-r,x[0]+r,x[1]+r],z);i.m_Radius=r;i.m_Pos=x;if(this.IsPosChangeable(f)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x);}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(i);}}this.m_ARC[n]=[3*Math.PI/2];var j=this.m_StartColor.GetValueLong(f);var k=VBI.VisualObjects.m_AC.length;for(var l=0;l<I.length;++l){d.setTransform(1,0,0,1,I[l],0);var m=3*Math.PI/2;for(h=0;h<a.length;++h){var o=d.createRadialGradient(x[0],x[1],0,x[0],x[1],r);var q=c[h];if(!q){q=VBI.VisualObjects.m_AC[(h+j)%k];}if(s){q=this.GetSelectColor(f,q);}if(h==b){q=this.GetHotColor(f,q);}o.addColorStop(0,q);o.addColorStop(0.95,q);o.addColorStop(1.0,'rgba(255,255,255,0.0 )');d.fillStyle=o;d.beginPath();d.moveTo(x[0],x[1]);var u=Math.PI*2*(a[h]/g);d.arc(x[0],x[1],r,m,m+u,false);d.lineTo(x[0],x[1]);d.closePath();d.fill();m+=u;if(!l){this.m_ARC[n].push(m);}}}d.setTransform(1,0,0,1,0,0);};this.Init4Render=function(){this.m_BB=[];this.m_IO=[];this.m_DH=[];this.m_ARC=[];this.m_SUM=[];};this.Render=function(c,d,a){var s=this.m_Scene;var b=s.m_Ctx;var e=0;var n,f;if((n=this.m_DataSource.GetCurrentNode(b))){e=n.m_dataelements.length;for(var g=0;g<e;++g){this.m_DataSource.Select(g);var p=this.m_Pos.GetValueVector(b);var S=this.m_Scale.GetValueVector(b);var r=16*S[0];var h=this.IsHot(g);var i=this.IsSelected(b);if(h){r=(this.GetHotScale(b))[0]*r;}var V=[],t=[],j=[];if((f=this.m_Series.GetCurrentNode(b))){for(var k=0;k<f.m_dataelements.length;++k){this.m_Series.Select(k);V.push(this.m_Values.GetValueFloat(b));t.push(this.m_Texts.GetValueString(b));var l=this.m_SliceColor.GetValueString(b);j.push(l?this.m_SliceColor.GetValueColor(b):l);}}var m,o=(h&&(m=s.m_HotItem.m_HitObj)&&(m=m.m_Detail))?m.m_slice:-1;this.RenderInstance(g,d,p,r,V,t,j,o,i);this.SetRichTooltip(h);}}this.BaseRender(c,d);return e;};this.DetailHitTest=function(o,n,a,b){var c=this.m_BB[n];var r=c.m_Radius;var p=c.m_Pos;var t,d;if(((t=(p[0]-a))*t+(d=(p[1]-b))*d)<(r*r)){var e=Math.acos(d/Math.sqrt(t*t+d*d));var f=(t<=0?3*Math.PI/2+e:7*Math.PI/2-e);var m=this.m_ARC[n];var l=0,h=m.length-1,g;while(h>l+1){g=Math.round((l+h)/2);if(m[g]>f){h=g;}else{l=g;}}return{m_hit:1,m_slice:l};}return null;};this.GetHitArray=function(x,y,a){var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var b=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_All:a};return this.BaseHitTest(n,b,o);};this.doFormatedReplaces=function(m,s,e,a){var l=s.length;var n;while((n=m.indexOf(s))>=0){var b=n+m.substring(n+l).indexOf(e)+l+1;var f=m.substring(n+l,b-1);var u=false,c;if((c=f.indexOf(","))>=0){u=true;}else{c=f.indexOf(".");}var d=Math.min(10,(c>=0?parseInt(f.substring(c+1),10):0));var g=m.substring(n,b);var h=""+a.toFixed(d);if(u){h=h.replace(".",",");}m=m.replace(g,h);}return m;};this.getTooltip=function(c,h){var p=h.m_Index;var i=h.m_Detail.m_slice;this.m_DataSource.Select(p);this.m_Series.Select(i);var t=this.m_Tooltips.GetValueString(c);if(t==""){t=this.m_Tooltip.GetValueString(c);}if((t===null)||(t==="")){return"";}t=t.replace(/%MAIN%/,this.m_Tooltip.GetValueString(c));t=t.replace(/%NUM%/g,i+1);t=t.replace(/%ONUM%/g,i+1);t=t.replace(/%NAME%/g,this.m_Texts.GetValueString(c));var a=parseFloat(this.m_Values.GetValueString(c));t=this.doFormatedReplaces(t,"%VALUE","%",a);t=this.doFormatedReplaces(t,"%PERCENTAGE","%",100*a/this.m_SUM[p]);return t;};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0);if(o.m_IO){(o.m_DhOrig[0])[0]+=o.m_IO;(o.m_DhOrig[0])[2]+=o.m_IO;}};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,true);};VBI.VisualObjects.Pie.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Box=function(){this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c,[0.0,0.0,0.0]));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(d,'altBorderDeltaColor',this.m_DataSource,c,null));this.BaseLoad(d,c,this);};this.RenderInstance=function(n,d,p,s,c,a,e){var g,h=this.m_Scene;var z=h.GetZoomFactor4Mode();var i=h.GetStretchFactor4Mode();if(!s){s=[1.0,1.0,1.0];}if(!c){c="#6f6f7a";}var x=h.GetPointFromPos(p,false);var j=1.0;var k=1.0;if(this.IsHot(n)){var m=this.GetHotScale(h.m_Ctx);j=m[0];k=m[1];}var o=370;var q=o*s[0]*j/i[0];var u=o*s[1]*k/i[1];if(!e){var f=Math.pow(2,h.GetCurrentZoomlevel())/14.6;q*=f;u*=f;}var l=x[0]-q/2;var t=x[1]-u/2;var r=x[0]+q/2;var b=x[1]+u/2;var I=this.m_IO[n]=h.GetCorrectedInstanceOffsets(g=this.m_BB[n]=[l,t,r,b],z);if(this.IsPosChangeable(h.m_Ctx)){var D=(this.m_DH[n]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;D.push(x);}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(g);}}for(var w=0;w<I.length;++w){d.setTransform(1,0,0,1,I[w],0);d.fillStyle=c;d.fillRect(l,t,q,u);d.lineWidth=1;d.strokeStyle=a;d.strokeRect(l,t,q,u);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[n]);}}d.setTransform(1,0,0,1,0,0);};this.Init4Render=this.StandardInit;this.Render=function(c,d,a){var s=this.m_Scene,b=s.m_Ctx;var e=0;var n;if((n=this.m_DataSource.GetCurrentNode(b))){e=n.m_dataelements.length;for(var f=0;f<e;++f){this.m_DataSource.Select(f);var h=this.IsHot(f);var S=this.IsSelected(b);var p=this.m_Pos.GetValueVector(b);var g=this.m_Scale.GetValueVector(b);var C=this.m_Color.GetValueColor(b);if(S){C=this.GetSelectColor(b,C);}if(h){C=this.GetHotColor(b,C);}var i=this.m_ColorBorder.GetValueColor(b);if(S){i=this.GetSelectColor(b,i);}if(h){i=this.GetAltBorderColor(b,i);}var F=this.m_FxSize.GetValueBool(b);this.RenderInstance(f,d,p,g,C,i,F);this.SetRichTooltip(h);}}this.BaseRender(c,d);return e;};this.DetailHitTest=function(o,n,a,b){return{m_hit:1};};this.GetHitArray=function(x,y,a){var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var b=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_All:a};return this.BaseHitTest(n,b,o);};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0);if(o.m_IO){(o.m_DhOrig[0])[0]+=o.m_IO;(o.m_DhOrig[0])[2]+=o.m_IO;}};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,false);};VBI.VisualObjects.Box.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Area=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));if(typeof(d["posarraymulti.bind"])==="string"||typeof(d["posarraymulti"])==="string"){this.m_Props.push(this.m_PosM=new VBI.AttributeProperty(d,'posarraymulti',this.m_DataSource,c));this.m_Pos=null;}else{this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'posarray',this.m_DataSource,c));this.m_PosM=null;}this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,null));this.m_Props.push(this.m_BorderDash=new VBI.AttributeProperty(d,'borderDash',this.m_DataSource,c,null));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_AltColorBorder=new VBI.AttributeProperty(d,'altBorderDeltaColor',this.m_DataSource,c,null));this.BaseLoad(d,c,this);};this.LassoSelect=function(p,h,o){var e=false;var s,a;var f=false;for(var n=this.m_LP.length-1;n>=0;--n){s=this.m_LP[n];e=false;for(var b=0;b<s.length;++b){a=s[b];if(jQuery.type(a[0])=='array'&&jQuery.type(a[0][0])=='array'){a=a[0];}if(!(e=VBI.Utilities.polyInPolygon(p,a,this.m_IO[n]))){break;}}if(e){h.push(n);o.push(n);f=true;}}return f;};this.RenderArea=function(a,d,p,c,b,e,l,h){var s=l*l/2;var i,x,t,f;var g=this.m_Scene;var n=g.m_CacheVars;if(p[0].length<6){return;}var L=this.m_LP[a];if(L.length){L=null;}var j=d.setLineDash?true:false;var k=false;var m=this.m_Scene.m_Canvas[0].m_nExactLOD;if(j&&e&&(VBI.m_bIsIDevice||VBI.m_bIsAndroid||m==Math.floor(m)||m<=(this.m_Scene.m_CacheVars.minLOD+0.01))){var o=e.split(";");d.setLineDash(o);k=true;}d.strokeStyle=(b)?b:c;d.fillStyle=c;d.lineWidth=h>-1?2:l;d.lineCap='round';var q=n.factX;var r=n.factY;var u=n.addX;var w=n.addY;d.beginPath();for(var y=0,z=p.length;y<z;++y){var A=[p[y][0]*q+u,p[y][1]*r+w];if(L){L.push([]);L[y].push(A);}d.moveTo(A[0],A[1]);var B=p[y].length;for(i=3;i<B;i+=3){x=[p[y][i]*q+u,p[y][i+1]*r+w,0.0];if(((t=(A[0]-x[0]))*t+(f=(A[1]-x[1]))*f)<s){continue;}d.lineTo(x[0],x[1]);if(L){L[y].push(x);}A=x;}}d.closePath();d.fill();d.stroke();if(k){d.setLineDash([]);}};this.CalculateLabelPos=function(s,p,o){var z=s.GetStretchFactor4Mode();var r=s.GetInternalDivClientRect();var a=r.width/z[0];var b=r.height/z[1];var P=s.m_Canvas[0].getPixelLeft()/z[0];var c=s.m_Canvas[0].getPixelTop()/z[1];var d=[-P,-c,-P+a,-c+b];var e=VBI.Utilities.GetMidpointsForPolygon(p.pa,p.bb,o,d);if(e&&e.aPos){return e.aPos;}return null;};this.ExtendBB=function(t,b){if(t[0]>b[0]){t[0]=b[0];}if(t[1]>b[1]){t[1]=b[1];}if(t[2]<b[2]){t[2]=b[2];}if(t[3]<b[3]){t[3]=b[3];}};this.IsPosChangeable=function(c){if(!VBI.m_bMouseSupported){return false;}if(this.m_PosM){return this.m_PosM.IsChangeable(c);}else{return Object.getPrototypeOf(this).IsPosChangeable.call(this,c);}};this.CalcExcludeAreaMinLod=function(s,m,l,a){var b=s.GetNearestPosArray(m);var c=s.GetPointFromPos([b.m_MinX,b.m_MaxY,0.0],false);var r=s.GetPointFromPos([b.m_MaxX,b.m_MinY,0.0],false);return this.CalcAreaMinLod(c,r,l,a);};this.RenderShape=function(a,d,p,c,b,e,l,h,f,g){var s=this.m_Scene;var E=false,i;if(typeof(p[0])==="number"){i=p;}else{i=p[0];E=true;}var z=s.GetZoomFactor4Mode();var n=s.m_CacheVars;if(i.cache==undefined){s.FillPositionCache(i);}var j=2.1;if(i.cache.minLod>g-j){return;}var k=[(i.cache.lt[0]*n.completeX-n.ox)*n.fx,(i.cache.lt[1]*n.completeY-n.oy)*n.fy];var r=[(i.cache.rb[0]*n.completeX-n.ox)*n.fx,(i.cache.rb[1]*n.completeY-n.oy)*n.fy];var B,I=s.GetCorrectedInstanceOffsets(B=[k[0]-l,k[1]-l,r[0]+l,r[1]+l],z);if(this.m_BB[a]){this.ExtendBB(this.m_BB[a],B);this.m_IO[a]=s.GetCorrectedInstanceOffsets(this.m_BB[a],z);}else{this.m_IO[a]=I;this.m_BB[a]=B;}var m;var o=null;if(I.length){o=[];o.push(i.cache.data);if(E){for(var q=1,t=p.length;q<t;++q){var u=p[q];if(u.cache==undefined){s.FillPositionCache(u);}if(u.cache.minLod<=g+j){o.push(u.cache.data);}}}if(this.IsPosChangeable(s.m_Ctx)){var D=(this.m_DH[a]=[]);if(this.IsHandleMode()){D.m_EditMode=VBI.EMHandle;var w=o[0].length/3;for(m=0;m<w;++m){D.push([(o[0][m*3]*n.completeX-n.ox)*n.fx,(o[0][m*3+1]*n.completeY-n.oy)*n.fy]);}}else if(this.IsBoxMode()){D.m_EditMode=VBI.EMBox;D.push(this.m_BB[a]);}}for(m=0;m<I.length;++m){d.setTransform(1,0,0,1,I[m],0);this.RenderArea(a,d,o,c,b,e,l,h);if(VBI.m_bTrace){VBI.Utilities.DrawFrameRect(d,"red",this.m_BB[a]);}}d.setTransform(1,0,0,1,0,0);if(f){var x=s.GetShortPointArrayFromUCSArray(i.cache.data);var y={pa:x,bb:[k,r]};this.m_Label.push(new VBI.Label(f,a,this.CalculateLabelPos,y,null,I));}}};this.RenderInstance=function(n,d,h,c,s,b){this.m_LP[n]=[];var e=this.m_Scene;var f=-1;var g=this.m_Color.GetValueColor(c);var i=this.m_ColorBorder.GetValueColor(c);var j=this.m_BorderDash.GetValueString(c);if(s){g=this.GetSelectColor(c,g);i=this.GetAltBorderColor(c,i);}else if(this.GetNumActiveSelections(c)){g=this.GetNonSelectColor(c,g);}if(h){var k=e.m_HotItem.m_HitObj.m_Detail;if(k&&k.m_edge>=0&&(this.BaseFindAction("EdgeClick")||this.BaseFindAction("EdgeContextMenu"))){f=k.m_edge;}else{g=this.GetHotColor(c,g);}i=this.GetAltBorderColor(c,i);}var p;if(this.m_Pos){p=this.m_Pos.GetValueVector(c);this.RenderShape(n,d,p,g,i,j,this.m_LineWidth,f,this.GetLabel(c),b);}else if(this.m_PosM){var a=this.m_PosM.GetValueVector(c);var m=[];for(var o=0,l=a.length;o<l;++o){this.RenderShape(n,d,a[o],g,i,j,this.m_LineWidth,f,this.GetLabel(c),b);if(this.m_LP[n].length){(m.push(this.m_LP[n]));this.m_LP[n]=[];}}this.m_LP[n]=m;}};this.Init4Render=this.StandardInitWithLPs;this.Render=function(c,d,a){var b=this.m_Scene.m_Ctx;var s=[];var n,l;var h;var e=this.m_Scene.m_Canvas[0].m_nExactLOD;if((n=this.m_DataSource.GetCurrentNode(b))){l=n.m_dataelements.length;for(var f=0;f<l;++f){this.m_DataSource.Select(f);var H=this.IsHot(f);if(H){h=f;}else if(this.IsSelected(b)){s.push(f);}else{this.RenderInstance(f,d,false,b,false,e);}this.SetRichTooltip(H);}}l=s.length;for(var i=0;i<l;i++){this.m_DataSource.Select(s[i]);this.RenderInstance(s[i],d,false,b,true,e);}if(h!=undefined){this.m_DataSource.Select(h);this.RenderInstance(h,d,true,b,this.IsSelected(b),e);}this.BaseRender(c,d);};this.DetailHitTest=function(a,n,b,c){var h=false;var l;var L=this.m_LP[n];if(jQuery.type(L[0])=='array'&&jQuery.type(L[0][0])=='array'&&jQuery.type(L[0][0][0])=='array'){l=L.length;for(var d=0;!h&&d<l;++d){L=this.m_LP[n][d];h=VBI.Utilities.pointInPolygon(L,b,c);}}else{h=VBI.Utilities.pointInPolygon(L,b,c);}if(h){var H={m_hit:1};var o;if((o=VBI.Utilities.pointOnLine(L[0],b,c,5,true))&&o.m_edge>=0){H.m_edge=o.m_edge;H.m_node=o.m_node;}return H;}return null;};this.GetHitArray=function(x,y,a){var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var b=y/z[1];var o={m_cb:this.DetailHitTest.bind(this),m_All:a};return this.BaseHitTest(n,b,o);};this.ProcessDetailNodeEdgeEvent=function(e,a,h,n){var s=this.m_Scene,b=s.m_Ctx.m_Actions;if(b){var c;if((c=b.findAction(n,s,this))){var p=s.GetEventVPCoordsObj(e);p.edge=h.m_Detail.m_edge.toString();p.node=h.m_Detail.m_node.toString();this.m_Scene.m_Ctx.FireAction(c,s,this,a,p);return true;}}return false;};this.DetailClick=function(e,a,h){if(h.m_Detail&&(h.m_Detail.m_edge>=0)){return this.ProcessDetailNodeEdgeEvent(e,a,h,'EdgeClick');}return false;};this.DetailContextmenu=function(e,a,h){if(h.m_Detail&&(h.m_Detail.m_edge>=0)){return this.ProcessDetailNodeEdgeEvent(e,a,h,'EdgeContextMenu');}return false;};this.DesignBoxSize=VBI.Utilities.SceneBindPosArrayDesignBoxSize.bind(this);};VBI.VisualObjects.Area.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.HeatMap=function(){this.load=function(d,c){jQuery.sap.require("sap.ui.vbm.lib.sapheatmap");Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_Value=new VBI.AttributeProperty(d,'value',this.m_DataSource,c,1));this.m_Props.push(this.m_Opacity=new VBI.AttributeProperty(d,'opacity',this.m_DataSource,c,0.5));this.m_Props.push(this.m_Gradient=new VBI.AttributeProperty(d,'gradient',this.m_DataSource,c,""));this.m_Props.push(this.m_Radius=new VBI.AttributeProperty(d,'radius',this.m_DataSource,c,5));this.m_Props.push(this.m_Behavior=new VBI.AttributeProperty(d,'behavior',this.m_DataSource,c,2));this.m_Props.push(this.m_RScale=new VBI.AttributeProperty(d,'radiusScale',this.m_DataSource,c,1.0));this.m_Props.push(this.m_VScale=new VBI.AttributeProperty(d,'valueScale',this.m_DataSource,c,1.0));this.m_Props.push(this.m_AExp=new VBI.AttributeProperty(d,'alphaExponent',this.m_DataSource,c,1.0));this.m_Props.push(this.m_CExp=new VBI.AttributeProperty(d,'colorExponent',this.m_DataSource,c,1.0));var g=(jQuery.type(this.m_Gradient.m_Value)=='array');this.GradientImage=new Image();this.GradientImage.onload=function(){this.GradientImage.IsLoaded=true;}.bind(this);if(g){this.m_GeneratedGradient=this.GenerateGradient(this.m_Gradient.m_Value);this.GradientImage.src=this.m_GeneratedGradient;}else{this.GradientImage.src=c.GetResources().GetData(this.m_Gradient.GetValueString(c));}this.cache=undefined;this.BaseLoad(d,c,this);};this.SetColor=function(c,p,m,a,b,d){var j=4*p;c[j]=a[0]*m+d[0]*b;c[j+1]=a[1]*m+d[1]*b;c[j+2]=a[2]*m+d[2]*b;c[j+3]=a[3]*m+d[3]*b;};this.SetColor1=function(c,p,a){var j=4*p;c[j]=a[0];c[j+1]=a[1];c[j+2]=a[2];c[j+3]=255;};this.GenerateGradient=function(c){var a=c.length/2;var b=c[2*(a-1)];var d=this.m_Scene.m_TargetName+"-"+this.m_Scene.m_ID+"-";var t=VBI.Utilities.CreateGeoSceneCanvas(d+"temporary",b,1,0,false);var e=t.getContext("2d");var f=[];e.lineWidth=1;var i;for(i=0;i<a;++i){e.fillStyle=c[2*i+1];e.fillRect(c[2*i],0,1,1);var D=e.getImageData(c[2*i],0,1,1);f.push(D.data);}var w=e.getImageData(0,0,b,1);for(i=1;i<a;++i){var g=f[i-1];var h=VBI.Utilities.RGB2HLS(g[0],g[1],g[2]);var k=h[0];var l=h[1];var s=h[2];var m=c[2*(i-1)],n=c[2*i],o=n-m;var p=f[i];var q=VBI.Utilities.RGB2HLS(p[0],p[1],p[2]);var r=q[0];var u=(r-k)/o;for(var j=m;j<=n;++j){var x=VBI.Utilities.HLS2RGB(k+(j-m)*u,l,s);this.SetColor1(w.data,j,x);}}e.putImageData(w,0,0);return t.toDataURL("png");};this.CollectData=function(c){var s=this.m_Scene;var n,V=[],r=[],p=[];var m=[];var d=0;if((n=this.m_DataSource.GetCurrentNode(c))){for(var e=0,l=n.m_dataelements.length;e<l;++e){this.m_DataSource.Select(e);var f=this.m_Pos.GetValueVector(c);m.push({x:f[0],y:f[1],r:this.m_Radius.GetValueFloat(c),v:this.m_Value.GetValueFloat(c)});}m.sort(function(a,b){return a.x-b.x;});for(var g=0;g<m.length;++g){var h=m[g];V.push(h.v);r.push(h.r);p.push(h.x,h.y,0);if(h.r>d){d=h.r;}}}s.FillPositionCache(p,true);this.cache=p.cache;this.cache.val=V;this.cache.rad=r;this.cache.maxRad=d;};this.Init4Render=function(){this.m_IO=[];};this.AddPoints2Heatmap=function(h,V,e,c,f){var a=h.m_V;var s=this.m_Scene;h.Clear();var b,d;var g=h.m_W;var i=h.m_H;var m=(e*V.maxRad/c)/2.0;var p=s.GetPointArrayFromUCSArray(V.data);for(var n=0;n<this.m_IO.length;++n){var l=V.data.length;var o=this.m_IO[n];var x=p[0]+o,j=p[l-3]+o;var t=0,k=l/3,q=0,r=0,u;if(x<=-m&&j>-m){t=l/3;while(t>q+1){u=Math.floor((q+t)/2);if(p[3*u]+o<=-m){q=u;}else{t=u;}}}if(x>i+m&&j<=i+m){while(k>r+1){u=Math.floor((r+k)/2);if(p[3*u]+o<=i+m){r=u;}else{k=u;}}}for(var w=3*t,y=t;y<k;w+=3,y++){var z=p[w]+o;var A=p[w+1];d=(e*V.rad[y]/c)/2.0;if((A>-d)&&(z<g+d)){b=f*(V.val[y])/50;a.AddPoint(z,A,b,d);}}}a.m_PointsSet=true;};this.Render=function(c,d){var s=this.m_Scene;var b=s.m_Ctx;var e=c.clientWidth;var f=c.clientHeight;var w=s.m_nWidthCanvas;var h=s.m_nHeightCanvas;var g=this.m_GeneratedGradient?this.m_GeneratedGradient:b.GetResources().GetData(this.m_Gradient.GetValueString(b));if(this.HeatmapWidth!=w||this.HeatmapHeight!=h){var i=document.createElement("canvas");i.width=2*w;i.height=2*h;this.Heatmap=VBI.CreateHM({canvas:i,colorTexture:g,colorTex:this.GradientImage,alpha:true,width:2*w,height:2*h,scene:this.m_Scene,aFunc:this.m_AExp.GetValueFloat(b),cFunc:this.m_CExp.GetValueFloat(b)});this.HeatmapWidth=w;this.HeatmapHeight=h;}var j=this.Heatmap;if(!this.cache){this.CollectData(b);}var l=s.GetPointFromUCSPoint([this.cache.lt[0],this.cache.lt[1]]);var r=s.GetPointFromUCSPoint([this.cache.rb[0],this.cache.rb[1]]);var z=s.GetZoomFactor4Mode();this.m_IO=s.GetCorrectedInstanceOffsets([l[0],l[1],r[0],r[1]],z);var k=this.m_RScale.GetValueFloat(b);var F=this.m_VScale.GetValueFloat(b);var m=this.m_Behavior.GetValueFloat(b);var n=s.m_Canvas[0].m_nExactLOD;var o=Math.floor(n);var p=(s.m_bObjCanvasMode==0?Math.pow(2,n-o):1.0)/k;var q=1.0;if(m>0){q=1+s.m_Canvas[0].m_nExactLOD;if(m==2){q=Math.pow(2,q);}}this.AddPoints2Heatmap(j,this.cache,q,p,F);j.Render();var a=d.globalAlpha;d.globalAlpha=this.m_Opacity.GetValueFloat(b);d.drawImage(j.m_Canv,0,0,e,f,0,0,e,f);d.globalAlpha=a;};this.DetailHitTest=function(o,n,a,b){return null;};this.GetHitArray=function(x,y){var z=this.m_Scene.GetStretchFactor4Mode();var n=x/z[0];var a=y/z[1];var o={m_cb:this.DetailHitTest.bind(this)};return this.BaseHitTest(n,a,o);};this.DesignBeginDrag=function(o){o.m_ScaleOrig=this.m_Scale.GetValueVector(this.m_Scene.m_Ctx).slice(0);o.m_DhOrig=this.m_DH[o.m_Index].slice(0);if(o.m_IO){(o.m_DhOrig[0])[0]+=o.m_IO;(o.m_DhOrig[0])[2]+=o.m_IO;}};this.DesignBoxSize=VBI.Utilities.SceneBindDesignBoxBoxSize.bind(this,true);};VBI.VisualObjects.HeatMap.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Container=function(){this.m_Sub=[];this.m_bContainer=true;this.m_openWin=[];this.m_Marker=1;this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c));this.m_Props.push(this.m_Key=new VBI.AttributeProperty(d,'key',this.m_DataSource,c,""));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,""));this.m_Props.push(this.m_Alignment=new VBI.AttributeProperty(d,'alignment',this.m_DataSource,c,"0"));this.m_Sub.push(this.m_Scene.m_EvtCont.subscribe("onMove",this.onLayout.bind(this)));this.m_bChanged=true;};this.clear=function(){for(var n=0,l=this.m_Sub.length;n<l;++n){this.m_Sub[n].unsubscribe();}this.m_Sub=[];this.m_Marker++;this.sweepContainers(this.m_Scene.m_Ctx);Object.getPrototypeOf(this).clear.call(this);};this.getParentDiv=function(){return this.m_Scene.m_MapsLayerDiv;};this.sweepContainers=function(c){for(var k in this.m_openWin){if(this.m_openWin[k].Marker!=this.m_Marker){var a=this.m_openWin[k];c.onCloseContainer(a.id,a);var p=this.getParentDiv();p.removeChild(a);delete this.m_openWin[k];}}};this.updateContainers=function(c,s,a){var d=this.getParentDiv();var x=c.getPixelLeft();var y=c.getPixelTop();var l,n;var b;if((b=this.m_DataSource.GetCurrentNode(a))){l=b.m_dataelements.length;for(n=0;n<l;++n){this.m_DataSource.Select(n);var p=this.m_Pos.GetValueVector(a);var k=this.m_Key.GetValueString(a);var t=this.m_Tooltip.GetValueString(a);var e=s.GetPointFromPos(p,false);var f=this.m_openWin[k];if(f){if(!f.children.length){a.onOpenContainer(k,f);}}else{f=VBI.Utilities.CreateContainer("vbi_"+k,k,x+(e[0]|0),y+(e[1]|0),"50px","30px",t);f.addEventListener("mouseover",this.onMouseOverDiv.bind(f));f.addEventListener("mouseout",this.onMouseOutDiv.bind(f));f.m_ID=this.m_ID;this.m_openWin[k]=f;this.m_openWin[k].index=n;d.appendChild(f);a.onOpenContainer(k,f);}this.m_openWin[k].Marker=this.m_Marker;}}this.sweepContainers(a);};this.onMouseOverDiv=function(){this.bIsHot=true;};this.onMouseOutDiv=function(){this.bIsHot=false;};this.onLayout=function(o){var s=this.m_Scene;var c=s.m_Canvas[s.m_nOverlayIndex];this.clusterParams=this.GetClusterPosParameters();var e=s.m_Canvas[0].m_nExactLOD;if(!this.m_LastCanvasPos||this.m_LastCanvasPos[2]!=e){return;}var d=[c.getPixelLeft()-this.m_LastCanvasPos[0],c.getPixelTop()-this.m_LastCanvasPos[1]];for(var k in this.m_openWin){var a=this.m_openWin[k];if(d[0]){var n=parseFloat(a.style.left)+d[0];n+=this.findRoundWorldOffset(n);a.style.left=(n)+"px";}if(d[1]){a.style.top=(parseInt(a.style.top,10)+d[1])+"px";}}this.m_LastCanvasPos=[c.getPixelLeft(),c.getPixelTop(),s.m_Canvas[0].m_nExactLOD];};this.ContainerAlign=function(c,a){var b=this.m_Alignment.GetValueString(a);var s=c.style;switch(b){case"0":s.msTransform=s.transform=s.webkitTransform="translate( -50%, -50%)";break;case"1":s.msTransform=s.transform=s.webkitTransform="translate( -50%,   0%)";break;case"2":s.msTransform=s.transform=s.webkitTransform="translate(-100%,   0%)";break;case"3":s.msTransform=s.transform=s.webkitTransform="translate(-100%, -50%)";break;case"4":s.msTransform=s.transform=s.webkitTransform="translate(-100%,-100%)";break;case"5":s.msTransform=s.transform=s.webkitTransform="translate( -50%,-100%)";break;case"6":s.msTransform=s.transform=s.webkitTransform="translate(   0%,-100%)";break;case"7":s.msTransform=s.transform=s.webkitTransform="translate(   0%, -50%)";break;default:case"8":s.msTransform=s.transform=s.webkitTransform="translate(0%, 0%)";break;}};this.RenderInstances=function(c,z){var s=this.m_Scene;var a=s.m_Ctx;if(this.m_bChanged){this.updateContainers(c,s,a);this.m_bChanged=false;}var x=c.getPixelLeft();var y=c.getPixelTop();if(this.m_DataSource.GetCurrentNode(a)){for(var k in this.m_openWin){var b=this.m_openWin[k];if(b.index==undefined){continue;}this.m_DataSource.Select(b.index);var p=this.m_Pos.GetValueVector(a);var l=s.GetPointFromPos(p,true);var d=Math.round(x+(l[0]|0)*z[0]);d=d+this.findRoundWorldOffset(d);b.style.left=d+"px";b.style.top=Math.round(y+(l[1]|0)*z[1])+"px";this.ContainerAlign(b,a);}}};this.GetClusterPosParameters=function(){var r={};var s=this.m_Scene;var e=s.m_Canvas[0].m_nExactLOD;r.worldPxOnLOD=Math.pow(2,e)*s.m_nWidthCanvas/s.m_nTilesX*s.m_Proj.m_nXYRatio;r.nLeftBorder=s.m_nDivWidth-r.worldPxOnLOD;r.nRightBorder=s.m_nDivWidth-r.nLeftBorder;return r;};this.findRoundWorldOffset=function(x){var o=0;var c=this.clusterParams;while(x+o<c.nLeftBorder){o+=c.worldPxOnLOD;}while(x+o>c.nRightBorder){o-=c.worldPxOnLOD;}return o;};this.GetClusterPosition=function(d,e,c,n,a,l,x,y){var b;var s=this.m_Scene;var X=d.canvas.getPixelLeft();var Y=d.canvas.getPixelTop();var z=s.GetCurrentZoomFactors();b=[X+z[0]*(l*e[0]-x),Y+z[1]*(l*e[1]-y)];var o=this.findRoundWorldOffset(b[0]);var f=this.m_Scene.GetZoomFactor4Mode();b[0]+=o;b[2]=o/f[0];if(e.c!=undefined&&c.anim&&(n>c.animLow)&&a&&e.c!=undefined&&e.c.lod==n-1){var g=this.m_Scene.GetStretchFactor4Mode();var E=e.c;var h=a*a;b=[X+o+z[0]*(l*(e[0]*(1-h)+E[0]*h)-x),Y+z[1]*(l*(e[1]*(1-h)+E[1]*h)-y),o/f[0]];if(c.anim==2){var i=[o+f[0]*(l*E[0]-x),f[1]*(l*E[1]-y)];var t=2*Math.abs(0.5-a);var j=""+(1-t);d.strokeStyle="rgba(110,110,110,"+j+")";d.lineWidth=2;d.lineCap='round';d.beginPath();d.moveTo((b[0]-X)/g[0],(b[1]-Y)/g[0]);d.lineTo(i[0],i[1]);d.stroke();}}return b;};this.RenderThisInstance=function(e,a,c,b,n,d,f,g,h,i,l,x,y,r){var s=this.m_Scene;var j=this.m_Scene.m_Ctx;var k=this.getParentDiv();var m=this.GetClusterPosition(f,e,c,h,i,l,x,y);var o=s.m_Ctx.m_Clustering.getClusterIdent(s.m_PreassembledData,b,d);var p=this.m_openWin[o];if(p==undefined){p=VBI.Utilities.CreateContainer("vbi_"+o,o,m[0],m[1],"50px","30px","",true);p.addEventListener("mouseover",this.onMouseOverDiv.bind(p));p.addEventListener("mouseout",this.onMouseOutDiv.bind(p));p.m_ID=this.m_ID;p.index=e.nJ;k.appendChild(p);this.m_openWin[o]=p;j.onOpenContainer(o,p);this.ContainerAlign(p,j);}else{if(p.bIsHot){this.RenderShadow(g,e,a,c,h,l,x-m[2],y);}p.style.left=Math.round(m[0])+"px";p.style.top=Math.round(m[1])+"px";}this.m_openWin[o].Marker=this.m_Marker;};this.Render=function(c,d,p,s,a,C){var b=this.m_Scene;var e=this.m_Scene.m_Ctx;var E=b.m_Canvas[0].m_nExactLOD;this.m_Marker++;this.clusterParams=this.GetClusterPosParameters();if(C){var f=0;var x=b.m_Canvas[0].m_nCurrentX*b.m_MapManager.m_tileWidth;var y=b.m_Canvas[0].m_nCurrentY*b.m_MapManager.m_tileHeight;var g=p.config;var h=p.cI;var n=p.m_TreeFatherNode;var i=Math.ceil(E);if(n){var j=this.GetAnimClusterDistance(i,E);f=this.RenderTree(n,p.m_edges,g,h,f,i,j,d,a,p.m_lodOffset,x,y,false);}else{var l=p.m_lodOffset;var k=p.length;for(var m=0;m<k;++m){var o=p[m];if(!o.b2Ignore){if(this.RenderThisInstance(o,p.m_edges,g,h,f,m,d,a,i,0,l,x,y,false)){f++;}}}}this.sweepContainers(e);}else if(this.m_DataSource.GetCurrentNode(e)){var z=this.m_Scene.GetStretchFactor4Mode();this.RenderInstances(c,[z[0],z[1]]);}var q=b.m_Canvas[b.m_nOverlayIndex];this.m_LastCanvasPos=[q.getPixelLeft(),q.getPixelTop(),E];};this.GetHitArray=function(x,y){var h=[];for(var k in this.m_openWin){var c=this.m_openWin[k];if(c&&c.bIsHot){h.push({m_Index:c.index,m_Entity:null,m_Detail:{m_hit:2},m_IO:0});}}return h;};this.onclick=function(e){return this.BaseClick(e);};};VBI.VisualObjects.Container.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Base2D=function(){this.m_DOMElement=null;this.m_paddingLeft=5;this.m_paddingTop=5;this.m_paddingRight=5;this.m_paddingBottom=5;this.IsValid=function(){if(this.m_DOMElement&&this.m_Scene.m_Div){if(this.m_DOMElement.parentNode==this.m_Scene.m_Div){return true;}}return false;};this.load=function(i,d,c){Object.getPrototypeOf(this).load.call(i,d,c);i.m_Props.push(i.m_Left=new VBI.AttributeProperty(d,'left',null,c));i.m_Props.push(i.m_Top=new VBI.AttributeProperty(d,'top',null,c));i.m_Props.push(i.m_Right=new VBI.AttributeProperty(d,'right',null,c));i.m_Props.push(i.m_Bottom=new VBI.AttributeProperty(d,'bottom',null,c));i.m_Props.push(i.m_Align=new VBI.AttributeProperty(d,'align',null,c,1));};this.clear=function(){Object.getPrototypeOf(Object.getPrototypeOf(this)).clear.call(this);this.m_DOMElement=null;};this.BaseClick=function(e){var s=this.m_Scene;var a;if((a=s.m_Ctx.m_Actions)){var b;if((b=a.findAction("Click",s,this))){s.m_Ctx.FireAction(b,s,this,null,s.GetEventVPCoordsObj(e));e.preventDefault();return true;}}return false;};};VBI.VisualObjects.Base2D.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Caption=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""));this.m_Props.push(this.m_Design=new VBI.AttributeProperty(d,'design',null,c,"0"));this.m_Props.push(this.m_Level=new VBI.AttributeProperty(d,'level',null,c,0));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""));};this.Render=function(c,d,a){if(this.IsValid()){return;}var e=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(e);var t=this.m_Top.GetValueLong(e);var r=this.m_Right.GetValueLong(e);var b=this.m_Bottom.GetValueLong(e);var f=this.m_Align.GetValueLong(e);var g=this.m_Text.GetValueString(e);var h=this.m_Design.GetValueLong(e);var i=this.m_Level.GetValueLong(e);var j=this.m_Tooltip.GetValueString(e);this.m_DOMElement=VBI.Utilities.CreateCaption(this.m_ID,g,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,j,h,i,f);this.m_Scene.m_Div.appendChild(this.m_DOMElement);};};VBI.VisualObjects.Caption.prototype=new VBI.VisualObjects.Base2D();VBI.VisualObjects.Label=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""));this.m_Props.push(this.m_Design=new VBI.AttributeProperty(d,'design',null,c,"0"));};this.Render=function(c,d,a){if(this.IsValid()){return;}var e=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(e);var t=this.m_Top.GetValueLong(e);var r=this.m_Right.GetValueLong(e);var f=this.m_Align.GetValueLong(e);var b=this.m_Bottom.GetValueLong(e);var g=this.m_Text.GetValueString(e);this.m_DOMElement=VBI.Utilities.CreateLabel(this.m_ID,g,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,0,f);this.m_Scene.m_Div.appendChild(this.m_DOMElement);};};VBI.VisualObjects.Label.prototype=new VBI.VisualObjects.Base2D();VBI.VisualObjects.Link=function(){this.m_LineWidth=1;this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Reference=new VBI.AttributeProperty(d,'reference',null,""));this.m_Props.push(this.m_Autoexecute=new VBI.AttributeProperty(d,'autoexecute',null,c,false));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""));};this.clear=function(){if(this.m_DOMElement){this.m_DOMElement.onclick=null;}Object.getPrototypeOf(this).clear.call(this);};this.Render=function(c,d,a){if(this.IsValid()){return;}var e=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(e);var t=this.m_Top.GetValueLong(e);var r=this.m_Right.GetValueLong(e);var b=this.m_Bottom.GetValueLong(e);var f=this.m_Align.GetValueLong(e);var g=this.m_Text.GetValueString(e);var h=this.m_Reference.GetValueString(e);var i=this.m_Autoexecute.GetValueBool(e);var j=this.m_Tooltip.GetValueString(e);this.m_DOMElement=VBI.Utilities.CreateLink(this.m_ID,g,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,i?h:null,j,f);this.m_Scene.m_Div.appendChild(this.m_DOMElement);this.m_DOMElement.onclick=this.onclick.bind(this);};this.onclick=function(e){return this.BaseClick(e);};};VBI.VisualObjects.Link.prototype=new VBI.VisualObjects.Base2D();VBI.VisualObjects.Image=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Image=new VBI.AttributeProperty(d,'image',null,c));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""));};this.Render=function(c,d,a){if(this.IsValid()){return;}var e=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(e);var t=this.m_Top.GetValueLong(e);var r=this.m_Right.GetValueLong(e);var b=this.m_Bottom.GetValueLong(e);var f=this.m_Align.GetValueLong(e);var i=this.m_Image.GetValueString(e);var g=this.m_Tooltip.GetValueString(e);var h;if((h=e.GetResources().GetImage(i))){this.m_DOMElement=VBI.Utilities.CreateImage(this.m_ID,h,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,g,f);this.m_Scene.m_Div.appendChild(this.m_DOMElement);}};};VBI.VisualObjects.Image.prototype=new VBI.VisualObjects.Base2D();VBI.VisualObjects.Button=function(){this.load=function(d,c){Object.getPrototypeOf(this).load(this,d,c);this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',null,c,""));this.m_Props.push(this.m_Text=new VBI.AttributeProperty(d,'text',null,c,""));};this.clear=function(){if(this.m_DOMElement){this.m_DOMElement.onclick=null;}Object.getPrototypeOf(this).clear.call(this);};this.Render=function(c,d,a){if(this.IsValid()){return;}var e=this.m_Scene.m_Ctx;var l=this.m_Left.GetValueLong(e);var t=this.m_Top.GetValueLong(e);var r=this.m_Right.GetValueLong(e);var b=this.m_Bottom.GetValueLong(e);var f=this.m_Text.GetValueString(e);var g=this.m_Tooltip.GetValueString(e);this.m_DOMElement=VBI.Utilities.CreateButton(this.m_ID,f,l+this.m_paddingLeft,t+this.m_paddingTop,r+this.m_paddingLeft,b+this.m_paddingTop,g);this.m_Scene.m_Div.appendChild(this.m_DOMElement);this.m_DOMElement.onclick=this.onclick.bind(this);};this.onclick=function(e){return this.BaseClick(e);};};VBI.VisualObjects.Button.prototype=new VBI.VisualObjects.Base2D();VBI.VisualObjects.Dummy=function(){this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);};this.RenderInstance=function(n,d,x,s,c){};this.Render=function(c,d,a){this.BaseRender(c,d);};this.RenderShadow=function(d,n,c,l,x,y){};};VBI.VisualObjects.Dummy.prototype=VBI.VisualObjects.Base;VBI.VisualObjects.Box3D=function(){this.load=function(d,c){Object.getPrototypeOf(this).load.call(this,d,c);this.m_Props.push(this.m_DataSource=new VBI.NodeProperty(d,'datasource',null,c));this.m_Props.push(this.m_Pos=new VBI.AttributeProperty(d,'pos',this.m_DataSource,c,[0.0,0.0,0.0]));this.m_Props.push(this.m_Scale=new VBI.AttributeProperty(d,'scale',this.m_DataSource,c,[1.0,1.0,1.0]));this.m_Props.push(this.m_Tooltip=new VBI.AttributeProperty(d,'tooltip',this.m_DataSource,c,this.m_defaultTooltip));this.m_Props.push(this.m_Color=new VBI.AttributeProperty(d,'color',this.m_DataSource,c,this.m_defaultColor));this.m_Props.push(this.m_ColorBorder=new VBI.AttributeProperty(d,'colorBorder',this.m_DataSource,c,this.m_defaultColor));this.BaseLoad(d,c,this);};this.RenderInstance=function(n,p,s,c,a,f){if(!s){s=[1.0,1.0,1.0];}if(!c){c="#6f6f7a";}};this.Render=function(c){var s=this.m_Scene;if(!s.m_bMainSceneInitialized){return 0;}var a=s.m_Ctx;var b=0;var n;if((n=this.m_DataSource.GetCurrentNode(a))){b=n.m_dataelements.length;for(var d=0;d<b;++d){this.m_DataSource.Select(d);var h=this.IsHot(d);var S=this.IsSelected(a);var p=this.m_Pos.GetValueVector(a);var e=this.m_Scale.GetValueVector(a);var C=this.m_Color.GetValueColor(a);if(S){C=this.GetSelectColor(a,C);}if(h){C=this.GetHotColor(a,C);}var f=this.m_ColorBorder.GetValueColor(a);if(S){f=this.GetSelectColor(a,f);}if(h){f=this.GetHotColor(a,f);}var F=this.m_FxSize.GetValueBool(a);this.RenderInstance(d,p,e,C,f,F);}}return b;};this.DetailHitTest=function(o,n,a,b){};this.GetHitArray=function(x,y){};};VBI.VisualObjects.Box3D.prototype=VBI.VisualObjects.Base;return v;}
;
