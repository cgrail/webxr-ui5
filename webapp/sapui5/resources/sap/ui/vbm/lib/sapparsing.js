VBI.Parser=
function(){"use strict";var p={};p.formulas=[];p.fPos=0;p.fCode="";p.fAttributes=[];p.clear=function(){var t;while((t=p.formulas.shift())!=undefined){p.clearExpression(t.dTree);}};p.evaluate=function(v,a,c){p.vo=v;p.voi=a;p.ctx=c;p.pos=undefined;var n=p.formulas.length;for(var i=0;i<n;++i){var f=p.formulas[i];if(p.evalF(f.dTree)){return f.index;}}return-1;};p.evalF=function(n){if((n.operator==false)||(n.operator==true)){return n.operator;}var r;if(n.operator==600){r=p.evalF(n.operand1);return r?p.evalF(n.operand2):false;}if(n.operator==700){r=p.evalF(n.operand1);return r?true:p.evalF(n.operand2);}var o;var v=p.vo;switch(n.operand1){case"text":o=v.m_Text.GetValueString(p.ctx);break;case"itext":o=parseInt(v.m_Text.GetValueString(p.ctx),10);break;case"id":o=v.m_ID;break;case"image":o=v.m_Image.GetValueString(p.ctx);break;case"x":if(!p.pos){p.pos=p.vo.m_Pos.GetValueVector(p.ctx);}o=p.pos[0];break;case"y":if(!p.pos){p.pos=p.vo.m_Pos.GetValueVector(p.ctx);}o=p.pos[1];break;case"tooltip":o=v.m_Tooltip.GetValueString(p.ctx);break;default:var a=p.fAttributes[p.voi];o="";for(var j=0;j<a.length;++j){if(a[j].name==n.operand1){var d=v.m_DataSource.m_CurElement.m_dataattributes[a[j].index];if(d!=undefined){o=d.m_Value;}}}}switch(n.operator){case 50:return o==n.operand2;case 51:return o>=n.operand2;case 52:return o>n.operand2;case 55:return o!=n.operand2;case 56:return o<=n.operand2;case 57:return o<n.operand2;}};p.verifyAttribute=function(n,v,d){if(jQuery.type(n.operand2)=='object'){p.verifyAttribute(n.operand2,v,d);}if(jQuery.type(n.operand1)=='object'){p.verifyAttribute(n.operand1,v,d);}else{var e=n.operand1;if((e!="id")&&(e!="image")&&(e!="x")&&(e!="y")&&(e!="tooltip")){if(!p.fAttributes){p.buildAttributeTable(v);}for(var i=0;i<d.m_datatypenodes.length;++i){var c=d.m_datatypenodes[i];var a=c.m_Name;var b=c.m_datatypeattributes;for(var j=0;j<b.length;++j){var f=b[j];if(f.m_Name==e){for(var k=0;k<p.fAttributes.length;++k){var g=p.fAttributes[k];if(g.m_Name==a){var F=false;for(var l=0;l<g.length;++l){if(g[l].name==e){F=true;}}if(!F){g.push({name:e,index:j});}}}}}}}}};p.buildAttributeTable=function(v){p.fAttributes=[];for(var i=0;i<v.length;++i){var P=[];var d=v[i].m_DataSource;if(d!=undefined){P.m_Name=d.m_NPath[0];p.fAttributes.push(P);}}};p.verifyAttributes=function(v,c){p.fAttributes=undefined;var d=c.m_DataTypeProvider;for(var i=0;i<p.formulas.length;++i){p.verifyAttribute(p.formulas[i].dTree,v,d);}};p.clearExpression=function(m){if(jQuery.type(m)!='object'){return;}p.clearExpression(m.operand1);p.clearExpression(m.operand2);m.operand1=m.operand2=undefined;};p.addFormula=function(i,m){p.formulas.push({index:i,formula:m,dTree:p.buildDecisionTree(m)});return p.formulas.length-1;};p.buildDecisionTree=function(m){p.fPos=0;p.fCode=m;var c={};if(!p.parseExpression(c)){VBI.Trace("Error: "+m+" could not be interpreted");c.operator=false;}return c;};p.parseExpression=function(n){var o=p.scan();if(o==-1){n.operator=true;return(n.operator);}if(o==10){n.operand1={};if(!p.parseExpression(n.operand1)){return false;}if(p.scan()!=20){return false;}n.operator=p.scan();if(p.ttype!=2){return false;}if(p.scan()!=10){return false;}n.operand2={};if(!p.parseExpression(n.operand2)){return false;}if(p.scan()!=20){return false;}return true;}if(o==500){n.operand1=p.token;n.operator=p.scan();if(p.ttype!=1){return false;}p.scan();if(p.ttype!=10){return false;}n.operand2=p.token;return true;}return false;};p.scan=function(){var l;var n=0;if(p.fPos>=p.fCode.length){return-1;}var m=p.fCode.substr(p.fPos,1);switch(true){case m=="(":return p.getToken(m,10,0);case m==")":return p.getToken(m,20,0);case m=="=":return p.getToken(m,50,1);case m=="!":return p.fCode.substr(p.fPos+1,1)=="="?p.getToken("!=",55,1):false;case m=="<":case m==">":n=5*(m=="<");l=p.fCode.substr(p.fPos+1,1);if(l=="="){return p.getToken(m+l,51+n,1);}if(m=="<"&&l==">"){return p.getToken("!=",55,1);}return p.getToken(m,52+n,1);case m=="|":case m=="&":n=100*(m=="|");l=p.fCode.substr(p.fPos+1,1);if(m!=l){l="";}return p.getToken(m+l,600+n,2);case((m>="0")&&(m<="9")):return p.readNumber(m);case(((m>="a")&&(m<="z"))||((m>="A")&&(m<="Z"))):return p.readString(m);default:return-2;}};p.readNumber=function(f){var s=f;var i=1;var n=p.fCode.substr(p.fPos+i,1);while((n>="0")&&(n<="9")){s+=n;i++;n=p.fCode.substr(p.fPos+i,1);}return p.getToken(s,600,10);};p.readString=function(f){var s=f;var i=1;var n=p.fCode.substr(p.fPos+i,1);while((((n>="a")&&(n<="z"))||((n>="A")&&(n<="Z")))||((n>="0")&&(n<="9"))||(n=="_")||(n==".")||(n=="/")||(n=="\\")){s+=n;i++;n=p.fCode.substr(p.fPos+i,1);}return p.getToken(s,500,10);};p.getToken=function(s,i,t){p.fPos+=s.length;p.token=s;p.ttype=t;return i;};return p;}
;
