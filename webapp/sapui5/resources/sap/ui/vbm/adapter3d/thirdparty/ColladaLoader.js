THREE.ColladaLoader=
function(){var C=null;var a=null;var b;var c;var r=null;var e={};var g={};var h={};var u={};var x={};var y={};var z={};var A={};var B={};var D;var E;var F;var G;var H;var I;var J;var K=true;var L=THREE.SmoothShading;var M={centerGeometry:false,convertUpAxis:false,subdivideFaces:true,upAxis:'Y',defaultEnvMap:null};var N=1.0;var O='Y';var P=null;function Q(d,f,p,i){var l=0;if(document.implementation&&document.implementation.createDocument){var j=new XMLHttpRequest();j.onreadystatechange=function(){if(j.readyState===4){if(j.status===0||j.status===200){if(j.response){r=f;R(j.response,undefined,d);}else{if(i){i({type:'error',url:d});}else{console.error("ColladaLoader: Empty or non-existing file ("+d+")");}}}else{if(i){i({type:'error',url:d});}else{console.error('ColladaLoader: Couldn\'t load "'+d+'" ('+j.status+')');}}}else if(j.readyState===3){if(p){if(l===0){l=j.getResponseHeader("Content-Length");}p({total:l,loaded:j.responseText.length});}}};j.open("GET",d,true);j.send(null);}else{alert("Don't know how to parse XML!");}}function R(t,d,f){C=new DOMParser().parseFromString(t,'text/xml');d=d||r;if(f!==undefined){var p=f.split('/');p.pop();H=(p.length<1?'.':p.join('/'))+'/';}T();t2();g=U("library_images image",u1,"image");y=U("library_materials material",P1,"material");z=U("library_effects effect",U1,"effect");x=U("library_geometries geometry",F1,"geometry");A=U("library_cameras camera",$1,"camera");B=U("library_lights light",a2,"light");u=U("library_controllers controller",w1,"controller");h=U("library_animations animation",W1,"animation");F=U("library_visual_scenes visual_scene",z1,"visual_scene");G=U("library_kinematics_models kinematics_model",c2,"kinematics_model");I=[];J=[];b=V();a=new THREE.Group();for(var i=0;i<b.nodes.length;i++){a.add(g1(b.nodes[i]));}a.scale.multiplyScalar(N);X();c=W();f1();var j={scene:a,morphs:I,skins:J,animations:D,kinematics:E,dae:{images:g,materials:y,cameras:A,lights:B,effects:z,geometries:x,controllers:u,animations:h,visualScenes:F,visualScene:b,scene:b,kinematicsModels:G,kinematicsModel:c}};if(d){d(j);}return j;}function S(s){L=s;}function T(){var d=C.querySelectorAll('asset');var f=d[0];if(f&&f.childNodes){for(var i=0;i<f.childNodes.length;i++){var j=f.childNodes[i];switch(j.nodeName){case'unit':var m=j.getAttribute('meter');if(m){N=parseFloat(m);}break;case'up_axis':O=j.textContent.charAt(0);break;}}}}function U(q,d,p){var f=C.querySelectorAll(q);var l={};var i=0;var k=f.length;for(var j=0;j<k;j++){var m=f[j];var n=(new d()).parse(m);if(!n.id||n.id.length===0)n.id=p+(i++);l[n.id]=n;}return l;}function V(){var s=C.querySelectorAll('scene instance_visual_scene')[0];if(s){var d=s.getAttribute('url').replace(/^#/,'');return F[d.length>0?d:'visual_scene0'];}else{return null;}}function W(){var k=C.querySelectorAll('instance_kinematics_model')[0];if(k){var d=k.getAttribute('url').replace(/^#/,'');return G[d.length>0?d:'kinematics_model0'];}else{return null;}}function X(){D=[];Y(a);}function Y(f){var n=b.getChildById(f.colladaId,true),k=null;if(n&&n.keys){k={fps:60,hierarchy:[{node:n,keys:n.keys,sids:n.sids}],node:f,name:'animation_'+f.name,length:0};D.push(k);for(var i=0,l=n.keys.length;i<l;i++){k.length=Math.max(k.length,n.keys[i].time);}}else{k={hierarchy:[{keys:[],sids:[]}]}}for(var i=0,l=f.children.length;i<l;i++){var d=Y(f.children[i]);for(var j=0,m=d.hierarchy.length;j<m;j++){k.hierarchy.push({keys:[],sids:[]});}}return k;}function Z(){var s=1000000;var d=-s;var f=0;var j;for(var k in h){var l=h[k];j=j||l.id;for(var i=0;i<l.sampler.length;i++){var m=l.sampler[i];m.create();s=Math.min(s,m.startTime);d=Math.max(d,m.endTime);f=Math.max(f,m.input.length);}}return{start:s,end:d,frames:f,ID:j};}function $(d,f){var m=f instanceof C1?u[f.url]:f;if(!m||!m.morph){console.log("could not find morph controller!");return;}var j=m.morph;for(var i=0;i<j.targets.length;i++){var t=j.targets[i];var k=x[t];if(!k.mesh||!k.mesh.primitives||!k.mesh.primitives.length){continue;}var l=k.mesh.primitives[0].geometry;if(l.vertices.length===d.vertices.length){d.morphTargets.push({name:"target_1",vertices:l.vertices});}}d.morphTargets.push({name:"target_Z",vertices:d.vertices});}function _(d,f,j){var s=u[f.url];if(!s||!s.skin){console.log("could not find skin controller!");return;}if(!f.skeleton||!f.skeleton.length){console.log("could not find the skeleton for the skin!");return;}var k=s.skin;var l=b.getChildById(f.skeleton[0]);var m=[];j=j!==undefined?j:true;var n=[];d.skinWeights=[];d.skinIndices=[];if(j){for(var i=0;i<d.vertices.length;i++){d.vertices[i].applyMatrix4(k.bindShapeMatrix);}}}function a1(n,d,f,p){n.world=n.world||new THREE.Matrix4();n.localworld=n.localworld||new THREE.Matrix4();n.world.copy(n.matrix);n.localworld.copy(n.matrix);if(n.channels&&n.channels.length){var j=n.channels[0];var m=j.sampler.output[f];if(m instanceof THREE.Matrix4){n.world.copy(m);n.localworld.copy(m);if(f===0)n.matrix.copy(m);}}if(p){n.world.multiplyMatrices(p,n.world);}d.push(n);for(var i=0;i<n.nodes.length;i++){a1(n.nodes[i],d,f,n.world);}}function b1(d,s){for(var i=0;i<d.length;i++){var f=d[i];var l=-1;if(f.type!='JOINT')continue;for(var j=0;j<s.joints.length;j++){if(f.sid===s.joints[j]){l=j;break;}}if(l>=0){var m=s.invBindMatrices[l];f.invBindMatrix=m;f.skinningMatrix=new THREE.Matrix4();f.skinningMatrix.multiplyMatrices(f.world,m);f.animatrix=new THREE.Matrix4();f.animatrix.copy(f.localworld);f.weights=[];for(var j=0;j<s.weights.length;j++){for(var k=0;k<s.weights[j].length;k++){var w=s.weights[j][k];if(w.joint===l){f.weights.push(w);}}}}else{console.warn("ColladaLoader: Could not find joint '"+f.sid+"'.");f.skinningMatrix=new THREE.Matrix4();f.weights=[];}}}function c1(s){var l=[];var w=function(p,n,l){var d={};d.name=n.sid;d.parent=p;d.matrix=n.matrix;var f=[new THREE.Vector3(),new THREE.Quaternion(),new THREE.Vector3()];d.matrix.decompose(f[0],f[1],f[2]);d.pos=[f[0].x,f[0].y,f[0].z];d.scl=[f[2].x,f[2].y,f[2].z];d.rotq=[f[1].x,f[1].y,f[1].z,f[1].w];l.push(d);for(var i in n.nodes){w(n.sid,n.nodes[i],l);}};w(-1,s,l);return l;}function d1(d,f,k){var l=[];a1(f,l,-1);b1(l,k.skin);var v=new THREE.Vector3();var m=[];for(var i=0;i<d.vertices.length;i++){m.push(new THREE.Vector3());}for(i=0;i<l.length;i++){if(l[i].type!='JOINT')continue;for(var j=0;j<l[i].weights.length;j++){var w=l[i].weights[j];var n=w.index;var p=w.weight;var o=d.vertices[n];var s=m[n];v.x=o.x;v.y=o.y;v.z=o.z;v.applyMatrix4(l[i].skinningMatrix);s.x+=(v.x*p);s.y+=(v.y*p);s.z+=(v.z*p);}}for(var i=0;i<d.vertices.length;i++){d.vertices[i]=m[i];}}function e1(d,f,k){var l=u[f.url];k=k!==undefined?k:40;if(!l||!l.skin){console.log('ColladaLoader: Could not find skin controller.');return;}if(!f.skeleton||!f.skeleton.length){console.log('ColladaLoader: Could not find the skeleton for the skin. ');return;}var m=Z();var n=b.getChildById(f.skeleton[0],true)||b.getChildBySid(f.skeleton[0],true);var p=c1(n);var q=l.skin.joints;var t=[];for(var i=0;i<q.length;i++){for(var j=0;j<p.length;j++){if(p[j].name===q[i]){t[i]=p[j];}}}for(var i=0;i<t.length;i++){for(var j=0;j<t.length;j++){if(t[i].parent===t[j].name){t[i].parent=j;}}}var i,j,w,m1,t1;var v=new THREE.Vector3(),o,s;for(i=0;i<d.vertices.length;i++){d.vertices[i].applyMatrix4(l.skin.bindShapeMatrix);}var v1=[];var v2=[];var B2=l.skin.weights;for(var i=0;i<B2.length;i++){var C2=new THREE.Vector4(B2[i][0]?B2[i][0].joint:0,B2[i][1]?B2[i][1].joint:0,B2[i][2]?B2[i][2].joint:0,B2[i][3]?B2[i][3].joint:0);var t1=new THREE.Vector4(B2[i][0]?B2[i][0].weight:0,B2[i][1]?B2[i][1].weight:0,B2[i][2]?B2[i][2].weight:0,B2[i][3]?B2[i][3].weight:0);v1.push(C2);v2.push(t1);}d.skinIndices=v1;d.skinWeights=v2;d.bones=t;var D2={"name":m.ID,"fps":30,"length":m.frames/30,"hierarchy":[]};for(var j=0;j<t.length;j++){D2.hierarchy.push({parent:t[j].parent,name:t[j].name,keys:[]});}console.log('ColladaLoader:',m.ID+' has '+t.length+' bones.');d1(d,n,l);for(k=0;k<m.frames;k++){var E2=[];var F2=[];a1(n,E2,k);b1(E2,l.skin);for(var i=0;i<E2.length;i++){for(var j=0;j<D2.hierarchy.length;j++){if(D2.hierarchy[j].name===E2[i].sid){var G2={};G2.time=(k/30);G2.matrix=E2[i].animatrix;if(k===0)E2[i].matrix=G2.matrix;var H2=[new THREE.Vector3(),new THREE.Quaternion(),new THREE.Vector3()];G2.matrix.decompose(H2[0],H2[1],H2[2]);G2.pos=[H2[0].x,H2[0].y,H2[0].z];G2.scl=[H2[2].x,H2[2].y,H2[2].z];G2.rot=H2[1];D2.hierarchy[j].keys.push(G2);}}}d.animation=D2;}}function f1(){if(c&&c.joints.length===0){E=undefined;return;}var j={};var d=function(m,p){var o=p.getAttribute('id');var q=b.getChildById(o,true);var s=c.joints[m];a.traverse(function(t){if(t.colladaId==o){j[m]={node:t,transforms:q.transforms,joint:s,position:s.zeroPosition};}});};E={joints:c&&c.joints,getJointValue:function(m){var o=j[m];if(o){return o.position;}else{console.log('getJointValue: joint '+m+' doesn\'t exist');}},setJointValue:function(m,o){var q=j[m];if(q){var s=q.joint;if(o>s.limits.max||o<s.limits.min){console.log('setJointValue: joint '+m+' value '+o+' outside of limits (min: '+s.limits.min+', max: '+s.limits.max+')');}else if(s.static){console.log('setJointValue: joint '+m+' is static');}else{var t=q.node;var l=s.axis;var w=q.transforms;var t1=new THREE.Matrix4();for(i=0;i<w.length;i++){var v1=w[i];if(v1.sid&&v1.sid.indexOf('joint'+m)!==-1){switch(s.type){case'revolute':t1.multiply(m1.makeRotationAxis(l,THREE.Math.degToRad(o)));break;case'prismatic':t1.multiply(m1.makeTranslation(l.x*o,l.y*o,l.z*o));break;default:console.warn('setJointValue: unknown joint type: '+s.type);break;}}else{var m1=new THREE.Matrix4();switch(v1.type){case'matrix':t1.multiply(v1.obj);break;case'translate':t1.multiply(m1.makeTranslation(v1.obj.x,v1.obj.y,v1.obj.z));break;case'rotate':t1.multiply(m1.makeRotationAxis(v1.obj,v1.angle));break;}}}var v2=t1.elements;var B2=Array.prototype.slice.call(v2);var C2=[B2[0],B2[4],B2[8],B2[12],B2[1],B2[5],B2[9],B2[13],B2[2],B2[6],B2[10],B2[14],B2[3],B2[7],B2[11],B2[15]];t.matrix.set.apply(t.matrix,C2);t.matrix.decompose(t.position,t.quaternion,t.scale);}}else{console.log('setJointValue: joint '+m+' doesn\'t exist');}}};var f=C.querySelector('scene instance_kinematics_scene');if(f){for(var i=0;i<f.childNodes.length;i++){var k=f.childNodes[i];if(k.nodeType!=1)continue;switch(k.nodeName){case'bind_joint_axis':var v=k.getAttribute('target').split('/').pop();var l=k.querySelector('axis param').textContent;var m=parseInt(l.split('joint').pop().split('.')[0]);var n=C.querySelector('[sid="'+v+'"]');if(n){var p=n.parentElement;d(m,p);}break;default:break;}}}}function g1(n,p){var o=new THREE.Object3D();var s=false;var d;var m;var i,j;for(i=0;i<n.controllers.length;i++){var f=u[n.controllers[i].url];switch(f.type){case'skin':if(x[f.skin.source]){var k=new E1();k.url=f.skin.source;k.instance_material=n.controllers[i].instance_material;n.geometries.push(k);s=true;d=n.controllers[i];}else if(u[f.skin.source]){var l=u[f.skin.source];m=l;if(l.morph&&x[l.morph.source]){var k=new E1();k.url=l.morph.source;k.instance_material=n.controllers[i].instance_material;n.geometries.push(k);}}break;case'morph':if(x[f.morph.source]){var k=new E1();k.url=f.morph.source;k.instance_material=n.controllers[i].instance_material;n.geometries.push(k);m=n.controllers[i];}console.log('ColladaLoader: Morph-controller partially supported.');default:break;}}var q={};for(i=0;i<n.geometries.length;i++){var t=n.geometries[i];var v=t.instance_material;var w=x[t.url];var m1={};var t1=[];var v1=0;var v2;if(w){if(!w.mesh||!w.mesh.primitives)continue;if(o.name.length===0){o.name=w.id;}if(v){for(j=0;j<v.length;j++){var B2=v[j];var C2=y[B2.target];var D2=C2.instance_effect.url;var E2=z[D2].shader;var F2=E2.material;if(w.doubleSided){if(!(B2.symbol in q)){var G2=F2.clone();G2.side=THREE.DoubleSide;q[B2.symbol]=G2;}F2=q[B2.symbol];}F2.opacity=!F2.opacity?1:F2.opacity;m1[B2.symbol]=v1;t1.push(F2);v2=F2;v2.name=C2.name===null||C2.name===''?C2.id:C2.name;v1++;}}var H2;var I2=v2||new THREE.MeshLambertMaterial({color:0xdddddd,side:w.doubleSided?THREE.DoubleSide:THREE.FrontSide});var J2=w.mesh.geometry3js;if(v1>1){I2=new THREE.MultiMaterial(t1);for(j=0;j<J2.faces.length;j++){var K2=J2.faces[j];K2.materialIndex=m1[K2.daeMaterial]}}if(d!==undefined){e1(J2,d);if(J2.morphTargets.length>0){I2.morphTargets=true;I2.skinning=false;}else{I2.morphTargets=false;I2.skinning=true;}H2=new THREE.SkinnedMesh(J2,I2,false);H2.name='skin_'+J.length;J.push(H2);}else if(m!==undefined){$(J2,m);I2.morphTargets=true;H2=new THREE.Mesh(J2,I2);H2.name='morph_'+I.length;I.push(H2);}else{if(J2.isLineStrip===true){H2=new THREE.Line(J2);}else{H2=new THREE.Mesh(J2,I2);}}o.add(H2);}}for(i=0;i<n.cameras.length;i++){var L2=n.cameras[i];var M2=A[L2.url];var N2=new THREE.PerspectiveCamera(M2.yfov,parseFloat(M2.aspect_ratio),parseFloat(M2.znear),parseFloat(M2.zfar));o.add(N2);}for(i=0;i<n.lights.length;i++){var O2=null;var P2=n.lights[i];var Q2=B[P2.url];if(Q2&&Q2.technique){var R2=Q2.color.getHex();var S2=Q2.intensity;var T2=Q2.distance;var U2=Q2.falloff_angle;switch(Q2.technique){case'directional':O2=new THREE.DirectionalLight(R2,S2,T2);O2.position.set(0,0,1);break;case'point':O2=new THREE.PointLight(R2,S2,T2);break;case'spot':O2=new THREE.SpotLight(R2,S2,T2,U2);O2.position.set(0,0,1);break;case'ambient':O2=new THREE.AmbientLight(R2);break;}}if(O2){o.add(O2);}}o.name=n.name||n.id||"";o.colladaId=n.id||"";o.layer=n.layer||"";o.matrix=n.matrix;o.matrix.decompose(o.position,o.quaternion,o.scale);if(M.centerGeometry&&o.geometry){var V2=o.geometry.center();V2.multiply(o.scale);V2.applyQuaternion(o.quaternion);o.position.sub(V2);}for(i=0;i<n.nodes.length;i++){o.add(g1(n.nodes[i],n));}return o;}function h1(s,d){for(var i=0;i<s.joints.length;i++){if(s.joints[i]===d){return i;}}}function i1(d){var n=C.querySelectorAll('library_nodes node');for(var i=0;i<n.length;i++){var f=n[i].attributes.getNamedItem('id');if(f&&f.value===d){return n[i];}}return undefined;}function j1(n){var d=[];var s=1000000;var f=-1000000;for(var j in h){var k=h[j];for(var i=0;i<k.channel.length;i++){var l=k.channel[i];var m=k.sampler[i];var j=l.target.split('/')[0];if(j==n.id){m.create();l.sampler=m;s=Math.min(s,m.startTime);f=Math.max(f,m.endTime);d.push(l);}}}if(d.length){n.startTime=s;n.endTime=f;}return d;}function k1(n){var m=10000000;for(var i=0;i<n.channels.length;i++){var s=n.channels[i].sampler;for(var j=0;j<s.input.length-1;j++){var t=s.input[j];var d=s.input[j+1];m=Math.min(m,d-t);}}return m;}function l1(n,t){var d={};var i,j;for(i=0;i<n.channels.length;i++){var f=n.channels[i];d[f.sid]=f;}var m=new THREE.Matrix4();for(i=0;i<n.transforms.length;i++){var k=n.transforms[i];var f=d[k.sid];if(f!==undefined){var s=f.sampler;var v;for(j=0;j<s.input.length-1;j++){if(s.input[j+1]>t){v=s.output[j];break;}}if(v!==undefined){if(v instanceof THREE.Matrix4){m.multiplyMatrices(m,v);}else{m.multiplyMatrices(m,k.matrix);}}else{m.multiplyMatrices(m,k.matrix);}}else{m.multiplyMatrices(m,k.matrix);}}return m;}function n1(n){if(n.channels&&n.channels.length){var k=[],s=[];for(var i=0,d=n.channels.length;i<d;i++){var f=n.channels[i],l=f.fullSid,m=f.sampler,o=m.input,t=n.getTransformBySid(f.sid),p;if(f.arrIndices){p=[];for(var j=0,q=f.arrIndices.length;j<q;j++){p[j]=z2(f.arrIndices[j]);}}else{p=A2(f.member);}if(t){if(s.indexOf(l)===-1){s.push(l);}for(var j=0,q=o.length;j<q;j++){var v=o[j],w=m.getData(t.type,j,p),m1=o1(k,v);if(!m1){m1=new Z1(v);var t1=p1(k,v);k.splice(t1===-1?k.length:t1,0,m1);}m1.addTarget(l,t,p,w);}}else{console.log('Could not find transform "'+f.sid+'" in node '+n.id);}}for(var i=0;i<s.length;i++){var v1=s[i];for(var j=0;j<k.length;j++){var m1=k[j];if(!m1.hasTarget(v1)){q1(k,m1,j,v1);}}}n.keys=k;n.sids=s;}}function o1(k,t){var d=null;for(var i=0,f=k.length;i<f&&d===null;i++){var j=k[i];if(j.time===t){d=j;}else if(j.time>t){break;}}return d;}function p1(k,t){var n=-1;for(var i=0,d=k.length;i<d&&n===-1;i++){var f=k[i];if(f.time>=t){n=i;}}return n;}function q1(k,d,n,f){var p=s1(k,f,n?n-1:0),j=r1(k,f,n+1);if(p&&j){var s=(d.time-p.time)/(j.time-p.time),l=p.getTarget(f),m=j.getTarget(f).data,o=l.data,q;if(l.type==='matrix'){q=o;}else if(o.length){q=[];for(var i=0;i<o.length;++i){q[i]=o[i]+(m[i]-o[i])*s;}}else{q=o+(m-o)*s;}d.addTarget(f,l.transform,l.member,q);}}function r1(k,f,n){for(;n<k.length;n++){var d=k[n];if(d.hasTarget(f)){return d;}}return null;}function s1(k,f,n){n=n>=0?n:n+k.length;for(;n>=0;n--){var d=k[n];if(d.hasTarget(f)){return d;}}return null;}function u1(){this.id="";this.init_from="";}u1.prototype.parse=function(d){this.id=d.getAttribute('id');for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeName==='init_from'){this.init_from=f.textContent;}}return this;};function w1(){this.id="";this.name="";this.type="";this.skin=null;this.morph=null;}w1.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');this.type="none";for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'skin':this.skin=(new y1()).parse(f);this.type=f.nodeName;break;case'morph':this.morph=(new x1()).parse(f);this.type=f.nodeName;break;default:break;}}return this;};function x1(){this.method=null;this.source=null;this.targets=null;this.weights=null;}x1.prototype.parse=function(d){var e={};var f=[];var i;this.method=d.getAttribute('method');this.source=d.getAttribute('source').replace(/^#/,'');for(i=0;i<d.childNodes.length;i++){var j=d.childNodes[i];if(j.nodeType!=1)continue;switch(j.nodeName){case'source':var s=(new O1()).parse(j);e[s.id]=s;break;case'targets':f=this.parseInputs(j);break;default:console.log(j.nodeName);break;}}for(i=0;i<f.length;i++){var k=f[i];var s=e[k.source];switch(k.semantic){case'MORPH_TARGET':this.targets=s.read();break;case'MORPH_WEIGHT':this.weights=s.read();break;default:break;}}return this;};x1.prototype.parseInputs=function(d){var f=[];for(var i=0;i<d.childNodes.length;i++){var j=d.childNodes[i];if(j.nodeType!=1)continue;switch(j.nodeName){case'input':f.push((new N1()).parse(j));break;default:break;}}return f;};function y1(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[];}y1.prototype.parse=function(d){var e={};var j,w;this.source=d.getAttribute('source').replace(/^#/,'');this.invBindMatrices=[];this.joints=[];this.weights=[];for(var i=0;i<d.childNodes.length;i++){var k=d.childNodes[i];if(k.nodeType!=1)continue;switch(k.nodeName){case'bind_shape_matrix':var f=j2(k.textContent);this.bindShapeMatrix=y2(f);break;case'source':var s=new O1().parse(k);e[s.id]=s;break;case'joints':j=k;break;case'vertex_weights':w=k;break;default:console.log(k.nodeName);break;}}this.parseJoints(j,e);this.parseWeights(w,e);return this;};y1.prototype.parseJoints=function(d,e){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'input':var j=(new N1()).parse(f);var s=e[j.source];if(j.semantic==='JOINT'){this.joints=s.read();}else if(j.semantic==='INV_BIND_MATRIX'){this.invBindMatrices=s.read();}break;default:break;}}};y1.prototype.parseWeights=function(d,e){var v,f,l=[];for(var i=0;i<d.childNodes.length;i++){var m=d.childNodes[i];if(m.nodeType!=1)continue;switch(m.nodeName){case'input':l.push((new N1()).parse(m));break;case'v':v=k2(m.textContent);break;case'vcount':f=k2(m.textContent);break;default:break;}}var n=0;for(var i=0;i<f.length;i++){var o=f[i];var p=[];for(var j=0;j<o;j++){var q={};for(var k=0;k<l.length;k++){var s=l[k];var t=v[n+s.offset];switch(s.semantic){case'JOINT':q.joint=t;break;case'WEIGHT':q.weight=e[s.source].data[t];break;default:break;}}p.push(q);n+=l.length;}for(var j=0;j<p.length;j++){p[j].index=i;}this.weights.push(p);}};function z1(){this.id="";this.name="";this.nodes=[];this.scene=new THREE.Group();}z1.prototype.getChildById=function(d,f){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(d,f);if(n){return n;}}return null;};z1.prototype.getChildBySid=function(s,d){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(s,d);if(n){return n;}}return null;};z1.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');this.nodes=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'node':this.nodes.push((new A1()).parse(f));break;default:break;}}return this;};function A1(){this.id="";this.name="";this.sid="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4();}A1.prototype.getChannelForTransform=function(t){for(var i=0;i<this.channels.length;i++){var d=this.channels[i];var p=d.target.split('/');var f=p.shift();var s=p.shift();var k=(s.indexOf(".")>=0);var l=(s.indexOf("(")>=0);var m;var n;if(k){p=s.split(".");s=p.shift();n=p.shift();}else if(l){m=s.split("(");s=m.shift();for(var j=0;j<m.length;j++){m[j]=parseInt(m[j].replace(/\)/,''));}}if(s===t){d.info={sid:s,dotSyntax:k,arrSyntax:l,arrIndices:m};return d;}}return null;};A1.prototype.getChildById=function(d,f){if(this.id===d){return this;}if(f){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(d,f);if(n){return n;}}}return null;};A1.prototype.getChildBySid=function(s,d){if(this.sid===s){return this;}if(d){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(s,d);if(n){return n;}}}return null;};A1.prototype.getTransformBySid=function(s){for(var i=0;i<this.transforms.length;i++){if(this.transforms[i].sid===s)return this.transforms[i];}return null;};A1.prototype.parse=function(d){var f;this.id=d.getAttribute('id');this.sid=d.getAttribute('sid');this.name=d.getAttribute('name');this.type=d.getAttribute('type');this.layer=d.getAttribute('layer');this.type=this.type==='JOINT'?this.type:'NODE';this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.lights=[];this.controllers=[];this.matrix=new THREE.Matrix4();for(var i=0;i<d.childNodes.length;i++){var j=d.childNodes[i];if(j.nodeType!=1)continue;switch(j.nodeName){case'node':this.nodes.push((new A1()).parse(j));break;case'instance_camera':this.cameras.push((new _1()).parse(j));break;case'instance_controller':this.controllers.push((new C1()).parse(j));break;case'instance_geometry':this.geometries.push((new E1()).parse(j));break;case'instance_light':this.lights.push((new b2()).parse(j));break;case'instance_node':f=j.getAttribute('url').replace(/^#/,'');var n=i1(f);if(n){this.nodes.push((new A1()).parse(n));}break;case'rotate':case'translate':case'scale':case'matrix':case'lookat':case'skew':this.transforms.push((new B1()).parse(j));break;case'extra':break;default:console.log(j.nodeName);break;}}this.channels=j1(this);n1(this);this.updateMatrix();return this;};A1.prototype.updateMatrix=function(){this.matrix.identity();for(var i=0;i<this.transforms.length;i++){this.transforms[i].apply(this.matrix);}};function B1(){this.sid="";this.type="";this.data=[];this.obj=null;}B1.prototype.parse=function(d){this.sid=d.getAttribute('sid');this.type=d.nodeName;this.data=j2(d.textContent);this.convert();return this;};B1.prototype.convert=function(){switch(this.type){case'matrix':this.obj=y2(this.data);break;case'rotate':this.angle=THREE.Math.degToRad(this.data[3]);case'translate':u2(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case'scale':u2(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log('Can not convert Transform of type '+this.type);break;}};B1.prototype.apply=function(){var m=new THREE.Matrix4();return function(d){switch(this.type){case'matrix':d.multiply(this.obj);break;case'translate':d.multiply(m.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case'rotate':d.multiply(m.makeRotationAxis(this.obj,this.angle));break;case'scale':d.scale(this.obj);break;}};}();B1.prototype.update=function(d,m){var f=['X','Y','Z','ANGLE'];switch(this.type){case'matrix':if(!m){this.obj.copy(d);}else if(m.length===1){switch(m[0]){case 0:this.obj.n11=d[0];this.obj.n21=d[1];this.obj.n31=d[2];this.obj.n41=d[3];break;case 1:this.obj.n12=d[0];this.obj.n22=d[1];this.obj.n32=d[2];this.obj.n42=d[3];break;case 2:this.obj.n13=d[0];this.obj.n23=d[1];this.obj.n33=d[2];this.obj.n43=d[3];break;case 3:this.obj.n14=d[0];this.obj.n24=d[1];this.obj.n34=d[2];this.obj.n44=d[3];break;}}else if(m.length===2){var p='n'+(m[0]+1)+(m[1]+1);this.obj[p]=d;}else{console.log('Incorrect addressing of matrix in transform.');}break;case'translate':case'scale':if(Object.prototype.toString.call(m)==='[object Array]'){m=f[m[0]];}switch(m){case'X':this.obj.x=d;break;case'Y':this.obj.y=d;break;case'Z':this.obj.z=d;break;default:this.obj.x=d[0];this.obj.y=d[1];this.obj.z=d[2];break;}break;case'rotate':if(Object.prototype.toString.call(m)==='[object Array]'){m=f[m[0]];}switch(m){case'X':this.obj.x=d;break;case'Y':this.obj.y=d;break;case'Z':this.obj.z=d;break;case'ANGLE':this.angle=THREE.Math.degToRad(d);break;default:this.obj.x=d[0];this.obj.y=d[1];this.obj.z=d[2];this.angle=THREE.Math.degToRad(d[3]);break;}break;}};function C1(){this.url="";this.skeleton=[];this.instance_material=[];}C1.prototype.parse=function(d){this.url=d.getAttribute('url').replace(/^#/,'');this.skeleton=[];this.instance_material=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!==1)continue;switch(f.nodeName){case'skeleton':this.skeleton.push(f.textContent.replace(/^#/,''));break;case'bind_material':var k=f.querySelectorAll('instance_material');for(var j=0;j<k.length;j++){var l=k[j];this.instance_material.push((new D1()).parse(l));}break;case'extra':break;default:break;}}return this;};function D1(){this.symbol="";this.target="";}D1.prototype.parse=function(d){this.symbol=d.getAttribute('symbol');this.target=d.getAttribute('target').replace(/^#/,'');return this;};function E1(){this.url="";this.instance_material=[];}E1.prototype.parse=function(d){this.url=d.getAttribute('url').replace(/^#/,'');this.instance_material=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;if(f.nodeName==='bind_material'){var k=f.querySelectorAll('instance_material');for(var j=0;j<k.length;j++){var l=k[j];this.instance_material.push((new D1()).parse(l));}break;}}return this;};function F1(){this.id="";this.mesh=null;}F1.prototype.parse=function(d){this.id=d.getAttribute('id');s2(this,d);for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'mesh':this.mesh=(new G1(this)).parse(f);break;case'extra':break;default:break;}}return this;};function G1(d){this.geometry=d.id;this.primitives=[];this.vertices=null;this.geometry3js=null;}G1.prototype.parse=function(d){this.primitives=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'source':g2(f);break;case'vertices':this.vertices=(new M1()).parse(f);break;case'linestrips':this.primitives.push((new J1().parse(f)));break;case'triangles':this.primitives.push((new K1().parse(f)));break;case'polygons':this.primitives.push((new H1().parse(f)));break;case'polylist':this.primitives.push((new I1().parse(f)));break;default:break;}}this.geometry3js=new THREE.Geometry();if(this.vertices===null){return this;}var v=e[this.vertices.input['POSITION'].source].data;for(var i=0;i<v.length;i+=3){this.geometry3js.vertices.push(x2(v,i).clone());}for(var i=0;i<this.primitives.length;i++){var p=this.primitives[i];p.setVertices(this.vertices);this.handlePrimitive(p,this.geometry3js);}if(this.geometry3js.calcNormals){this.geometry3js.computeVertexNormals();delete this.geometry3js.calcNormals;}return this;};G1.prototype.handlePrimitive=function(d,f){if(d instanceof J1){f.isLineStrip=true;return;}var j,k,l=d.p,m=d.inputs;var n,o,q;var s,t;var v=0,w=3,m1=0;var t1=[];for(j=0;j<m.length;j++){n=m[j];var B2=n.offset+1;m1=(m1<B2)?B2:m1;switch(n.semantic){case'TEXCOORD':t1.push(n.set);break;}}for(var C2=0;C2<l.length;++C2){var p=l[C2],i=0;while(i<p.length){var vs=[];var ns=[];var ts=null;var cs=[];if(d.vcount){w=d.vcount.length?d.vcount[v++]:d.vcount;}else{w=p.length/m1;}for(j=0;j<w;j++){for(k=0;k<m.length;k++){n=m[k];s=e[n.source];o=p[i+(j*m1)+n.offset];t=s.accessor.params.length;q=o*t;switch(n.semantic){case'VERTEX':vs.push(o);break;case'NORMAL':ns.push(x2(s.data,q));break;case'TEXCOORD':ts=ts||{};if(ts[n.set]===undefined)ts[n.set]=[];ts[n.set].push(new THREE.Vector2(s.data[q],s.data[q+1]));break;case'COLOR':cs.push(new THREE.Color().setRGB(s.data[q],s.data[q+1],s.data[q+2]));break;default:break;}}}if(ns.length===0){n=this.vertices.input.NORMAL;if(n){s=e[n.source];t=s.accessor.params.length;for(var H2=0,I2=vs.length;H2<I2;H2++){ns.push(x2(s.data,vs[H2]*t));}}else{f.calcNormals=true;}}if(!ts){ts={};n=this.vertices.input.TEXCOORD;if(n){t1.push(n.set);s=e[n.source];t=s.accessor.params.length;for(var H2=0,I2=vs.length;H2<I2;H2++){q=vs[H2]*t;if(ts[n.set]===undefined)ts[n.set]=[];ts[n.set].push(new THREE.Vector2(s.data[q],1.0-s.data[q+1]));}}}if(cs.length===0){n=this.vertices.input.COLOR;if(n){s=e[n.source];t=s.accessor.params.length;for(var H2=0,I2=vs.length;H2<I2;H2++){q=vs[H2]*t;cs.push(new THREE.Color().setRGB(s.data[q],s.data[q+1],s.data[q+2]));}}}var J2=null,K2=[],uv,M2;if(w===3){K2.push(new THREE.Face3(vs[0],vs[1],vs[2],ns,cs.length?cs:new THREE.Color()));}else if(w===4){K2.push(new THREE.Face3(vs[0],vs[1],vs[3],ns.length?[ns[0].clone(),ns[1].clone(),ns[3].clone()]:[],cs.length?[cs[0],cs[1],cs[3]]:new THREE.Color()));K2.push(new THREE.Face3(vs[1],vs[2],vs[3],ns.length?[ns[1].clone(),ns[2].clone(),ns[3].clone()]:[],cs.length?[cs[1],cs[2],cs[3]]:new THREE.Color()));}else if(w>4&&M.subdivideFaces){var N2=cs.length?cs:new THREE.Color(),O2,P2,Q2,v1,v2,T2;for(k=1;k<w-1;){K2.push(new THREE.Face3(vs[0],vs[k],vs[k+1],ns.length?[ns[0].clone(),ns[k++].clone(),ns[k].clone()]:[],N2));}}if(K2.length){for(var H2=0,I2=K2.length;H2<I2;H2++){J2=K2[H2];J2.daeMaterial=d.material;f.faces.push(J2);for(k=0;k<t1.length;k++){uv=ts[t1[k]];if(w>4){M2=[uv[0],uv[H2+1],uv[H2+2]];}else if(w===4){if(H2===0){M2=[uv[0],uv[1],uv[3]];}else{M2=[uv[1].clone(),uv[2],uv[3].clone()];}}else{M2=[uv[0],uv[1],uv[2]];}if(f.faceVertexUvs[k]===undefined){f.faceVertexUvs[k]=[];}f.faceVertexUvs[k].push(M2);}}}else{console.log('dropped face with vcount '+w+' for geometry with id: '+f.id);}i+=m1*w;}}};function H1(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry();}H1.prototype.setVertices=function(v){for(var i=0;i<this.inputs.length;i++){if(this.inputs[i].source===v.id){this.inputs[i].source=v.input['POSITION'].source;}}};H1.prototype.parse=function(d){this.material=d.getAttribute('material');this.count=o2(d,'count',0);for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'input':this.inputs.push((new N1()).parse(d.childNodes[i]));break;case'vcount':this.vcount=k2(f.textContent);break;case'p':this.p.push(k2(f.textContent));break;case'ph':console.warn('polygon holes not yet supported!');break;default:break;}}return this;};function I1(){H1.call(this);this.vcount=[];}I1.prototype=Object.create(H1.prototype);I1.prototype.constructor=I1;function J1(){H1.call(this);this.vcount=1;}J1.prototype=Object.create(H1.prototype);J1.prototype.constructor=J1;function K1(){H1.call(this);this.vcount=3;}K1.prototype=Object.create(H1.prototype);K1.prototype.constructor=K1;function L1(){this.source="";this.count=0;this.stride=0;this.params=[];}L1.prototype.parse=function(d){this.params=[];this.source=d.getAttribute('source');this.count=o2(d,'count',0);this.stride=o2(d,'stride',0);for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeName==='param'){var p={};p['name']=f.getAttribute('name');p['type']=f.getAttribute('type');this.params.push(p);}}return this;};function M1(){this.input={};}M1.prototype.parse=function(d){this.id=d.getAttribute('id');for(var i=0;i<d.childNodes.length;i++){if(d.childNodes[i].nodeName==='input'){var f=(new N1()).parse(d.childNodes[i]);this.input[f.semantic]=f;}}return this;};function N1(){this.semantic="";this.offset=0;this.source="";this.set=0;}N1.prototype.parse=function(d){this.semantic=d.getAttribute('semantic');this.source=d.getAttribute('source').replace(/^#/,'');this.set=o2(d,'set',-1);this.offset=o2(d,'offset',0);if(this.semantic==='TEXCOORD'&&this.set<0){this.set=0;}return this;};function O1(i){this.id=i;this.type=null;}O1.prototype.parse=function(d){this.id=d.getAttribute('id');for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'bool_array':this.data=i2(f.textContent);this.type=f.nodeName;break;case'float_array':this.data=j2(f.textContent);this.type=f.nodeName;break;case'int_array':this.data=k2(f.textContent);this.type=f.nodeName;break;case'IDREF_array':case'Name_array':this.data=l2(f.textContent);this.type=f.nodeName;break;case'technique_common':for(var j=0;j<f.childNodes.length;j++){if(f.childNodes[j].nodeName==='accessor'){this.accessor=(new L1()).parse(f.childNodes[j]);break;}}break;default:break;}}return this;};O1.prototype.read=function(){var d=[];var p=this.accessor.params[0];switch(p.type){case'IDREF':case'Name':case'name':case'float':return this.data;case'float4x4':for(var j=0;j<this.data.length;j+=16){var s=this.data.slice(j,j+16);var m=y2(s);d.push(m);}break;default:console.log('ColladaLoader: Source: Read dont know how to read '+p.type+'.');break;}return d;};function P1(){this.id="";this.name="";this.instance_effect=null;}P1.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');for(var i=0;i<d.childNodes.length;i++){if(d.childNodes[i].nodeName==='instance_effect'){this.instance_effect=(new V1()).parse(d.childNodes[i]);break;}}return this;};function Q1(){this.color=new THREE.Color();this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1.0;this.texture=null;this.texcoord=null;this.texOpts=null;}Q1.prototype.isColor=function(){return(this.texture===null);};Q1.prototype.isTexture=function(){return(this.texture!=null);};Q1.prototype.parse=function(d){if(d.nodeName==='transparent'){this.opaque=d.getAttribute('opaque');}for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'color':var j=j2(f.textContent);this.color=new THREE.Color();this.color.setRGB(j[0],j[1],j[2]);this.color.a=j[3];break;case'texture':this.texture=f.getAttribute('texture');this.texcoord=f.getAttribute('texcoord');this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1};this.parseTexture(f);break;default:break;}}return this;};Q1.prototype.parseTexture=function(d){if(!d.childNodes)return this;if(d.childNodes[1]&&d.childNodes[1].nodeName==='extra'){d=d.childNodes[1];if(d.childNodes[1]&&d.childNodes[1].nodeName==='technique'){d=d.childNodes[1];}}for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'offsetU':case'offsetV':case'repeatU':case'repeatV':this.texOpts[f.nodeName]=parseFloat(f.textContent);break;case'wrapU':case'wrapV':if(f.textContent.toUpperCase()==='TRUE'){this.texOpts[f.nodeName]=1;}else{this.texOpts[f.nodeName]=parseInt(f.textContent);}break;default:this.texOpts[f.nodeName]=f.textContent;break;}}return this;};function R1(t,d){this.type=t;this.effect=d;this.material=null;}R1.prototype.parse=function(d){for(var i=0;i<d.childNodes.length;i++){var j=d.childNodes[i];if(j.nodeType!=1)continue;switch(j.nodeName){case'emission':case'diffuse':case'specular':case'transparent':this[j.nodeName]=(new Q1()).parse(j);break;case'bump':var k=j.getAttribute('bumptype');if(k){if(k.toLowerCase()==="heightfield"){this['bump']=(new Q1()).parse(j);}else if(k.toLowerCase()==="normalmap"){this['normal']=(new Q1()).parse(j);}else{console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+k+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'");this['bump']=(new Q1()).parse(j);}}else{console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'");this['bump']=(new Q1()).parse(j);}break;case'shininess':case'reflectivity':case'index_of_refraction':case'transparency':var f=j.querySelectorAll('float');if(f.length>0)this[j.nodeName]=parseFloat(f[0].textContent);break;default:break;}}this.create();return this;};R1.prototype.create=function(){var p={};var t=false;if(this['transparency']!==undefined&&this['transparent']!==undefined){var d=this['transparent'];var f=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;if(f>0){t=true;p['transparent']=true;p['opacity']=1-f;}}var k={'diffuse':'map','ambient':'lightMap','specular':'specularMap','emission':'emissionMap','bump':'bumpMap','normal':'normalMap'};for(var i in this){switch(i){case'ambient':case'emission':case'diffuse':case'specular':case'bump':case'normal':var j=this[i];if(j instanceof Q1){if(j.isTexture()){var s=j.texture;var l=this.effect.sampler[s];if(l!==undefined&&l.source!==undefined){var m=this.effect.surface[l.source];if(m!==undefined){var n=g[m.init_from];if(n){var o=H+n.init_from;var q;var v=THREE.Loader.Handlers.get(o);if(v!==null){q=v.load(o);}else{q=new THREE.Texture();r2(q,o);}if(l.wrap_s==="MIRROR"){q.wrapS=THREE.MirroredRepeatWrapping;}else if(l.wrap_s==="WRAP"||j.texOpts.wrapU){q.wrapS=THREE.RepeatWrapping;}else{q.wrapS=THREE.ClampToEdgeWrapping;}if(l.wrap_t==="MIRROR"){q.wrapT=THREE.MirroredRepeatWrapping;}else if(l.wrap_t==="WRAP"||j.texOpts.wrapV){q.wrapT=THREE.RepeatWrapping;}else{q.wrapT=THREE.ClampToEdgeWrapping;}q.offset.x=j.texOpts.offsetU;q.offset.y=j.texOpts.offsetV;q.repeat.x=j.texOpts.repeatU;q.repeat.y=j.texOpts.repeatV;p[k[i]]=q;if(i==='emission')p['emissive']=0xffffff;}}}}else if(i==='diffuse'||!t){if(i==='emission'){p['emissive']=j.color.getHex();}else{p[i]=j.color.getHex();}}}break;case'shininess':p[i]=this[i];break;case'reflectivity':p[i]=this[i];if(p[i]>0.0)p['envMap']=M.defaultEnvMap;p['combine']=THREE.MixOperation;break;case'index_of_refraction':p['refractionRatio']=this[i];if(this[i]!==1.0)p['envMap']=M.defaultEnvMap;break;case'transparency':break;default:break;}}p['shading']=L;p['side']=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;if(p.diffuse!==undefined){p.color=p.diffuse;delete p.diffuse;}switch(this.type){case'constant':if(p.emissive!=undefined)p.color=p.emissive;this.material=new THREE.MeshBasicMaterial(p);break;case'phong':case'blinn':this.material=new THREE.MeshPhongMaterial(p);break;case'lambert':default:this.material=new THREE.MeshLambertMaterial(p);break;}return this.material;};function S1(d){this.effect=d;this.init_from=null;this.format=null;}S1.prototype.parse=function(d){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'init_from':this.init_from=f.textContent;break;case'format':this.format=f.textContent;break;default:console.log("unhandled Surface prop: "+f.nodeName);break;}}return this;};function T1(d){this.effect=d;this.source=null;this.wrap_s=null;this.wrap_t=null;this.minfilter=null;this.magfilter=null;this.mipfilter=null;}T1.prototype.parse=function(d){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'source':this.source=f.textContent;break;case'minfilter':this.minfilter=f.textContent;break;case'magfilter':this.magfilter=f.textContent;break;case'mipfilter':this.mipfilter=f.textContent;break;case'wrap_s':this.wrap_s=f.textContent;break;case'wrap_t':this.wrap_t=f.textContent;break;default:console.log("unhandled Sampler2D prop: "+f.nodeName);break;}}return this;};function U1(){this.id="";this.name="";this.shader=null;this.surface={};this.sampler={};}U1.prototype.create=function(){if(this.shader===null){return null;}};U1.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');s2(this,d);this.shader=null;for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'profile_COMMON':this.parseTechnique(this.parseProfileCOMMON(f));break;default:break;}}return this;};U1.prototype.parseNewparam=function(d){var s=d.getAttribute('sid');for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'surface':this.surface[s]=(new S1(this)).parse(f);break;case'sampler2D':this.sampler[s]=(new T1(this)).parse(f);break;case'extra':break;default:console.log(f.nodeName);break;}}};U1.prototype.parseProfileCOMMON=function(d){var t;for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'profile_COMMON':this.parseProfileCOMMON(f);break;case'technique':t=f;break;case'newparam':this.parseNewparam(f);break;case'image':var j=(new u1()).parse(f);g[j.id]=j;break;case'extra':break;default:console.log(f.nodeName);break;}}return t;};U1.prototype.parseTechnique=function(d){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'constant':case'lambert':case'blinn':case'phong':this.shader=(new R1(f.nodeName,this)).parse(f);break;case'extra':this.parseExtra(f);break;default:break;}}};U1.prototype.parseExtra=function(d){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'technique':this.parseExtraTechnique(f);break;default:break;}}};U1.prototype.parseExtraTechnique=function(d){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'bump':this.shader.parse(d);break;default:break;}}};function V1(){this.url="";}V1.prototype.parse=function(d){this.url=d.getAttribute('url').replace(/^#/,'');return this;};function W1(){this.id="";this.name="";this.source={};this.sampler=[];this.channel=[];}W1.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');this.source={};for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'animation':var k=(new W1()).parse(f);for(var s in k.source){this.source[s]=k.source[s];}for(var j=0;j<k.channel.length;j++){this.channel.push(k.channel[j]);this.sampler.push(k.sampler[j]);}break;case'source':var s=(new O1()).parse(f);this.source[s.id]=s;break;case'sampler':this.sampler.push((new Y1(this)).parse(f));break;case'channel':this.channel.push((new X1(this)).parse(f));break;default:break;}}return this;};function X1(d){this.animation=d;this.source="";this.target="";this.fullSid=null;this.sid=null;this.dotSyntax=null;this.arrSyntax=null;this.arrIndices=null;this.member=null;}X1.prototype.parse=function(d){this.source=d.getAttribute('source').replace(/^#/,'');this.target=d.getAttribute('target');var p=this.target.split('/');var i=p.shift();var s=p.shift();var f=(s.indexOf(".")>=0);var k=(s.indexOf("(")>=0);if(f){p=s.split(".");this.sid=p.shift();this.member=p.shift();}else if(k){var l=s.split("(");this.sid=l.shift();for(var j=0;j<l.length;j++){l[j]=parseInt(l[j].replace(/\)/,''));}this.arrIndices=l;}else{this.sid=s;}this.fullSid=s;this.dotSyntax=f;this.arrSyntax=k;return this;};function Y1(d){this.id="";this.animation=d;this.inputs=[];this.input=null;this.output=null;this.strideOut=null;this.interpolation=null;this.startTime=null;this.endTime=null;this.duration=0;}Y1.prototype.parse=function(d){this.id=d.getAttribute('id');this.inputs=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'input':this.inputs.push((new N1()).parse(f));break;default:break;}}return this;};Y1.prototype.create=function(){for(var i=0;i<this.inputs.length;i++){var d=this.inputs[i];var s=this.animation.source[d.source];switch(d.semantic){case'INPUT':this.input=s.read();break;case'OUTPUT':this.output=s.read();this.strideOut=s.accessor.stride;break;case'INTERPOLATION':this.interpolation=s.read();break;case'IN_TANGENT':break;case'OUT_TANGENT':break;default:console.log(d.semantic);break;}}this.startTime=0;this.endTime=0;this.duration=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(var i=0;i<this.input.length;i++){this.startTime=Math.min(this.startTime,this.input[i]);this.endTime=Math.max(this.endTime,this.input[i]);}this.duration=this.endTime-this.startTime;}};Y1.prototype.getData=function(t,n,m){var d;if(t==='matrix'&&this.strideOut===16){d=this.output[n];}else if(this.strideOut>1){d=[];n*=this.strideOut;for(var i=0;i<this.strideOut;++i){d[i]=this.output[n+i];}if(this.strideOut===3){switch(t){case'rotate':case'translate':u2(d,-1);break;case'scale':u2(d,1);break;}}else if(this.strideOut===4&&t==='matrix'){u2(d,-1);}}else{d=this.output[n];if(m&&t==='translate'){d=w2(m,d);}}return d;};function Z1(t){this.targets=[];this.time=t;}Z1.prototype.addTarget=function(f,t,m,d){this.targets.push({sid:f,member:m,transform:t,data:d});};Z1.prototype.apply=function(o){for(var i=0;i<this.targets.length;++i){var t=this.targets[i];if(!o||t.sid===o){t.transform.update(t.data,t.member);}}};Z1.prototype.getTarget=function(f){for(var i=0;i<this.targets.length;++i){if(this.targets[i].sid===f){return this.targets[i];}}return null;};Z1.prototype.hasTarget=function(f){for(var i=0;i<this.targets.length;++i){if(this.targets[i].sid===f){return true;}}return false;};Z1.prototype.interpolate=function(n,t){for(var i=0,l=this.targets.length;i<l;i++){var d=this.targets[i],f=n.getTarget(d.sid),k;if(d.transform.type!=='matrix'&&f){var s=(t-this.time)/(n.time-this.time),m=f.data,p=d.data;if(s<0)s=0;if(s>1)s=1;if(p.length){k=[];for(var j=0;j<p.length;++j){k[j]=p[j]+(m[j]-p[j])*s;}}else{k=p+(m-p)*s;}}else{k=d.data;}d.transform.update(k,d.member);}};function $1(){this.id="";this.name="";this.technique="";}$1.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'optics':this.parseOptics(f);break;default:break;}}return this;};$1.prototype.parseOptics=function(d){for(var i=0;i<d.childNodes.length;i++){if(d.childNodes[i].nodeName==='technique_common'){var t=d.childNodes[i];for(var j=0;j<t.childNodes.length;j++){this.technique=t.childNodes[j].nodeName;if(this.technique==='perspective'){var p=t.childNodes[j];for(var k=0;k<p.childNodes.length;k++){var f=p.childNodes[k];switch(f.nodeName){case'yfov':this.yfov=f.textContent;break;case'xfov':this.xfov=f.textContent;break;case'znear':this.znear=f.textContent;break;case'zfar':this.zfar=f.textContent;break;case'aspect_ratio':this.aspect_ratio=f.textContent;break;}}}else if(this.technique==='orthographic'){var o=t.childNodes[j];for(var k=0;k<o.childNodes.length;k++){var f=o.childNodes[k];switch(f.nodeName){case'xmag':this.xmag=f.textContent;break;case'ymag':this.ymag=f.textContent;break;case'znear':this.znear=f.textContent;break;case'zfar':this.zfar=f.textContent;break;case'aspect_ratio':this.aspect_ratio=f.textContent;break;}}}}}}return this;};function _1(){this.url="";}_1.prototype.parse=function(d){this.url=d.getAttribute('url').replace(/^#/,'');return this;};function a2(){this.id="";this.name="";this.technique="";}a2.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'technique_common':this.parseCommon(f);break;case'technique':this.parseTechnique(f);break;default:break;}}return this;};a2.prototype.parseCommon=function(d){for(var i=0;i<d.childNodes.length;i++){switch(d.childNodes[i].nodeName){case'directional':case'point':case'spot':case'ambient':this.technique=d.childNodes[i].nodeName;var l=d.childNodes[i];for(var j=0;j<l.childNodes.length;j++){var k=l.childNodes[j];switch(k.nodeName){case'color':var m=j2(k.textContent);this.color=new THREE.Color(0);this.color.setRGB(m[0],m[1],m[2]);this.color.a=m[3];break;case'falloff_angle':this.falloff_angle=parseFloat(k.textContent);break;case'quadratic_attenuation':var f=parseFloat(k.textContent);this.distance=f?Math.sqrt(1/f):0;}}}}return this;};a2.prototype.parseTechnique=function(d){this.profile=d.getAttribute('profile');for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];switch(f.nodeName){case'intensity':this.intensity=parseFloat(f.textContent);break;}}return this;};function b2(){this.url="";}b2.prototype.parse=function(d){this.url=d.getAttribute('url').replace(/^#/,'');return this;};function c2(){this.id='';this.name='';this.joints=[];this.links=[];}c2.prototype.parse=function(d){this.id=d.getAttribute('id');this.name=d.getAttribute('name');this.joints=[];this.links=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'technique_common':this.parseCommon(f);break;default:break;}}return this;};c2.prototype.parseCommon=function(d){for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(d.childNodes[i].nodeName){case'joint':this.joints.push((new d2()).parse(f));break;case'link':this.links.push((new e2()).parse(f));break;default:break;}}return this;};function d2(){this.sid='';this.name='';this.axis=new THREE.Vector3();this.limits={min:0,max:0};this.type='';this.static=false;this.zeroPosition=0.0;this.middlePosition=0.0;}d2.prototype.parse=function(d){this.sid=d.getAttribute('sid');this.name=d.getAttribute('name');this.axis=new THREE.Vector3();this.limits={min:0,max:0};this.type='';this.static=false;this.zeroPosition=0.0;this.middlePosition=0.0;var f=d.querySelector('axis');var j=j2(f.textContent);this.axis=x2(j,0);var m=d.querySelector('limits min')?parseFloat(d.querySelector('limits min').textContent):-360;var k=d.querySelector('limits max')?parseFloat(d.querySelector('limits max').textContent):360;this.limits={min:m,max:k};var l=['prismatic','revolute'];for(var i=0;i<l.length;i++){var t=l[i];var n=d.querySelector(t);if(n){this.type=t;}}if(this.limits.min>=this.limits.max){this.static=true;}this.middlePosition=(this.limits.min+this.limits.max)/2.0;return this;};function e2(){this.sid='';this.name='';this.transforms=[];this.attachments=[];}e2.prototype.parse=function(d){this.sid=d.getAttribute('sid');this.name=d.getAttribute('name');this.transforms=[];this.attachments=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'attachment_full':this.attachments.push((new f2()).parse(f));break;case'rotate':case'translate':case'matrix':this.transforms.push((new B1()).parse(f));break;default:break;}}return this;};function f2(){this.joint='';this.transforms=[];this.links=[];}f2.prototype.parse=function(d){this.joint=d.getAttribute('joint').split('/').pop();this.links=[];for(var i=0;i<d.childNodes.length;i++){var f=d.childNodes[i];if(f.nodeType!=1)continue;switch(f.nodeName){case'link':this.links.push((new e2()).parse(f));break;case'rotate':case'translate':case'matrix':this.transforms.push((new B1()).parse(f));break;default:break;}}return this;};function g2(d){var i=d.getAttribute('id');if(e[i]!=undefined){return e[i];}e[i]=(new O1(i)).parse(d);return e[i];}function h2(n){if(n==="dae"){return"http://www.collada.org/2005/11/COLLADASchema";}return null;}function i2(s){var d=l2(s);var f=[];for(var i=0,l=d.length;i<l;i++){f.push((d[i]==='true'||d[i]==='1')?true:false);}return f;}function j2(s){var d=l2(s);var f=[];for(var i=0,l=d.length;i<l;i++){f.push(parseFloat(d[i]));}return f;}function k2(s){var d=l2(s);var f=[];for(var i=0,l=d.length;i<l;i++){f.push(parseInt(d[i],10));}return f;}function l2(s){return(s.length>0)?m2(s).split(/\s+/):[];}function m2(s){return s.replace(/^\s+/,"").replace(/\s+$/,"");}function n2(d,n,f){if(d.hasAttribute(n)){return parseFloat(d.getAttribute(n));}else{return f;}}function o2(d,n,f){if(d.hasAttribute(n)){return parseInt(d.getAttribute(n),10);}else{return f;}}function p2(d,n,f){if(d.hasAttribute(n)){return d.getAttribute(n);}else{return f;}}function q2(f,n){if(f===undefined){var s='0.';while(s.length<n+2){s+='0';}return s;}n=n||2;var p=f.toString().split('.');p[1]=p.length>1?p[1].substr(0,n):"0";while(p[1].length<n){p[1]+='0';}return p.join('.');}function r2(t,d){var l=new THREE.ImageLoader();l.load(d,function(i){t.image=i;t.needsUpdate=true;});}function s2(o,d){o.doubleSided=false;var n=d.querySelectorAll('extra double_sided')[0];if(n){if(n&&parseInt(n.textContent,10)===1){o.doubleSided=true;}}}function t2(){if(M.convertUpAxis!==true||O===M.upAxis){P=null;}else{switch(O){case'X':P=M.upAxis==='Y'?'XtoY':'XtoZ';break;case'Y':P=M.upAxis==='X'?'YtoX':'YtoZ';break;case'Z':P=M.upAxis==='X'?'ZtoX':'ZtoY';break;}}}function u2(d,s){if(M.convertUpAxis!==true||O===M.upAxis){return;}switch(P){case'XtoY':var t=d[0];d[0]=s*d[1];d[1]=t;break;case'XtoZ':var t=d[2];d[2]=d[1];d[1]=d[0];d[0]=t;break;case'YtoX':var t=d[0];d[0]=d[1];d[1]=s*t;break;case'YtoZ':var t=d[1];d[1]=s*d[2];d[2]=t;break;case'ZtoX':var t=d[0];d[0]=d[1];d[1]=d[2];d[2]=t;break;case'ZtoY':var t=d[1];d[1]=d[2];d[2]=s*t;break;}}function w2(d,f){if(M.convertUpAxis!==true||O===M.upAxis){return f;}switch(d){case'X':f=P==='XtoY'?f*-1:f;break;case'Y':f=P==='YtoZ'||P==='YtoX'?f*-1:f;break;case'Z':f=P==='ZtoY'?f*-1:f;break;default:break;}return f;}function x2(d,o){var f=[d[o],d[o+1],d[o+2]];u2(f,-1);return new THREE.Vector3(f[0],f[1],f[2]);}function y2(d){if(M.convertUpAxis){var f=[d[0],d[4],d[8]];u2(f,-1);d[0]=f[0];d[4]=f[1];d[8]=f[2];f=[d[1],d[5],d[9]];u2(f,-1);d[1]=f[0];d[5]=f[1];d[9]=f[2];f=[d[2],d[6],d[10]];u2(f,-1);d[2]=f[0];d[6]=f[1];d[10]=f[2];f=[d[0],d[1],d[2]];u2(f,-1);d[0]=f[0];d[1]=f[1];d[2]=f[2];f=[d[4],d[5],d[6]];u2(f,-1);d[4]=f[0];d[5]=f[1];d[6]=f[2];f=[d[8],d[9],d[10]];u2(f,-1);d[8]=f[0];d[9]=f[1];d[10]=f[2];f=[d[3],d[7],d[11]];u2(f,-1);d[3]=f[0];d[7]=f[1];d[11]=f[2];}return new THREE.Matrix4().set(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]);}function z2(i){if(i>-1&&i<3){var m=['X','Y','Z'],d={X:0,Y:1,Z:2};i=A2(m[i]);i=d[i];}return i;}function A2(m){if(M.convertUpAxis){switch(m){case'X':switch(P){case'XtoY':case'XtoZ':case'YtoX':m='Y';break;case'ZtoX':m='Z';break;}break;case'Y':switch(P){case'XtoY':case'YtoX':case'ZtoX':m='X';break;case'XtoZ':case'YtoZ':case'ZtoY':m='Z';break;}break;case'Z':switch(P){case'XtoZ':m='X';break;case'YtoZ':case'ZtoX':case'ZtoY':m='Y';break;}break;}}return m;}return{load:Q,parse:R,setPreferredShading:S,applySkin:e1,geometries:x,options:M};}
;
