/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/model/type/Unit"],function(N,P,V,B){"use strict";var c=new Map(),r=/\.(\d+)$/;function g(k,p){return sap.ui.getCore().getLibraryResourceBundle().getText(k,p);}var U=B.extend("sap.ui.model.odata.type.Unit",{constructor:function(f,C,d){if(f&&f["customUnits"]){throw new Error("Format option customUnits is not supported");}if(C){throw new Error("Constraints not supported");}if(arguments.length>2){throw new Error("Only the parameter oFormatOptions is supported");}this.bParseAsString=!f||!("parseAsString"in f)||f.parseAsString;f=Object.assign({unitOptional:true},f,{parseAsString:true});B.call(this,f,C);this.bParseWithValues=true;this.setConstraints=function(){throw new Error("Constraints not supported");};this.setFormatOptions=function(){throw new Error("Format options are immutable");};this.mCustomUnits=undefined;}});U.prototype.formatValue=function(v,t){var a=this;if(this.mCustomUnits===undefined&&v&&v[2]!==undefined){if(v[2]===null){this.mCustomUnits=null;}else{this.mCustomUnits=c.get(v[2]);if(!this.mCustomUnits){this.mCustomUnits={};Object.keys(v[2]).forEach(function(k){a.mCustomUnits[k]={decimals:v[2][k].UnitSpecificScale,displayName:v[2][k].Text,"unitPattern-count-other":N.getDefaultUnitPattern(k)};});c.set(v[2],this.mCustomUnits);}B.prototype.setFormatOptions.call(this,Object.assign({customUnits:this.mCustomUnits},this.oFormatOptions));}}if(!v||v[0]===undefined||v[1]===undefined||this.mCustomUnits===undefined&&v[2]===undefined){return null;}return B.prototype.formatValue.call(this,v.slice(0,2),t);};U.prototype.getInterface=function(){return this;};U.prototype.getName=function(){return"sap.ui.model.odata.type.Unit";};U.prototype.parseValue=function(v,s,C){var d,f,m,u,a;if(this.mCustomUnits===undefined){throw new P("Cannot parse value without unit customizing");}a=B.prototype.parseValue.apply(this,arguments);u=a[1]||C[1];if(a[0].includes(".")){a[0]=a[0].replace(/0+$/,"").replace(/\.$/,"");}if(u&&this.mCustomUnits){m=r.exec(a[0]);f=m?m[1].length:0;d=this.mCustomUnits[u].decimals;if(f>d){throw new P(d?g("EnterNumberFraction",[d]):g("EnterInt"));}}if(!this.bParseAsString){a[0]=Number(a[0]);}return a;};U.prototype.validateValue=function(v){if(this.mCustomUnits===undefined){throw new V("Cannot validate value without unit customizing");}};return U;});
