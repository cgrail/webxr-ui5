/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','sap/ui/model/BindingMode','sap/ui/model/Context','sap/ui/model/Model','sap/ui/model/odata/v2/ODataAnnotations','sap/ui/model/odata/ODataUtils','sap/ui/model/odata/CountMode','sap/ui/model/odata/UpdateMethod','sap/ui/model/odata/OperationMode','sap/ui/model/odata/MessageScope','./ODataContextBinding','./ODataListBinding','sap/ui/model/odata/ODataMetadata','sap/ui/model/odata/ODataPropertyBinding','./ODataTreeBinding','sap/ui/model/FilterProcessor','sap/ui/model/odata/ODataMetaModel','sap/ui/core/message/MessageParser','sap/ui/model/odata/ODataMessageParser','sap/ui/thirdparty/datajs',"sap/base/Log","sap/base/assert","sap/base/util/uid","sap/base/util/UriParameters","sap/base/util/deepEqual","sap/base/util/merge","sap/base/security/encodeURL","sap/ui/thirdparty/jquery","sap/base/util/isPlainObject","sap/base/util/each"],function(U,B,C,M,O,a,b,c,d,e,f,g,h,l,m,F,o,p,q,r,L,s,u,t,v,w,x,Q,y,z){"use strict";var A=M.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(S,P){M.apply(this,arguments);var i,j,H,T,W,k,n,R,E,G,I,J,K,N,V,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1=this;if(typeof(S)==="object"){P=S;S=P.serviceUrl;}if(P){i=P.user;j=P.password;H=P.headers;T=P.tokenHandling;W=P.withCredentials;k=P.maxDataServiceVersion;n=P.useBatch;R=P.refreshAfterChange;E=P.annotationURI;G=P.loadAnnotationsJoined;K=P.defaultBindingMode;I=P.defaultCountMode;J=P.preliminaryContext;N=P.defaultOperationMode;V=P.metadataNamespaces;X=P.serviceUrlParams;Y=P.metadataUrlParams;Z=P.json;$=P.messageParser;_=P.skipMetadataAnnotationParsing;a1=P.defaultUpdateMethod;b1=P.disableHeadRequestForToken;c1=P.sequentializeRequests;d1=P.disableSoftStateHeader;e1=P.bindableResponseHeaders;f1=P.warmupUrl;g1=P.canonicalRequests;}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!g1;this.sMessageScope=e.RequestedObjects;this.sWarmupUrl=f1;this.bWarmup=!!f1;this.mSupportedBindingModes={"OneWay":true,"OneTime":true,"TwoWay":true};this.mUnsupportedFilterOperators={"Any":true,"All":true};this.sDefaultBindingMode=K||B.OneWay;this.bIsMessageScopeSupported=false;this.bJSON=Z!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=a1||c.Merge;this.bTokenHandling=T!==false;this.bWithCredentials=W===true;this.bUseBatch=n!==false;this.bRefreshAfterChange=R!==false;this.sMaxDataServiceVersion=k;this.bLoadAnnotationsJoined=G!==false;this.sAnnotationURI=E;this.sDefaultCountMode=I||b.Request;this.sDefaultOperationMode=N||d.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!_;this.bDisableHeadRequestForToken=!!b1;this.bSequentializeRequests=!!c1;this.bDisableSoftStateHeader=!!d1;this.aBindableResponseHeaders=e1?e1:null;this.bPreliminaryContext=J||false;this.mMetadataUrlParams=Y||{};if($){$.setProcessor(this);}this.oMessageParser=$;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();this.sServiceUrl=S;var i1=S.split("?");if(i1.length>1){this.sServiceUrl=i1[0];if(i1[1]){this.aUrlParams.push(i1[1]);}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=i;this.sPassword=j;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true");}this.oHeaders={};this.setHeaders(H);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header";}var j1=this._getServerUrl();var k1=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=A._getSharedData("server",j1);this.oSharedServiceData=A._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=A._getSharedData("meta",k1);this.bUseCache=this._cacheSupported(k1);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new h(k1,{async:true,cacheKey:this.bUseCache?k1:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:V,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata;}}else{this.oMetadata=this.oSharedMetaData.oMetadata;}this.oAnnotations=new O(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(k1),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"];}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(X){this.aUrlParams=this.aUrlParams.concat(a._createUrlParamsArray(X));}this.onMetadataFailed=function(l1){h1.fireMetadataFailed(l1.getParameters());};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed);}this.oMetadata.loaded().then(function(){h1._initializeMetadata();});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata";}else{this.oHeaders["Accept"]="application/json";}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml";}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion;}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});A.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};A.prototype.attachBatchRequestFailed=function(i,j,k){this.attachEvent("batchRequestFailed",i,j,k);return this;};A.prototype.detachBatchRequestFailed=function(i,j){this.detachEvent("batchRequestFailed",i,j);return this;};A.prototype.fireBatchRequestFailed=function(i){this.fireEvent("batchRequestFailed",i);return this;};A.prototype.attachBatchRequestSent=function(i,j,k){this.attachEvent("batchRequestSent",i,j,k);return this;};A.prototype.detachBatchRequestSent=function(i,j){this.detachEvent("batchRequestSent",i,j);return this;};A.prototype.fireBatchRequestSent=function(i){this.fireEvent("batchRequestSent",i);return this;};A.prototype.attachBatchRequestCompleted=function(i,j,k){this.attachEvent("batchRequestCompleted",i,j,k);return this;};A.prototype.detachBatchRequestCompleted=function(i,j){this.detachEvent("batchRequestCompleted",i,j);return this;};A.prototype.fireBatchRequestCompleted=function(i){this.fireEvent("batchRequestCompleted",i);return this;};A.mSharedData={server:{},service:{},meta:{}};A._getSharedData=function(S,k){var i=this.mSharedData[S][k];if(!i){i={};this.mSharedData[S][k]=i;}return i;};A.prototype._initializeMetadata=function(){if(this.bDestroyed){return;}this.bIsMessageScopeSupported=this.oMetadata._isMessageScopeSupported();var i=function(){this.fireMetadataLoaded({metadata:this.oMetadata});L.debug(this+" - metadataloaded fired");}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(i,this.fireMetadataFailed.bind(this));}else{i();}};A.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh();}};A.prototype.fireAnnotationsLoaded=function(i){this.fireEvent("annotationsLoaded",i);return this;};A.prototype.attachAnnotationsLoaded=function(i,j,k){this.attachEvent("annotationsLoaded",i,j,k);return this;};A.prototype.detachAnnotationsLoaded=function(i,j){this.detachEvent("annotationsLoaded",i,j);return this;};A.prototype.fireAnnotationsFailed=function(i){this.fireEvent("annotationsFailed",i);L.debug(this+" - annotationsfailed fired");return this;};A.prototype.attachAnnotationsFailed=function(i,j,k){this.attachEvent("annotationsFailed",i,j,k);return this;};A.prototype.detachAnnotationsFailed=function(i,j){this.detachEvent("annotationsFailed",i,j);return this;};A.prototype.fireMetadataLoaded=function(i){this.fireEvent("metadataLoaded",i);return this;};A.prototype.attachMetadataLoaded=function(i,j,k){this.attachEvent("metadataLoaded",i,j,k);return this;};A.prototype.detachMetadataLoaded=function(i,j){this.detachEvent("metadataLoaded",i,j);return this;};A.prototype.fireMetadataFailed=function(i){this.fireEvent("metadataFailed",i);return this;};A.prototype.attachMetadataFailed=function(i,j,k){this.attachEvent("metadataFailed",i,j,k);return this;};A.prototype.detachMetadataFailed=function(i,j){this.detachEvent("metadataFailed",i,j);return this;};A.prototype._createEventInfo=function(R,k,n){var E={};E.url=R.requestUri;E.method=R.method;E.async=R.async;E.headers=R.headers;if(n){E.requests=[];for(var i=0;i<n.length;i++){var G={};if(Array.isArray(n[i])){var H=n[i];for(var j=0;j<H.length;j++){var R=H[j].request;var I=n[i][j].response;G={};G.url=R.requestUri;G.method=R.method;G.headers=R.headers;if(I){G.response={};if(R._aborted){G.success=false;G.response.statusCode=0;G.response.statusText="abort";}else{G.success=true;if(I.message){G.response.message=I.message;I=I.response;G.response.responseText=I.body;G.success=false;}G.response.headers=I.headers;G.response.statusCode=I.statusCode;G.response.statusText=I.statusText;}}E.requests.push(G);}}else{var R=n[i].request;var I=n[i].response;G.url=R.requestUri;G.method=R.method;G.headers=R.headers;if(I){G.response={};if(R._aborted){G.success=false;G.response.statusCode=0;G.response.statusText="abort";}else{G.success=true;if(I.message){G.response.message=I.message;I=I.response;G.response.responseText=I.body;G.success=false;}G.response.headers=I.headers;G.response.statusCode=I.statusCode;G.response.statusText=I.statusText;}}E.requests.push(G);}}}if(k){E.response={};E.success=true;if(k.message){E.response.message=k.message;E.success=false;}if(k.response){k=k.response;}if(k&&k.statusCode!=undefined){E.response.headers=k.headers;E.response.statusCode=k.statusCode;E.response.statusText=k.statusText;E.response.responseText=k.body!==undefined?k.body:k.responseText;}}E.ID=R.requestID;return E;};A.prototype._createRequestID=function(){var R;R=u();return R;};A.prototype._getServerUrl=function(){var S,i;S=new U(this.sServiceUrl).absoluteTo(document.baseURI);i=new U("/").absoluteTo(S).toString();return i;};A.prototype._createMetadataUrl=function(i){if(i.indexOf(this.sServiceUrl)==-1){if(!i.startsWith("/")){i="/"+i;}i=this.sServiceUrl+i;}var j=new t(i||window.location.href).mParams||{};Object.keys(j).forEach(function(K){j[K]=j[K][0];});var k=Q.extend({},this.mMetadataUrlParams,j);var n=a._createUrlParamsArray(k);var E=i.split("?");if(E.length>1){i=E[0];}return this._addUrlParams(i,n);};A.prototype._addUrlParams=function(i,j){var k=[];if(this.aUrlParams){k=k.concat(this.aUrlParams);}if(j){k=k.concat(j);}if(k&&k.length>0){i+="?"+k.join("&");}return i;};A.prototype._createRequestUrl=function(P,i,j,k){var n,E="";n=this._normalizePath(P,i);if(!k){E=this.sServiceUrl+n;}else{E=n.substr(n.indexOf('/')+1);}return this._addUrlParams(E,j);};A.prototype._importData=function(j,k,R,P,n,K){var E=this,G,H,I;P=P||"";K=K||"";if(j.results){G=[];z(j.results,function(i,W){K=E._getKey(W);var K=E._importData(W,k,R,P.substr(0,P.lastIndexOf("/")),n,K);if(K){G.push(K);}});return G;}else{if(K){P="/"+K;n+=K.substr(K.indexOf("("));}else{K=this._getKey(j);}if(!K){return K;}I=this._getEntity(K);if(!I||(I.__metadata&&I.__metadata.invalid)){I=j;K=this._addEntity(I);}if(this.aBindableResponseHeaders){var J={};for(var N in R.headers){var S=N.toLowerCase();if(this.aBindableResponseHeaders.indexOf(S)>-1){J[S]=R.headers[N];}}if(!Q.isEmptyObject(J)){if(!j.__metadata){j.__metadata={};}j.__metadata.headers=J;}}z(j,function(i,W){if(W&&(W.__metadata&&W.__metadata.uri||W.results)&&!W.__deferred){var X=P+"/"+i;var Y=n+"/"+i;H=E._importData(W,k,R,X,Y);if(Array.isArray(H)){I[i]={__list:H};}else{if(I[i]&&I[i].__ref){if(I[i].__ref!==H){E.mInvalidatedPaths[P.substr(P.lastIndexOf("("))+"/"+i]="/"+H;}}I[i]={__ref:H};}}else if(!W||!W.__deferred){I[i]=W;}});var T={};T[K]=I;this._updateChangedEntities(T);k[K]=true;P=P||'/'+K;n=n||P;var V=this.resolveFromCache(n);if(V==="/"+K||(V&&V.split("/").length>2)){this._writePathCache(V,"/"+K);}this._writePathCache(P,"/"+K);this._writePathCache(n,"/"+K);return K;}};A.prototype._writePathCache=function(P,i){if(P&&i){if(!this.mPathCache[P]){this.mPathCache[P]={};}this.mPathCache[P].canonicalPath=i;if(!this.mPathCache[P].updateKey){this.mPathCache[P].updateKey=P.substr(P.lastIndexOf("("));}}};A.prototype._removeReferences=function(j){var k=this,n;if(!j){return j;}if(j.results){n=[];z(j.results,function(i,E){n.push(k._removeReferences(E));});return n;}else{z(j,function(P,i){if(i){if(i["__ref"]||i["__list"]){delete j[P];}}});return j;}};A.prototype._restoreReferences=function(j,V){var k=this,K,n,R;function E(K){var n=V[K];if(!n){n=k._getObject("/"+K);s(n,"ODataModel inconsistent: "+K+" not found!");if(n){n=w({},n);V[K]=n;k._restoreReferences(n,V);}}return n;}if(!V){V={};}z(j,function(P,G){if(G){if(G.__ref){K=G.__ref;n=E(K);if(n){j[P]=n;}delete G.__ref;}else if(G.__list){R=[];z(G.__list,function(i,K){n=E(K);if(n){R.push(n);}});delete G.__list;G.results=R;}}});return j;};A.prototype.removeData=function(){this.oData={};};A.prototype.initialize=function(){var i=this.getBindings();i.forEach(function(j){j.initialize();});};A.prototype.invalidate=function(i){var E;for(var k in this.oData){E=this.oData[k];if(!i||i(k,E)){E.__metadata.invalid=true;}}};A.prototype.invalidateEntry=function(E){var i;if(typeof E==="string"){if(E.indexOf("/")===0){i=this._getObject(E);}else{i=this.oData[E];}}else if(E instanceof C){i=this._getObject(E.getPath());}if(i&&i.__metadata){i.__metadata.invalid=true;}};A.prototype.invalidateEntityType=function(E){var i;for(var k in this.oData){i=this.oData[k];if(i.__metadata.type===E){i.__metadata.invalid=true;}}};A.prototype.refresh=function(i,R,G){if(typeof i==="string"){G=i;i=false;R=false;}if(R){this.removeData();}this._refresh(i,G);};A.prototype._refresh=function(i,G,j,E){var k=this.getBindings();this.sRefreshGroupId=G;k.forEach(function(n){n._refresh(i,j,E);});this.sRefreshGroupId=undefined;};A.prototype.checkUpdate=function(i,j,k,n){if(j){if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(i,false,k);}.bind(this),0);}return;}if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;}var E=this.getBindings();E.forEach(function(G){if(!n||this.isMetaModelPath(G.getPath())){G.checkUpdate(i,k);}}.bind(this));this._processAfterUpdate();};A.prototype.checkDataState=function(i){var j=this.getBindings();j.forEach(function(k){if(k.checkDataState){k.checkDataState(i);}});};A.prototype.bindProperty=function(P,i,j){var k=new l(this,P,i,j);return k;};A.prototype.bindList=function(P,i,S,j,k){var n=new g(this,P,i,S,j,k);return n;};A.prototype.bindTree=function(P,i,j,k,S){var n=new m(this,P,i,j,k,S);return n;};A.prototype.createBindingContext=function(P,i,j,k,R){var n,E,N,G,H,I=this;if(i!==null&&typeof i==="object"&&!(i instanceof sap.ui.model.Context)){R=k;k=j;j=i;i=undefined;}if(typeof i=="function"){R=j;k=i;j=undefined;i=undefined;}if(typeof i=="boolean"){R=i;k=undefined;j=undefined;i=undefined;}if(typeof j=="function"){R=k;k=j;j=undefined;}if(typeof j=="boolean"){R=j;k=undefined;j=undefined;}if(typeof k=="boolean"){R=k;k=undefined;}n=this.resolve(P,i,this.bCanonicalRequests);if(!n&&this.bCanonicalRequests){n=this.resolve(P,i);}H=this.resolveDeep(P,i);if(!n){if(k){k(null);}return null;}if(R===undefined){R=this._isReloadNeeded(n,j);}if(!R){E=this.resolve(P,i,true);if(E){N=this.getContext(E);N.sDeepPath=H;}else{N=null;}if(k){k(N);}return N;}function J(W){var X=W?I._getKey(W):null,Y=!(P===""||P.indexOf("/")>0),Z=null,$,_;N=null;if(X){N=I.getContext('/'+X);N.sDeepPath=H;Z={__ref:X};}if(i&&S&&Y){$=i.getPath();$=$.substr(1);_=I._getEntity($);if(_){_[P]=Z;}}k(N);}function K(W){var X;if(W.statusCode=='404'&&i&&S){var Y=i.getPath();Y=Y.substr(1);X=I._getEntity(Y);if(X){X[P]={__ref:null};}}k(null);}if(k){var S=!P.startsWith("/");if(n){var T=[],V=this.createCustomParams(j);if(V){T.push(V);}if(j&&(j.batchGroupId||j.groupId)){G=j.groupId||j.batchGroupId;}this.read(P,{groupId:G,urlParameters:T,success:J,error:K,context:i});}else{k(null);}}if(j&&j.createPreliminaryContext){n=this.resolve(P,i);N=this.getContext(n);N.sDeepPath=H;return N;}};A.prototype._updateContext=function(i,P){if(!P.startsWith("/")){throw new Error("Path "+P+" must start with a / ");}i.sPath=P;this.mContexts[P]=i;};A.prototype._splitEntries=function(E){return E.replace(/\s/g,"").split(',').map(function(i){return i.split("/");});};A.prototype._filterOwnSelect=function(S,E){var i,j;if(!E){return[];}j=E.map(function(P){return P.name;});i=S.filter(function(k){return k.length===1;}).map(function(k){return k[0];});if(S.length===0||i.indexOf("*")!==-1||i.indexOf("**")!==-1){return j;}else{return i.filter(function(k){return j.indexOf(k)!==-1;});}};A.prototype._filterOwnExpand=function(E,S){return E.map(function(i){return i[0];}).filter(function(V,i,j){return j.indexOf(V)===i;}).filter(function(V){return S.length===0||S.some(function(i){return i.indexOf(V)===0||i.indexOf("**")===0;});});};A.prototype._filterSelectByNavProp=function(E,n){return E.filter(function(S){return S[0]===n;}).map(function(S){return S.length>1?S.slice(1):["**"];});};A.prototype._filterExpandByNavProp=function(E,n){return E.filter(function(S){return S.length>1&&S[0]===n;}).map(function(S){return S.slice(1);});};A.prototype._isReloadNeeded=function(P,k){var n=this,E=this.oMetadata,G,H=this._getObject(P),I=[],S=[];if(!this.oMetadata.isLoaded()){return true;}G=this.oMetadata._getEntityTypeByPath(P);if(this._isCreatedEntity(H)){return false;}function J(G,H,S,I){var K,N,R,T,V,W,X,Y,Z;if(!G){return false;}if(H===null){return false;}if(!H){return true;}if(H.__metadata&&H.__metadata.invalid){return true;}K=n._filterOwnSelect(S,G.property);for(var i=0;i<K.length;i++){Z=K[i];if(H[Z]===undefined){return true;}}N=n._filterOwnExpand(I,S);for(var i=0;i<N.length;i++){Y=N[i];R=H[Y];if(R===null){continue;}if(R===undefined||R.__deferred){return true;}T=E._getEntityTypeByNavProperty(G,Y);W=n._filterSelectByNavProp(S,Y);X=n._filterExpandByNavProp(I,Y);if(R.__ref){V=n._getEntity(R.__ref);if(J(T,V,W,X)){return true;}}if(R.__list){for(var j=0;j<R.__list.length;j++){V=n._getEntity(R.__list[j]);if(J(T,V,W,X)){return true;}}}}return false;}if(k){if(k.select){S=this._splitEntries(k.select);}if(k.expand){I=this._splitEntries(k.expand);}}return J(G,H,S,I);};A.prototype.createCustomParams=function(P){var i=[],j,S={expand:true,select:true};for(var n in P){if(n in S){i.push("$"+n+"="+x(P[n]));}if(n==="custom"){j=P[n];for(n in j){if(n.indexOf("$")===0){L.warning(this+" - Trying to set OData parameter '"+n+"' as custom query option!");}else if(typeof j[n]==='string'){i.push(n+"="+x(j[n]));}else{i.push(n);}}}}return i.join("&");};A.prototype.bindContext=function(P,i,j){var k=new f(this,P,i,j);return k;};A.prototype.setDefaultCountMode=function(i){this.sDefaultCountMode=i;};A.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode;};A.prototype._addEntity=function(E){var k=this._getKey(E);this.oData[k]=E;return k;};A.prototype._removeEntity=function(k){k=k&&a._normalizeKey(k);delete this.oData[k];delete this.mChangedEntities[k];delete this.mContexts["/"+k];};A.prototype._getEntity=function(k){var E=this.oData[k];if(!E){k=k&&a._normalizeKey(k);E=this.oData[k];}return E;};A.prototype._getKey=function(V){var k,i;if(V instanceof C){k=V.getPath().substr(1);}else if(V&&V.__metadata&&V.__metadata.uri){i=V.__metadata.uri;k=i.substr(i.lastIndexOf("/")+1);}else if(typeof V==='string'){k=V.substr(V.lastIndexOf("/")+1);}if(!this.oData[k]){k=k&&a._normalizeKey(k);}return k;};A.prototype.getKey=function(V){return this._getKey(V);};A.prototype.createKey=function(j,k){var E=this.oMetadata._getEntityTypeByPath(j),K=j,n=this,N,P;s(E,"Could not find entity type of collection \""+j+"\" in service metadata!");K+="(";if(E.key.propertyRef.length===1){N=E.key.propertyRef[0].name;s(N in k,"Key property \""+N+"\" is missing in object!");P=this.oMetadata._getPropertyMetadata(E,N);K+=encodeURIComponent(a.formatValue(k[N],P.type));}else{z(E.key.propertyRef,function(i,G){if(i>0){K+=",";}N=G.name;s(N in k,"Key property \""+N+"\" is missing in object!");P=n.oMetadata._getPropertyMetadata(E,N);K+=N;K+="=";K+=encodeURIComponent(a.formatValue(k[N],P.type));});}K+=")";return K;};A.prototype.getProperty=function(P,i,I){var V=this._getObject(P,i);if(!I){return V;}if(!y(V)){return V;}V=w({},V);if(I===true){return this._restoreReferences(V);}else{return this._removeReferences(V);}};A.prototype.getObject=function(P,n,E){if(y(n)){E=n;n=undefined;}var G=this,R=this.resolve(P,n),V=this._getObject(R),H=this.oMetadata._getEntityTypeByPath(R),I=[],S=[];if(!H||!y(V)||!V.__metadata||!V.__metadata.uri){return V;}if(!E||!(E.select||E.expand)){return w({},V);}function J(H,V,S,I){var K,N,T,W,X,Y,Z,$,_,a1,b1,c1,d1;if(!V){return undefined;}if(!H){return undefined;}T=G._filterOwnSelect(S,H.property);N={};for(var i=0;i<T.length;i++){c1=T[i];if(V[c1]!==undefined){N[c1]=V[c1];}else{L.fatal("No data loaded for select property: "+c1+" of entry: "+G.getKey(V));return undefined;}}if(V.__metadata){N.__metadata=V.__metadata;}K=G._filterOwnExpand(I,S);for(var i=0;i<K.length;i++){b1=K[i];X=V[b1];Y=G.oMetadata._getEntityTypeByNavProperty(H,b1);_=G._filterSelectByNavProp(S,b1);a1=G._filterExpandByNavProp(I,b1);if(X&&X.__ref){$=G._getObject("/"+X.__ref);Z=J(Y,$,_,a1);if(Z!==undefined){N[b1]=Z;}else{L.fatal("No data loaded for expand property: "+b1+" of entry: "+G.getKey(Z));return undefined;}}if(X&&X.__list){d1=[];for(var j=0;j<X.__list.length;j++){$=G._getObject("/"+X.__list[j]);Z=J(Y,$,_,a1);if(Z!==undefined){d1.push(Z);}else{L.fatal("No data loaded for expand property: "+b1+" of entry: "+G.getKey(Z));return undefined;}}N[b1]=d1;}}W=G._filterOwnSelect(S,H.navigationProperty);for(var k=0;k<W.length;k++){b1=W[k];if(K.indexOf(b1)===-1){var e1=N.__metadata.uri+"/"+b1;N[b1]={__deferred:{uri:e1}};}}return N;}if(E.select){S=this._splitEntries(E.select);}if(E.expand){I=this._splitEntries(E.expand);}V=J(H,V,S,I);return V;};A.prototype._getObject=function(P,i,j){var n=this.isLegacySyntax()?this.oData:null,k,E,R,S,G,H,I,K,J;R=this.resolve(P,i,this.bCanonicalRequests);if(!R&&this.bCanonicalRequests){R=this.resolve(P,i);}if(!R){return n;}if(this._isMetadataPath(R)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(R)){S=R.indexOf('/##');J=this.getMetaModel();if(!this.bMetaModelLoaded){return null;}G=R.substr(0,S);H=R.substr(S+3);I=J.getMetaContext(G);n=J.getProperty(H,I);}else{n=this.oMetadata._getAnnotation(R);}}}else{if(R==="/"){return this.oData;}var N=R.split("/"),T=0;K=N[1];N.splice(0,2);k=this.mChangedEntities[K];E=this._getEntity(K);n=j?E:k||E;while(n&&N[T]){var V=k&&k.hasOwnProperty(N[T]);k=k&&k[N[T]];E=E&&E[N[T]];n=j||!V?E:k;if(n){if(n.__ref){k=this.mChangedEntities[n.__ref];E=this._getEntity(n.__ref);n=j?E:k||E;}else if(n.__list){n=n.__list;}else if(n.__deferred){n=undefined;}}T++;}}if(y(k)){n=j?E:w({},E,k);}return n;};A.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken();}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}};A.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken;};A.prototype.getSecurityToken=function(){var T=this.oSharedServiceData.securityToken;if(!T){this.refreshSecurityToken();T=this.oSharedServiceData.securityToken;}return T;};A.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken);}else{this.pSecurityToken=new Promise(function(i,j){this.refreshSecurityToken(function(){i(this.oSharedServiceData.securityToken);}.bind(this),function(){j();},true);}.bind(this));}}return this.pSecurityToken;};A.prototype.refreshSecurityToken=function(S,E,i){var T;var j=this;var k=this._createRequestUrl("/");var n={abort:function(){this.request.abort();}};function G(K,R){if(R){T=j._getHeader("x-csrf-token",R.headers);j._setSessionContextIdHeader(j._getHeader("sap-contextid",R.headers));if(T){j.oSharedServerData.securityToken=T;j.oSharedServiceData.securityToken=T;j.pSecurityToken=Promise.resolve(T);j.oHeaders["x-csrf-token"]=T;}else{j.resetSecurityToken();j.bTokenHandling=false;}}if(S){S(K,R);}}function H(K){j.resetSecurityToken();j.bTokenHandling=false;j._handleError(K);if(E){E(K);}}function I(K){n.request=J("GET",H);}function J(R,E){var K=j._createRequest(k,"",R,j._getHeaders(undefined,true),null,null,!!i);K.headers["x-csrf-token"]="Fetch";return j._request(K,G,E,undefined,undefined,j.getServiceMetadata());}if(this.bDisableHeadRequestForToken){n.request=J("GET",H);}else{n.request=J("HEAD",I);}return n;};A.prototype._submitRequest=function(R,S,E){var j=this,H,k,n,G,I;G=new Promise(function(i,W){I=i;});function J(i,W){if(S){S(i,W);}I();}function K(i){if(j.bTokenHandling&&i.response){var W=j._getHeader("x-csrf-token",i.response.headers);if(!R.bTokenReset&&i.response.statusCode=='403'&&W&&W.toLowerCase()==="required"){j.resetSecurityToken();R.bTokenReset=true;P();return;}}if(E){E(i);}I();}function N(R){if(j.bTokenHandling&&R.method!=="GET"){j.pReadyForRequest=j.securityTokenAvailable();}return j.pReadyForRequest;}function P(){if(j.bTokenHandling){delete R.headers["x-csrf-token"];}N(R).then(function(i){if(j.bTokenHandling&&R.method!=="GET"){R.headers["x-csrf-token"]=i;}V();},function(){V();});}function T(W,R,X){var Y,Z=R.eventInfo.requests;if(Z){z(Z,function(i,R){if(Array.isArray(R)){R.forEach(function(R){z(R.parts,function(i,$){Y=j._createEventInfo(R.request,$.fnError);j["fireRequest"+W](Y);});});}else{if(R.parts){z(R.parts,function(i,$){Y=j._createEventInfo(R.request,$.fnError);j["fireRequest"+W](Y);});}else{Y=j._createEventInfo(R.request,R.fnError);j["fireRequest"+W](Y);}}});if(R.eventInfo.batch){Y=j._createEventInfo(R,X,Z);j["fireBatchRequest"+W](Y);}}}function V(){if(j.sSessionContextId){R.headers["sap-contextid"]=j.sSessionContextId;}k=j._request(R,J,K,H,undefined,j.getServiceMetadata());if(R.eventInfo){T("Sent",R,null);delete R.eventInfo;}if(n){k.abort();}}H=j._getODataHandler(R.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){P();});this.pSequentialRequestCompleted=G;}else{P();}return{abort:function(){if(k){k.abort();}n=true;}};};A.prototype._setSessionContextIdHeader=function(S){if(S){this.sSessionContextId=S;}};A.prototype._submitSingleRequest=function(R){var j=this,k,n={},G={},E={};function H(J,K){if(J===undefined&&K.statusCode===200){I({message:"Response did not contain a valid OData result",response:K});return;}function N(J,K){for(var i=0;i<R.parts.length;i++){if(R.parts[i].request._aborted){j._processAborted(R.parts[i].request,K);}else if(R.parts[i].fnSuccess){R.parts[i].fnSuccess(J,K);}}if(R.request.requestUri.indexOf("$count")===-1){j.checkUpdate(false,false,G);if(R.bRefreshAfterChange){j._refresh(false,undefined,n,E);}}}j._processSuccess(R.request,K,N,G,n,E);j._invalidatePathCache();j._setSessionContextIdHeader(j._getHeader("sap-contextid",K.headers));}function I(J){if(J.message=="Request aborted"){for(var i=0;i<R.parts.length;i++){j._processAborted(R.parts[i].request,J);}}else{for(var i=0;i<R.parts.length;i++){j._processError(R.parts[i].request,J,R.parts[i].fnError);}}j._processAfterUpdate();}R.request.eventInfo={requests:R.parts,batch:false};k=this._submitRequest(R.request,H,I);return k;};A.prototype._submitBatchRequest=function(k,R,S,E){var n=this,G={},H={},I={};function J(j,W,X){for(var i=0;i<j.parts.length;i++){if(X||j.parts[i].request._aborted){n._processAborted(j.parts[i].request,W);}else if(W.message){n._processError(j.parts[i].request,W,j.parts[i].fnError);}else{n._processSuccess(j.parts[i].request,W,j.parts[i].fnSuccess,H,G,I);}}}function K(W,X){if(W===undefined&&X.statusCode===200){N({message:"Response did not contain a valid OData batch result",response:X});return;}var Y,Z,$,_=W.__batchResponses;if(_){var i,j;for(i=0;i<_.length;i++){Y=_[i];if(Array.isArray(R[i])){if(Y.message){for(j=0;j<R[i].length;j++){Z=R[i][j];J(Z,Y);Z.response=Y;}}else{$=Y.__changeResponses;for(j=0;j<$.length;j++){var a1=$[j];Z=R[i][j];J(Z,a1);Z.response=a1;}}}else{Z=R[i];J(Z,Y);Z.response=Y;}}n._invalidatePathCache();n.checkUpdate(false,false,H);}n._processSuccess(k,X,S,H,G,I,true,R);n._setSessionContextIdHeader(n._getHeader("sap-contextid",X.headers));}function N(j){var W=j.message=="Request aborted";z(R,function(i,X){if(Array.isArray(X)){X.forEach(function(X){J(X,j,W);});}else{J(X,j,W);}});n._processAfterUpdate();if(W){n._processAborted(k,j,true);}else{n._processError(k,j,E,true,R);}}k.eventInfo={requests:R,batch:true};var P=this._submitRequest(k,K,N);function T(j){var E;for(var i=0;i<j.parts.length;i++){E=j.parts[i].fnError;if(!j.parts[i].request._aborted&&E){E(D);}}}var V={abort:function(){z(R,function(i,j){if(Array.isArray(j)){j.forEach(function(j){T(j);});}else{T(j);}});P.abort();}};return V;};A.prototype._invalidatePathCache=function(){var i=this,I;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(k){for(var j in i.mInvalidatedPaths){I=k.indexOf(j);if(I>-1){if(I+j.length!==i.mPathCache[k].canonicalPath.length){var E=k.substr(I+j.length);i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[j]+E;}else{i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[j];}}}});}this.mInvalidatedPaths={};};A.prototype._createBatchRequest=function(i){var j,R,k={},P={},n=true;P.__batchRequests=i;for(var I in i){if(i[I]&&i[I].__changeRequests||i[I]&&i[I].headers&&!i[I].headers['sap-cancel-on-close']){n=false;break;}}j=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){j+="?"+this.aUrlParams.join("&");}Q.extend(k,this.mCustomHeaders,this.oHeaders);k["Accept"]="multipart/mixed";delete k["Content-Type"];k['sap-cancel-on-close']=n;R={headers:k,requestUri:j,method:"POST",data:P,user:this.sUser,password:this.sPassword,async:true};R.withCredentials=this.bWithCredentials;return R;};A.prototype.abortInternalRequest=function(k,G){var R=this.mRequests;if(G in this.mDeferredGroups){R=this.mDeferredRequests;}var j=R[G];if(j&&k in j.map){var n=j.map[k];for(var i=0;i<n.parts.length;i++){n.parts[i].requestHandle.abort();}}};A.prototype._pushToRequestQueue=function(R,G,i,j,S,E,k,n){var H=R[G],I=j.key?j.key:j.method+":"+j.requestUri;if(this.bWarmup){return;}if(!H){H={};H.map={};H.requests=[];R[G]=H;}if(I in H.map&&(j.key||j.method==='GET')){var J=H.map[I];var K=J.request;j.deepPath=K.deepPath;if(this.bIsMessageScopeSupported&&this.sMessageScope===e.BusinessObject){j.headers["sap-message-scope"]=K.headers["sap-message-scope"];}if(J.bRefreshAfterChange===undefined){J.bRefreshAfterChange=n;}if(!j.key){J.parts.push({request:j,fnSuccess:S,fnError:E,requestHandle:k});}if(j.method==="GET"){delete K.data;}else{K.method=j.method;K.headers=j.headers;K.data=j.data;K.requestUri=j.requestUri;if(j.method==="PUT"){delete K.headers["x-http-method"];}if(K._aborted){delete K._aborted;}}}else{var J={request:j,bRefreshAfterChange:n,parts:[{request:j,fnSuccess:S,fnError:E,requestHandle:k}]};if(j.method==="GET"){H.requests.push(J);}else{if(!H.changes){H.changes={};}var N=H.changes[i];if(!N){N=[];H.changes[i]=N;}J.changeSetId=i;N.push(J);}H.map[I]=J;}};A.prototype._collectChangedEntities=function(G,j,E){var k=this;if(G.changes){z(G.changes,function(n,H){for(var i=0;i<H.length;i++){if(H[i].bRefreshAfterChange){var R=H[i].request,P="/"+R.requestUri.split("?")[0],I,K;if(R.method==="POST"||R.method==="DELETE"){var J=k.oMetadata._getEntityTypeByPath(P);if(J){E[J.entityType]=true;}}else{I=k._getObject(P);if(I){K=k._getKey(I);}else if(P.lastIndexOf("/")===0){K=k._getKey(P);}if(K){j[K]=true;}}}}});}};A.prototype._processRequestQueue=function(R,G,S,E){var j=this,P,k=[];function n(I,W){for(var i=0;i<I.parts.length;i++){var J=I.parts[i];if(J.request._aborted){j._processAborted(I.request,null);I.parts.splice(i,1);i--;}else if(W){J.request._handle=W;W.iRelevantRequests++;}}}function H(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort();}}};}if(this.bUseBatch){z(R,function(i,I){if(i===G||!G){var J={},K={};j._collectChangedEntities(I,J,K);if(Object.keys(J).length||Object.keys(K).length){j.bIncludeInCurrentBatch=true;j._refresh(false,i,J,K);j.bIncludeInCurrentBatch=false;}}});z(R,function(I,J){if(I===G||!G){var K=[],N=[],T,V;var W=H();if(J.changes){z(J.changes,function(Z,$){T={__changeRequests:[]};V=[];for(var i=0;i<$.length;i++){P='/'+j.getKey($[i].request.data);j.increaseLaundering(P,$[i].request.data);n($[i],W);if($[i].parts.length>0){if($[i].request.data&&$[i].request.data.__metadata){delete $[i].request.data.__metadata.created;}T.__changeRequests.push($[i].request);V.push($[i]);}}if(T.__changeRequests&&T.__changeRequests.length>0){K.push(T);N.push(V);}});}if(J.requests){var X=J.requests;for(var i=0;i<X.length;i++){n(X[i],W);if(X[i].parts.length>0){K.push(X[i].request);N.push(X[i]);}}}if(K.length>0){var Y=j._createBatchRequest(K);W.oRequestHandle=j._submitBatchRequest(Y,N,S,E);k.push(W.oRequestHandle);}delete R[I];}});}else{z(R,function(I,J){if(I===G||!G){if(J.changes){z(J.changes,function(N,T){for(var i=0;i<T.length;i++){var W=H();P='/'+j.getKey(T[i].request.data);j.increaseLaundering(P,T[i].request.data);n(T[i],W);if(T[i].parts.length>0){W.oRequestHandle=j._submitSingleRequest(T[i]);k.push(W.oRequestHandle);}}});}if(J.requests){var K=J.requests;for(var i=0;i<K.length;i++){var W=H();n(K[i],W);if(K[i].parts.length>0){W.oRequestHandle=j._submitSingleRequest(K[i]);k.push(W.oRequestHandle);}}}delete R[I];}});}this.checkDataState(this.mLaunderingState);return k.length==1?k[0]:k;};A.prototype._processRequestQueueAsync=function(R){var i=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){i._processRequestQueue(R);i.pCallAsync=undefined;});});}};A.prototype._processSuccess=function(R,i,S,G,j,E,k,n){var H=i.data,I,J,K,P,N,T,V,W={},X={},Y=this;if(!k){J=!(i.statusCode===204||i.statusCode==='204');K=R.requestUri;P=K.replace(this.sServiceUrl,"");if(!P.startsWith('/')){P='/'+P;}P=this._normalizePath(P);this.decreaseLaundering(P,R.data);if(J&&H===undefined&&i){this._parseResponse(i,R);L.fatal(this+" - No data was retrieved by service: '"+i.requestUri+"'");Y.fireRequestCompleted({url:i.requestUri,type:"GET",async:i.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false;}if(H&&H.results&&!Array.isArray(H.results)){H=H.results;}if(!i._imported&&H&&(Array.isArray(H)||typeof H=='object')){I=w({},H);if(R.key||R.created){Y._importData(I,W,i);}else{Y._importData(I,W,i,P,R.deepPath);}i._imported=true;}T=this._getEntity(R.key);if(W&&T&&T.__metadata.created&&T.__metadata.created.functionImport){var Z=[];var $=T["$result"];if($&&$.__list){z(W,function(a1){Z.push(a1);});$.__list=Z;}else if($&&$.__ref){z(W,function(a1){$.__ref=a1;});}}if(!J){N=P.split("/");if(N[1]){X[N[1]]=R;var _={};_[N[1]]=R.data;this._updateChangedEntities(_);}if(R.method==="DELETE"&&N[2]!=="$links"){this._removeEntity(N[1]);}}if(J&&R.method==="POST"){V=this.oMetadata._getEntityTypeByPath(P);if(V){E[V.entityType]=true;}if(R.key){if(R.created){var a1=this._getKey(H);var b1=this.getContext("/"+R.key);b1.bCreated=false;this._updateContext(b1,'/'+a1);T=this._getEntity(a1);if(T){delete T.__metadata.created;}}this._removeEntity(R.key);}}this._parseResponse(i,R,W,X);Q.extend(G,W);Q.extend(j,X);this._updateETag(R,i);}if(S){S(H,i);}var c1=this._createEventInfo(R,i,n);if(k){this.fireBatchRequestCompleted(c1);}else{this.fireRequestCompleted(c1);}return true;};A.prototype._processError=function(R,i,E,j,k){var P,n=this._handleError(i,R);if(!j){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);}if(E){E(n);}var G=this._createEventInfo(R,n,k);if(j){this.fireBatchRequestCompleted(G);this.fireBatchRequestFailed(G);}else{this.fireRequestCompleted(G);this.fireRequestFailed(G);}};var D={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};A.prototype._processAborted=function(R,i,j){var P;if(!j){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);}if(i){var E=this._createEventInfo(R,D);E.success=false;if(j){this.fireBatchRequestCompleted(E);}else{this.fireRequestCompleted(E);}}};A.prototype._processAfterUpdate=function(){var j=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var i=0;i<j.length;i++){j[i]();}};A.prototype._processChange=function(k,i,j,E){var P,G,H,I,J,K,N,R,S,T,V,W=this;G=this.oMetadata._getEntityTypeByPath(k);if(!j){j="MERGE";}P=w({},this._getObject('/'+k,true),i);if(i.__metadata&&i.__metadata.created){I=i.__metadata.created.method?i.__metadata.created.method:"POST";k=i.__metadata.created.key;N=true;H=i.__metadata.created;if(i.__metadata.created.functionImport){H.urlParameters=this._createFunctionImportParameters(i.__metadata.created.key,I,P);P=undefined;}else{delete P.__metadata['uri'];}}else if(j==="MERGE"){I="MERGE";V=this._getEntity(k);}else{I="PUT";}if(P&&P.__metadata){for(var n in P.__metadata){if(n!=='type'&&n!=='uri'&&n!=='etag'&&n!=='content_type'&&n!=='media_src'){delete P.__metadata[n];}}}if(P&&G){var X=this.oMetadata._getNavigationPropertyNames(G);X.forEach(function($){delete P[$];});}if(I==="MERGE"&&G&&V){z(P,function($,_){if($!=='__metadata'){if(v(V[$],_)&&!W.isLaundering('/'+k+'/'+$)){delete P[$];}}});var Y="/"+k,Z;z(P,function($,_){if($!=='__metadata'){Z=W.getProperty(Y+"/"+$+"/#@sap:unit");if(Z){if(P[Z]===undefined){P[Z]=V[Z];}}}});}P=this._removeReferences(P);S=H&&H.urlParameters?a._createUrlParamsArray(H.urlParameters):undefined;R=H?this._getHeaders(H.headers):this._getHeaders();J=H&&H.eTag?H.eTag:this.getETag(P);K=this._createRequestUrl('/'+k,null,S,this.bUseBatch);T=this._createRequest(K,E,I,R,P,J);if(N){T.created=true;}if(this.bUseBatch){T.requestUri=T.requestUri.replace(this.sServiceUrl+'/','');}return T;};A.prototype._resolveGroup=function(k){var i,E,P,G,j,n;E=this.oMetadata._getEntityTypeByPath(k);n=this._getObject('/'+k);if(n){P=n.__metadata.created;if(P){return{groupId:P.groupId,changeSetId:P.changeSetId};}}if(this.mChangeGroups[E.name]){i=this.mChangeGroups[E.name];G=i.groupId;j=i.single?u():i.changeSetId;}else if(this.mChangeGroups['*']){i=this.mChangeGroups['*'];G=i.groupId;j=i.single?u():i.changeSetId;}return{groupId:G,changeSetId:j};};A.prototype._updateETag=function(R,i){var j,E,k;j=R.requestUri.replace(this.sServiceUrl+'/','');if(!j.startsWith("/")){j="/"+j;}E=this._getObject(j.split("?")[0]);k=this._getHeader("etag",i.headers);if(E&&E.__metadata&&k){E.__metadata.etag=k;}};A.prototype._handleError=function(E,R){var P={},T;var i="The following problem occurred: "+E.message;P.message=E.message;if(E.response){this._parseResponse(E.response,R);if(this.bTokenHandling){T=this._getHeader("x-csrf-token",E.response.headers);if(E.response.statusCode=='403'&&T&&T.toLowerCase()==="required"){this.resetSecurityToken();}}i+=E.response.statusCode+","+E.response.statusText+","+E.response.body;P.statusCode=E.response.statusCode;P.statusText=E.response.statusText;P.headers=E.response.headers;P.responseText=E.response.body;}L.fatal(i);return P;};A.prototype.getData=function(P,i,I){return this.getProperty(P,i,I);};A.prototype._getODataHandler=function(i){if(i.indexOf("$batch")>-1){return r.batchHandler;}else if(i.indexOf("$count")>-1){return undefined;}else if(this.bJSON){return r.jsonHandler;}else{return r.atomHandler;}};A.prototype.getETag=function(P,i,E){if(typeof P=="object"){E=P;P="";}return this._getETag(P,i,E);};A.prototype._getETag=function(P,i,j){if(!j||!j.__metadata){j=this._getObject(P,i);}if(j&&j.__metadata){return j.__metadata.etag;}return null;};A.prototype.forceEntityUpdate=function(k){var i=this.mChangedEntities[k];if(i&&i.__metadata){i.__metadata.etag='*';}else{L.error(this+" - Entity with key "+k+" does not exist or has no change");}};A.prototype._createRequest=function(i,j,k,H,n,E,G){G=G!==false;if(E&&k!=="GET"){H["If-Match"]=E;}if(!H["Content-Type"]&&k!=="DELETE"&&k!=="GET"){if(this.bJSON){H["Content-Type"]="application/json";}else{H["Content-Type"]="application/atom+xml";}}if(i.indexOf("$count")>-1){H["Accept"]="text/plain, */*;q=0.5";}if(k==="MERGE"&&!this.bUseBatch){H["x-http-method"]="MERGE";k="POST";}if(j&&this.bIsMessageScopeSupported&&this.sMessageScope===e.BusinessObject){var P=j.split("/");H["sap-message-scope"]="/"+P[0]+P[1];}var R={headers:H,requestUri:i,method:k,user:this.sUser,password:this.sPassword,async:G,deepPath:j};if(n){R.data=n;}if(this.bWithCredentials){R.withCredentials=this.bWithCredentials;}R.requestID=this._createRequestID();return R;};A.prototype._processRequest=function(P,E){var R,i,j=false,k=this;if(this.bWarmup){return{abort:function(){}};}R={abort:function(){if(!j&&E){E(D);}if(i){i._aborted=true;if(i._handle){i._handle.abort();}}j=true;}};this.oMetadata.loaded().then(function(){i=P(R);k._processRequestQueueAsync(k.mRequests);if(j){R.abort();}});return R;};A.prototype.update=function(P,i,j){var S,E,R,k,n,G,H,I,J,K,N,T,V,W,X=this;if(j){I=j.groupId||j.batchGroupId;J=j.changeSetId;n=j.context;S=j.success;E=j.error;G=j.eTag;N=j.headers;K=j.urlParameters;W=j.refreshAfterChange;if(j.merge!==undefined){T=j.merge?"MERGE":"PUT";}}W=this._getRefreshAfterChange(W,I);H=a._createUrlParamsArray(K);N=this._getHeaders(N);T=T?T:this.sDefaultUpdateMethod;G=G||this._getETag(P,n,i);return this._processRequest(function(Y){k=X._createRequestUrl(P,n,H,X.bUseBatch);R=X._createRequest(k,X.resolveDeep(P,n),T,N,i,G);V=X.mRequests;if(I in X.mDeferredGroups){V=X.mDeferredRequests;}X._pushToRequestQueue(V,I,J,R,S,E,Y,W);return R;},E);};A.prototype.create=function(P,i,j){var R,k,E,n,S,G,H,I,J,K,N,T,V,W,X,Y=this;if(j){n=j.context;H=j.urlParameters;S=j.success;G=j.error;T=j.groupId||j.batchGroupId;W=j.changeSetId;N=j.eTag;J=j.headers;X=j.refreshAfterChange;}X=this._getRefreshAfterChange(X,T);K=a._createUrlParamsArray(H);J=this._getHeaders(J);V="POST";return this._processRequest(function(Z){k=Y._createRequestUrl(P,n,K,Y.bUseBatch);R=Y._createRequest(k,Y.resolveDeep(P,n),V,J,i,N);R.created=true;P=Y._normalizePath(P,n);E=Y.oMetadata._getEntityTypeByPath(P);R.entityTypes={};if(E){R.entityTypes[E.entityType]=true;}I=Y.mRequests;if(T in Y.mDeferredGroups){I=Y.mDeferredRequests;}Y._pushToRequestQueue(I,T,W,R,S,G,Z,X);return R;},G);};A.prototype.remove=function(P,i){var j,k,S,E,R,n,G,H,I,J,K,N,T,V,W,X=this;if(i){G=i.groupId||i.batchGroupId;H=i.changeSetId;j=i.context;S=i.success;E=i.error;I=i.eTag;N=i.headers;K=i.urlParameters;J=i.refreshAfterChange;}J=this._getRefreshAfterChange(J,G);T=a._createUrlParamsArray(K);N=this._getHeaders(N);V="DELETE";I=I||this._getETag(P,j);function Y(Z,$){k=n.substr(n.lastIndexOf('/')+1);if(k.indexOf('?')!==-1){k=k.substr(0,k.indexOf('?'));}X._removeEntity(k);if(S){S(Z,$);}}return this._processRequest(function(Z){n=X._createRequestUrl(P,j,T,X.bUseBatch);R=X._createRequest(n,X.resolveDeep(P,j),V,N,undefined,I);W=X.mRequests;if(G in X.mDeferredGroups){W=X.mDeferredRequests;}X._pushToRequestQueue(W,G,H,R,Y,E,Z,J);return R;},E);};A.prototype.callFunction=function(i,P){var R,j,k,n,E,G,S,H,I="GET",J,K,N,T,V=this,W,X,Y,Z,$,_,a1,b1={};if(P){J=P.groupId||P.batchGroupId;K=P.changeSetId;I=P.method?P.method:I;E=Object.assign({},P.urlParameters);T=P.eTag;S=P.success;H=P.error;N=P.headers;a1=P.refreshAfterChange;}a1=this._getRefreshAfterChange(a1,J);if(!i.startsWith("/")){L.fatal(this+" callFunction: path '"+i+"' must be absolute!");return;}N=this._getHeaders(N);$=new Promise(function(c1,d1){Y=c1;Z=d1;});_=this._processRequest(function(c1){k=V.oMetadata._getFunctionImportMetadata(i,I);s(k,V+": Function "+i+" not found in the metadata !");if(!k){Z();return;}var d1=k.entitySet||k.entitySetPath;if(d1){b1.$result={__list:[]};if(k.returnType&&k.returnType.indexOf("Collection")==-1){b1.$result={__ref:{}};}}if(k.parameter!=null){z(k.parameter,function(e1,f1){b1[f1.name]=V._createPropertyValue(f1.type);if(E&&E[f1.name]!==undefined){b1[f1.name]=E[f1.name];E[f1.name]=a.formatValue(E[f1.name],f1.type);}else{L.warning(V+" - No value for parameter '"+f1.name+"' found!'");}});}W=i.substring(1)+"('"+u()+"')";b1.__metadata={uri:V.sServiceUrl+'/'+W,created:{key:i.substring(1),success:S,error:H,headers:N,method:I,groupId:J,changeSetId:K,eTag:T,functionImport:true}};W=V._addEntity(b1);X=V.getContext("/"+W);V._writePathCache("/"+W,"/"+W);Y(X);G=a._createUrlParamsArray(E);j=V._createRequestUrl(i,null,G,V.bUseBatch);R=V._createRequest(j,V.resolveDeep(i,X),I,N,undefined,T);R.key=W;n=V.mRequests;if(J in V.mDeferredGroups){n=V.mDeferredRequests;}V._pushToRequestQueue(n,J,K,R,S,H,c1,a1);return R;},H);_.contextCreated=function(){return $;};return _;};A.prototype._createFunctionImportParameters=function(i,j,P){var k=Q.extend(true,{},P);delete k.__metadata;delete k["$result"];var n=this.oMetadata._getFunctionImportMetadata(i,j);s(n,this+": Function "+i+" not found in the metadata !");if(!n){return;}if(n.parameter!=null){z(n.parameter,function(I,E){if(k&&k[E.name]!==undefined){k[E.name]=a.formatValue(k[E.name],E.type);}});}return k;};A.prototype.read=function(P,i){var R,j,k,n,S,E,G,H,I,J,K,N,T,V,W,X,Y,Z,$,_=this;if(i){k=i.context;n=i.urlParameters;S=i.success;E=i.error;G=i.filters;H=i.sorters;Y=i.groupId||i.batchGroupId;W=i.headers;}if(this.sRefreshGroupId){Y=this.sRefreshGroupId;}V=a._createUrlParamsArray(n);W=this._getHeaders(W,true);X="GET";Z=this._getETag(P,k);var a1={abort:function(){if(R){R._aborted=true;}}};function b1(c1){J=a.createSortParams(H);if(J){V.push(J);}var d1=P;var e1=P.indexOf("$count");if(e1!==-1){d1=P.substring(0,e1-1);}T=_._normalizePath(d1,k);N=_.oMetadata._getEntityTypeByPath(T);K=F.groupFilters(G);I=a.createFilterParams(K,_.oMetadata,N);if(I){V.push(I);}j=_._createRequestUrl(P,k,V,_.bUseBatch);R=_._createRequest(j,_.resolveDeep(P,k),X,W,null,Z);$=_.mRequests;if(Y in _.mDeferredGroups){$=_.mDeferredRequests;}_._pushToRequestQueue($,Y,null,R,S,E,c1,false);return R;}if(this.bUseBatch&&this.bIncludeInCurrentBatch){R=b1(a1);return a1;}else{return this._processRequest(b1,E);}};A.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata();}};A.prototype.metadataLoaded=function(){var i=this.oMetadata.loaded();if(this.bLoadAnnotationsJoined){var j=function(){return i;};return this.pAnnotationsLoaded.then(j,j);}else{return i;}};A.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded;};A.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed();};A.prototype.getServiceAnnotations=function(){var i=this.oAnnotations.getData();return Q.isEmptyObject(i)?null:i;};A.prototype.onAnnotationsFailed=function(E){this.fireAnnotationsFailed(E.getParameters());};A.prototype.onAnnotationsLoaded=function(E){this.fireAnnotationsLoaded(E.getParameters());};A.prototype.addAnnotationUrl=function(i){var j=[].concat(i),k=[],n=[],E=[],G=this;j.forEach(function(H){var I=H.indexOf("$metadata");if(I>=0){H=G._createMetadataUrl(H);k.push(H);}else{n.push(H);}});return this.oMetadata._addUrl(k).then(function(P){return Promise.all(P.map(function(H){E=E.concat(H.entitySets);return G.oAnnotations.addSource({type:"xml",data:H["metadataString"]});}));}).then(function(){return G.oAnnotations.addSource(n);}).then(function(P){return{annotations:G.oAnnotations.getData(),entitySets:E};});};A.prototype.addAnnotationXML=function(X,S){return this.oAnnotations.addSource({type:"xml",data:X});};A.prototype.submitChanges=function(P){var R,G,j,S,E,k,n,H=false,I,J,K=this.bRefreshAfterChange,N,T=this;if(P){G=P.groupId||P.batchGroupId;S=P.success;E=P.error;if(P.merge!==undefined){I=P.merge?"MERGE":"PUT";}}if(G&&!this.mDeferredGroups[G]){L.fatal(this+" submitChanges: \""+G+"\" is not a deferred group!");}J=w({},T.mChangedEntities);this.oMetadata.loaded().then(function(){z(J,function($,_){j=T._resolveGroup($);if(j.groupId===G||!G){R=T._processChange($,_,I||T.sDefaultUpdateMethod);R.key=$;N=_.__metadata&&_.__metadata.created?_.__metadata.created:{};var k={abort:function(){R._aborted=true;}};if(j.groupId in T.mDeferredGroups){T._pushToRequestQueue(T.mDeferredRequests,j.groupId,j.changeSetId,R,N.success,N.error,k,K);}}});var V,W,X,Y,Z,i;for(V in T.mDeferredRequests){X=T.mDeferredRequests[V];for(W in X.changes){Y=X.changes[W];for(i=Y.length-1;i>=0;i--){Z=Y[i];if(Z.bRefreshAfterChange===undefined){Z.bRefreshAfterChange=K;}}}}n=T._processRequestQueue(T.mDeferredRequests,G,S,E);if(H){k.abort();}if(Array.isArray(n)&&n.length==0&&S){S({},undefined);}});k={abort:function(){if(n){if(Array.isArray(n)){n.forEach(function(k){k.abort();});}else{n.abort();}}else{if(!H&&E){E(D);}H=true;}}};return k;};A.prototype._updateChangedEntities=function(i){var j=this,R,E,n;function k(G,H,I){z(H,function(K){var J=I+'/'+K;if(y(H[K])&&y(G[K])){k(G[K],H[K],J);if(Q.isEmptyObject(H[K])){delete H[K];}}else if(v(H[K],G[K])&&!j.isLaundering(J)){delete H[K];if(I===R){E=j.oMetadata._getEntityTypeByPath(R);n=E&&j.oMetadata._getNavPropertyRefInfo(E,K);if(n&&H[n.name]){G[n.name]=H[n.name];delete H[n.name];}}}});}z(i,function(K,G){if(K in j.mChangedEntities){var H=j._getObject('/'+K,null,true);var I=j._getObject('/'+K);w(H,G);R='/'+K;k(H,I,R);if(Q.isEmptyObject(I)){delete j.mChangedEntities[K];j.abortInternalRequest(K,j._resolveGroup(K).groupId);}else{j.mChangedEntities[K]=I;I.__metadata={};Q.extend(I.__metadata,H.__metadata);}}});};A.prototype.resetChanges=function(P){var j=this,k,E={},n,G;if(P){z(P,function(I,H){j.getEntityByPath(H,null,E);k=E.propertyPath.split("/");var K=E.key;n=j.mChangedEntities[K];for(var i=0;i<k.length-1;i++){if(n.hasOwnProperty(k[i])){n=n[k[i]];}else{n=undefined;}}if(n){delete n[k[k.length-1]];}if(j.mChangedEntities[K]){G=j.mChangedEntities[K].__metadata;delete j.mChangedEntities[K].__metadata;if(Q.isEmptyObject(j.mChangedEntities[K])||!E.propertyPath){j.oMetadata.loaded().then(function(){j.abortInternalRequest(K,j._resolveGroup(K).groupId);});delete j.mChangedEntities[K];sap.ui.getCore().getMessageManager().removeMessages(j.getMessagesByEntity(K,true));}else{j.mChangedEntities[K].__metadata=G;}}else{L.warning(j+" - resetChanges: "+H+" is not changed");}});}else{z(this.mChangedEntities,function(K,i){j.oMetadata.loaded().then(function(){j.abortInternalRequest(K,j._resolveGroup(K).groupId);});delete j.mChangedEntities[K];sap.ui.getCore().getMessageManager().removeMessages(j.getMessagesByEntity(K,true));});}this.checkUpdate(true);};A.prototype.setProperty=function(P,V,j,k){var n,E,R,G,H,I,J,K,N,S,T,W,X={},Y={},Z,$,_,a1=false,b1=this,c1,d1,e1,f1,g1,h1;function i1(k1,l1){z(l1,function(N){if(y(l1[N])&&y(k1[N])){i1(k1[N],l1[N]);if(Q.isEmptyObject(l1[N])){delete l1[N];}}else if(v(l1[N],k1[N])){delete l1[N];}});}J=this.resolve(P,j);I=this.getEntityByPath(J,null,Y);if(!I){return false;}E=J.substring(J.lastIndexOf("/")+1);N=Y.key;H=this._getObject('/'+N,null,true);n=this._getObject(P,j,true);if(!this.mChangedEntities[N]){W=I.__metadata;I={};I.__metadata=Object.assign({},W);this.mChangedEntities[N]=I;}$=this.mChangedEntities[N];K=Y.propertyPath.split("/");for(var i=0;i<K.length-1;i++){if(!$.hasOwnProperty(K[i])){$[K[i]]={};}$=$[K[i]];}a1=H.__metadata.created&&H.__metadata.created.functionImport;$[E]=V;d1=this.oMetadata._getEntityTypeByPath(Y.key);e1=d1&&this.oMetadata._getNavPropertyRefInfo(d1,E);f1=e1&&H[e1.name]&&H[e1.name].__ref;if(f1&&e1.keys.length===1){if(V===null){h1=null;}else{g1={};e1.keys.forEach(function(k1){g1[k1]=I[k1]!==undefined?I[k1]:H[k1];});g1[e1.keys[0]]=V;h1=this.createKey(e1.entitySet,g1);}$[e1.name]={__ref:h1};}if(v(V,n)&&!this.isLaundering('/'+N)&&!a1){W=this.mChangedEntities[N].__metadata;c1=W&&W.created;delete this.mChangedEntities[N].__metadata;if(!c1){i1(H,this.mChangedEntities[N]);}if(Q.isEmptyObject(this.mChangedEntities[N])){delete this.mChangedEntities[N];X[N]=true;this.checkUpdate(false,k,X);b1.oMetadata.loaded().then(function(){b1.abortInternalRequest(N,b1._resolveGroup(N).groupId);});return true;}this.mChangedEntities[N].__metadata=W;}S=this._resolveGroup(N);R=this.mRequests;var j1=this.resolveDeep(P,j);if(S.groupId in this.mDeferredGroups){R=this.mDeferredRequests;G=this._processChange(N,{__metadata:I.__metadata},this.sDefaultUpdateMethod,j1);}else{G=this._processChange(N,this._getObject('/'+N),this.sDefaultUpdateMethod,j1);}G.key=N;Z=$.__metadata&&$.__metadata.created?$.__metadata.created:{};_=this._getRefreshAfterChange(undefined,S.groupId);this.oMetadata.loaded().then(function(){T={abort:function(){G._aborted=true;}};b1._pushToRequestQueue(R,S.groupId,S.changeSetId,G,Z.success,Z.error,T,_);b1._processRequestQueueAsync(b1.mRequests);});X[N]=true;this.checkUpdate(false,k,X);return true;};A.prototype._isHeaderPrivate=function(H){switch(H.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false;}};A.prototype.setHeaders=function(H){var i={},j=this;this.mCustomHeaders={};if(H){z(H,function(k,n){if(j._isHeaderPrivate(k)){L.warning(this+" - modifying private header: '"+k+"' not allowed!");}else{i[k]=n;}});this.mCustomHeaders=i;}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders);}};A.prototype._getHeaders=function(H,i){var j={},k=this;if(H){z(H,function(n,E){if(k._isHeaderPrivate(n)){L.warning(this+" - modifying private header: '"+n+"' not allowed!");}else{j[n]=E;}});}return Q.extend({'sap-cancel-on-close':!!i},this.mCustomHeaders,j,this.oHeaders);};A.prototype.getHeaders=function(){return Q.extend({},this.mCustomHeaders,this.oHeaders);};A.prototype._getHeader=function(H,i){var j;for(j in i){if(j.toLowerCase()===H.toLowerCase()){return i[j];}}return null;};A.prototype.hasPendingChanges=function(){return!Q.isEmptyObject(this.mChangedEntities);};A.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0;};A.prototype.getPendingChanges=function(){return w({},this.mChangedEntities);};A.prototype.updateBindings=function(i){this.checkUpdate(i);};A.prototype.setTokenHandlingEnabled=function(T){this.bTokenHandling=T;};A.prototype.setUseBatch=function(i){this.bUseBatch=i;};A.prototype.formatValue=function(V,T){return a.formatValue(V,T);};A.prototype.deleteCreatedEntry=function(i){var j=this,k,G;if(i){var k=i.getPath().substr(1);G=this._resolveGroup(k).groupId;j.oMetadata.loaded().then(function(){j.abortInternalRequest(k,G);});j._removeEntity(k);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(i.getPath(),true));}};A.prototype.createEntry=function(P,j){var S,E,R,k,n,G,K,H,I,J,N,T,V,W,X,Y={},Z,$="POST",_=this;if(j){X=j.properties;I=j.groupId||j.batchGroupId;J=j.changeSetId;G=j.context;S=j.success;E=j.error;Z=j.created;n=j.eTag;V=j.headers;T=j.urlParameters;N=j.refreshAfterChange;}V=V||{};N=this._getRefreshAfterChange(N,I);I=I?I:this.sDefaultChangeGroup;H=a._createUrlParamsArray(T);var a1={abort:function(){if(R){R._aborted=true;}}};function b1(){var c1;if(!P.startsWith("/")){P="/"+P;}var d1=_.oMetadata._getEntityTypeByPath(P);if(!d1){s(d1,"No Metadata for collection "+P+" found");return undefined;}if(typeof X==="object"&&!Array.isArray(X)){Y=w({},X);}else{for(var i=0;i<d1.property.length;i++){var e1=d1.property[i];var f1=(X?X.indexOf(e1.name):-1)>-1;if(!X||f1){Y[e1.name]=_._createPropertyValue(e1.type);if(f1){X.splice(X.indexOf(e1.name),1);}}}if(X){s(X.length===0,"No metadata for the following properties found: "+X.join(","));}}var g1=_.oMetadata._getEntitySetByType(d1);K=g1.name+"('"+u()+"')";Y.__metadata={type:""+d1.entityType,uri:_.sServiceUrl+'/'+K,created:{key:P.substring(1),success:S,error:E,headers:V,urlParameters:T,groupId:I,changeSetId:J,eTag:n}};K=_._addEntity(w({},Y));_.mChangedEntities[K]=Y;k=_._createRequestUrl(P,G,H,_.bUseBatch);R=_._createRequest(k,_.resolveDeep(P,G),$,V,Y,n);c1=_.getContext("/"+K);c1.bCreated=true;R.key=K;R.created=true;W=_.mRequests;if(I in _.mDeferredGroups){W=_.mDeferredRequests;}_.oMetadata.loaded().then(function(){_._pushToRequestQueue(W,I,J,R,S,E,a1,N);_._processRequestQueueAsync(_.mRequests);});return c1;}if(Z){this.oMetadata.loaded().then(function(){Z(b1());});}else if(this.oMetadata.isLoaded()){return b1();}else{L.error("Tried to use createEntry without created-callback, before metadata is available!");}};A.prototype._isCreatedEntity=function(E){return!!(E&&E.__metadata&&E.__metadata.created);};A.prototype._createPropertyValue=function(T){var j=this.oMetadata._splitName(T);var n=j.namespace;var k=j.name;if(n.toUpperCase()!=='EDM'){var E={};var G=this.oMetadata._getObjectMetadata("complexType",k,n);s(G,"Complex type "+T+" not found in the metadata !");for(var i=0;i<G.property.length;i++){var P=G.property[i];E[P.name]=this._createPropertyValue(P.type);}return E;}else{return this._getDefaultPropertyValue(k,n);}};A.prototype._getDefaultPropertyValue=function(T,n){return undefined;};A.prototype._normalizePath=function(P,i){if(P&&P.indexOf('?')!==-1){P=P.substr(0,P.indexOf('?'));}if(!i&&!P.startsWith("/")){L.fatal(this+" path "+P+" must be absolute if no Context is set");}return this.resolve(P,i,this.bCanonicalRequests)||this.resolve(P,i);};A.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange;};A.prototype.setRefreshAfterChange=function(R){this.bRefreshAfterChange=R;};A.prototype.isList=function(P,i){P=this.resolve(P,i);return P&&P.substr(P.lastIndexOf("/")).indexOf("(")===-1;};A.prototype._isMetadataPath=function(P){var i=false;if(P&&P.indexOf('/#')>-1){i=true;}return i;};A.prototype.isMetaModelPath=function(P){return P.indexOf("##")==0||P.indexOf("/##")>-1;};A.prototype._request=function(R,S,E,H,i,j){var k;if(this.bDestroyed){return{abort:function(){}};}var n=this;function G(I){return function(){if(n.aPendingRequestHandles){var J=n.aPendingRequestHandles.indexOf(k);if(J>-1){n.aPendingRequestHandles.splice(J,1);}}if(!(k&&k.bSuppressErrorHandlerCall)){I.apply(this,arguments);}};}k=r.request(R,G(S||r.defaultSuccess),G(E||r.defaultError),H,i,j);if(R.async!==false){this.aPendingRequestHandles.push(k);}return k;};A.prototype.destroy=function(){this.bDestroyed=true;M.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var i=this.aPendingRequestHandles.length-1;i>=0;i--){var R=this.aPendingRequestHandles[i];if(R&&R.abort){R.bSuppressErrorHandlerCall=true;R.abort();}}delete this.aPendingRequestHandles;}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent);}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent);}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata;}delete this.oMetadata;delete this.pMetadataLoaded;}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel;}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded;}};A.prototype.setDeferredBatchGroups=function(G){this.setDeferredGroups(G);};A.prototype.setDeferredGroups=function(G){var i=this;this.mDeferredGroups={};z(G,function(I,j){i.mDeferredGroups[j]=j;});};A.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups();};A.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups);};A.prototype.setChangeBatchGroups=function(G){z(G,function(E,i){i.groupId=i.batchGroupId;});this.setChangeGroups(G);};A.prototype.setChangeGroups=function(G){this.mChangeGroups=G;};A.prototype.getChangeBatchGroups=function(){return this.getChangeGroups();};A.prototype.getChangeGroups=function(){return this.mChangeGroups;};A.prototype.setMessageParser=function(P){if(!(P instanceof p)){L.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this;}P.setProcessor(this);this.oMessageParser=P;return this;};A.prototype._parseResponse=function(R,i,G,j){try{if(!this.oMessageParser){this.oMessageParser=new q(this.sServiceUrl,this.oMetadata);this.oMessageParser.setProcessor(this);}this.oMessageParser.parse(R,i,G,j);}catch(k){L.error("Error parsing OData messages: "+k);}};A.prototype.callAfterUpdate=function(i){this.aCallAfterUpdate.push(i);};A.prototype.getMetaModel=function(){var i=this;if(!this.oMetaModel){this.oMetaModel=new o(this.oMetadata,this.oAnnotations,{addAnnotationUrl:this.addAnnotationUrl.bind(this),annotationsLoadedPromise:this.pAnnotationsLoaded});this.oMetaModel.loaded().then(function(){i.bMetaModelLoaded=true;i.checkUpdate(false,false,null,true);},function(E){var j=E.message,k;if(!j&&E.xmlDoc&&E.xmlDoc.parseError){j=E.xmlDoc.parseError.reason;k=E.xmlDoc.parseError.srcText;}L.error("error in ODataMetaModel.loaded(): "+j,k,"sap.ui.model.odata.v2.ODataModel");});}return this.oMetaModel;};A.prototype.getOriginalProperty=function(P,i){return this._getObject(P,i,true);};A.prototype.getEntityByPath=function(P,i,E){var R=M.prototype.resolve.call(this,P,i);if(!R){return null;}var j=R.split("/"),k=null,n=[];while(j.length>0){var G=j.join("/"),H=this._getObject(G);if(y(H)){var K=this._getKey(H);if(K){k=H;break;}}n.unshift(j.pop());}if(k){E.propertyPath=n.join("/");E.key=K;return k;}return null;};A.prototype.resolveFromCache=function(P){if(!this.mPathCache){return undefined;}var S,E="",i,n,I;i=this.mPathCache[P]?this.mPathCache[P].canonicalPath:undefined;if(P&&i!==P){S=i||P;if(!i){I=S.lastIndexOf("/");E=S.substr(I);S=S.substr(0,I);}n=this.resolveFromCache(S);if(n&&n!==S){i=n+E;}}return i;};A.prototype.resolve=function(P,i,j){var R=M.prototype.resolve.call(this,P,i);if(R&&!this._isMetadataPath(R)&&j){var k=this.resolveFromCache(R);if(!k){k=this.oMetadata._calculateCanonicalPath(R);k=this.resolveFromCache(k)||k;}this._writePathCache(R,k);return k;}return R;};A.prototype.resolveDeep=function(P,i){var R=M.prototype.resolve.call(this,P,i);if(P&&!P.startsWith("/")){R=i?i.sDeepPath+'/'+P:R;}return R;};A.prototype.isLaundering=function(P,i){var R=this.resolve(P,i);return(R in this.mLaunderingState)&&this.mLaunderingState[R]>0;};A.prototype.increaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n];if(y(j)){this.increaseLaundering(P+"/"+n,j);}else{var T=P+"/"+n;if(!(T in this.mLaunderingState)){this.mLaunderingState[T]=0;}this.mLaunderingState[T]++;}}if(!(P in this.mLaunderingState)){this.mLaunderingState[P]=0;}this.mLaunderingState[P]++;};A.prototype.decreaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n],T=P+"/"+n;if(y(j)){this.decreaseLaundering(T,j);}else{if(T in this.mLaunderingState){this.mLaunderingState[T]--;if(this.mLaunderingState[T]===0){delete this.mLaunderingState[T];}}}}this.mLaunderingState[P]--;if(this.mLaunderingState[P]===0){delete this.mLaunderingState[P];}};A.prototype._getRefreshAfterChange=function(R,G){if(R===undefined&&!(G in this.mDeferredGroups)){return this.bRefreshAfterChange;}return R;};A.prototype.getMessagesByEntity=function(E,j){var k=E,n=[],P;function G(n){var H=[];for(var i=0;i<n.length;i++){if(!j||(j&&!n[i].persistent)){H.push(n[i]);}}return H;}if(!k.startsWith('/')){k='/'+k;}if(this.mMessages){for(P in this.mMessages){if(typeof k=="string"&&k.length>0&&P.startsWith(k)){n=n.concat(G(this.mMessages[P]));}}return n;}return null;};A.prototype._cacheSupported=function(i){var j=/\/~[\w\-]+~[A-Z0-9]?/;var k=[i];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}k=k.concat(this.sAnnotationURI);}k=k.filter(function(n){return n.indexOf("sap-context-token")===-1;});k=k.filter(function(n){return!j.test(n);});return k.length===0?true:false;};A.prototype._getAnnotationCacheKey=function(i){var j;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){j=i+"#annotations";}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}this.sAnnotationURI=this.sAnnotationURI.map(function(k){return k+"#annotations";});j=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):j+"_"+this.sAnnotationURI.join("_");}}return j;};A.prototype.canonicalRequestsEnabled=function(){return this.bCanonicalRequests;};return A;});
