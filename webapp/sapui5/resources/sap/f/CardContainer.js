/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/base/ManagedObjectObserver",'sap/ui/core/ResizeHandler',"sap/ui/core/delegate/ItemNavigation","sap/f/CardContainerRenderer","sap/ui/Device","sap/ui/layout/cssgrid/VirtualGrid"],function(C,M,R,I,a,D,V){"use strict";var b=5*16;var g=16;var E=16;function c(i){var l=i.getLayoutData();return l?l.getColumns():1;}function d(){return!D.browser.msie&&!(D.browser.edge&&D.browser.version<E);}var e=C.extend("sap.f.CardContainer",{metadata:{library:"sap.f",properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:""},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:""}},defaultAggregation:"items",aggregations:{items:{type:"sap.ui.core.Control",multiple:true,singularName:"item"}}}});e.prototype._onBeforeItemRendering=function(){var f=this.getParent(),r=f._resizeListeners[this.getId()];if(r){R.deregister(r);}delete f._resizeListeners[this.getId()];};e.prototype._onAfterItemRendering=function(){var f=this.getParent(),i=c(this);if(d()){this.$().parent().css({'grid-column':'span '+i});}else{var w=i*b+(i-1)*g;this.$().css({top:0,left:0,width:w,position:'absolute'});}f._resizeListeners[this.getId()]=R.register(this.getDomRef(),f._resizeHandler);f._setItemNavigationItems();f._applyLayout();};e.prototype._onItemChange=function(f){if(f.name!=="items"||!f.child){return;}if(f.mutation==="insert"){f.child.addEventDelegate(this._itemDelegate,f.child);}else if(f.mutation==="remove"){f.child.removeEventDelegate(this._itemDelegate,f.child);}};e.prototype._deregisterResizeListeners=function(){var k,i;for(k in this._resizeListeners){i=this._resizeListeners[k];R.deregister(i);}delete this._resizeListeners;};e.prototype._setItemNavigationItems=function(){if(!this._isRenderingFinished){return;}};e.prototype.init=function(){this._resizeListeners={};this._itemDelegate={onBeforeRendering:this._onBeforeItemRendering,onAfterRendering:this._onAfterItemRendering};this._itemsObserver=new M(this._onItemChange.bind(this));this._itemsObserver.observe(this,{aggregations:["items"]});this._resizeHandler=this._resize.bind(this);this._itemNavigation=new I().setCycling(false);this._itemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"]});this.addDelegate(this._itemNavigation);};e.prototype.onBeforeRendering=function(){var r=this._resizeListeners[this.getId()];if(r){R.deregister(r);}this._isRenderingFinished=false;};e.prototype.onAfterRendering=function(){this._resizeListeners[this.getId()]=R.register(this.getDomRef(),this._resizeHandler);this._isRenderingFinished=true;this._setItemNavigationItems();this._applyLayout();};e.prototype.exit=function(){this._deregisterResizeListeners();if(this._itemsObserver){this._itemsObserver.disconnect();delete this._itemsObserver;}if(this._itemNavigation){this.removeDelegate(this._itemNavigation);this._itemNavigation.destroy();delete this._itemNavigation;}};e.prototype._resize=function(){this._applyLayout();};e.prototype._applyLayout=function(){if(!this._isRenderingFinished){return;}if(d()){this.$().children().each(function(){var $=jQuery(this);var h=jQuery($.children()[0]).outerHeight();$.css({'grid-row':'span '+(Math.floor(h/(b+g))+1)});});}else{this._applyIEPolyfillLayout();}};e.prototype._applyIEPolyfillLayout=function(){var $=this.$(),w=$.innerWidth(),f=Math.floor((w-g)/(b+g)),t=parseInt($.css("padding-top").replace("px","")),l=parseInt($.css("padding-left").replace("px","")),h=this.getItems(),j=this.$().children();if(!h.length){return;}var v=new V();v.init({numberOfCols:Math.max(1,f),cellWidth:b,cellHeight:b,unitOfMeasure:"px",gapSize:g,topOffset:t?t:0,leftOffset:l?l:0});for(var i=0;i<h.length;i++){var k=h[i];var m=c(k);var n=jQuery(j.get(i));var o=jQuery(n.children().get(0)).outerHeight();var r=(Math.floor(o/(b+g))+1);v.fitElement(i+'',m,r);}v.calculatePositions();for(var i=0;i<h.length;i++){var k=v.getItems()[i];var n=jQuery(j.get(i));n.css({position:'absolute',top:k.top,left:k.left});}$.css("height",v.getHeight()+"px");};return e;});
