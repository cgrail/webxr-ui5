/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/f/cards/Data","sap/base/Log"],function(C,J,D,L){"use strict";var B=C.extend("sap.f.cards.BaseContent",{metadata:{properties:{configuration:{type:"object"}},aggregations:{_content:{multiple:false,visibility:"hidden"}}},constructor:function(i,s){if(typeof i!=="string"){s=i;}if(s&&s.serviceManager){this._oServiceManager=s.serviceManager;delete s.serviceManager;}C.apply(this,arguments);},renderer:function(r,c){var s="sapFCard";var l=c.getMetadata().getLibraryName();var n=c.getMetadata().getName();var t=n.slice(l.length+1,n.length);var h=B.getMinHeight(t,c.getConfiguration());s+=t;r.write("<div");r.writeElementData(c);r.addClass(s);r.addClass("sapFCardBaseContent");r.writeClasses();r.addStyle("min-height",h);r.writeStyles();r.write(">");r.renderControl(c.getAggregation("_content"));r.write("</div>");}});B.prototype.init=function(){var m=new J();this.setModel(m);};B.prototype.destroy=function(){this.setAggregation("_content",null);this.setModel(null);if(this._dataChangeHandler&&this._oDataService){this._oDataService.detachDataChanged(this._dataChangeHandler);this._dataChangeHandler=null;this._oDataService=null;}return C.prototype.destroy.apply(this,arguments);};B.prototype.setConfiguration=function(c){this.setProperty("configuration",c);if(!c){return this;}if(c.data){this._setData(c.data);}if(c.maxItems){this.getModel().setSizeLimit(c.maxItems);}return this;};B.prototype._setData=function(d){this.setBusy(true);var r=d.request;var s=d.service;this.bindElement({path:d.path||"/"});if(d.json&&!r){this._updateModel(d.json);this.setBusy(false);}if(s){this._oServiceManager.getService("sap.ui.integration.services.Data").then(function(o){if(o){this._dataChangeHandler=function(e){this._updateModel(e.data);}.bind(this);o.getData().then(function(a){this._updateModel(a);}.bind(this)).catch(function(){this._handleError("Card content data service failed to get data");}).finally(function(){this.setBusy(false);}.bind(this));o.attachDataChanged(this._dataChangeHandler,d.service.parameters);this._oDataService=o;}}.bind(this)).catch(function(){this._handleError("Data service unavailable");this.setBusy(false);});}else if(r){D.fetch(r).then(function(a){this._updateModel(a,d.path);}.bind(this)).catch(function(e){this._handleError("Card content data request failed");}).finally(function(){this.setBusy(false);}.bind(this));}};B.prototype._updateModel=function(d){this.getModel().setData(d);setTimeout(function(){this.fireEvent("_updated");}.bind(this),0);};B.prototype._handleError=function(l){this.fireEvent("_error",{logMessage:l});};B.getMinHeight=function(t,c){var M=5,h;if(jQuery.isEmptyObject(c)){return"0rem";}switch(t){case"ListContent":h=B._getMinListHeight(c);break;case"TableContent":h=B._getMinTableHeight(c);break;case"TimelineContent":h=B._getMinTimelineHeight(c);break;case"AnalyticalContent":h=14;break;case"ObjectContent":h=0;break;default:h=0;}return(h!==0?h:M)+"rem";};B._getMinListHeight=function(c){var i=c.maxItems||0,t=c.item,I=3;if(!t){return 0;}if(t.icon||t.description){I=4;}return i*I;};B._getMinTableHeight=function(c){var i=c.maxItems||0,r=3,t=3;return i*r+t;};B._getMinTimelineHeight=function(c){var i=c.maxItems||0,I=6;return i*I;};return B;});
